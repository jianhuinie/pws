!function($){function getListener(e,t,n){var i;return t=t.toLowerCase(),(i=e.__allListeners||n&&(e.__allListeners={}))&&(i[t]||n&&(i[t]=[]))}function getDomNode(e,t,n,i,o,r){var a,s=i&&e[t];for(!s&&(s=e[n]);!s&&(a=(a||e).parentNode);){if("BODY"==a.tagName||r&&!r(a))return null;s=a[n]}return s&&o&&!o(s)?getDomNode(s,t,n,!1,o):s}UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var dom=UM.dom={},browser=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};n.gecko="Gecko"==navigator.product&&!n.webkit&&!n.opera&&!n.ie;var i=0;if(n.ie){var o=e.match(/(?:msie\s([\w.]+))/),r=e.match(/(?:trident.*rv:([\w.]+))/);i=o&&r&&o[1]&&r[1]?Math.max(1*o[1],1*r[1]):o&&o[1]?1*o[1]:r&&r[1]?1*r[1]:0,n.ie11Compat=11==document.documentMode,n.ie9Compat=9==document.documentMode,n.ie8=!!document.documentMode,n.ie8Compat=8==document.documentMode,n.ie7Compat=7==i&&!document.documentMode||7==document.documentMode,n.ie6Compat=7>i||n.quirks,n.ie9above=i>8,n.ie9below=9>i}if(n.gecko){var a=e.match(/rv:([\d\.]+)/);a&&(a=a[1].split("."),i=1e4*a[0]+100*(a[1]||0)+1*(a[2]||0))}return/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(i=parseFloat(t.version())),n.webkit&&(i=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=i,n.isCompatible=!n.mobile&&(n.ie&&i>=6||n.gecko&&i>=10801||n.opera&&i>=9.5||n.air&&i>=1||n.webkit&&i>=522||!1),n}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UM.utils={each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i],i,e)===!1)return!1}else for(var r in e)if(e.hasOwnProperty(r)&&t.call(n,e[r],r,e)===!1)return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var i in t)n&&e.hasOwnProperty(i)||(e[i]=t[i]);return e},extend2:function(e){for(var t=arguments,n=1;n<t.length;n++){var i=t[n];for(var o in i)e.hasOwnProperty(o)||(e[o]=i[o])}return e},inherits:function(e,t){var n=e.prototype,i=utils.makeInstance(t.prototype);return utils.extend(i,n,!0),e.prototype=i,i.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var i;return function(){n&&clearTimeout(i),i=setTimeout(e,t)}},indexOf:function(e,t,n){var i=-1;return n=this.isNumber(n)?n:0,this.each(e,function(e,o){return o>=n&&e===t?(i=o,!1):void 0}),i},removeItem:function(e,t){for(var n=0,i=e.length;i>n;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t,n=0,i={};t=e[n++];)i[t.toUpperCase()]=i[t]=1;return i},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":void 0!=e.cssFloat?"cssFloat":void 0!=e.styleFloat?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function e(e,n){try{for(var i,o=0;i=t[o++];)if(i.doc===e&&i.url==(n.src||n.href))return i}catch(r){return null}}var t=[];return function(n,i,o){var r=e(n,i);if(r)return void(r.ready?o&&o():r.funs.push(o));if(t.push({doc:n,url:i.src||i.href,funs:[o]}),!n.body){var a=[];for(var s in i)"tag"!=s&&a.push(s+'="'+i[s]+'"');return void n.write("<"+i.tag+" "+a.join(" ")+" ></"+i.tag+">")}if(!i.id||!n.getElementById(i.id)){var l=n.createElement(i.tag);delete i.tag;for(var s in i)l.setAttribute(s,i[s]);l.onload=l.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(r=e(n,i),r.funs.length>0){r.ready=1;for(var t;t=r.funs.pop();)t()}l.onload=l.onreadystatechange=null}},l.onerror=function(){throw Error("The load "+(i.href||i.src)+" fails,check the url settings of file umeditor.config.js ")},n.getElementsByTagName("head")[0].appendChild(l)}}}(),isEmptyObject:function(e){if(null==e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(n.length>3)return"";t="#";for(var i,o=0;i=n[o++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=1==i.length?"0"+i:i;t=t.toUpperCase()}return t},clone:function(e,t){var n;t=t||{};for(var i in e)e.hasOwnProperty(i)&&(n=e[i],"object"==typeof n?(t[i]=utils.isArray(n)?[]:{},utils.clone(e[i],t[i])):t[i]=n);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;switch(e.replace(/([\d.]+)(\w+)/,function(n,i,o){e=i,t=o}),t){case"cm":e=25*parseFloat(e);break;case"pt":e=Math.round(96*parseFloat(e)/72)}return e+(e?"px":"")},cssRule:browser.ie&&11!=browser.version?function(e,t,n){var i,o;n=n||document,i=n.indexList?n.indexList:n.indexList={};var r;if(i[e])r=n.styleSheets[i[e]];else{if(void 0===t)return"";r=n.createStyleSheet("",o=n.styleSheets.length),i[e]=o}return void 0===t?r.cssText:void(r.cssText=t||"")}:function(e,t,n){n=n||document;var i,o=n.getElementsByTagName("head")[0];if(!(i=n.getElementById(e))){if(void 0===t)return"";i=n.createElement("style"),i.id=e,o.appendChild(i)}return void 0===t?i.innerHTML:void(""!==t?i.innerHTML=t:o.removeChild(i))}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var EventBase=UM.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(" ");for(var n,i=0;n=e[i++];)getListener(this,n,!0).push(t)},removeListener:function(e,t){e=utils.trim(e).split(" ");for(var n,i=0;n=e[i++];)utils.removeItem(getListener(this,n)||[],t)},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t,n=0;t=e[n++];){var i,o,r,a=getListener(this,t);if(a)for(r=a.length;r--;)if(a[r]){if(o=a[r].apply(this,arguments),o===!0)return o;void 0!==o&&(i=o)}(o=this["on"+t.toLowerCase()])&&(i=o.apply(this,arguments))}return i}};var dtd=dom.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=utils.extend2,n=e({isindex:1,fieldset:1}),i=e({input:1,button:1,select:1,textarea:1,label:1}),o=t(e({a:1}),i),r=t({iframe:1},o),a=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),s=e({ins:1,del:1,script:1,style:1}),l=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),s),d=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),l),c=t(e({p:1}),d),u=t(e({iframe:1}),d,i),f=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),h=t(e({a:0}),u),p=e({tr:1}),m=e({"#":1}),g=t(e({param:1}),f),v=t(e({form:1}),n,r,a,c),b=e({li:1,ol:1,ul:1}),y=e({style:1,script:1}),C=e({base:1,link:1,meta:1,title:1}),w=t(C,y),x=e({head:1,body:1}),N=e({html:1}),k=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),E=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(N,x,C),$block:k,$inline:h,$inlineWithA:t(e({a:1}),h),$body:t(e({script:1,style:1}),k),$cdata:e({script:1,style:1}),$empty:E,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:x,head:w,style:m,script:m,body:v,base:{},link:{},meta:{},title:m,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:v,td:v,br:{},th:v,center:v,kbd:h,button:t(c,a),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:b,h1:h,h3:h,option:m,h2:h,form:t(n,r,a,c),select:e({optgroup:1,option:1}),font:h,ins:h,menu:b,abbr:h,label:h,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:h,tfoot:p,cite:h,li:v,input:{},iframe:v,strong:h,textarea:m,noframes:v,big:h,small:h,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:h,dt:h,sub:h,optgroup:e({option:1}),param:{},bdo:h,"var":h,div:v,object:g,sup:h,dd:v,strike:h,area:{},dir:b,map:t(e({area:1,form:1,p:1}),n,s,a),applet:g,dl:e({dt:1,dd:1}),del:h,isindex:{},fieldset:t(e({legend:1}),f),thead:p,ul:b,acronym:h,b:h,a:t(e({a:1}),u),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),v),caption:h,i:h,u:h,tbody:p,s:h,address:t(r,c),tt:h,legend:h,q:h,pre:t(l,o),p:t(e({a:1}),h),em:h,dfn:h})}(),attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var n,i,o,r=e,a=e;do{for(r=r.parentNode,i?(n=r.cloneNode(!1),n.appendChild(i),i=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(i=r.cloneNode(!1),o=i.cloneNode(!1));n=a.previousSibling;)i.insertBefore(n,i.firstChild);for(;n=a.nextSibling;)o.appendChild(n);a=r}while(t!==r);return n=t.parentNode,n.insertBefore(i,t),n.insertBefore(o,t),n.insertBefore(e,o),domUtils.remove(t),e},trimWhiteTextNode:function(e){function t(t){for(var n;(n=e[t])&&3==n.nodeType&&domUtils.isWhitespace(n);)e.removeChild(n)}t("firstChild"),t("lastChild")},getPosition:function(e,t){if(e===t)return 0;var n,i=[e],o=[t];for(n=e;n=n.parentNode;){if(n===t)return 10;i.push(n)}for(n=t;n=n.parentNode;){if(n===e)return 20;o.push(n)}if(i.reverse(),o.reverse(),i[0]!==o[0])return 1;for(var r=-1;r++,i[r]===o[r];);for(e=i[r],t=o[r];e=e.nextSibling;)if(e===t)return 4;return 2},getNodeIndex:function(e,t){for(var n=e,i=0;n=n.previousSibling;)t&&3==n.nodeType?n.nodeType!=n.nextSibling.nodeType&&i++:i++;return i},inDoc:function(e,t){return 10==domUtils.getPosition(e,t)},findParent:function(e,t,n){if(e&&!domUtils.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e)||domUtils.isBody(e))return t&&!t(e)&&domUtils.isBody(e)?null:e;e=e.parentNode}return null},findParentByTagName:function(e,t,n,i){return t=utils.listToMap(utils.isArray(t)?t:[t]),domUtils.findParent(e,function(e){return t[e.tagName]&&!(i&&i(e))},n)},findParents:function(e,t,n,i){for(var o=t&&(n&&n(e)||!n)?[e]:[];e=domUtils.findParent(e,n);)o.push(e);return i?o:o.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n,i=e.parentNode;if(i){if(t&&e.hasChildNodes())for(;n=e.firstChild;)i.insertBefore(n,e);i.removeChild(e)}return e},getNextDomNode:function(e,t,n,i){return getDomNode(e,"firstChild","nextSibling",t,n,i)},getPreDomNode:function(e,t,n,i){return getDomNode(e,"lastChild","previousSibling",t,n,i)},isBookmarkNode:function(e){return 1==e.nodeType&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;for(var n=[e],i=[t],o=e,r=-1;o=o.parentNode;){if(o===t)return o;n.push(o)}for(o=t;o=o.parentNode;){if(o===e)return o;i.push(o)}for(n.reverse(),i.reverse();r++,n[r]===i[r];);return 0==r?null:n[r-1]},clearEmptySibling:function(e,t,n){function i(e,t){for(var n;e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!new RegExp("[^	\n\r"+domUtils.fillChar+"]").test(e.nodeValue));)n=e[t],domUtils.remove(e),e=n}!t&&i(e.nextSibling,"nextSibling"),!n&&i(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var i=n.createTextNode("");return domUtils.insertAfter(e,i)}var o=e.splitText(t);if(browser.ie8){var r=n.createTextNode("");domUtils.insertAfter(o,r),domUtils.remove(r)}return o},isWhitespace:function(e){return!new RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(e.nodeValue)},getXY:function(e){for(var t=0,n=0;e.offsetParent;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},isEmptyInlineElement:function(e){if(1!=e.nodeType||!dtd.$removeEmpty[e.tagName])return 0;for(e=e.firstChild;e;){if(domUtils.isBookmarkNode(e))return 0;if(1==e.nodeType&&!domUtils.isEmptyInlineElement(e)||3==e.nodeType&&!domUtils.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return 1==e.nodeType&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},getElementsByTagName:function(e,t,n){if(n&&utils.isString(n)){var i=n;n=function(e){var t=!1;return $.each(utils.trim(i).replace(/[ ]{2,}/g," ").split(" "),function(n,i){return $(e).hasClass(i)?(t=!0,!1):void 0}),t}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var o,r=[],a=0;o=t[a++];)for(var s,l=e.getElementsByTagName(o),d=0;s=l[d++];)(!n||n(s))&&r.push(s);return r},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t,n=0;t=e.all[n++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var n,i=0;n=t[i++];){switch(n=attrFix[n]||n){case"className":e[n]="";break;case"style":e.style.cssText="",!browser.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(n)}},createElement:function(e,t,n){return domUtils.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];switch(n){case"class":e.className=i;break;case"style":e.style.cssText=e.style.cssText+";"+i;break;case"innerHTML":e[n]=i;break;case"value":e.value=i;break;default:e.setAttribute(attrFix[n]||n,i)}}return e},getComputedStyle:function(e,t){return utils.transUnitToPx(utils.fixColor(t,$(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){browser.ie?("color"==t&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(utils.cssStyleToDomStyle(t)),e.style.cssText||domUtils.removeAttributes(e,["style"])},getStyle:function(e,t){var n=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,n)},setStyle:function(e,t,n){e.style[utils.cssStyleToDomStyle(t)]=n,utils.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t,n=0,i=e.getElementsByTagName("*");t=i[n++];)t.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,i=e.firstChild;for(t=t||function(){return 1};i;)t(i)&&n++,i=i.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||0==domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})},isBr:function(e){return 1==e.nodeType&&"BR"==e.tagName},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isEmptyBlock:function(e,t){if(1!=e.nodeType)return 0;if(t=t||new RegExp("[ 	\r\n"+domUtils.fillChar+"]","g"),e[browser.ie?"innerText":"textContent"].replace(t,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},isCustomeNode:function(e){return 1==e.nodeType&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var n=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},isBoundaryNode:function(e,t){for(var n;!domUtils.isBody(e);)if(n=e,e=e.parentNode,n!==e[t])return!1;return!0},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(new RegExp((t?"^":"")+domUtils.fillChar),"").length},isBody:function(e){return $(e).hasClass("edui-body-container")}},fillCharReg=new RegExp(domUtils.fillChar,"g");!function(){function e(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function t(e){return!e.collapsed&&1==e.startContainer.nodeType&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function n(t,n,i,o){return 1==n.nodeType&&(dtd.$empty[n.tagName]||dtd.$nonChild[n.tagName])&&(i=domUtils.getNodeIndex(n)+(t?0:1),n=n.parentNode),t?(o.startContainer=n,o.startOffset=i,o.endContainer||o.collapse(!0)):(o.endContainer=n,o.endOffset=i,o.startContainer||o.collapse(!1)),e(o),o}function i(e,t){try{if(a&&domUtils.inDoc(a,e))if(a.nodeValue.replace(fillCharReg,"").length)a.nodeValue=a.nodeValue.replace(fillCharReg,"");else{var n=a.parentNode;for(domUtils.remove(a);n&&domUtils.isEmptyInlineElement(n)&&(browser.safari?!(domUtils.getPosition(n,t)&domUtils.POSITION_CONTAINS):!n.contains(t));)a=n.parentNode,domUtils.remove(n),n=a}}catch(i){}}function o(e,t){var n;for(e=e[t];e&&domUtils.isFillChar(e);)n=e[t],domUtils.remove(e),e=n}function r(e,t){var n,i,o=e.startContainer,r=e.endContainer,a=e.startOffset,s=e.endOffset,l=e.document,d=l.createDocumentFragment();if(1==o.nodeType&&(o=o.childNodes[a]||(n=o.appendChild(l.createTextNode("")))),1==r.nodeType&&(r=r.childNodes[s]||(i=r.appendChild(l.createTextNode("")))),o===r&&3==o.nodeType)return d.appendChild(l.createTextNode(o.substringData(a,s-a))),t&&(o.deleteData(a,s-a),e.collapse(!0)),d;for(var c,u,f=d,h=domUtils.findParents(o,!0),p=domUtils.findParents(r,!0),m=0;h[m]==p[m];)m++;for(var g,v=m;g=h[v];v++){for(c=g.nextSibling,g==o?n||(3==e.startContainer.nodeType?(f.appendChild(l.createTextNode(o.nodeValue.slice(a))),t&&o.deleteData(a,o.nodeValue.length-a)):f.appendChild(t?o:o.cloneNode(!0))):(u=g.cloneNode(!1),f.appendChild(u));c&&c!==r&&c!==p[v];)g=c.nextSibling,f.appendChild(t?c:c.cloneNode(!0)),c=g;f=u}f=d,h[m]||(f.appendChild(h[m-1].cloneNode(!1)),f=f.firstChild);for(var b,v=m;b=p[v];v++){if(c=b.previousSibling,b==r?i||3!=e.endContainer.nodeType||(f.appendChild(l.createTextNode(r.substringData(0,s))),t&&r.deleteData(0,s)):(u=b.cloneNode(!1),f.appendChild(u)),v!=m||!h[m])for(;c&&c!==o;)b=c.previousSibling,f.insertBefore(t?c:c.cloneNode(!0),f.firstChild),c=b;f=u}return t&&e.setStartBefore(p[m]?h[m]?p[m]:h[m-1]:p[m-1]).collapse(!0),n&&domUtils.remove(n),i&&domUtils.remove(i),d}var a,s=0,l=domUtils.fillChar,d=dom.Range=function(e,t){var n=this;n.startContainer=n.startOffset=n.endContainer=n.endOffset=null,n.document=e,n.collapsed=!0,n.body=t};d.prototype={deleteContents:function(){var e;return this.collapsed||r(this,1),browser.webkit&&(e=this.startContainer,3!=e.nodeType||e.nodeValue.length||(this.setStartBefore(e).collapse(!0),domUtils.remove(e))),this},inFillChar:function(){var e=this.startContainer;return this.collapsed&&3==e.nodeType&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length?!0:!1},setStart:function(e,t){return n(!0,e,t,this)},setEnd:function(e,t){return n(!1,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return new d(e.document).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;return e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=!0,t},shrinkBoundary:function(e){function t(e){return 1==e.nodeType&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}for(var n,i=this,o=i.collapsed;1==i.startContainer.nodeType&&(n=i.startContainer.childNodes[i.startOffset])&&t(n);)i.setStart(n,0);if(o)return i.collapse(!0);if(!e)for(;1==i.endContainer.nodeType&&i.endOffset>0&&(n=i.endContainer.childNodes[i.endOffset-1])&&t(n);)i.setEnd(n,n.childNodes.length);return i},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,n=this.startOffset,i=this.collapsed,o=this.endContainer;if(3==t.nodeType){if(0==n)this.setStartBefore(t);else if(n>=t.nodeValue.length)this.setStartAfter(t);else{var r=domUtils.split(t,n);t===o?this.setEnd(r,this.endOffset-n):t.parentNode===o&&(this.endOffset+=1),this.setStartBefore(r)}if(i)return this.collapse(!0)}return e||(n=this.endOffset,o=this.endContainer,3==o.nodeType&&(0==n?this.setEndBefore(o):(n<o.nodeValue.length&&domUtils.split(o,n),this.setEndAfter(o)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],i=e[t+"Offset"];3==n.nodeType&&(i?i>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}return(e||!this.collapsed)&&(t(this,"start"),t(this,"end")),this},insertNode:function(e){var t=e,n=1;11==e.nodeType&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var i=this.startContainer,o=this.startOffset,r=i.childNodes[o];return r?i.insertBefore(e,r):i.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset=this.endOffset+n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var n,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(t?"":s++),this.collapsed||(n=i.cloneNode(!0),n.id="_baidu_bookmark_end_"+(t?"":s++)),this.insertNode(i),n&&this.collapse().insertNode(n).setEndBefore(n),this.setStartAfter(i),{start:e?i.id:i,end:n?e?n.id:n:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,n=e.end&&e.id?this.document.getElementById(e.end):e.end;return this.setStartBefore(t),domUtils.remove(t),n?(this.setEndBefore(n),domUtils.remove(n)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e;if(!this.collapsed){var n=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(t(n)){var i=n.startContainer.childNodes[n.startOffset];i&&1==i.nodeType&&(dtd.$empty[i.tagName]||dtd.$nonChild[i.tagName])&&(e=i)}}return e},select:browser.ie?function(e,t){var n;this.collapsed||this.shrinkBoundary();var r=this.getClosedNode();if(r&&!t){try{n=this.document.body.createControlRange(),n.addElement(r),n.select()}catch(s){}return this}var d,c=this.createBookmark(),u=c.start;if(n=this.document.body.createTextRange(),n.moveToElementText(u),n.moveStart("character",1),this.collapsed){if(!e&&3!=this.startContainer.nodeType){var f=this.document.createTextNode(l),h=this.document.createElement("span");h.appendChild(this.document.createTextNode(l)),u.parentNode.insertBefore(h,u),u.parentNode.insertBefore(f,u),i(this.document,f),a=f,o(h,"previousSibling"),o(u,"nextSibling"),n.moveStart("character",-1),n.collapse(!0)}}else{var p=this.document.body.createTextRange();d=c.end,p.moveToElementText(d),n.setEndPoint("EndToEnd",p)}this.moveToBookmark(c),h&&domUtils.remove(h);try{n.select()}catch(s){}return this}:function(e){function t(e){function t(t,n,i){3==t.nodeType&&t.nodeValue.length<n&&(e[i+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var n,r=domUtils.getWindow(this.document),s=r.getSelection();if(browser.gecko?this.body.focus():r.focus(),s){if(s.removeAllRanges(),this.collapsed&&!e){var d=this.startContainer,c=d;1==d.nodeType&&(c=d.childNodes[this.startOffset]),3==d.nodeType&&this.startOffset||(c?c.previousSibling&&3==c.previousSibling.nodeType:d.lastChild&&3==d.lastChild.nodeType)||(n=this.document.createTextNode(l),this.insertNode(n),i(this.document,n),o(n,"previousSibling"),o(n,"nextSibling"),a=n,this.setStart(n,browser.webkit?1:0).collapse(!0))}var u=this.document.createRange();if(this.collapsed&&browser.opera&&1==this.startContainer.nodeType){var c=this.startContainer.childNodes[this.startOffset];if(c){for(;c&&domUtils.isBlockElm(c)&&1==c.nodeType&&c.childNodes[0];)c=c.childNodes[0];c&&this.setStartBefore(c).collapse(!0)}else c=this.startContainer.lastChild,c&&domUtils.isBr(c)&&this.setStartBefore(c).collapse(!0)}t(this),u.setStart(this.startContainer,this.startOffset),u.setEnd(this.endContainer,this.endOffset),s.addRange(u)}return this},createAddress:function(e,t){function n(e){for(var n,i=e?o.startContainer:o.endContainer,r=domUtils.findParents(i,!0,function(e){return!domUtils.isBody(e)}),a=[],s=0;n=r[s++];)a.push(domUtils.getNodeIndex(n,t));var l=0;if(t)if(3==i.nodeType){for(var d=i.previousSibling;d&&3==d.nodeType;)l+=d.nodeValue.replace(fillCharReg,"").length,d=d.previousSibling;l+=e?o.startOffset:o.endOffset}else if(i=i.childNodes[e?o.startOffset:o.endOffset])l=domUtils.getNodeIndex(i,t);else{i=e?o.startContainer:o.endContainer;for(var c=i.firstChild;c;)if(domUtils.isFillChar(c))c=c.nextSibling;else if(l++,3==c.nodeType)for(;c&&3==c.nodeType;)c=c.nextSibling;else c=c.nextSibling}else l=e?domUtils.isFillChar(i)?0:o.startOffset:o.endOffset;return 0>l&&(l=0),a.push(l),a}var i={},o=this;return i.startAddress=n(!0),e||(i.endAddress=o.collapsed?[].concat(i.startAddress):n()),i},moveToAddress:function(e,t){function n(e,t){for(var n,o,r,a=i.body,s=0,l=e.length;l>s;s++)if(r=e[s],n=a,a=a.childNodes[r],!a){o=r;break}t?a?i.setStartBefore(a):i.setStart(n,o):a?i.setEndBefore(a):i.setEnd(n,o)}var i=this;return n(e.startAddress,!0),!t&&e.endAddress&&n(e.endAddress),i},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=$(window).scrollTop(),n=$(window).height(),i=e.offset().top;(t-n>i||i>t+n)&&(i>t+n?window.scrollTo(0,i-n+e.height()):window.scrollTo(0,t-i)),e.remove()},getOffset:function(){var e=this.createBookmark(),t=$(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}}}(),function(){function e(e,t){var n=domUtils.getNodeIndex;e=e.duplicate(),e.collapse(t);var i=e.parentElement();if(!i.hasChildNodes())return{container:i,offset:0};for(var o,r,a=i.children,s=e.duplicate(),l=0,d=a.length-1,c=-1;d>=l;){c=Math.floor((l+d)/2),o=a[c],s.moveToElementText(o);var u=s.compareEndPoints("StartToStart",e);if(u>0)d=c-1;else{if(!(0>u))return{container:i,offset:n(o)};l=c+1}}if(-1==c){if(s.moveToElementText(i),s.setEndPoint("StartToStart",e),r=s.text.replace(/(\r\n|\r)/g,"\n").length,a=i.childNodes,!r)return o=a[a.length-1],{container:o,offset:o.nodeValue.length};for(var f=a.length;r>0;)r-=a[--f].nodeValue.length;return{container:a[f],offset:-r}}if(s.collapse(u>0),s.setEndPoint(u>0?"StartToStart":"EndToStart",e),r=s.text.replace(/(\r\n|\r)/g,"\n").length,!r)return dtd.$empty[o.tagName]||dtd.$nonChild[o.tagName]?{container:i,offset:n(o)+(u>0?0:1)}:{container:o,offset:u>0?0:o.childNodes.length};for(;r>0;)try{var h=o;o=o[u>0?"previousSibling":"nextSibling"],r-=o.nodeValue.length}catch(p){return{container:i,offset:n(h)}}return{container:o,offset:u>0?-r:o.nodeValue.length+r}}function t(t,n){if(t.item)n.selectNode(t.item(0));else{var i=e(t,!0);n.setStart(i.container,i.offset),0!=t.compareEndPoints("StartToEnd",t)&&(i=e(t,!1),n.setEnd(i.container,i.offset))}return n}function n(e,t){var n;try{n=e.getNative(t).createRange()}catch(i){return null}var o=n.item?n.item(0):n.parentElement();return(o.ownerDocument||o)===e.document?n:null}var i=dom.Selection=function(e,t){var i=this;i.document=e,i.body=t,browser.ie9below&&$(t).on("beforedeactivate",function(){i._bakIERange=i.getIERange()}).on("activate",function(){try{var e=n(i);e&&i.rangeInBody(e)||!i._bakIERange||i._bakIERange.select()}catch(t){}i._bakIERange=null})};i.prototype={hasNativeRange:function(){var e;if(!browser.ie||browser.ie9above){var t=this.getNative();if(!t.rangeCount)return!1;e=t.getRangeAt(0)}else e=n(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?browser.ie9below||e?t.selection:domUtils.getWindow(t).getSelection():null}catch(n){return null}},getIERange:function(e){var t=n(this,e);return t&&this.rangeInBody(t,e)||!this._bakIERange?t:this._bakIERange},rangeInBody:function(e,t){var n=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return n===this.body||domUtils.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?domUtils.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange();

},getRange:function(){function e(e){for(var t=n.body.firstChild,i=e.collapsed;t&&t.firstChild;)e.setStart(t,0),t=t.firstChild;e.startContainer||e.setStart(n.body,0),i&&e.collapse(!0)}var n=this;if(null!=n._cachedRange)return this._cachedRange;var i=new dom.Range(n.document,n.body);if(browser.ie9below){var o=n.getIERange();if(o&&this.rangeInBody(o))try{t(o,i)}catch(r){e(i)}else e(i)}else{var a=n.getNative();if(a&&a.rangeCount&&n.rangeInBody(a.getRangeAt(0))){var s=a.getRangeAt(0),l=a.getRangeAt(a.rangeCount-1);i.setStart(s.startContainer,s.startOffset).setEnd(l.endContainer,l.endOffset),i.collapsed&&domUtils.isBody(i.startContainer)&&!i.startOffset&&e(i)}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(i)}}return this._bakRange=i},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e,t,n,i,o=browser.ie9below?this.getIERange():this.getRange();if(browser.ie9below){if(!o)return this.document.body.firstChild;if(o.item)return o.item(0);for(e=o.duplicate(),e.text.length>0&&e.moveStart("character",1),e.collapse(1),t=e.parentElement(),i=n=o.parentElement();n=n.parentNode;)if(n==t){t=i;break}}else if(t=o.startContainer,1==t.nodeType&&t.hasChildNodes()&&(t=t.childNodes[Math.min(t.childNodes.length-1,o.startOffset)]),3==t.nodeType)return t.parentNode;return t},getText:function(){var e,t;return this.isFocus()&&(e=this.getNative())?(t=browser.ie9below?e.createRange():e.getRangeAt(0),browser.ie9below?t.text:t.toString()):""}}}(),function(){function e(e,t){var n;if(t.textarea)if(utils.isString(t.textarea)){for(var i,o=0,r=domUtils.getElementsByTagName(e,"textarea");i=r[o++];)if(i.id=="umeditor_textarea_"+t.options.textarea){n=i;break}}else n=t.textarea;n||(e.appendChild(n=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=n),n.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function t(e){for(var t in UM.plugins)-1==e.options.excludePlugins.indexOf(t)&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function n(e){for(var t in e)return t}var i,o=0,r=UM.Editor=function(e){var i=this;i.uid=o++,EventBase.call(i),i.commands={},i.options=utils.extend(utils.clone(e||{}),UMEDITOR_CONFIG,!0),i.shortcutkeys={},i.inputRules=[],i.outputRules=[],i.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:i.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:i.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),i.plugins={},utils.isEmptyObject(UM.I18N)?utils.loadFile(document,{src:i.options.langPath+i.options.lang+"/"+i.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){t(i)}):(i.options.lang=n(UM.I18N),t(i))};r.prototype={ready:function(e){var t=this;e&&(t.isReady?e.apply(t):t.addListener("ready",e))},setOpt:function(e,t){var n={};utils.isString(e)?n[e]=t:n=e,utils.extend(this.options,n,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;t===document.body&&(t=e.container);var n=e.textarea;n?n.style.display="":(n=document.createElement("textarea"),t.parentNode.insertBefore(n,t)),n.style.width=e.body.offsetWidth+"px",n.style.height=e.body.offsetHeight+"px",n.value=e.getContent(),n.id=e.key,t.contains(n)&&$(n).insertBefore(t),t.innerHTML="",domUtils.remove(t),UM.clearCache(e.id);for(var i in e)e.hasOwnProperty(i)&&delete this[i]},initialCont:function(e){if(e){if(e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name")),e&&/script|textarea/gi.test(e.tagName)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),e=t,e.innerHTML=""}return e}return null},render:function(e){var t=this,n=t.options,i=function(t){return parseInt($(e).css(t))};if(utils.isString(e)&&(e=document.getElementById(e)),e){this.id=e.getAttribute("id"),UM.setEditor(this),utils.cssRule("edui-style-body",t.options.initialStyle,document),e=this.initialCont(e),e.className+=" edui-body-container",n.minFrameWidth=n.initialFrameWidth?n.initialFrameWidth:n.initialFrameWidth=$(e).width()||UM.defaultWidth,n.initialFrameHeight?n.minFrameHeight=n.initialFrameHeight:n.initialFrameHeight=n.minFrameHeight=$(e).height()||UM.defaultHeight,e.style.width=/%$/.test(n.initialFrameWidth)?"100%":n.initialFrameWidth-i("padding-left")-i("padding-right")+"px";var o=/%$/.test(n.initialFrameHeight)?"100%":n.initialFrameHeight-i("padding-top")-i("padding-bottom");this.options.autoHeightEnabled?(e.style.minHeight=o+"px",e.style.height="",browser.ie&&browser.version<=6&&(e.style.height=o,e.style.setExpression("height","this.scrollHeight <= "+o+' ? "'+o+'px" : "auto"'))):$(e).height(o),e.style.zIndex=n.zIndex,this._setup(e)}},_setup:function(t){var n=this,i=n.options;t.contentEditable=!0,document.body.spellcheck=!1,n.document=document,n.window=document.defaultView||document.parentWindow,n.body=t,n.$body=$(t),n.selection=new dom.Selection(document,n.body),n._isEnabled=!1;var o;browser.gecko&&(o=this.selection.getNative())&&o.removeAllRanges(),this._initEvents();for(var r=t.parentNode;r&&!domUtils.isBody(r);r=r.parentNode)if("FORM"==r.tagName){n.form=r,n.options.autoSyncData?$(t).on("blur",function(){e(r,n)}):$(r).on("submit",function(){e(this,n)});break}if(i.initialContent)if(i.autoClearinitialContent){var a=n.execCommand;n.execCommand=function(){return n.fireEvent("firstBeforeExecCommand"),a.apply(n,arguments)},this._setDefaultContent(i.initialContent)}else this.setContent(i.initialContent,!1,!0);domUtils.isEmptyNode(n.body)&&(n.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),i.focus&&setTimeout(function(){n.focus(n.options.focusInEnd),!n.options.autoClearinitialContent&&n._selectionChange()},0),n.container||(n.container=t.parentNode),n._bindshortcutKeys(),n.isReady=1,n.fireEvent("ready"),i.onready&&i.onready.call(n),(!browser.ie||browser.ie9above)&&$(n.body).on("blur focus",function(e){var t=n.selection.getNative();if("blur"==e.type)t.rangeCount>0&&(n._bakRange=t.getRangeAt(0));else{try{n._bakRange&&t.addRange(n._bakRange)}catch(e){}n._bakRange=null}}),!i.isShow&&n.setHide(),i.readonly&&n.setDisabled()},sync:function(t){var n=this,i=t?document.getElementById(t):domUtils.findParent(n.body.parentNode,function(e){return"FORM"==e.tagName},!0);i&&e(i,n)},setHeight:function(e,t){!t&&(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?($(this.body).css({"min-height":e+"px"}),browser.ie&&browser.version<=6&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):$(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),$(this.body).width(e-1*$(this.body).css("padding-left").replace("px","")-1*$(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(e,t){var n={};t?n[e]=t:n=e,utils.extend(this.shortcutkeys,n)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(n,i){var o=i.keyCode||i.which;for(var r in t)for(var a,s=t[r].split(","),l=0;a=s[l++];){a=a.split(":");var d=a[0],c=a[1];(/^(ctrl)(\+shift)?\+(\d+)$/.test(d.toLowerCase())||/^(\d+)$/.test(d))&&(("ctrl"==RegExp.$1?i.ctrlKey||i.metaKey:0)&&(""!=RegExp.$2?i[RegExp.$2.slice(1)+"Key"]:1)&&o==RegExp.$3||o==RegExp.$1)&&(-1!=e.queryCommandState(r,c)&&e.execCommand(r,c),domUtils.preventDefault(i))}})},getContent:function(e,t,n,i,o){var r=this;if(e&&utils.isFunction(e)&&(t=e,e=""),t?!t():!this.hasContents())return"";r.fireEvent("beforegetcontent");var a=UM.htmlparser(r.body.innerHTML,i);return r.filterOutputRule(a),r.fireEvent("aftergetcontent",a),a.toHtml(o)},getAllHtml:function(){var e=this,t=[];if(e.fireEvent("getAllHtml",t),browser.ie&&browser.version>8){var n="";utils.each(e.document.styleSheets,function(e){n+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),utils.each(e.document.getElementsByTagName("script"),function(e){n+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(n||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return dtd.$block[n]?"\n":t?t:""}),t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(t,n,i){function o(e){return"DIV"==e.tagName&&e.getAttribute("cdata_tag")}var r=this;r.fireEvent("beforesetcontent",t);var a=UM.htmlparser(t);if(r.filterInputRule(a),t=a.toHtml(),r.body.innerHTML=(n?r.body.innerHTML:"")+t,"p"==r.options.enterTag){var s,l=this.body.firstChild;if(!l||1==l.nodeType&&(dtd.$cdata[l.tagName]||o(l)||domUtils.isCustomeNode(l))&&l===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var d=r.document.createElement("p");l;){for(;l&&(3==l.nodeType||1==l.nodeType&&dtd.p[l.tagName]&&!dtd.$cdata[l.tagName]);)s=l.nextSibling,d.appendChild(l),l=s;if(d.firstChild){if(!l){r.body.appendChild(d);break}l.parentNode.insertBefore(d,l),d=r.document.createElement("p")}l=l.nextSibling}}r.fireEvent("aftersetcontent"),r.fireEvent("contentchange"),!i&&r._selectionChange(),r._bakRange=r._bakIERange=r._bakNativeRange=null;var c;browser.gecko&&(c=this.selection.getNative())&&c.removeAllRanges(),r.options.autoSyncData&&r.form&&e(r.form,r)},focus:function(e){try{var t=this,n=t.selection.getRange();e?n.setStartAtLast(t.body.lastChild).setCursor(!1,!0):n.select(!0),this.fireEvent("focus")}catch(i){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return this.fireEvent("isfocus")===!0?!0:this.selection.isFocus()},_initEvents:function(){var e=this,t=e.body,n=function(){e._proxyDomEvent.apply(e,arguments)};$(t).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",n).on("focus blur",n).on("mouseup keydown",function(t){"keydown"==t.type&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||2!=t.button&&e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,t){var n,o,r=this,a=!1;if(browser.ie&&browser.version<9&&t&&"mouseup"==t.type){var s=this.selection.getRange();s.collapsed||(a=!0,n=t.clientX,o=t.clientY)}clearTimeout(i),i=setTimeout(function(){if(r.selection.getNative()){var e;if(a&&"None"==r.selection.getNative().type){e=r.document.body.createTextRange();try{e.moveToPoint(n,o)}catch(i){e=null}}var s;e&&(s=r.selection.getIERange,r.selection.getIERange=function(){return e}),r.selection.cache(),s&&(r.selection.getIERange=s),r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!t),r.fireEvent("afterselectionchange"),r.selection.clear())}},e||50)},_callCmdFn:function(e,t){t=Array.prototype.slice.call(t,0);var n,i,o=t.shift().toLowerCase();return n=this.commands[o]||UM.commands[o],i=n&&n[e],n&&i||"queryCommandState"!=e?i?i.apply(this,[o].concat(t)):void 0:0},execCommand:function(e){if(!this.isFocus()){var t=this.selection._bakRange;t?t.select():this.focus(!0)}e=e.toLowerCase();var n,i=this,o=i.commands[e]||UM.commands[e];return o&&o.execCommand?(o.notNeedUndo||i.__hasEnterExecCommand?(n=this._callCmdFn("execCommand",arguments),!i.__hasEnterExecCommand&&!o.ignoreContentChange&&!i._ignoreContentChange&&i.fireEvent("contentchange")):(i.__hasEnterExecCommand=!0,-1!=i.queryCommandState.apply(i,arguments)&&(i.fireEvent("saveScene"),i.fireEvent("beforeexeccommand",e),n=this._callCmdFn("execCommand",arguments),!o.ignoreContentChange&&!i._ignoreContentChange&&i.fireEvent("contentchange"),i.fireEvent("afterexeccommand",e),i.fireEvent("saveScene")),i.__hasEnterExecCommand=!1),!i.__hasEnterExecCommand&&!o.ignoreContentChange&&!i._ignoreContentChange&&i._selectionChange(),n):null},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(e){if(e)for(var t,n=0;t=e[n++];)if(this.body.getElementsByTagName(t).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(e=["div"],n=0;t=e[n++];)for(var i,o=domUtils.getElementsByTagName(this.body,t),r=0;i=o[r++];)if(domUtils.isCustomeNode(i))return!0;return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var e,t=this;if(t.body.contentEditable=!0,t.lastBk){e=t.selection.getRange();try{e.moveToBookmark(t.lastBk),delete t.lastBk}catch(n){e.setStartAtFirst(t.body).collapse(!0)}e.select(!0)}t.bkqueryCommandState&&(t.queryCommandState=t.bkqueryCommandState,delete t.bkqueryCommandState),t._bkproxyDomEvent&&(t._proxyDomEvent=t._bkproxyDomEvent,delete t._bkproxyDomEvent),t.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var n=this;n.body.contentEditable=!1,n._except=e?utils.isArray(e)?e:[e]:[],n.lastBk||(n.lastBk=n.selection.getRange().createBookmark(!0)),n.bkqueryCommandState||(n.bkqueryCommandState=n.queryCommandState,n.queryCommandState=function(e){return-1!=utils.indexOf(n._except,e)?n.bkqueryCommandState.apply(n,arguments):-1}),t||n._bkproxyDomEvent||(n._bkproxyDomEvent=n._proxyDomEvent,n._proxyDomEvent=function(){return!1}),n.fireEvent("selectionchange"),n.fireEvent("setDisabled",n._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){var n=this;n.body.innerHTML='<p id="initContent">'+t+"</p>",n.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this,t=e.selection.getRange();if("none"==e.container.style.display){try{t.moveToBookmark(e.lastBk),delete e.lastBk}catch(n){t.setStartAtFirst(e.body).collapse(!0)}setTimeout(function(){t.select(!0)},100),e.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;e.lastBk||(e.lastBk=e.selection.getRange().createBookmark(!0)),e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n,i=0;(n=e[i++])&&(t=t[n],t););return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]),n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var i,o=0;i=t[o++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var n,i=0;n=this.inputRules[i++];)t&&n.ignoreUndo||n.call(this,e)},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var n,i=0;n=this.outputRules[i++];)t&&n.ignoreUndo||n.call(this,e)}},utils.inherits(r,EventBase)}();var filterWord=UM.filterWord=function(){function e(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)}function t(e){return e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)})}function n(e){return e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera)return"";try{if(/Bitmap/i.test(e))return"";var n=e.match(/width:([ \d.]*p[tx])/i)[1],i=e.match(/height:([ \d.]*p[tx])/i)[1],o=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+t(n)+'" height="'+t(i)+'" src="'+o+'" />'}catch(r){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,n,i){return"class"==t&&"MsoListParagraph"==i?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,n,i,o){for(var r,a=[],s=o.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),l=0;r=s[l];l++){var d,c,u=r.split(":");if(2==u.length){if(d=u[0].toLowerCase(),c=u[1].toLowerCase(),/^(background)\w*/.test(d)&&0==c.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(d)&&/^0\w+$/.test(c))continue;switch(d){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(n)||(a[l]=d.replace(/^mso-|-alt$/g,"")+":"+t(c));continue;case"horiz-align":a[l]="text-align:"+c;continue;case"vert-align":a[l]="vertical-align:"+c;continue;case"font-color":case"mso-foreground":a[l]="color:"+c;continue;case"mso-background":case"mso-highlight":a[l]="background:"+c;continue;case"mso-default-height":a[l]="min-height:"+t(c);continue;case"mso-default-width":a[l]="min-width:"+t(c);continue;case"mso-padding-between-alt":a[l]="border-collapse:separate;border-spacing:"+t(c);continue;case"text-line-through":("single"==c||"double"==c)&&(a[l]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==c&&(a[l]="display:none");continue;case"margin":if(!/[1-9]/.test(c))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(d)||/text\-indent|padding|margin/.test(d)&&/\-[\d.]+/.test(c))continue;a[l]=d+":"+u[1]}}return n+(a.length?' style="'+a.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)})}return function(t){return e(t)?n(t):t}}();!function(){function e(e,t,n){return e.push(h),t+(n?1:-1)}function t(e,t){for(var n=0;t>n;n++)e.push(f)}function n(a,s,l,d){switch(a.type){case"root":for(var c,u=0;c=a.children[u++];)l&&"element"==c.type&&!dtd.$inlineWithA[c.tagName]&&u>1&&(e(s,d,!0),t(s,d)),n(c,s,l,d);break;case"text":i(a,s);break;case"element":o(a,s,l,d);break;case"comment":r(a,s,l)}return s}function i(e,t){t.push("pre"==e.parentNode.tagName?e.data:u[e.parentNode.tagName]?utils.html(e.data):e.data.replace(/[ ]{2}/g," &nbsp;"))}function o(i,o,r,a){var s="";if(i.attrs){s=[];var l=i.attrs;for(var d in l)s.push(d+(void 0!==l[d]?'="'+(c[d]?utils.html(l[d]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(l[d]))+'"':""));s=s.join(" ")}if(o.push("<"+i.tagName+(s?" "+s:"")+(dtd.$empty[i.tagName]?"/":"")+">"),r&&!dtd.$inlineWithA[i.tagName]&&"pre"!=i.tagName&&i.children&&i.children.length&&(a=e(o,a,!0),t(o,a)),i.children&&i.children.length)for(var u,f=0;u=i.children[f++];)r&&"element"==u.type&&!dtd.$inlineWithA[u.tagName]&&f>1&&(e(o,a),t(o,a)),n(u,o,r,a);dtd.$empty[i.tagName]||(r&&!dtd.$inlineWithA[i.tagName]&&"pre"!=i.tagName&&i.children&&i.children.length&&(a=e(o,a),t(o,a)),o.push("</"+i.tagName+">"))}function r(e,t){t.push("<!--"+e.data+"-->")}function a(e,t){var n;if("element"==e.type&&e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var i,o=0;i=e.children[o++];)if(n=a(i,t))return n}function s(e,t,n){if("element"==e.type&&e.tagName==t&&n.push(e),e.children&&e.children.length)for(var i,o=0;i=e.children[o++];)s(i,t,n)}function l(e,t){if(e.children&&e.children.length)for(var n,i=0;n=e.children[i];)l(n,t),n.parentNode&&(n.children&&n.children.length&&t(n),n.parentNode&&i++);else t(e)}var d=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},c={href:1,src:1,_src:1,_href:1,cdata_data:1},u={style:1,script:1},f="    ",h="\n";d.createElement=function(e){return/[<>]/.test(e)?UM.htmlparser(e).children[0]:new d({type:"element",children:[],tagName:e})},d.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:utils.unhtml(e||"")})},d.prototype={toHtml:function(e){var t=[];return n(this,t,e,0),t.join("")},innerHTML:function(e){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(utils.isString(e)){if(this.children)for(var t,n=0;t=this.children[n++];)t.parentNode=null;this.children=[];for(var t,i=UM.htmlparser(e),n=0;t=i.children[n++];)this.children.push(t),t.parentNode=this;return this}var i=new UM.uNode({type:"root",children:this.children});return i.toHtml()},innerText:function(e,t){if("element"!=this.type||dtd.$empty[this.tagName])return this;if(e){if(this.children)for(var n,i=0;n=this.children[i++];)n.parentNode=null;return this.children=[],this.appendChild(d.createText(e,t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return 0==n?null:t.children[n-1]},nextSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n++];)if(e===this)return t.children[n]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if("root"==this.type||"element"==this.type&&!dtd.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t,n=0;t=this.children[n];n++)if(t===e){this.children.splice(n,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n,i=0;n=this.children[i];i++)if(n===e){if(this.children.splice(i,1),n.parentNode=null,t&&n.children&&n.children.length)for(var o,r=0;o=n.children[r];r++)this.children.splice(i+r,0,o),o.parentNode=this;return n}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e)return void delete this.attrs;if(this.attrs||(this.attrs={}),utils.isObject(e))for(var n in e)e[n]?this.attrs[n.toLowerCase()]=e[n]:delete this.attrs[n];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e]},hasAttr:function(e){var t=this.getAttr(e);return null!==t&&void 0!==t},getIndex:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return n;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n,i=0;n=this.children[i++];)if(t=a(n,e))return t},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],n=this;return utils.each(e,function(e){if(n.children&&n.children.length)for(var i,o=0;i=n.children[o++];)s(i,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");if(!t)return"";var n=new RegExp("(^|;)\\s*"+e+":([^;]+)","i"),i=t.match(n);return i&&i[0]?i[2]:""},setStyle:function(e,t){function n(e,t){var n=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");i=i.replace(n,"$1"),t&&(i=e+":"+utils.unhtml(t)+";"+i)}var i=this.getAttr("style");if(i||(i=""),utils.isObject(e))for(var o in e)n(o,e[o]);else n(e,t);this.setAttr("style",utils.trim(i))},hasClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),n=!1;return $.each(t,function(t,i){i===e&&(n=!0)}),n}return!1},addClass:function(e){var t=null,n=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){return t===e?void(n=!0):void 0}),!n&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class");t=t.replace(new RegExp("\\b"+e+"\\b","g"),""),this.setAttr("class",utils.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(e){return this.children&&this.children.length&&l(this,e),this}}}();var htmlparser=UM.htmlparser=function(e,t){function n(e,t){if(f[e.tagName]){var n=c.createElement(f[e.tagName]);e.appendChild(n),n.appendChild(c.createText(t)),e=n}else e.appendChild(c.createText(t))}function i(e,t,n){var o;if(o=u[t]){for(var r,s=e;"root"!=s.type;){if(utils.isArray(o)?-1!=utils.indexOf(o,s.tagName):o==s.tagName){e=s,r=!0;break}s=s.parentNode}r||(e=i(e,utils.isArray(o)?o[0]:o))}var l=new c({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(n){for(var f,h={};f=a.exec(n);)h[f[1].toLowerCase()]=d[f[1].toLowerCase()]?f[2]||f[3]||f[4]:utils.unhtml(f[2]||f[3]||f[4]);l.attrs=h}return e.children.push(l),dtd.$empty[t]?e:l}function o(e,t){e.children.push(new c({type:"comment",data:t,parentNode:e}))}var r=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,a=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,s={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),""),t||(e=e.replace(new RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,n){return n&&s[n.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(new RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));for(var l,d={href:1,src:1},c=UM.uNode,u={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},f={ol:"li",ul:"li"},h=0,p=0,m=new c({type:"root",children:[]}),g=m;l=r.exec(e);){h=l.index;try{if(h>p&&n(g,e.slice(p,h)),l[3])dtd.$cdata[g.tagName]?n(g,l[0]):g=i(g,l[3].toLowerCase(),l[4]);else if(l[1]){if("root"!=g.type)if(dtd.$cdata[g.tagName]&&!dtd.$cdata[l[1]])n(g,l[0]);else{for(var v=g;"element"==g.type&&g.tagName!=l[1].toLowerCase();)if(g=g.parentNode,"root"==g.type)throw g=v,"break";g=g.parentNode}}else l[2]&&o(g,l[2])}catch(b){}p=r.lastIndex}return p<e.length&&n(g,e.slice(p)),m},filterNode=UM.filterNode=function(){function e(t,n){switch(t.type){case"text":break;case"element":var i;if(i=n[t.tagName])if("-"===i)t.parentNode.removeChild(t);else if(utils.isFunction(i)){var o=t.parentNode,r=t.getIndex();if(i(t),t.parentNode){if(t.children)for(var a,s=0;a=t.children[s];)e(a,n),a.parentNode&&s++}else for(var a,s=r;a=o.children[s];)e(a,n),a.parentNode&&s++}else{var l=i.$;if(l&&t.attrs){var d,c={};for(var u in l){if(d=t.getAttr(u),"style"==u&&utils.isArray(l[u])){var f=[];utils.each(l[u],function(e){var n;(n=t.getStyle(e))&&f.push(e+":"+n)}),d=f.join(";")}d&&(c[u]=d)}t.attrs=c}if(t.children)for(var a,s=0;a=t.children[s];)e(a,n),a.parentNode&&s++}else if(dtd.$cdata[t.tagName])t.parentNode.removeChild(t);else{var o=t.parentNode,r=t.getIndex();t.parentNode.removeChild(t,!0);for(var a,s=r;a=o.children[s];)e(a,n),a.parentNode&&s++}break;case"comment":t.parentNode.removeChild(t)}}return function(t,n){if(utils.isEmptyObject(n))return t;var i;(i=n["-"])&&utils.each(i.split(" "),function(e){n[e]="-"});for(var o,r=0;o=t.children[r];)e(o,n),o.parentNode&&r++;return t}}();UM.commands.inserthtml={execCommand:function(e,t,n){var i,o,r=this;if(t&&r.fireEvent("beforeinserthtml",t)!==!0){if(i=r.selection.getRange(),o=i.document.createElement("div"),o.style.display="inline",!n){var a=UM.htmlparser(t);r.options.filterRules&&UM.filterNode(a,r.options.filterRules),r.filterInputRule(a),t=a.toHtml()}if(o.innerHTML=utils.trim(t),!i.collapsed){var s=i.startContainer;if(domUtils.isFillChar(s)&&i.setStartBefore(s),s=i.endContainer,domUtils.isFillChar(s)&&i.setEndAfter(s),i.txtToElmBoundary(),i.endContainer&&1==i.endContainer.nodeType&&(s=i.endContainer.childNodes[i.endOffset],s&&domUtils.isBr(s)&&i.setEndAfter(s)),0==i.startOffset&&(s=i.startContainer,domUtils.isBoundaryNode(s,"firstChild")&&(s=i.endContainer,i.endOffset==(3==s.nodeType?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")&&(r.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",i.setStart(r.body.firstChild,0).collapse(!0)))),!i.collapsed&&i.deleteContents(),1==i.startContainer.nodeType){var l,d=i.startContainer.childNodes[i.startOffset];if(d&&domUtils.isBlockElm(d)&&(l=d.previousSibling)&&domUtils.isBlockElm(l)){for(i.setEnd(l,l.childNodes.length).collapse();d.firstChild;)l.appendChild(d.firstChild);domUtils.remove(d)}}}var d,c,l,u,f,h=0;for(i.inFillChar()&&(d=i.startContainer,domUtils.isFillChar(d)?(i.setStartBefore(d).collapse(!0),domUtils.remove(d)):domUtils.isFillChar(d,!0)&&(d.nodeValue=d.nodeValue.replace(fillCharReg,""),i.startOffset--,i.collapsed&&i.collapse(!0)));d=o.firstChild;){if(h){for(var p=r.document.createElement("p");d&&(3==d.nodeType||!dtd.$block[d.tagName]);)f=d.nextSibling,p.appendChild(d),d=f;p.firstChild&&(d=p)}if(i.insertNode(d),f=d.nextSibling,!h&&d.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(d)&&(c=domUtils.findParent(d,function(e){return domUtils.isBlockElm(e)}),c&&"body"!=c.tagName.toLowerCase()&&(!dtd[c.tagName][d.nodeName]||d.parentNode!==c))){if(dtd[c.tagName][d.nodeName])for(u=d.parentNode;u!==c;)l=u,u=u.parentNode;else l=c;domUtils.breakParent(d,l||u);var l=d.previousSibling;domUtils.trimWhiteTextNode(l),l.childNodes.length||domUtils.remove(l),!browser.ie&&(m=d.nextSibling)&&domUtils.isBlockElm(m)&&m.lastChild&&!domUtils.isBr(m.lastChild)&&m.appendChild(r.document.createElement("br")),h=1}var m=d.nextSibling;if(!o.firstChild&&m&&domUtils.isBlockElm(m)){i.setStart(m,0).collapse(!0);break}i.setEndAfter(d).collapse()}if(d=i.startContainer,f&&domUtils.isBr(f)&&domUtils.remove(f),domUtils.isBlockElm(d)&&domUtils.isEmptyNode(d))if(f=d.nextSibling)domUtils.remove(d),1==f.nodeType&&dtd.$block[f.tagName]&&i.setStart(f,0).collapse(!0).shrinkBoundary();else try{d.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(g){i.setStartBefore(d),domUtils.remove(d)}try{if(browser.ie9below&&1==i.startContainer.nodeType&&!i.startContainer.childNodes[i.startOffset]){var v=i.startContainer,l=v.childNodes[i.startOffset-1];if(l&&1==l.nodeType&&dtd.$empty[l.tagName]){var b=this.document.createTextNode(domUtils.fillChar);i.insertNode(b).setStart(b,0).collapse(!0);

}}setTimeout(function(){i.select(!0)})}catch(g){}setTimeout(function(){i=r.selection.getRange(),i.scrollIntoView(),r.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(e,t){if(t=utils.isArray(t)?t:[t],t.length){var n,i=this,o=[],r="";if(n=t[0],1==t.length)r='<img src="'+n.src+'" '+(n._src?' _src="'+n._src+'" ':"")+(n.width?'width="'+n.width+'" ':"")+(n.height?' height="'+n.height+'" ':"")+("left"==n.floatStyle||"right"==n.floatStyle?' style="float:'+n.floatStyle+';"':"")+(n.title&&""!=n.title?' title="'+n.title+'"':"")+(n.border&&"0"!=n.border?' border="'+n.border+'"':"")+(n.alt&&""!=n.alt?' alt="'+n.alt+'"':"")+(n.hspace&&"0"!=n.hspace?' hspace = "'+n.hspace+'"':"")+(n.vspace&&"0"!=n.vspace?' vspace = "'+n.vspace+'"':"")+"/>","center"==n.floatStyle&&(r='<p style="text-align: center">'+r+"</p>"),o.push(r);else for(var a=0;n=t[a++];)r="<p "+("center"==n.floatStyle?'style="text-align: center" ':"")+'><img src="'+n.src+'" '+(n.width?'width="'+n.width+'" ':"")+(n._src?' _src="'+n._src+'" ':"")+(n.height?' height="'+n.height+'" ':"")+' style="'+(n.floatStyle&&"center"!=n.floatStyle?"float:"+n.floatStyle+";":"")+(n.border||"")+'" '+(n.title?' title="'+n.title+'"':"")+" /></p>",o.push(r);i.execCommand("insertHtml",o.join(""),!0)}}},UM.plugins.justify=function(){var e=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(t,n){e.commands[n]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return t===!0||"true"===t?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},n={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},i={forecolor:"color",fontsize:"size",fontfamily:"face"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),e.addOutputRule(function(e){utils.each(e.getNodesByTagName("font"),function(e){if("font"==e.tagName){var t=[];for(var n in e.attrs)switch(n){case"size":var i=e.attrs[n];$.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){return t==i?(i=e,!1):void 0}),t.push("font-size:"+i+"px");break;case"color":t.push("color:"+e.attrs[n]);break;case"face":t.push("font-family:"+e.attrs[n]);break;case"style":t.push(e.attrs[n])}e.attrs={style:t.join(";")}}e.tagName="span","span"==e.parentNode.tagName&&1==e.parentNode.children.length&&($.each(e.attrs,function(t,n){e.parentNode.attrs[t]="style"==t?e.parentNode.attrs[t]+n:n}),e.parentNode.removeChild(e,!0))})});for(var o in t)!function(o){e.commands[o]={execCommand:function(e,i){if("transparent"!=i){var o=this.selection.getRange();if(!o.collapsed){if("fontsize"==e&&(i={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(i+"").replace(/px/,"")]),this.document.execCommand(t[e],!1,i),browser.gecko&&$.each(this.$body.find("a"),function(e,t){var n=t.parentNode;if(n.lastChild===n.firstChild&&/FONT|SPAN/.test(n.tagName)){var i=n.cloneNode(!1);i.innerHTML=t.innerHTML,$(t).html("").append(i).insertBefore(n),$(n).remove()}}),!browser.ie){var r=this.selection.getNative().getRangeAt(0),a=r.commonAncestorContainer,o=this.selection.getRange(),s=o.createBookmark(!0);$(a).find("a").each(function(e,t){var n=t.parentNode;if("FONT"==n.nodeName){var i=n.cloneNode(!1);i.innerHTML=t.innerHTML,$(t).html("").append(i)}}),o.moveToBookmark(s).select()}return!0}var l=$("<span></span>").css(n[e],i)[0];o.insertNode(l).setStart(l,0).setCursor()}},queryCommandValue:function(t){var o=e.selection.getStart(),r=$(o).css(n[t]);return void 0===r&&(r=$(o).attr(i[t])),r?utils.fixColor(t,r).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}}(o)},UM.plugins.link=function(){var e=this;e.setOpt("autourldetectinie",!1),browser.ie&&this.options.autourldetectinie===!1&&this.addListener("keyup",function(e,t){var n=this,i=t.keyCode;if(13==i||32==i){var o=n.selection.getRange(),r=o.startContainer;if(13==i){if("P"==r.nodeName){var a=r.previousSibling;if(a&&1==a.nodeType){var a=a.lastChild;a&&"A"==a.nodeName&&!a.getAttribute("_href")&&domUtils.remove(a,!0)}}}else 32==i&&3==r.nodeType&&/^\s$/.test(r.nodeValue)&&(r=r.previousSibling,r&&"A"==r.nodeName&&!r.getAttribute("_href")&&domUtils.remove(r,!0))}}),this.addOutputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){var n=utils.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(n)||(n="http://"+n),t.setAttr("href",n),t.setAttr("_href"),""==t.getAttr("title")&&t.setAttr("title")})}),this.addInputRule(function(e){$.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",utils.html(t.getAttr("href")))})}),e.commands.link={execCommand:function(e,t){var n=this,i=n.selection.getRange();if(i.collapsed){var o=i.startContainer;(o=domUtils.findParentByTagName(o,"a",!0))?($(o).attr(t),i.selectNode(o).select()):i.insertNode($("<a>"+t.href+"</a>").attr(t)[0]).select()}else n.document.execCommand("createlink",!1,"_umeditor_link"),utils.each(domUtils.getElementsByTagName(n.body,"a",function(e){return"_umeditor_link"==e.getAttribute("href")}),function(e){"_umeditor_link"==$(e).text()&&$(e).text(t.href),domUtils.setAttributes(e,t),i.selectNode(e).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var e,t=this.selection.getStartElementPath();return $.each(t,function(t,n){return"A"==n.nodeName?(e=n,!1):void 0}),e}},e.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e=this,t="editor_print_"+ +new Date;$('<iframe src="" id="'+t+'" name="'+t+'" frameborder="0"></iframe>').attr("id",t).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(e.$container.find(".edui-dialog-container"));var n=window.open("",t,""),i=n.document;i.open(),i.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+t+"').remove();},100);},200);</script></body></html>"),i.close()},notNeedUndo:1},UM.plugins.paragraph=function(){var e=this;e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),e.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(t){}return e}}},UM.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=e.selection.getRange().txtToElmBoundary(!0),n=t.startContainer;if(domUtils.isBody(t.startContainer)){var i=t.startContainer.childNodes[t.startOffset];i||(i=$("<p></p>").appendTo(t.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0]),t.setStart(i,0).setCursor()}else{for(;dtd.$inline[n.tagName]&&n.lastChild===n.firstChild;){var o=n.parentNode;o.appendChild(n.firstChild),o.removeChild(n),n=o}for(;dtd.$inline[n.tagName];)n=n.parentNode;if(1==n.childNodes.length&&"HR"==n.lastChild.nodeName){var r=n.lastChild;$(r).insertBefore(n),t.setStart(n,0).setCursor()}else{r=$("hr",n)[0],domUtils.breakParent(r,n);var a=r.previousSibling;a&&domUtils.isEmptyBlock(a)&&$(a).remove(),t.setStart(r.nextSibling,0).setCursor()}}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){function e(e,t){if(e.length!=t.length)return 0;for(var n=0,i=e.length;i>n;n++)if(e[n]!=t[n])return 0;return 1}function t(t,n){return t.collapsed!=n.collapsed?0:e(t.startAddress,n.startAddress)&&e(t.endAddress,n.endAddress)?1:0}function n(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&1==this.list.length)return void this.reset();for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],n=UM.htmlparser(t.content.replace(l,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(n,!0),e.options.autoClearEmptyNode=c,e.body.innerHTML=n.toHtml(),e.fireEvent("afterscencerestore"),browser.ie&&utils.each(domUtils.getElementsByTagName(e.document,"td th caption p"),function(t){domUtils.isEmptyNode(t)&&domUtils.fillNode(e.document,t)});try{var i=new dom.Range(e.document,e.body).moveToAddress(t.address);if(browser.ie&&i.collapsed&&1==i.startContainer.nodeType){var o=i.startContainer.childNodes[i.startOffset];(!o||1==o.nodeType&&dtd.$empty[o])&&i.insertNode(e.document.createTextNode(" ")).collapse(!0)}i.select(d[i.startContainer.nodeName.toLowerCase()])}catch(r){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange(),n=t.createAddress(!1,!0);e.fireEvent("beforegetscene");var i=UM.htmlparser(e.body.innerHTML,!0);e.options.autoClearEmptyNode=!1,e.filterOutputRule(i,!0),e.options.autoClearEmptyNode=c;var o=i.toHtml();return browser.ie&&(o=o.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:n,content:o}},this.save=function(e,n){clearTimeout(o);var i=this.getScene(n),r=this.list[this.index];r&&r.content==i.content&&(e?1:t(r.address,i.address))||(this.list=this.list.slice(0,this.index+1),this.list.push(i),this.list.length>a&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){h=0,u=null}}function i(){this.undoManger.save()}var o,r=this,a=r.options.maxUndoCount||20,s=r.options.maxInputCount||20,l=new RegExp(domUtils.fillChar+"|</hr>","gi"),d={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},c=r.options.autoClearEmptyNode;r.undoManger=new n,r.undoManger.editor=r,r.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),r.addListener("beforeexeccommand",i),r.addListener("afterexeccommand",i),r.addListener("reset",function(e,t){t||this.undoManger.reset()}),r.commands.redo=r.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+("undo"==e.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var u,f={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,p=!1;r.addListener("ready",function(){$(this.body).on("compositionstart",function(){p=!0}).on("compositionend",function(){p=!1})}),r.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var m=!0;r.addListener("keydown",function(e,t){function n(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")}var i=this,r=t.keyCode||t.which;if(!(f[r]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(p)return;if(!i.selection.getRange().collapsed)return i.undoManger.save(!1,!0),void(m=!1);0==i.undoManger.list.length&&i.undoManger.save(!0),clearTimeout(o),o=setTimeout(function(){if(p)var e=setInterval(function(){p||(n(i),clearInterval(e))},300);else n(i)},200),u=r,h++,h>=s&&n(i)}}),r.addListener("keyup",function(e,t){var n=t.keyCode||t.which;if(!(f[n]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){if(p)return;m||(this.undoManger.save(!1,!0),m=!0)}})},UM.plugins.paste=function(){function e(e){var t=this.document;if(!t.getElementById("baidu_pastebin")){var n=this.selection.getRange(),i=n.createBookmark(),o=t.createElement("div");o.id="baidu_pastebin",browser.webkit&&o.appendChild(t.createTextNode(domUtils.fillChar+domUtils.fillChar)),this.body.appendChild(o),i.start.style.display="",o.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;top:"+$(i.start).position().top+"px",n.selectNodeContents(o).select(!0),setTimeout(function(){if(browser.webkit)for(var r,a=0,s=t.querySelectorAll("#baidu_pastebin");r=s[a++];){if(!domUtils.isEmptyNode(r)){o=r;break}domUtils.remove(r)}try{o.parentNode.removeChild(o)}catch(l){}n.moveToBookmark(i).select(!0),e(o)},0)}}function t(e){var t;if(e.firstChild){for(var i,o=domUtils.getElementsByTagName(e,"span"),r=0;i=o[r++];)("_baidu_cut_start"==i.id||"_baidu_cut_end"==i.id)&&domUtils.remove(i);if(browser.webkit){for(var a,s=e.querySelectorAll("div br"),r=0;a=s[r++];){var l=a.parentNode;"DIV"==l.tagName&&1==l.childNodes.length&&(l.innerHTML="<p><br/></p>",domUtils.remove(l))}for(var d,c=e.querySelectorAll("#baidu_pastebin"),r=0;d=c[r++];){var u=n.document.createElement("p");for(d.parentNode.insertBefore(u,d);d.firstChild;)u.appendChild(d.firstChild);domUtils.remove(d)}for(var f,h=e.querySelectorAll("meta"),r=0;f=h[r++];)domUtils.remove(f);var s=e.querySelectorAll("br");for(r=0;f=s[r++];)/^apple-/i.test(f.className)&&domUtils.remove(f)}if(browser.gecko){var p=e.querySelectorAll("[_moz_dirty]");for(r=0;f=p[r++];)f.removeAttribute("_moz_dirty")}if(!browser.ie)for(var f,m=e.querySelectorAll("span.Apple-style-span"),r=0;f=m[r++];)domUtils.remove(f,!0);t=e.innerHTML,t=t.replace(/white-space\s*:\s*nowrap/g,""),t=UM.filterWord(t);var g=UM.htmlparser(t);if(n.options.filterRules&&UM.filterNode(g,n.options.filterRules),n.filterInputRule(g),browser.webkit){var v=g.lastChild();v&&"element"==v.type&&"br"==v.tagName&&g.removeChild(v),utils.each(n.body.querySelectorAll("div"),function(e){domUtils.isEmptyBlock(e)&&domUtils.remove(e)})}if(t={html:g.toHtml()},n.fireEvent("beforepaste",t,g),!t.html)return;n.execCommand("insertHtml",t.html,!0),n.fireEvent("afterpaste",t)}}var n=this;n.addListener("ready",function(){$(n.body).on("cut",function(){var e=n.selection.getRange();!e.collapsed&&n.undoManger&&n.undoManger.save()}).on(browser.ie||browser.opera?"keydown":"paste",function(i){(!browser.ie&&!browser.opera||(i.ctrlKey||i.metaKey)&&"86"==i.keyCode)&&e.call(n,function(e){t(e)})})})},UM.plugins.list=function(){var e=this;e.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){0==e.children.length&&e.parentNode.removeChild(e)})}),e.commands.insertorderedlist=e.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e);var t=this.selection.getRange(),n=t.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var n=t.parentNode;"P"==n.tagName&&n.lastChild===n.firstChild&&($(t).children().each(function(e,t){var i=n.cloneNode(!1);$(i).append(t.innerHTML),$(t).html("").append(i)}),$(t).insertBefore(n),$(n).remove()),dtd.$inline[n.tagName]&&("SPAN"==n.tagName&&$(t).children().each(function(e,t){var i=n.cloneNode(!1);if("P"!=t.firstChild.nodeName){for(;t.firstChild;)i.appendChild(t.firstChild);$("<p></p>").appendTo(t).append(i)}else{for(;t.firstChild;)i.appendChild(t.firstChild);$(t.firstChild).append(i)}}),domUtils.remove(n,!0))}),t.moveToBookmark(n).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},function(){var e={textarea:function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",browser.ie&&browser.version<8&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{container:n,setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;browser.ie?(e=n.createTextRange(),e.collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t.onresize=null,n=null,t=null}}}};UM.plugins.source=function(){function t(t){return e.textarea(i,t)}var n,i=this,o=this.options,r=!1;o.sourceEditor="textarea",i.setOpt({sourceEditorFirst:!1});var a,s=i.getContent;i.commands.source={execCommand:function(){if(r=!r){a=i.selection.getRange().createAddress(!1,!0),i.undoManger&&i.undoManger.save(!0),browser.gecko&&(i.body.contentEditable=!1),i.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",i.fireEvent("beforegetcontent");var e=UM.htmlparser(i.body.innerHTML);i.filterOutputRule(e),e.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),i.fireEvent("aftergetcontent");var o=e.toHtml(!0);n=t(i.body.parentNode),n.setContent(o);var l=function(e){return parseInt($(i.body).css(e))};$(n.container).width($(i.body).width()+l("padding-left")+l("padding-right")).height($(i.body).height()),setTimeout(function(){n.select()}),i.getContent=function(){return n.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{i.$body.css({position:"",left:"",top:""});var d=n.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";d=d.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!dtd.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),i.setContent(d),n.dispose(),n=null,i.getContent=s;var c=i.body.firstChild;c||(i.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),i.undoManger&&i.undoManger.save(!0),browser.gecko&&(i.body.contentEditable=!0);try{i.selection.getRange().moveToAddress(a).select()}catch(u){}}this.fireEvent("sourcemodechanged",r)},queryCommandState:function(){return 0|r},notNeedUndo:1};var l=i.queryCommandState;i.queryCommandState=function(e){return e=e.toLowerCase(),r?e in{source:1,fullscreen:1}?l.apply(this,arguments):-1:l.apply(this,arguments)}}}(),UM.plugins.enterkey=function(){var e,t=this,n=t.options.enterTag;t.addListener("keyup",function(n,i){var o=i.keyCode||i.which;if(13==o){var r,a=t.selection.getRange(),s=a.startContainer;if(browser.ie)t.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(e)){if(browser.gecko){var l=domUtils.findParentByTagName(s,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],!0);l||(t.document.execCommand("formatBlock",!1,"<p>"),r=1)}else if(1==s.nodeType){var d,c=t.document.createTextNode("");if(a.insertNode(c),d=domUtils.findParentByTagName(c,"div",!0)){for(var u=t.document.createElement("p");d.firstChild;)u.appendChild(d.firstChild);d.parentNode.insertBefore(u,d),domUtils.remove(d),a.setStartBefore(c).setCursor(),r=1}domUtils.remove(c)}t.undoManger&&r&&t.undoManger.save()}browser.opera&&a.select()}}}),t.addListener("keydown",function(i,o){var r=o.keyCode||o.which;if(13==r){if(t.fireEvent("beforeenterkeydown"))return void domUtils.preventDefault(o);t.fireEvent("saveScene",!0,!0),e="";var a=t.selection.getRange();if(!a.collapsed){var s=a.startContainer,l=a.endContainer,d=domUtils.findParentByTagName(s,"td",!0),c=domUtils.findParentByTagName(l,"td",!0);if(d&&c&&d!==c||!d&&c||d&&!c)return void(o.preventDefault?o.preventDefault():o.returnValue=!1)}"p"==n&&(browser.ie||(s=domUtils.findParentByTagName(a.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],!0),s||browser.opera?(e=s.tagName,"p"==s.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(s)):(t.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(a=t.selection.getRange(),s=domUtils.findParentByTagName(a.startContainer,"p",!0),s&&domUtils.removeDirtyAttr(s)))))}}),browser.ie&&t.addListener("setDisabled",function(){$(t.body).find("p").each(function(e,t){domUtils.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank",""),t=e.document,n=this.getContent(null,null,!0),i=this.getOpt("UMEDITOR_HOME_URL"),o=-1!=n.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+i+'third-party/mathquill/mathquill.css"/><script src="'+i+'third-party/jquery.min.js"></script><script src="'+i+'third-party/mathquill/mathquill.min.js"></script>':"";t.open(),t.write("<html><head>"+o+"</head><body><div>"+n+"</div></body></html>"),t.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var e=["bold","underline","superscript","subscript","italic","strikethrough"],t=this;t.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),t.addOutputRule(function(e){$.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),$.each(e,function(e,n){t.commands[n]={execCommand:function(e){var t=this.selection.getRange();if(t.collapsed&&1!=this.queryCommandState(e)){var n=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]);return t.insertNode(n).setStart(n,0).setCursor(!1),!0}return this.document.execCommand(e)},queryCommandState:function(e){if(browser.gecko)return this.document.queryCommandState(e);var t=this.selection.getStartElementPath(),n=!1;return $.each(t,function(t,i){switch(e){case"bold":if("STRONG"==i.nodeName||"B"==i.nodeName)return n=1,!1;break;case"underline":if("U"==i.nodeName||"SPAN"==i.nodeName&&"underline"==$(i).css("text-decoration"))return n=1,!1;break;case"superscript":if("SUP"==i.nodeName)return n=1,!1;break;case"subscript":if("SUB"==i.nodeName)return n=1,!1;break;case"italic":if("EM"==i.nodeName||"I"==i.nodeName)return n=1,!1;break;case"strikethrough":if("S"==i.nodeName||"STRIKE"==i.nodeName||"SPAN"==i.nodeName&&"line-through"==$(i).css("text-decoration"))return n=1,!1}}),n}}})},UM.plugins.video=function(){function e(e,t,i,o,r,a){return a?'<iframe  frameborder=0 allowfullscreen src="'+e+'" width="'+t+'" height="'+i+'"'+(r?' style="float:'+r+'"':"")+"/>":"<img "+(o?'id="'+o+'"':"")+' width="'+t+'" height="'+i+'" _url="'+e+'" class="edui-faked-video" src="'+n.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+n.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(r?"float:"+r+";":"")+'" />'}function t(t,n){utils.each(t.getNodesByTagName(n?"img":"embed"),function(t){if("edui-faked-video"==t.getAttr("class")){var i=e(t.getAttr(n?"_url":"src"),t.getAttr("width"),t.getAttr("height"),null,t.getStyle("float")||"",n);t.parentNode.replaceChild(UM.uNode.createElement(i),t)}})}var n=this;n.addOutputRule(function(e){t(e,!0)}),n.addInputRule(function(e){t(e)}),n.commands.insertvideo={execCommand:function(t,i){i=utils.isArray(i)?i:[i];for(var o,r=[],a="tmpVedio",s=0,l=i.length;l>s;s++)o=i[s],r.push(e(o.url,o.width||420,o.height||280,a+s,o.align,!1));n.execCommand("inserthtml",r.join(""),!0)},queryCommandState:function(){var e=n.selection.getRange().getClosedNode(),t=e&&"edui-faked-video"==e.className;return t?1:0}}},UM.plugins.selectall=function(){var e=this;e.commands.selectall={execCommand:function(){var e=this,t=e.body,n=e.selection.getRange();n.selectNodeContents(t),domUtils.isEmptyBlock(t)&&(browser.opera&&t.firstChild&&1==t.firstChild.nodeType&&n.setStartAtFirst(t.firstChild),n.collapse(!0)),n.select(!0)},notNeedUndo:1},e.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),e.commands.removeformat={execCommand:function(e,t,n,i,o){function r(e){if(3==e.nodeType||"span"!=e.tagName.toLowerCase())return 0;if(browser.ie){var t=e.attributes;if(t.length){for(var n=0,i=t.length;i>n;n++)if(t[n].specified)return 0;return 1}}return!e.attributes.length}function a(e){var t=e.createBookmark();if(e.collapsed&&e.enlarge(!0),!o){var i=domUtils.findParentByTagName(e.startContainer,"a",!0);i&&e.setStartBefore(i),i=domUtils.findParentByTagName(e.endContainer,"a",!0),i&&e.setEndAfter(i)}for(s=e.createBookmark(),m=s.start;(l=m.parentNode)&&!domUtils.isBlockElm(l);)domUtils.breakParent(m,l),domUtils.clearEmptySibling(m);if(s.end){for(m=s.end;(l=m.parentNode)&&!domUtils.isBlockElm(l);)domUtils.breakParent(m,l),domUtils.clearEmptySibling(m);for(var a,u=domUtils.getNextDomNode(s.start,!1,f);u&&u!=s.end;)a=domUtils.getNextDomNode(u,!0,f),dtd.$empty[u.tagName.toLowerCase()]||domUtils.isBookmarkNode(u)||(d.test(u.tagName)?n?(domUtils.removeStyle(u,n),r(u)&&"text-decoration"!=n&&domUtils.remove(u,!0)):domUtils.remove(u,!0):dtd.$tableContent[u.tagName]||dtd.$list[u.tagName]||(domUtils.removeAttributes(u,c),r(u)&&domUtils.remove(u,!0))),u=a}var h=s.start.parentNode;!domUtils.isBlockElm(h)||dtd.$tableContent[h.tagName]||dtd.$list[h.tagName]||domUtils.removeAttributes(h,c),h=s.end.parentNode,s.end&&domUtils.isBlockElm(h)&&!dtd.$tableContent[h.tagName]&&!dtd.$list[h.tagName]&&domUtils.removeAttributes(h,c),e.moveToBookmark(s).moveToBookmark(t);for(var p,m=e.startContainer,g=e.collapsed;1==m.nodeType&&domUtils.isEmptyNode(m)&&dtd.$removeEmpty[m.tagName];)p=m.parentNode,e.setStartBefore(m),e.startContainer===e.endContainer&&e.endOffset--,domUtils.remove(m),m=p;if(!g)for(m=e.endContainer;1==m.nodeType&&domUtils.isEmptyNode(m)&&dtd.$removeEmpty[m.tagName];)p=m.parentNode,e.setEndBefore(m),domUtils.remove(m),m=p}var s,l,d=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),c=n?[]:(i||this.options.removeFormatAttributes).split(","),u=new dom.Range(this.document),f=function(e){return 1==e.nodeType};u=this.selection.getRange(),u.collapsed||(a(u),u.select())}}},UM.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(n,i){var o=i.keyCode||i.which,r=e.selection.getRange();if(!r.collapsed&&!(i.ctrlKey||i.shiftKey||i.altKey||i.metaKey)&&(o>=65&&90>=o||o>=48&&57>=o||o>=96&&111>=o||{13:1,8:1,46:1}[o])){var a=r.startContainer;if(domUtils.isFillChar(a)&&r.setStartBefore(a),a=r.endContainer,domUtils.isFillChar(a)&&r.setEndAfter(a),r.txtToElmBoundary(),r.endContainer&&1==r.endContainer.nodeType&&(a=r.endContainer.childNodes[r.endOffset],a&&domUtils.isBr(a)&&r.setEndAfter(a)),0==r.startOffset&&(a=r.startContainer,domUtils.isBoundaryNode(a,"firstChild")&&(a=r.endContainer,r.endOffset==(3==a.nodeType?a.nodeValue.length:a.childNodes.length)&&domUtils.isBoundaryNode(a,"lastChild"))))return e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",r.setStart(e.body.firstChild,0).setCursor(!1,!0),void e._selectionChange()}if(8==o){if(r=e.selection.getRange(),t=r.collapsed,e.fireEvent("delkeydown",i))return;var s,l;if(r.collapsed&&r.inFillChar()&&(s=r.startContainer,domUtils.isFillChar(s)?(r.setStartBefore(s).shrinkBoundary(!0).collapse(!0),domUtils.remove(s)):(s.nodeValue=s.nodeValue.replace(new RegExp("^"+domUtils.fillChar),""),r.startOffset--,r.collapse(!0).select(!0))),s=r.getClosedNode())return e.fireEvent("saveScene"),r.setStartBefore(s),domUtils.remove(s),r.setCursor(),e.fireEvent("saveScene"),void domUtils.preventDefault(i);if(!browser.ie&&(s=domUtils.findParentByTagName(r.startContainer,"table",!0),l=domUtils.findParentByTagName(r.endContainer,"table",!0),s&&!l||!s&&l||s!==l))return void i.preventDefault();if(s=r.startContainer,r.collapsed&&1==s.nodeType){var d=s.childNodes[r.startOffset-1];d&&1==d.nodeType&&"BR"==d.tagName&&(e.fireEvent("saveScene"),r.setStartBefore(d).collapse(!0),domUtils.remove(d),r.select(),e.fireEvent("saveScene"))}if(browser.chrome&&r.collapsed){for(;0==r.startOffset&&!domUtils.isEmptyBlock(r.startContainer);)r.setStartBefore(r.startContainer);var c=r.startContainer.childNodes[r.startOffset-1];c&&"BR"==c.nodeName&&(r.setStartBefore(c),e.fireEvent("saveScene"),$(c).remove(),r.setCursor(),e.fireEvent("saveScene"))}}if(browser.gecko&&46==o){var u=e.selection.getRange();if(u.collapsed&&(s=u.startContainer,domUtils.isEmptyBlock(s))){for(var f=s.parentNode;1==domUtils.getChildCount(f)&&!domUtils.isBody(f);)s=f,f=f.parentNode;return void(s===f.lastChild&&i.preventDefault())}}}),e.addListener("keyup",function(e,n){var i,o=n.keyCode||n.which,r=this;if(8==o){if(r.fireEvent("delkeyup"))return;if(i=r.selection.getRange(),i.collapsed){var a,s=["h1","h2","h3","h4","h5","h6"];if((a=domUtils.findParentByTagName(i.startContainer,s,!0))&&domUtils.isEmptyBlock(a)){var l=a.previousSibling;if(l&&"TABLE"!=l.nodeName)return domUtils.remove(a),void i.setStartAtLast(l).setCursor(!1,!0);var d=a.nextSibling;if(d&&"TABLE"!=d.nodeName)return domUtils.remove(a),void i.setStartAtFirst(d).setCursor(!1,!0)}if(domUtils.isBody(i.startContainer)){var a=domUtils.createElement(r.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});i.insertNode(a).setStart(a,0).setCursor(!1,!0)}}if(!t&&(3==i.startContainer.nodeType||1==i.startContainer.nodeType&&domUtils.isEmptyBlock(i.startContainer)))if(browser.ie){var c=i.document.createElement("span");i.insertNode(c).setStartBefore(c).collapse(!0),i.select(),domUtils.remove(c)}else i.select()}})},UM.plugins.autosave=function(){function e(e){var a=null;if(!(new Date-n<i)){if(!e.hasContents())return void(o&&r.removeItem(o));n=new Date,e._saveFlag=null,a=t.body.innerHTML,e.fireEvent("beforeautosave",{content:a})!==!1&&(r.saveLocalData(o,a),e.fireEvent("afterautosave",{content:a}))}}var t=this,n=new Date,i=20,o=null;t.setOpt("saveInterval",500);var r=UM.LocalStorage=function(){function e(){var e=document.createElement("div");return e.style.display="none",e.addBehavior?(e.addBehavior("#default#userdata"),{getItem:function(t){var i=null;try{document.body.appendChild(e),e.load(n),i=e.getAttribute(t),document.body.removeChild(e)}catch(o){}return i},setItem:function(t,i){document.body.appendChild(e),e.setAttribute(t,i),e.save(n),document.body.removeChild(e)},removeItem:function(t){document.body.appendChild(e),e.removeAttribute(t),e.save(n),document.body.removeChild(e)}}):null}var t=window.localStorage||e()||null,n="localStorage";return{saveLocalData:function(e,n){return t&&n?(t.setItem(e,n),!0):!1},getLocalData:function(e){return t?t.getItem(e):null},removeItem:function(e){t&&t.removeItem(e)}}}();t.addListener("ready",function(){var e="-drafts-data",n=null;n=t.key?t.key+e:(t.container.parentNode.id||"ue-common")+e,o=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+n}),t.addListener("contentchange",function(){o&&(t._saveFlag&&window.clearTimeout(t._saveFlag),t.options.saveInterval>0?t._saveFlag=window.setTimeout(function(){e(t)},t.options.saveInterval):e(t))}),t.commands.clearlocaldata={execCommand:function(e,t){o&&r.getLocalData(o)&&r.removeItem(o)},notNeedUndo:!0,ignoreContentChange:!0},t.commands.getlocaldata={execCommand:function(e,t){return o?r.getLocalData(o)||"":""},notNeedUndo:!0,ignoreContentChange:!0},t.commands.drafts={execCommand:function(e,n){o&&(t.body.innerHTML=r.getLocalData(o)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",t.focus(!0))},queryCommandState:function(){
return o?null===r.getLocalData(o)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){function getPasteImage(e){return e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function getDropImage(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}var me=this;me.setOpt("pasteImageEnabled",!0),me.setOpt("dropFileEnabled",!0);var sendAndInsertImage=function(file,editor){var fd=new FormData;fd.append(editor.options.imageFieldName||"upfile",file,file.name||"blob."+file.type.substr("image/".length)),fd.append("type","ajax");var xhr=new XMLHttpRequest;xhr.open("post",me.options.imageUrl,!0),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}}),xhr.send(fd)};me.addListener("ready",function(){if(window.FormData&&window.FileReader){var e=function(e){var t,n=!1;if(t="paste"==e.type?getPasteImage(e.originalEvent):getDropImage(e.originalEvent)){for(var i,o=t.length;o--;)i=t[o],i.getAsFile&&(i=i.getAsFile()),i&&i.size>0&&/image\/\w+/i.test(i.type)&&(sendAndInsertImage(i,me),n=!0);if(n)return!1}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",e),me.getOpt("dropFileEnabled")&&me.$body.on("drop",e),me.$body.on("dragover",function(e){return"Files"==e.originalEvent.dataTransfer.types[0]?!1:void 0})}})},UM.plugins.formula=function(){function e(){return n.$body.find("iframe.edui-formula-active")[0]||null}function t(){var t=e();t&&t.contentWindow.formula.blur()}var n=this;n.addInputRule(function(e){$.each(e.getNodesByTagName("span"),function(e,t){if(t.hasClass("mathquill-embedded-latex")){for(var i,o="";i=t.firstChild();)o+=i.data,t.removeChild(i);t.tagName="iframe",t.setAttr({frameborder:"0",src:n.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(o)})}})}),n.addOutputRule(function(e){$.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),n.addListener("click",function(){t()}),n.addListener("afterexeccommand",function(e,n){"formula"!=n&&t()}),n.commands.formula={execCommand:function(t,i){var o=e();o?o.contentWindow.formula.insertLatex(i):(n.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+i+"</span>"),browser.ie&&browser.ie9below&&setTimeout(function(){var e=n.selection.getRange(),t=e.startContainer;1!=t.nodeType||t.childNodes[e.startOffset]||(e.insertNode(n.document.createTextNode(" ")),e.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(t){var n=e();return n&&n.contentWindow.formula.getLatex()}}},function(e){function t(t,n,i){if(t.prototype=e.extend2(e.extend({},n),(UM.ui[i]||o).prototype,!0),t.prototype.supper=(UM.ui[i]||o).prototype,UM.ui[i]&&UM.ui[i].prototype.defaultOpt){var r=UM.ui[i].prototype.defaultOpt,a=t.prototype.defaultOpt;t.prototype.defaultOpt=e.extend({},r,a||{})}return t}function n(t,n){e[r+n]=t,e.fn[r+n]=function(n){var i,o=Array.prototype.slice.call(arguments,1);return this.each(function(r,a){var s=e(a),l=s.edui();if(l||(t(n&&e.isPlainObject(n)?n:{},s),s.edui(l)),"string"==e.type(n))if("this"==n)i=l;else{if(i=l[n].apply(l,o),i!==l&&void 0!==i)return!1;i=null}}),null!==i?i:this}}e.parseTmpl=function(e,t){var n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",n);return t?i(t):i},e.extend2=function(t,n){for(var i=arguments,o="boolean"==e.type(i[i.length-1])?i[i.length-1]:!1,r="boolean"==e.type(i[i.length-1])?i.length-1:i.length,a=1;r>a;a++){var s=i[a];for(var l in s)o&&t.hasOwnProperty(l)||(t[l]=s[l])}return t},e.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var i=[],o=function(){},r="edui";o.prototype={on:function(t,n){return this.root().on(t,e.proxy(n,this)),this},off:function(t,n){return this.root().off(t,e.proxy(n,this)),this},trigger:function(e,t){return this.root().trigger(e,t)===!1?!1:this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return void 0!==t?(this.root().data(r+e,t),this):this.root().data(r+e)},register:function(t,n,o){i.push({evtname:t,$els:e.isArray(n)?n:[n],handler:e.proxy(o,n)})}},e.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var a=1;UM.ui={define:function(i,o,s){var l=UM.ui[i]=t(function(t,n){var o=function(){};e.extend(o.prototype,l.prototype,{guid:i+a++,widgetName:i});var s=new o;if("string"==e.type(t))return s.init&&s.init({}),s.root().edui(s),s.root().find("a").click(function(e){e.preventDefault()}),s.root()[r+i].apply(s.root(),arguments);n&&s.root(n),s.init&&s.init(!t||e.isPlainObject(t)?e.extend2(t||{},s.defaultOpt||{},!0):t);try{s.root().find("a").click(function(e){e.preventDefault()})}catch(d){}return s.root().edui(s)},o,s);n(l,i)}},e(function(){e(document).on("click mouseup mousedown dblclick mouseover",function(t){e.each(i,function(n,i){i.evtname==t.type&&e.each(i.$els,function(n,o){o[0]===t.target||e.contains(o[0],t.target)||i.handler(t)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))).click(function(n){t.wrapclick(e.click,n)}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),$.proxy(e,this,t)()),this},label:function(e){return void 0===e?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root($(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var t=this.data("$btnToolbar");e=$.isArray(e)?e:[e],$.each(e,function(e,n){t.append(n)})}})}(),UM.ui.define("menu",{show:function(e,t,n,i,o){n=n||"position",this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},e?{top:e[n]().top+("right"==t?0:e.outerHeight())-(i||0),left:e[n]().left+("right"==t?e.outerWidth():0)-(o||0)}:{})),this.trigger("aftershow"))},hide:function(e){var t;this.trigger("beforehide")!==!1&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var t=this,n={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(n){$.proxy(e.click,t,n,$(this).data("value"),$(this))()}).find("li").each(function(i,o){var r=$(this);if(!r.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var a=e.data[i];$.each(n,function(e){a[e]&&r[e](function(n){$.proxy(a[e],o)(n,a,t.root)})})}})},disabled:function(e){$("li[class!=edui-divider]",this.root()).each(function(){var t=$(this);e===!0?t.addClass("edui-disabled"):$.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var t;return $('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var n=$(this);if(void 0===e){if(n.find("em.edui-dropmenu-checked").length)return t=n.data("value"),!1}else n.find("em").toggleClass("edui-dropmenu-checked",n.data("value")==e)}),void 0===e?t:void 0},addSubmenu:function(e,t,n){n=n||0;var i=$("li[class!=edui-divider]",this.root()),o=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t);n>=0&&n<i.length?o.insertBefore(i[n]):0>n?o.insertBefore(i[0]):n>=i.length&&o.appendTo(i)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t.root().find(".edui-btn:first").click(function(n){t.disabled()||$.proxy(e.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||$.proxy(e,this,t)(),this},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),$.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){var t=this;t.supper.init.call(t,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root($($.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return $.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){t||(t={});var n=t.fnname||"position";this.trigger("beforeshow")!==!1&&(this.root().css($.extend({display:"block"},e?{top:e[n]().top+("right"==t.dir?0:e.outerHeight())-(t.offsetTop||0),left:e[n]().left+("right"==t.dir?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,t){var n=this;e.data("$mergeObj")||(e.data("$mergeObj",n.root()),e.on("wrapclick",function(i){n.show(e,t)}),n.register("click",e,function(e){n.hide()}),n.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root($($.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this,n=t.defaultOpt.$doc;switch(e.type){case"mousedown":var i,i=e.target||e.srcElement;-1!=i.className.indexOf("edui-scale-hand")&&(t.dragId=i.className.slice(-1),t.startPos.x=t.prePos.x=e.clientX,t.startPos.y=t.prePos.y=e.clientY,n.bind("mousemove",$.proxy(t._eventHandler,t)));break;case"mousemove":-1!=t.dragId&&(t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y}),t.prePos.x=e.clientX,t.prePos.y=e.clientY,t.updateTargetElement());break;case"mouseup":if(-1!=t.dragId){t.dragId=-1,t.updateTargetElement();var o=t.data("$scaleTarget");o.parent()&&t.attachTo(t.data("$scaleTarget"))}n.unbind("mousemove",$.proxy(t._eventHandler,t))}},updateTargetElement:function(){var e=this,t=e.root(),n=e.data("$scaleTarget");n.css({width:t.width(),height:t.height()}),e.attachTo(n)},updateContainerStyle:function(e,t){var n,i=this,o=i.root(),r=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=r[e][0]&&(n=parseInt(o.offset().left)+t.x,o.css("left",i._validScaledProp("left",n))),0!=r[e][1]&&(n=parseInt(o.offset().top)+t.y,o.css("top",i._validScaledProp("top",n))),0!=r[e][2]&&(n=o.width()+r[e][2]*t.x,o.css("width",i._validScaledProp("width",n))),0!=r[e][3]&&(n=o.height()+r[e][3]*t.y,o.css("height",i._validScaledProp("height",n)))},_validScaledProp:function(e,t){var n=this.root(),i=this.defaultOpt.$doc,o=function(e,n,i){return e+n>i?i-n:t};switch(t=isNaN(t)?0:t,e){case"left":return 0>t?0:o(t,n.width(),i.width());case"top":return 0>t?0:o(t,n.height(),i.height());case"width":return 0>=t?1:o(t,n.offset().left,i.width());case"height":return 0>=t?1:o(t,n.offset().top,i.height())}},show:function(e){var t=this;e&&t.attachTo(e),t.root().bind("mousedown",$.proxy(t._eventHandler,t)),t.defaultOpt.$doc.bind("mouseup",$.proxy(t._eventHandler,t)),t.root().show(),t.trigger("aftershow")},hide:function(){var e=this;e.root().unbind("mousedown",$.proxy(e._eventHandler,e)),e.defaultOpt.$doc.unbind("mouseup",$.proxy(e._eventHandler,e)),e.root().hide(),e.trigger("afterhide")},attachTo:function(e){var t=this,n=e.offset(),i=t.root(),o=t.defaultOpt.$wrap,r=o.offset();t.data("$scaleTarget",e),t.root().css({position:"absolute",width:e.width(),height:e.height(),left:n.left-r.left-parseInt(o.css("border-left-width"))-parseInt(i.css("border-left-width")),top:n.top-r.top-parseInt(o.css("border-top-width"))-parseInt(i.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){for(var t="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(","),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',i=0;i<t.length;i++)i&&i%10===0&&(n+="</tr>"+(60==i?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-firstrow"':"")+">"),n+=70>i?'<td><a unselectable="on" onmousedown="return false" title="'+t[i]+'" class="edui-colorpicker-colorcell" data-color="#'+t[i]+'" style="background-color:#'+t[i]+";border:solid #ccc;"+(10>i||i>=60?"border-width:1px;":i>=10&&20>i?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return n+="</tr></table></div>"},init:function(e){var t=this;t.root($($.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",$(e.target).data("color"))})}},"popup"),function(){var e="combobox",t="edui-combobox-item",n="edui-combobox-item-hover",i="edui-combobox-checked-icon",o="edui-combobox-item-label";UM.ui.define(e,function(){return{tpl:'<ul class="ex-dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){var n=this;$.extend(n._optionAdaptation(e),n._createItemMapping(e.recordStack,e.items),{itemClassName:t,iconClass:i,labelClassName:o}),this._transStack(e),n.root($($.parseTmpl(n.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){var e=this;e.initSelectItem(),this.initItemActive()},initSelectItem:function(){var e=this,n="."+o;e.root().delegate("."+t,"click",function(){var t=$(this),i=t.attr("data-item-index");return e.trigger("comboboxselect",{index:i,label:t.find(n).text(),value:e.data("options").value[i]}).select(i),e.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};$.IE6&&this.root().delegate("."+t,"mouseenter mouseleave",function(t){$(this)[e[t.type]](n)}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),0==t?null:(0>e?e=t+e%t:e>=t&&(e=t-1),this.trigger("changebefore",n[e]),this._update(e),this.trigger("changeafter",n[e]),null)},selectItemByLabel:function(e){var t=this.data("options").itemMapping,n=this,i=null;!$.isArray(e)&&(e=[e]),$.each(e,function(e,o){return i=t[o],void 0!==i?(n.select(i),!1):void 0})},_transStack:function(e){var t=[],n=-1,i=-1;$.each(e.recordStack,function(o,r){n=e.itemMapping[r],$.isNumeric(n)&&(t.push(n),r==e.selected&&(i=n))}),e.recordStack=t,e.selected=i,t=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,n=e.items.length;n>t;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var n={},i={recordStack:[],mapping:{}};return $.each(t,function(e,t){n[t]=e}),i.itemMapping=n,$.each(e,function(e,t){void 0!==n[t]&&(i.recordStack.push(n[t]),i.mapping[t]=n[t])}),i},_update:function(e){var t=this.data("options"),n=[],i=null;$.each(t.recordStack,function(t,i){i!=e&&n.push(i)}),n.unshift(e),n.length>t.recordCount&&(n.length=t.recordCount),t.recordStack=n,t.selected=e,i=$($.parseTmpl(this.tpl,t)),this.root().html(i.html()),i=null,n=null}}}(),"menu")}(),function(){var e="buttoncombobox";UM.ui.define(e,function(){return{defaultOpt:{label:"",title:""},init:function(e){var t=this,n=$.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){n.eduibutton("label",t)}),t.data("button",n),t.attachTo(n)},button:function(){return this.data("button")}}}(),"combobox")}(),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{}))),t.data("options",e),e.okFn&&t.on("ok",$.proxy(e.okFn,t)),e.cancelFn&&t.on("beforehide",$.proxy(e.cancelFn,t)),t.root().delegate('[data-hide="modal"]',"click",$.proxy(t.hide,t)).delegate('[data-ok="modal"]',"click",$.proxy(t.ok,t)),$('[data-hide="modal"],[data-ok="modal"]',t.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){var e=this;return e[e.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow"),e.data("isShown")||(e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")}))},showTip:function(e){$(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var e=this;e.trigger("beforehide"),e.data("isShown")&&(e.data("isShown",!1),e.escape(),e.hideModal())},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){27==t.which&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var t=this;t.data("isShown")&&t.data("options").backdrop&&(t.$backdrop=$('<div class="edui-modal-backdrop" />').click("static"==t.data("options").backdrop?$.proxy(t.root()[0].focus,t.root()[0]):$.proxy(t.hide,t))),t.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){var e=this;e.trigger("beforeok"),e.trigger("ok",e)!==!1&&e.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){var t=this;t.root($($.parseTmpl(t.tpl,e||{})))},content:function(e){var t=this,n=$(e.currentTarget).attr("data-original-title");t.root().find(".edui-tooltip-inner").text(n)},position:function(e){var t=this,n=$(e.currentTarget);t.root().css($.extend({display:"block"},n?{top:n.outerHeight(),left:(n.outerWidth()-t.root().outerWidth())/2}:{}))},show:function(e){if(!$(e.currentTarget).hasClass("edui-disabled")){var t=this;t.content(e),t.root().appendTo($(e.currentTarget)),t.position(e),t.root().css("display","block")}},hide:function(){var e=this;e.root().css("display","none")},attachTo:function(e){function t(e){var t=this;$.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){$(this).attr("data-original-title")&&$(this).on("mouseenter",$.proxy(t.show,t)).on("mouseleave click",$.proxy(t.hide,t))})}var n=this;"undefined"===$.type(e)?$("[data-original-title]").each(function(e,i){t.call(n,$(i))}):e.data("tooltip")||t.call(n,e)}}),UM.ui.define("tab",{init:function(e){var t=this,n=e.selector;$.type(n)&&(t.root($(n,e.context)),t.data("context",e.context),$(n,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t,n,i,e,o=this,r=$(e.target),a=r.closest("ul");t=r.attr("data-context"),t=t&&t.replace(/.*(?=#[^\s]*$)/,"");var s=r.parent("li");s.length&&!s.hasClass("edui-active")&&(n=a.find(".edui-active:last a")[0],e=$.Event("beforeshow",{target:r[0],relatedTarget:n}),o.trigger(e),e.isDefaultPrevented()||(i=$(t,o.data("context")),o.activate(r.parent("li"),a),o.activate(i,i.parent(),function(){o.trigger({type:"aftershow",relatedTarget:n})})))},activate:function(e,t,n){if(void 0===e)return $(".edui-tab-item.edui-active",this.root()).index();var i=t.find("> .edui-active");i.removeClass("edui-active"),e.addClass("edui-active"),n&&n()}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){var t=this;return t.root($($.parseTmpl(t.tpl,e))),t}}),function(){var e={},t={},n=[],i=null,o={},r={},a={},s=null;utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(t,n){utils.each(t.split(/\s+/),function(t){e[t]=n})},setEditor:function(e){!t[e.id]&&(t[e.id]=e)},registerWidget:function(e,t,n){o[e]=$.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(r[e]=n)},getWidgetData:function(e){return o[e]},setWidgetBody:function(e,t,n){n._widgetData||utils.extend(n,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var n=this;return function(){return r[e].apply(n,[n,t].concat(Array.prototype.slice.call(arguments,0)))}}});var i=o[e];return i?(i=n._widgetData[e],i||(i=o[e],i=n._widgetData[e]="function"==$.type(i)?i:utils.clone(i)),i.root(t.edui().getBodyContainer()),i.initContent(n,t),i._preventDefault||i.initEvent(n,t),void(i.width&&t.width(i.width))):null},setActiveWidget:function(e){i=e},getEditor:function(e,n){var i=t[e]||(t[e]=this.createEditor(e,n));return s=s?Math.max(i.getOpt("zIndex"),s):i.getOpt("zIndex"),i},setTopEditor:function(e){$.each(t,function(t,n){e==n?e.$container&&e.$container.css("zIndex",s+1):n.$container&&n.$container.css("zIndex",n.getOpt("zIndex"))})},clearCache:function(e){t[e]&&delete t[e]},delEditor:function(e){var n;(n=t[e])&&n.destroy()},ready:function(e){n.push(e)},createEditor:function(e,t){function i(){var t=this.createUI("#"+e,o);o.key=e,o.ready(function(){$.each(n,function(e,t){$.proxy(t,o)()})});var i=o.options;i.minFrameWidth=i.initialFrameWidth?i.initialFrameWidth:i.initialFrameWidth=o.$body.width()||UM.defaultWidth,t.css({width:i.initialFrameWidth,zIndex:o.getOpt("zIndex")}),UM.browser.ie&&6===UM.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),o.render(e),$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",t)).css("z-index",o.getOpt("zIndex")+1),t.find("a").click(function(e){e.preventDefault()}),o.fireEvent("afteruiready")}var o=new UM.Editor(t),r=this;return o.langIsReady?$.proxy(i,r)():o.addListener("langReady",$.proxy(i,r)),o},createUI:function(t,n){var i=$(t),o=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(i);if(n.$container=o,n.container=o[0],n.$body=i,browser.ie&&browser.ie9above){var r=$('<span style="padding:0;margin:0;height:0;width:0"></span>');r.insertAfter(o)}return $.each(e,function(e,t){var i=t.call(n,e);i&&(a[e]=i)}),o.find(".edui-editor-body").append(i).before(this.createToolbar(n.options,n)),o.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>')),o},createToolbar:function(e,t){var n=$.eduitoolbar(),i=n.edui();if(e.toolbar&&e.toolbar.length){var o=[];$.each(e.toolbar,function(e,t){$.each(t.split(/\s+/),function(e,t){if("|"==t)$.eduiseparator&&o.push($.eduiseparator());else{var n=a[t];"fullscreen"==t?n&&o.unshift(n):n&&o.push(n)}}),o.length&&i.appendToBtnmenu(o)})}else n.find(".edui-btn-toolbar").remove();return n}})}(),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,n=$.eduibutton({
icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),function(){function e(e){var t=this;if(!e)throw new Error("invalid params, notfound editor");t.editor=e,a[e.uid]=this,e.addListener("destroy",function(){delete a[e.uid],t.editor=null})}var t={},n=["width","height","position","top","left","margin","padding","overflowX","overflowY"],i={},o={},r={},a={};UM.registerUI("fullscreen",function(t){var n=this,i=$.eduibutton({icon:"fullscreen",title:n.options.labelMap&&n.options.labelMap[t]||n.getLang("labelMap."+t),click:function(){n.execCommand(t),UM.setTopEditor(n)}});return n.addListener("selectionchange",function(){var e=this.queryCommandState(t);i.edui().disabled(-1==e).active(1==e)}),n.addListener("ready",function(){n.options.fullscreen&&e.getInstance(n).toggle()}),i}),UM.commands.fullscreen={execCommand:function(t){e.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},e.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),"true"===e.body.contentEditable&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,t=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+t+' ? "'+t+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e=null,t=0,n=0,i=0,o=0,r=this.editor,a=null,s=null;this.isFullState()&&(e=$(window),n=e.width(),t=e.height(),s=this.getEditorHolder(),i=parseInt(domUtils.getComputedStyle(s,"border-width"),10)||0,i+=parseInt(domUtils.getComputedStyle(r.container,"border-width"),10)||0,o+=parseInt(domUtils.getComputedStyle(s,"padding-left"),10)+parseInt(domUtils.getComputedStyle(s,"padding-right"),10)||0,$.IE6&&s.style.setExpression("height",null),a=this.getBound(),$(r.container).css({width:n+"px",height:t+"px",position:$.IE6?"absolute":"fixed",top:a.top,left:a.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),$(s).css({width:n-2*i-o+"px",height:t-2*i-(r.options.withoutToolbar?0:$(".edui-toolbar",r.container).outerHeight())-$(".edui-bottombar",r.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var e=this.editor.container.style,i=null,o={},r=0,a=n.length;a>r;r++)i=n[r],o[i]=e[i];t[this.editor.uid]=o,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=$(this.getEditorHolder());i[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=$(this.getEditorDocumentBody());o[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},r[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),$(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),$(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return t[this.editor.uid]},getContentAreaStatus:function(){return i[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:o[this.editor.uid],html:r[this.editor.uid]}},supportMin:function(){var e=null;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style,e=null),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},n=null;return $.IE6?(n=this.editor.container.offsetParent,n&&!e[n.nodeName.toLowerCase()]&&(e=n.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t):t},getStyleValue:function(e){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),e))}},$.extend(e,{listen:function(){var t=null;e._hasFullscreenListener||(e._hasFullscreenListener=!0,$(window).on("resize",function(){null!==t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){for(var e in a)a[e].resize();t=null},50)}))},getInstance:function(t){return a[t.uid]||new e(t),a[t.uid]}}),e.listen()}(),UM.registerUI("link image video map formula",function(e){var t,n,i=this,o={title:i.options.labelMap&&i.options.labelMap[e]||i.getLang("labelMap."+e),url:i.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js"},r=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:o.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var a=UM.getWidgetData(e);if(a){if(a.buttons){var s=a.buttons.ok;s&&(o.oklabel=s.label||i.getLang("ok"),s.exec&&(o.okFn=function(){return $.proxy(s.exec,null,i,n)()}));var l=a.buttons.cancel;l&&(o.cancellabel=l.label||i.getLang("cancel"),l.exec&&(o.cancelFn=function(){return $.proxy(l.exec,null,i,n)()}))}a.width&&(o.width=a.width),a.height&&(o.height=a.height),n=$.eduimodal(o),n.attr("id","edui-dialog-"+e).addClass("edui-dialog-"+e).find(".edui-modal-body").addClass("edui-dialog-"+e+"-body"),n.edui().on("beforehide",function(){var e=i.selection.getRange();e.equals(t)&&e.select()}).on("beforeshow",function(){var o=this.root(),r=null,a=null;t=i.selection.getRange(),o.parent()[0]||i.$container.find(".edui-dialog-container").append(o),$.IE6&&(r={width:$(window).width(),height:$(window).height()},a=o.parents(".edui-toolbar")[0].getBoundingClientRect(),o.css({position:"absolute",margin:0,left:(r.width-o.width())/2-a.left,top:100-a.top})),UM.setWidgetBody(e,n,i),UM.setTopEditor(i)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",i.getOpt("zIndex")+1).appendTo(i.$container.find(".edui-dialog-container")),n.css("zIndex",i.getOpt("zIndex")+2)}).on("beforeok",function(){try{t.select()}catch(e){}}).attachTo(r)}}),i.addListener("selectionchange",function(){var t=this.queryCommandState(e);r.edui().disabled(-1==t).active(1==t)}),r}),UM.registerUI("emotion formula",function(e){var t=this,n=t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js",i=$.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return utils.loadFile(document,{src:n,tag:"script",type:"text/javascript",defer:"defer"},function(){var o={url:n},r=UM.getWidgetData(e);r.width&&(o.width=r.width),r.height&&(o.height=r.height),$.eduipopup(o).css("zIndex",t.options.zIndex+1).addClass("edui-popup-"+e).edui().on("beforeshow",function(){var n=this.root();n.parent().length||t.$container.find(".edui-dialog-container").append(n),UM.setWidgetBody(e,n,t),UM.setTopEditor(t)}).attachTo(i,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);i.edui().disabled(-1==t).active(1==t)})}),i}),UM.registerUI("imagescale",function(){var e,t=this;t.setOpt("imageScaleEnabled",!0),browser.webkit&&t.getOpt("imageScaleEnabled")&&(t.addListener("click",function(n,i){var o=t.selection.getRange(),r=o.getClosedNode(),a=i.target;if(r&&"IMG"==r.tagName&&a==r){if(!e){e=$.eduiscale({$wrap:t.$container}).css("zIndex",t.options.zIndex),t.$container.append(e);var s,l=function(){e.edui().hide()},d=function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale")&&l(e)};e.edui().on("aftershow",function(){$(document).bind("keydown",l),$(document).bind("mousedown",d),t.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",l),$(document).unbind("mousedown",d);var n=e.edui().getScaleTarget();n.parentNode&&t.selection.getRange().selectNode(n).select()}).on("mousedown",function(n){t.selection.getNative().removeAllRanges();var i=n.target||n.srcElement;i&&-1==i.className.indexOf("edui-scale-hand")&&(s=setTimeout(function(){e.edui().hide()},200))}).on("mouseup",function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale-hand")&&clearTimeout(s)})}e.edui().show($(r))}else e&&"none"!=e.css("display")&&e.edui().hide()}),t.addListener("click",function(e,n){if("IMG"==n.target.tagName){var i=new dom.Range(t.document,t.body);i.selectNode(n.target).select()}}))}),UM.registerUI("autofloat",function(){var e=this,t=e.getLang();e.setOpt({autoFloatEnabled:!0,topOffset:0});var n=e.options.autoFloatEnabled!==!1,i=e.options.topOffset;n&&e.ready(function(){function n(){return UM.ui?1:(alert(t.autofloatMsg),0)}function o(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function r(){if(!m){var t=domUtils.getXY(d),n=domUtils.getComputedStyle(d,"position"),o=domUtils.getComputedStyle(d,"left");d.style.width=d.offsetWidth+"px",d.style.zIndex=1*e.options.zIndex+1,d.parentNode.insertBefore(h,d),u||f&&browser.ie?("absolute"!=d.style.position&&(d.style.position="absolute"),d.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-c+i+"px"):"fixed"!=d.style.position&&(d.style.position="fixed",d.style.top=i+"px",("absolute"==n||"relative"==n)&&parseFloat(o)&&(d.style.left=t.x+"px"))}}function a(){h.parentNode&&h.parentNode.removeChild(h),d.style.cssText=l}function s(){var t=p(e.container),n=e.options.toolbarTopOffset||0;t.top<0&&t.bottom-d.offsetHeight>n?r():a()}var l,d,c,u=browser.ie&&browser.version<=6,f=browser.quirks,h=document.createElement("div"),p=function(e){var t;try{t=e.getBoundingClientRect()}catch(n){t={left:0,top:0,height:0,width:0}}for(var i,o={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)};(i=e.ownerDocument)!==document&&(e=domUtils.getWindow(i).frameElement);)t=e.getBoundingClientRect(),o.left+=t.left,o.top+=t.top;return o.bottom=o.top+o.height,o.right=o.left+o.width,o},m=!1,g=utils.defer(function(){s()},browser.ie?200:100,!0);e.addListener("destroy",function(){$(window).off("scroll resize",s),e.removeListener("keydown",g)}),n(e)&&(d=$(".edui-toolbar",e.container)[0],e.addListener("afteruiready",function(){setTimeout(function(){c=$(d).offset().top},100)}),l=d.style.cssText,h.style.height=d.offsetHeight+"px",u&&o(),$(window).on("scroll resize",s),e.addListener("keydown",g),e.addListener("resize",function(){a(),h.style.height=d.offsetHeight+"px",s()}),e.addListener("beforefullscreenchange",function(e,t){t&&(a(),m=t)}),e.addListener("fullscreenchanged",function(e,t){t||s(),m=t}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){s()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){s()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var n=$.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(e){function t(e,n){var i=$("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),o=i.width();return i.remove(),i=null,50>o?e:(e=e.slice(0,n?-4:-1),e.length?t(e+"...",!0):"...")}function n(e){var n=[];for(var i in e.items)e.value.push(i),n.push(i),e.autowidthitem.push(t(i));return e.items=n,e.autoRecord=!1,e}function i(e){for(var n=null,i=[],o=0,r=e.items.length;r>o;o++)n=e.items[o].val,i.push(n.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+n),e.value.push(n),e.autowidthitem.push(t(i[o]));return e.items=i,e}function o(e){var t=null,n=[];e.itemStyles=[],e.value=[];for(var i=0,o=e.items.length;o>i;i++)t=e.items[i],n.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=n,e.autoRecord=!1,e}var r=this,a=r.options.labelMap&&r.options.labelMap[e]||r.getLang("labelMap."+e),s={label:a,title:a,comboboxName:e,items:r.options[e]||[],itemStyles:[],value:[],autowidthitem:[]},l=null,d=null;if(0==s.items.length)return null;switch(e){case"paragraph":s=n(s);break;case"fontfamily":s=i(s);break;case"fontsize":s=o(s)}return l=$.eduibuttoncombobox(s).css("zIndex",r.getOpt("zIndex")+1),d=l.edui(),d.on("comboboxselect",function(t,n){r.execCommand(e,n.value)}).on("beforeshow",function(){0===l.parent().length&&l.appendTo(r.$container.find(".edui-dialog-container")),UM.setTopEditor(r)}),this.addListener("selectionchange",function(t){var n=this.queryCommandState(e),i=this.queryCommandValue(e);d.button().edui().disabled(-1==n).active(1==n),i&&(i=i.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),d.selectItemByLabel(i))}),d.button().addClass("edui-combobox")}),UM.registerUI("forecolor backcolor",function(e){function t(){return domUtils.getComputedStyle(o[0],"background-color")}var n=this,i=null,o=null,r=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);r.edui().disabled(-1==t).active(1==t)}),r=$.eduicolorsplitbutton({icon:e,caret:!0,name:e,title:n.getLang("labelMap")[e],click:function(){n.execCommand(e,t())}}),o=r.edui().colorLabel(),i=$.eduicolorpicker({name:e,lang_clearColor:n.getLang("clearColor")||"",lang_themeColor:n.getLang("themeColor")||"",lang_standardColor:n.getLang("standardColor")||""}).on("pickcolor",function(t,i){window.setTimeout(function(){o.css("backgroundColor",i),n.execCommand(e,i)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",n.getOpt("zIndex")+1),r.edui().on("arrowclick",function(){i.parent().length||n.$container.find(".edui-dialog-container").append(i),i.edui().show(r,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(n)}).register("click",r,function(){i.edui().hide()}),r})}(jQuery);