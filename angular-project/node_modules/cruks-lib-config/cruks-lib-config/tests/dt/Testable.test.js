/**
 * @license Copyright (c) 2013, CKSource - Frederico Knabben
 * @license Copyright (c) 2013-2014, Cruks
 * For licensing, see LICENSE
 */

"use strict";

/*global describe: false, it: false */

var assert = require("chai").assert,
    Testable = require(process.env.PACKAGE_ROOT + "/cruks-lib-config/Testable");

describe("cruks-lib-config/Testable", function () {
    describe("#and()", function () {
        it("combines two assertions", function () {
            var t1 = new Testable(),
                t2 = new Testable();

            t1.assert = function (item) {
                return item * 2;
            };

            assert.strictEqual(4, t2.and(t1).assert(2));
        });
    });

    describe("#normalize()", function () {
        describe("#and()", function () {
            it("normalizes input before passing it further", function () {
                var ret,
                    t1 = new Testable(),
                    t2 = new Testable();

                function normalizer(item) {
                    return item * 2;
                }

                t2.assert = function (item) {
                    return item + 3;
                };

                ret = t1.normalize(normalizer).and(t2).assert(1);

                assert.strictEqual(5, ret);
            });
        });

        it("normalizes current input", function () {
            var t = new Testable(),
                ret;

            ret = t.normalize(function (item) {
                return item * 2;
            }).assert(4);

            assert.strictEqual(8, ret);
        });
    });

    describe("#not()", function () {
        it("disallows assertion", function () {
            var t1,
                t2;

            t1 = new Testable();
            t1.assert = function (item) {
                return item * 2;
            };

            t2 = new Testable();
            t2.assert = function (item) {
                return item * 2;
            };

            assert.strictEqual(4, t2.not(t1).assert(2));
        });
    });
});
