<div class="video-course-edit">
    <div class="top-info">
        <a class="go-back" ng-click="goToListPage()">
            &lt;返回
        </a>
        <span class="one2one-title">/ 设置视频课</span>
        <span ng-bind="'课程编号: ' + courseNumber" ng-if="courseNumber"></span>
        <span class="auto-save" ng-bind="'草稿最近自动保存时间：' + autoSaveTime" ng-if="autoSaveTime"></span>
        <div class="remind-info" ng-if="displayStatus && displayStatus.display" ng-bind="displayStatus.display">
        </div>
    </div>
    <side-nav options="sideNavOptions"></side-nav>
    <div class="course-edit">
        <div class="basic-info module-area">
            <div class="title">
                基础信息
                <span class="help-info" tooltip options="baseInfoHelpOptions">
                    <i class="icon icon-help"></i>
                    帮助信息
                </span>
            </div>
            <div class="verify-rejected" ng-if="courseInfoVerifyReasons" tooltip
                    options="{content:courseInfoVerifyReasons,position:'right',width:500}">
                基础信息审核被拒
                <i class="icon icon-help"></i>
            </div>
            <div class="info-box form">
                <div class="info-item form-group course-name">
                    <span class="info-title">
                        <span class="required-icon">*</span>
                        <span>课程名称</span>
                    </span>
                    <div class="form-input">
                        <input type="text" name="courseName" maxlength="26" placeholder="请输入26字以内" ng-model="baseInfo.courseName"/>
                    </div>
                    <span data-error-for="courseName" class="error"></span>
                    <div class="left-words">还可以输入<span ng-bind="26 - baseInfo.courseName.length"></span>个字</div>
                </div>
                <div class="info-item form-group course-subject">
                    <span class="info-title">
                        <span class="required-icon">*</span>
                        <span>科目</span>
                    </span>
                    <div class="form-input" ng-click="toggleShowSubjectMenu($event)">
                        <input type="text" name="courseSubject"  ng-model="selectSubjectOpts.pathCrumbs" readonly/>
                        <i class="icon icon-caret-down" ng-if="!showSubjectMenu"></i>
                        <i class="icon icon-caret-up" ng-if="showSubjectMenu"></i>
                        <div select-subject options="selectSubjectOpts" ng-show="showSubjectMenu"></div>
                    </div>
                    <span data-error-for="courseSubject" class="error"></span>
                </div>
                <div class="info-item form-group course-price">
                    <span class="info-title">
                        <span class="required-icon">*</span>
                        <span>课程价格</span>
                    </span>
                    <div class="form-input">
                        <input type="text" name="coursePrice"  ng-model="baseInfo.coursePrice" />
                    </div>
                    <span>元</span>
                    <span data-error-for="coursePrice" class="error"></span>
                </div>
                <div class="info-item form-group expire-day">
                    <span class="info-title">
                        <span class="required-icon">*</span>
                        <span>观看期限</span>
                    </span>
                    <div class="form-input">
                        <input type="text" name="expireDays"  ng-model="baseInfo.expireDays" />
                    </div>
                    <span>天</span>
                    <span data-error-for="expireDays" class="error"></span>
                </div>
                <div class="info-item form-group course-language">
                    <span class="info-title">
                        <span class="required-icon">*</span>
                        <span>授课语言</span>
                    </span>
                    <div class="language-dropdown dropdown-item">
                        <language-selector options="languageOptions"></language-selector>
                    </div>
                </div>
                <div class="info-item form-group course-teacher" ng-if="user.user_role == 6">
                    <span class="info-title">
                        <span>授课老师</span>
                    </span>
                    <div class="language-dropdown dropdown-item">
                        <dropdown options="teacherSelectorOptions"></dropdown>
                    </div>
                </div>
                <div class="info-item form-group define-number" ng-if="user.user_role == 6">
                    <span class="info-title">
                        <span>机构课程编码</span>
                    </span>
                    <div class="form-input">
                        <input type="text" name="definedNumber" maxlength="10"  ng-model="baseInfo.definedNumber" />
                    </div>
                    <span data-error-for="definedNumber" class="error"></span>
                </div>
                <div class="info-item form-group course-group" ng-if="user.user_role == 6">
                    <span class="info-title">
                        <span>课程分组</span>
                    </span>
                    <div class="form-input" ng-click="chooseCourseGroup()">
                        <input type="text" name="courseGroup" ng-model="baseInfo.groupName" readonly/>
                    </div>
                </div>
            </div>
        </div>

        <div class="photo-upload module-area">
            <div class="title">
                课程封面
                <span class="help-info" tooltip options="introPicHelpOptions">
                    <i class="icon icon-help"></i>
                    帮助信息
                </span>
            </div>
            <div class="verify-rejected" ng-if="coverVerifyReasons" tooltip
                    options="{content:coverVerifyReasons,position:'right',width:500}">
                课程封面审核被拒
                <i class="icon icon-help"></i>
            </div>
            <div class="upload-coursecover">
                <div class="remind-title">
                    <span class="required-icon">*</span>
                    <span class="text-info">课程封面</span>
                </div>
                <div class="image-box" ng-if="!covers.url" ng-click="uploadCourseCover()">
                    <div>
                        <i class="icon icon-ic_add"></i>
                        上传照片
                    </div>
                    <div class="uploading-mask" ng-if="coverUploading">
                        <span>上传中,请稍后...</span>
                        <span ng-bind="coverUploadParam.uploadedPercent"></span>
                    </div>
                </div>
                <div class="image-box has-image" ng-if="covers.url">
                    <crop-image options="{width:240,height:136,imgSrc:covers.url}"></crop-image>
                </div>
                <div class="bottom-info">
                    <span class="change-cover" ng-if="covers.url"  ng-click="uploadCourseCover()">更换封面</span>
                    <span class="text-info">图片大小不超过5M</span>
                </div>
            </div>
        </div>

        <div class="detail-intro module-area">
            <div class="title">
                图文详情
                <span class="help-info" tooltip options="detailIntroHelpOptions">
                    <i class="icon icon-help"></i>
                    帮助信息
                </span>
            </div>
            <div class="verify-rejected" ng-if="courseDetailVerifyReasons" tooltip
                    options="{content:courseDetailVerifyReasons,position:'right',width:500}">
                图文详情审核被拒
                <i class="icon icon-help"></i>
            </div>
            <rich-editor options="richEditorOptions" ng-show="isNewCourse"></rich-editor>
            <div ng-hide="isNewCourse">
                <div umeditor ng-model="courseDetails" id="demo-umeditor"></div>
            </div>
        </div>

        <div class="videos-upload module-area">
            <div class="title">
                视频上传
                <span class="required-icon">*</span>
                <span class="encode-info" ng-if="encodeInfo && !encodeInfoToolTipOpt" ng-bind="encodeInfo"></span>
                <span class="encode-info" ng-if="encodeInfoToolTipOpt" ng-bind="encodeInfo" tooltip options="encodeInfoToolTipOpt"></span>
                <span class="help-info" tooltip options="videoUploadHelpOptions">
                    <i class="icon icon-help"></i>
                    帮助信息
                </span>
            </div>

            <div class="verify-rejected" ng-if="videoCourseVerifyReasons" tooltip options="{content:videoCourseVerifyReasons,position:'right',width:500}">
                视频审核被拒
                <i class="icon icon-help"></i>
            </div>

            <div class="edit-container">
                <span class="text-title">课程模式</span>
                <label>
                    <input type="radio" name="courseMode" ng-model="courseMode" value="multiple"
                           ng-click="swtichCourseMode('multiple')">
                    多节模式
                </label>
                <label>
                    <input type="radio" name="courseMode" ng-model="courseMode" value="chapter"
                           ng-click="swtichCourseMode('chapter')">
                    章节模式
                </label>
                <div class="remind-info">
                    注：不同的课程模式编辑样式会有所差异，请根据实际需要选择合适的课程模式
                </div>

                <div class="chapter-section" ng-if="courseMode === 'chapter'">
                    <div class="chapter-item" ng-repeat="chapter in chapterSections track by chapter.chapterIndex">

                        <div class="chapter-info" ng-if="!chapter.isEditing">
                            <span ng-bind="'第' + {{chapter.chapterIndex + 1}} + '章'"></span>
                            <span class="chapter-name" ng-bind="chapter.name"></span>
                            <div class="actions">
                                <span class="action-edit" ng-click="editChapter(chapter)">
                                    编辑
                                </span>
                                <span class="action-delete" ng-click="deleteChapter(chapter.chapterIndex)">
                                    删除
                                </span>
                            </div>
                            <i class="icon icon-angle-down" ng-if="!chapter.showSectionList" ng-click="toggleShowList(chapter)"></i>
                            <i class="icon icon-angle-up" ng-if="chapter.showSectionList" ng-click="toggleShowList(chapter)"></i>
                        </div>

                        <edit-chapterinfo ng-if="chapter.isEditing" options="chapter">
                        </edit-chapterinfo>

                        <div class="section-list" ng-if="chapter.showSectionList">
                            <div class="course-item" ng-repeat="section in chapter.sectionList track by $index">

                                <single-videocourse ng-if="section.isEditing" options="section"
                                index="$index"
                                course-mode="{{courseMode}}"
                                is-playbackcourse="isPlaybackCourse"
                                course-number="{{courseNumber}}"
                                course-schedule="chapterSections"
                                chapter-index="chapter.chapterIndex">
                                </single-videocourse>

                                <div ng-if="!section.isEditing" class="section-item">
                                    <span ng-bind="'第'+ {{$index + 1}} + '节'"></span>
                                    <span class="section-name" ng-bind="section.name"></span>
                                    <div class="actions">
                                        <span class="upload-percent" ng-if="section.videoUploading" ng-bind="'已上传' + section.uploadedPercent"></span>

                                        <span class="failure" ng-if="section.videoUploadFailure">
                                            上传失败
                                        </span>
                                        <span class="encode-failure" ng-if="section.encoding_status === 50">
                                            转码失败
                                        </span>

                                        <span class="action-edit" ng-click="editSection(section)">
                                            编辑
                                        </span>

                                        <span class="action-delete" ng-click="deleteSection($index, chapter.chapterIndex)">
                                            删除
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="add-newsection" ng-click="addNewSection(chapter.chapterIndex)" ng-if="!hasEditingItem && !isPlaybackCourse">+ 添加新课节</div>
                        </div>
                    </div>
                    <div class="add-newchapter" ng-click="addNewChapter()" ng-if="!hasEditingItem && !isPlaybackCourse">+ 添加新章节</div>
                </div>

                <div class="multiple-section" ng-if="courseMode === 'multiple'">
                    <div class="course-item" ng-repeat="section in sectionList track by $index">

                        <single-videocourse ng-if="section.isEditing"
                        options="section"
                        index="$index"
                        course-mode="{{courseMode}}"
                        is-playbackcourse="isPlaybackCourse"
                        course-number="{{courseNumber}}"
                        course-schedule="sectionList">
                        </single-videocourse>

                        <div ng-if="!section.isEditing" class="section-item">
                            <span ng-bind="'第'+ {{$index + 1}} + '节'"></span>
                            <span class="section-name" ng-bind="section.name"></span>
                            <div class="actions">
                                <span class="upload-percent" ng-if="section.videoUploading" ng-bind="'已上传' + section.uploadedPercent"></span>

                                <span class="failure" ng-if="section.videoUploadFailure">
                                    上传失败
                                </span>
                                <span class="encode-failure" ng-if="section.encoding_status === 50">
                                    转码失败
                                </span>

                                <span class="action-edit" ng-click="editSection(section)">
                                    编辑
                                </span>
                                <span class="action-delete" ng-click="deleteSection($index)">
                                    删除
                                </span>
                            </div>
                        </div>

                    </div>
                    <div class="add-newsection" ng-click="addNewSection()" ng-if="!hasEditingItem && !isPlaybackCourse">+ 添加新课节</div>
                </div>
            </div>
        </div>

        <div class="course-actions" ng-if="!hasEditingItem && (sectionList.length || chapterSections.length)">
            <span ng-click="sortAll()">
                <i class="icon icon-arrow-sort"></i>
                整体排序
            </span>
            <span ng-click="selectDelete()">
                <i class="icon icon-delete"></i>
                选择删除
            </span>
        </div>

        <div class="modify-reason module-area" ng-if="verifyPassed">
            <div class="title">
                修改原因
                <!-- <span class="help-info" tooltip options="introPicHelpOptions">
                    <i class="icon icon-help"></i>
                    帮助信息
                </span> -->
                <span class="required-icon">*</span>
            </div>
            <textarea placeholder="请填写修改原因，此原因将会影响审核是否通过" ng-model="baseInfo.modifyReasons"></textarea>
        </div>
    </div>
    <div class="release-course">
        <button class="save-btn"
                ng-click="releaseCourse()"
                ng-disabled="savingCourse || hasEditingItem || coverUploading || hasUploadingEditorItem"
                ng-class="{'btn-disabled':savingCourse || hasEditingItem || coverUploading || hasUploadingEditorItem}">
            立即发布课程
        </button>
    </div>
</div>