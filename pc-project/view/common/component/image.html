{{ *

@file: 单独用一个组件来设置图片大小，避免显示小图却加载大图片

       参数：

       url 必传
       lazy_load 是否需要延迟加载
       onerror 添加onerror属性
       width 必传
       class 可选，图片 class
       alt 可选，说明文字，当图片加载失败，会显示出来
       no_crop 可选，是否不裁剪
       no_img 可选, 是否不输出图片,只定义$url

@author: zhujialu

* }}
{{ strip }}

{{ if isset($class) }}
    {{ $class = ' class="'|cat: $class|cat: '"' }}
{{ else }}
    {{ $class = '' }}
{{ /if }}

{{ if isset($alt) }}
    {{ $alt = ' alt="'|cat: $alt|cat: '"' }}
{{ else }}
    {{ $alt = '' }}
{{ /if }}

{{ * 暂时只有下面这几种尺寸，先写死 * }}

{{ $width2height = [ ] }}
{{ $width2height['160'] = 120 }}
{{ $width2height['180'] = 134 }}
{{ $width2height['48'] = 48 }}
{{ $width2height['54'] = 54 }}
{{ $width2height['58'] = 58 }}
{{ $width2height['60'] = 60 }}
{{ $width2height['66'] = 66 }}
{{ $width2height['72'] = 72 }}
{{ $width2height['78'] = 78 }}
{{ $width2height['80'] = 80 }}
{{ $width2height['90'] = 90 }}
{{ $width2height['98'] = 98 }}
{{ $width2height['120'] = 120 }}
{{ $width2height['150'] = 150 }}
{{ $width2height['152'] = 152 }}
{{ $width2height['240'] = 170 }}
{{ $width2height['200'] = 150 }}
{{ $width2height['167'] = 167 }}
{{ $width2height['130'] = 74 }}
{{ $width2height['390'] = 293 }}
{{ $width2height['70'] = 54 }}

{{ $parts = explode('.', $url) }}
{{ $extname = array_pop($parts) }}

{{ if $extname === 'gif' }}
    {{ $extname = 'jpg' }}
{{ /if }}

{{ if isset($no_crop) && $no_crop }}
    {{ $crop_value = '0' }}
{{ else }}
    {{ $crop_value = '1' }}
{{ /if }}

{{ if !isset($height) }}
    {{ $height = $width2height[$width] }}
{{ /if }}

{{ $width = intval($width) }}
{{ $height = intval($height) }}

{{ if isset($no_img) }}
    {{ $url = $url|cat: "@"|cat: $crop_value|cat: "e_"|cat: $width|cat:"w_"|cat: $height|cat: 'h_1c_0i_1o_90Q_1x.'|cat: $extname scope="parent" }}
    {{ $url }}
{{ else }}
    {{ $url = $url|cat: "@"|cat: $crop_value|cat: "e_"|cat: $width|cat:"w_"|cat: $height|cat: 'h_1c_0i_1o_90Q_1x.'|cat: $extname }}

    <img {{ if isset($lazy_load) && $lazy_load }}data-{{ /if }}src="{{ $url }}" {{ $class }}{{ $alt }} width="{{ $width }}" height="{{ $height }}" {{ if !empty($onerror) }}onerror="{{ $onerror }}"{{ /if }}/>
{{ /if }}

{{ /strip }}
