{{ *

@file 新版老师详情页 - 评价页 2015.5.12
@author jixiaohui

* }}

{{ extends file="common/main/base.html" }}

{{ block name="data" }}
{{ strip }}
    {{ $smarty.block.parent }}
    {{ $script_path = "teacher/newComment" }}
    {{ $script_data.teacherId = $tpl_data.profile.user_id }}
    {{ $script_data.teacherNum = $tpl_data.profile.user_number }}
    {{ $script_data.domain = $tpl_data.profile.domain }}
    {{ $script_data.teacherName = $tpl_data.profile.name }}
    {{ $script_data.isFavored = $tpl_data.is_favored }}
    {{ $script_data.audio = $tpl_data.profile.audio }}
    {{ $script_data.audio_length = $tpl_data.profile.audio_length }}
    {{ $script_data.userId = $user_data.user_id }}
    {{ if !empty($tpl_data.profile.org_type) }}
        {{ $script_data.org_type = $tpl_data.profile.org_type }}
    {{ /if }}
    {{ if !empty($tpl_data.profile.organization) }}
        {{ $script_data.org_id = $tpl_data.profile.organization.id }}
    {{ /if }}
    {{ $script_data.sortby = $tpl_data.comment_data.additional.comment_nav.sort_by }}
    {{ $script_data.url = "/"|cat:$tpl_data.profile.domain|cat:"/tcomment"|cat:"?face_type="|cat:$tpl_data.comment_data.additional.comment_nav.face_type|cat:"&comment_type="|cat:$tpl_data.comment_data.additional.comment_nav.comment_type }}

    {{ $nav_config.hidden = 1 }}
    {{ $nav_config.active = '' }}

    {{ $baidu_share_text = "#跟谁学# 分享一位老师给你哦~"|cat: $tpl_data.profile.name }}
    {{ $baidu_share_text = $baidu_share_text|cat: "，"|cat: $tpl_data.profile.slogan|regex_replace:"/[\r\t\n]/":" " }}
    {{ $baidu_share_text = $baidu_share_text|cat: "，还在等什么？找好老师，上跟谁学，快来开启寻师之旅吧！" }}

    {{ $baidu_share_image = $static_origin|cat:"/asset/img/share.jpg" }}

    {{ **顶部搜索去掉placeholder支持空query** }}
    {{ $current_page = 'detail' }}
    {{ $need_location_seo = true }}

{{ /strip }}
{{ /block }}

{{ block name="title" }}
    {{ $tpl_data.title }}
{{ /block }}

{{ block name="keywords" }}
    {{ $tpl_data.keywords }}
{{ /block }}

{{ block name="description" }}
    {{ $tpl_data.description }}
{{ /block }}

{{ block name="style" }}
<link rel="stylesheet" href="{{ $static_origin }}/src/css/teacher/newComment.less">
{{ /block }}

{{ block name="main" }}
{{ strip }}

{{ include file="./newDetail/crumb.html" profile=$tpl_data.profile crumb=$tpl_data.crumb }}
{{ include file="./common/banner.html" }}

{{ **李杜老师特殊处理, 329108828** }}
{{ $hidden = true }}

<div id="main" class="comment-active">
    {{ include "teacher/newDetail/profile.html" tpl_data=$tpl_data.profile is_favored=$tpl_data.is_favored active="comment"  }}

    <div id="teacher-content">
        {{ $totalCount = $tpl_data.comment_data.additional.comment_type.total.total_count }}
        <!-- <div id="teacher-comment" class="show-teacher-comment">
            <div class="new-title">所有评价</div>

                <div class="overview">
                    {{ include file="teacher/newDetail/commentOverview.html" tpl_data=$tpl_data }}
                </div>

                <div class="tab-nav-info">

                    {{ $additional = $tpl_data.comment_data.additional }}
                    {{ $comment_nav = $additional.comment_nav }}
                    {{ $comment_type = $additional.comment_type }}
                    {{ $count = $additional.face_type }}

                    {{ *全部评价0 一对一评价1 邀请评价2 班课评价3 视频课评价4* }}

                    {{ $item_all_html = '<li class="nav-item list-source" data-comment="0">全部评价（'|cat:$comment_type.total.total_count|cat:'）</li>' }}

                    {{ if $comment_type.normal.total_count }}
                        {{ $item_order_html = '<li class="nav-item list-source" data-comment="1">一对一评价（'|cat:$comment_type.normal.total_count|cat:'）</li>' }}
                    {{ else }}
                        {{ $item_order_html = '' }}
                    {{ /if }}

                    {{ if $comment_type.invite.total_count }}
                        {{ $item_invite_html = '<li class="nav-item list-source" data-comment="2">邀请评价（'|cat:$comment_type.invite.total_count|cat:'）</li>' }}
                    {{ else }}
                        {{ $item_invite_html = '' }}
                    {{ /if }}

                    {{ if $comment_type.class.total_count }}
                        {{ $item_course_html = '<li class="nav-item list-source" data-comment="3">班课评价（'|cat:$comment_type.class.total_count|cat:'）</li>' }}
                    {{ else }}
                        {{ $item_course_html = '' }}
                    {{ /if }}

                    {{ if $comment_type.video.total_count }}
                        {{ $item_video_html = '<li class="nav-item list-source" data-comment="4">视频课评价（'|cat:$comment_type.video.total_count|cat:'）</li>' }}
                    {{ else }}
                        {{ $item_video_html = '' }}
                    {{ /if }}

                    {{ if $comment_nav.comment_type == 0 }}
                        {{ $comment_source = '全部评价（'|cat:$comment_type.total.total_count|cat:'）' }}
                        {{ $comment_value = 0 }}
                        {{ $other_comment_source = $item_order_html|cat:$item_course_html|cat:$item_video_html|cat:$item_invite_html }}
                    {{ elseif $comment_nav.comment_type == 1 }}
                        {{ $comment_source = '一对一评价（'|cat:$comment_type.normal.total_count|cat:'）' }}
                        {{ $comment_value = 1 }}
                        {{ $other_comment_source = $item_all_html|cat:$item_course_html|cat:$item_video_html|cat:$item_invite_html }}
                    {{ elseif $comment_nav.comment_type == 2 }}
                        {{ $comment_source = '邀请评价（'|cat:$comment_type.invite.total_count|cat:'）' }}
                        {{ $comment_value = 2 }}
                        {{ $other_comment_source = $item_all_html|cat:$item_order_html|cat:$item_course_html|cat:$item_video_html }}
                    {{ elseif $comment_nav.comment_type == 3 }}
                        {{ $comment_source = '班课评价（'|cat:$comment_type.class.total_count|cat:'）' }}
                        {{ $comment_value = 3 }}
                        {{ $other_comment_source = $item_all_html|cat:$item_order_html|cat:$item_video_html|cat:$item_invite_html }}
                    {{ elseif $comment_nav.comment_type == 4 }}
                        {{ $comment_source = '视频课评价（'|cat:$comment_type.video.total_count|cat:'）' }}
                        {{ $comment_value = 4 }}
                        {{ $other_comment_source = $item_all_html|cat:$item_order_html|cat:$item_course_html|cat:$item_invite_html }}
                    {{ /if }}
                    <div class="top-nav">
                        {{ include file="common/ui/dropdown.html" class="sort-select" default_text="默认排序" }}
                        <b class="item{{ if $comment_nav.comment_type == 0 }} nav-active{{ /if }}">
                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=0&sort_by={{ $comment_nav.sort_by }}&comment_tag=all" data-comment="0" data-type="1">
                              全部评价
                            </a>
                        </b>
                        <b class="item{{ if $comment_nav.comment_type == 1 }} nav-active{{ /if }}">
                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=1&sort_by={{ $comment_nav.sort_by }}&comment_tag=all" data-comment="1" data-type="2">
                                1对1评价
                            </a>
                        </b>
                        <b class="item{{ if $comment_nav.comment_type == 3 }} nav-active{{ /if }}">
                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=3&sort_by={{ $comment_nav.sort_by }}&comment_tag=all" data-comment="3" data-type="3">
                                班课评价
                            </a>
                        </b>
                        <b class="item{{ if $comment_nav.comment_type == 4 }} nav-active{{ /if }}">
                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=4&sort_by={{ $comment_nav.sort_by }}&comment_tag=all" data-comment="4" data-type="4">
                                视频课评价
                            </a>
                        </b>
                        <b class="item{{ if $comment_nav.comment_type == 2 }} nav-active{{ /if }}">
                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=2&sort_by={{ $comment_nav.sort_by }}&comment_tag=all" data-comment="2">
                                邀请评价
                            </a>
                        </b>
                    </div>

                    {{ if isset($additional.comment_tag) && $additional.comment_tag }}
                    <ul class="comment-label">

                        {{ foreach $additional.comment_tag as $tag }}
                        <li class="{{ if $tag.type==2 }} negative {{ else }} positive {{ /if }} {{ if $tag.selected }} selected {{ /if }}" data-value="{{ $tag.value }}" data-name="{{ $tag.name }}" data-count="{{ $tag.count }}">

                            <a href="/{{ $tpl_data.profile.domain }}/tcomment?face_type={{ $comment_nav.face_type }}&comment_type=0&sort_by={{ $comment_nav.sort_by }}&comment_tag={{ $tag.value }}" data-tag="{{ $tag.value }}" >

                                {{ $tag.name }}
                                {{ if $tag.count > 0 }}
                                    <em>{{ $tag.count }}</em>
                                {{ /if }}
                            </a>
                        </li>
                        {{ /foreach }}
                    </ul>
                    {{ /if }}
                </div>

                {{ if $totalCount > 0 }}
                    <div class="nav-content">

                        {{ $comment_list = $tpl_data.comment_data.comment_list }}
                        {{ $pager = $tpl_data.comment_data.pager }}
                        {{ include file="common/variable/lesson.html" scope=parent }}

                        {{ if count($comment_list) > 0 }}
                        <div class="list">

                            {{ foreach $comment_list as $item }}
                            <div class="item">

                                <dl>
                                    <dt>
                                        {{ if $item.anonymous == 1 }}
                                            {{ include file="common/component/avatar.html" type="small" img=$item.user.avatar_url }}
                                        {{ else }}
                                            <a href="/x/{{ $item.user.number }}" target="_blank">
                                                {{ include file="common/component/avatar.html" type="small" img=$item.user.avatar_url }}
                                            </a>
                                        {{ /if }}

                                        <div class="user-name">
                                            {{ $item.user.display_name|cn_truncate: 4 }}
                                            {{ if isset($item.fr) }}
                                                {{ if $item.fr == 2 && !empty($item.del) }}
                                                    <span class="del" data-id="{{ $item.comment_id }}">删除</span>
                                                {{ /if }}
                                            {{ /if }}
                                        </div>

                                    </dt>
                                </dl>

                                <div class="comment">

                                    <div class="score-info">

                                        {{ include file="common/component/starScore.html" score=$item.total_score fr=$item.fr }}

                                    </div>

                                    <div class="content">
                                        {{ if isset($item.fr) && ($item.fr == 1 || $item.fr == 3) }}
                                            未做出评价，系统默认评价！
                                        {{ else }}
                                            {{ $item.info|escape }}
                                        {{ /if }}
                                    </div>

                                    {{ if !empty($item.photo_list) }}
                                    <div class="comment-photo-box">
                                        <ul class="comment-photo-list">
                                            {{ foreach $item.photo_list as $val }}
                                            <li class="photo-item" data-image="{{ $val.url }}" data-name="{{ $val.title }}" {{ include file="common/variable/zoomPhoto.html" url=$val.url raw_width=$val.width raw_height=$val.height width=400 height=300 }} data-horizontal="{{ $photo }}" data-hheight="{{ $fit_height }}"

                                            {{ include file="common/variable/zoomPhoto.html" url=$val.url raw_width=$val.height raw_height=$val.width width=300 height=400 }} data-vertical="{{ $photo }}" data-vheight="{{ $fit_height }}"

                                            >
                                                {{ include file="common/variable/photo.html" url=$val.url raw_width=$val.width raw_height=$val.height width=80 height=60 }}
                                                <img src="{{ $photo }}">
                                            </li>
                                            {{ /foreach }}
                                        </ul>
                                        <div class="comment-photo-player" style="display:none;">
                                            <ul class="photo-action">
                                                <li class="packup"><i class="photo-icon photo-packup"></i>收起</li>
                                                <li class="sourse"><i class="photo-icon photo-sourse"></i>原图</li>
                                                <li class="left"><i class="photo-icon photo-left"></i>向左转</li>
                                                <li class="right"><i class="photo-icon photo-right"></i>向右转</li>
                                            </ul>
                                            <div class="photo-wrapper">
                                            {{ *垂直居中* }}
                                            {{ *margin-bottom:-{{ $fit_height/2 }}px;* }}
                                                <div class="floater" style=""></div>
                                                <img src="" class="rotate-img">
                                            </div>
                                            <div class="photo-name">
                                            </div>
                                        </div>
                                    </div>
                                    {{ /if }}

                                    <div class="order-info">
                                        {{ if isset($item.fr) && $item.fr == 2 }}
                                        <span>邀请评价</span>
                                        {{ else }}
                                            {{ if !empty($item.course_type)&&$item.course_type == 2 }}
                                                <a href="{{ $item.course.course_url }}">班课：{{ $item.course.course_name }}</a>
                                            {{ else }}
                                                {{ if !empty($item.course_url) }}
                                                <a href="{{ $item.course.course_url }}">
                                                    班课：{{ $item.course.course_name|cn_truncate: 30 }}
                                                </a>
                                                {{ else }}
                                                <span>{{ $item.course.course_name|cn_truncate: 33 }}</span>
                                                {{ /if }}
                                            {{ /if }}
                                            <span>{{ $item.course.lesson_way_name }}</span>
                                            <span>{{ $item.display_title }}</span>
                                            <a href="{{ $item.course.teacher_url }}">{{ $item.course.teacher_name }}</a>
                                        {{ /if }}

                                        <span class="date">
                                            {{ $item.create_time }}
                                        </span>
                                    </div>
                                    <div class="feedback">
                                        {{ if empty($item.thumb_flag) }}
                                            {{ $item.thumb_flag=0 }}
                                        {{ /if }}
                                        <b class="link btn-support" data-supported="{{ $item.thumb_flag }}" data-id="{{ $item.comment_id }}" data-count="{{ $item.thumb_up }}"{{ if $item.thumb_flag == 1 }} data-title="你已经点过了哦"{{ /if }}>
                                            有用
                                            <span>
                                            （<em>{{ $item.thumb_up }}</em>）
                                            </span>
                                        </b>

                                        {{ if isset($item.if_can_review) && $item.if_can_review }}
                                            <b class="link reply-comment-btn">回复</b>
                                        {{ /if }}

                                    </div>

                                    {{ if isset($item.if_can_review) && $item.if_can_review }}
                                    <div class="form comment-form" data-commentid="{{ $item.comment_id }}">

                                        <div class="form-group">
                                            <div class="form-editor">
                                                <textarea class="form-text" name="info" placeholder=""></textarea>
                                                <div class="form-hint">
                                                    还可以输入 <strong>200</strong> 个字
                                                </div>
                                            </div>

                                            <span class="error"></span>
                                        </div>

                                        <div class="form-action">
                                            <button class="btn-primary small comment-submit">
                                                发布
                                            </button>
                                        </div>
                                    </div>
                                    {{ /if }}

                                    {{ if isset($item.additional) && isset($item.additional.student) }}
                                        <div class="add-comment-show">
                                            ［追加评论］{{ $item.additional.student.info }}
                                        </div>
                                    {{ /if }}

                                    {{ if isset($item.additional) && isset($item.additional.teacher) }}
                                        <div class="comment-reply">
                                            ［回复］{{ $item.additional.teacher.info }}
                                        </div>
                                    {{ /if }}

                                </div>

                                {{ if isset($item.other_comment) && count($item.other_comment) > 0 }}
                                    {{ include "teacher/otherComment.html" val=$item }}
                                {{ /if }}

                            </div>
                            {{ /foreach }}

                        </div>
                        {{ /if }}

                        {{ include file="teacher/newDetail/pager.html" page=$pager.page page_size=$pager.page_size count=$pager.count  url='/'|cat:$tpl_data.profile.domain|cat:'/tcomment' fix="?face_type="|cat:$comment_nav.face_type|cat:'&comment_type='|cat:$comment_nav.comment_type|cat:'&sort_by='|cat:$comment_nav.sort_by }}
                    </div>
                {{ else }}
                    <div id="teacher-no-comment" style="height:340px;">
                        {{ if $tpl_data.comment_data.additional.user_diff == 0 }}
                            <div class="no-comment-icon"></div>
                            <span>暂时还没有评价<br/></span>
                            <button class="btn btn-primary" id="comment-more">
                                写评价
                            </button>
                        {{ else }}
                            <div class="no-comment-icon"></div>
                            <span>暂时还没有评价</span>
                        {{ /if }}
                    </div>
                {{ /if }}

        </div> -->
        
        {{ include file="teacher/newDetail/newComment.html" }}

        {{ include file="teacher/detail/orderForm.html" tpl_data=$tpl_data.teach.subject min_price=$tpl_data.teach.min_price hidden=$hidden can_order=$tpl_data.profile.can_order }}
    </div>
</div>
{{ /strip }}
{{ /block }}

{{ block name="inner_link" }}
{{ include file="common/innerlink/searchList.html" data=$tpl_data.pageInnerLinks mod="老师" inner_type="teacher" }}
{{ /block }}

{{ block name="script" }}
{{ strip }}
    {{ include file="common/component/loginDialog.html" onlyShowStudent=1 }}
{{ /strip }}
{{ /block }}
