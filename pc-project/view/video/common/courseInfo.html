{{ *

@file 视频课详情页 - 课程信息
@author wangyujie

* }}

{{ strip }}

<div id="course-info" class="card">

    <div class="imgshow">
        {{ include file="common/variable/photo.html" url=$tpl_data.portrait raw_width=480 raw_height=270 width=480 height=270 }}
        <img src="{{ $photo }}">

        <div class="action">
            {{ $share_text = "#跟谁学# 分享一门精致视频课程给你哦~"|cat: $tpl_data.name }}
            {{ $share_text = $share_text|cat: "，还在等什么？找好老师，上跟谁学，快来开启寻师之旅吧！" }}

            {{ $share_data = [] }}
            {{ $share_data.url = $root_http|cat: '/video_course/getcourseshowdetail?number='|cat: $tpl_data.number }}
            {{ $share_data.title = $share_text }}
            {{ $share_data.content = ' ' }}
            {{ $share_data.img = $tpl_data.portrait }}

            {{ $is_self_share = isset($tpl_data.self_share_info) && $tpl_data.self_share_info }}

            <span id="favor">
                <i class="icon icon-favor"></i>
                <span>收藏</span>
            </span>

            <span class="popularity">
                (<span>0</span>人)
            </span>

            {{ if $is_self_share }}
            <span class="social-share">
                <span class="share-wrapper" data-share='{{ json_encode($share_data, 77) }}' data-query='{"sf": 1}'>
                    <i class="icon icon-share"></i>
                    分享
                </span>
            </span>
            {{ else }}
            <span class="social-share">
                <span class="share-wrapper" data-share='{{ json_encode($share_data, 77) }}'>
                    <i class="icon icon-share"></i>
                    分享
                </span>
            </span>
            {{ /if }}

        </div>
    </div>

    <div class="baseinfo">
        <ul class="info">
            <li class="video-title">
                {{ $title = $tpl_data.name|cn_truncate:22 }}
                <span class="txt" {{ if $title != $tpl_data.name }}data-title="{{ $tpl_data.name }}" data-width="20em"{{ /if }}>
                    {{ $title }}
                </span>
            </li>

            <li class="price">
                {{ $show_zhekou_tips = false }}
                {{ if !empty($tpl_data.discount) && $tpl_data.discount }}
                    {{ if $tpl_data.discount.type == 1 }}
                        {{ * 限额折扣 活动中提醒 * }}
                        {{ $show_zhekou_tips = true }}
                        {{ $remain_amount = $tpl_data.discount.remain_amount }}
                        {{ $class = "price-tip-end" }}
                        {{ $price = $tpl_data.discount.discount_price }}
                        {{ $price_no = $tpl_data.discount.pre_price }}
                    {{ else if $tpl_data.discount.type == 2 }}
                        {{ $cur_time = $smarty.now }}
                        {{ $start_time = strtotime($tpl_data.discount.start_time) }}
                        {{ $end_time = strtotime($tpl_data.discount.end_time) }}

                        {{ if ($start_time - $cur_time) < (24*60*60) && ($start_time - $cur_time > 0) }}
                            {{ * 活动开始前24小时提醒 * }}
                            {{ $show_zhekou_tips = true }}
                            {{ $zhekou_descript = "限时折扣｜距抢购开始 " }}
                            {{ $class = "price-tip-begin" }}
                            {{ $time = ($start_time - $cur_time) }}
                            {{ $price = $tpl_data.discount.pre_price }}
                            {{ $price_no = $tpl_data.discount.discount_price }}
                        {{ else if ($start_time < $cur_time) && ($cur_time < $end_time) }}
                            {{ * 活动进行中的提醒 * }}
                            {{ $show_zhekou_tips = true }}
                            {{ $zhekou_descript = "限时折扣｜距抢购结束 " }}
                            {{ $class = "price-tip-end" }}
                            {{ $time = ($end_time - $cur_time) }}
                            {{ $price = $tpl_data.discount.discount_price }}
                            {{ $price_no = $tpl_data.discount.pre_price }}
                        {{ /if }}
                    {{ /if }}
                {{ /if }}

                <span class="price-now">
                    &nbsp;￥
                    <em>
                        {{ if $show_zhekou_tips }}
                            {{ $price }}
                        {{ else }}
                            {{ $tpl_data.price }}
                        {{ /if }}
                    </em>
                </span>

                {{ if $show_zhekou_tips }}
                    <span class="previous">
                        {{ if $class == "price-tip-begin" }}
                            <span class="cheap-price">
                                抢购价：￥{{ $price_no }}
                            </span>
                        {{ else if $class == "price-tip-end" }}
                            <span>￥{{ $price_no }}</span>
                        {{ /if }}
                    </span>
                {{ /if }}

                {{ if $tpl_data.fenqi }}
                    <span class="can-stage">
                        <span class="stage-desc">
                            {{ $tpl_data.fenqi.desc }}
                        </span>
                        <span class="stage-pay">
                            {{ $tpl_data.fenqi.tag_name }}&gt;
                        </span>
                    </span>
                {{ /if }}

                {{ $coupons = $tpl_data.coupons }}
                {{ if isset($coupons) && count($coupons) > 0 }}
                    <div class="get-coupon text-primary">
                        <div class="coupons">
                            <i class="icon icon-coupons"></i><span>&nbsp;领取优惠券</span>
                        </div>
                        <div class="coupon">
                            <span class="small-arrow"></span>
                            <span class="big-arrow"></span>
                            <ul class="coupon-list">
                                {{ foreach $coupons as $item }}
                                <li class="coupon-color" data-num="{{ $item.serial_num }}">
                                    <div class="coupon-info">
                                        <div class="balance">
                                            ￥<em>{{ $item.balance }}</em>
                                        </div>
                                        <div class="threshold">
                                            {{ if $item.cond_course_type != 0 }}
                                            指定课程可用
                                            {{ else if $item.cond_threshold == 0 }}
                                            不限
                                            {{ else }}
                                            满{{ $item.cond_threshold }}使用
                                            {{ /if }}
                                        </div>
                                    </div>
                                    <div class="status">
                                        {{ include file="common/variable/couponStatus.html" scope=parent }}
                                        {{ $couponStatusMap[1] }}
                                    </div>

                                </li>
                                {{ /foreach }}
                            </ul>
                        </div>
                    </div>
                {{ /if }}
            </li>

            <li class="learning">
                <i class="icon icon-group-o"></i>
                <span class="text-primary">
                    {{ $tpl_data.payer_count }}
                </span>
                人已报名

                {{ if $show_zhekou_tips && $tpl_data.discount.type == 1 }}
                    <div class="zhekou-info {{ $class }}">
                        限额折扣｜剩余{{ $remain_amount }}个优惠名额
                    </div>
                {{ else if $show_zhekou_tips && !empty($time) && $tpl_data.discount.type == 2 }}
                    <div class="zhekou-info {{ $class }}">
                        {{ $zhekou_descript }}
                        <span class="limit-discount {{ $class }}" data-cur="{{ $cur_time }}" data-start="{{ $start_time }}" data-end="{{ $end_time }}">
                            <span class="time">
                                {{ include file='common/component/countDown.html' time=$time }}
                            </span>
                        </span>
                    </div>
                {{ /if }}
            </li>

            <li class="play-times">
                <i class="icon icon-play-oo"></i>
                {{ $tpl_data.play_count }}次播放
            </li>

            <li class="section">
                <i class="icon icon-clock-o"></i>
                共{{ $tpl_data.course_items_count }}节课
            </li>

            <li class="section">
                {{ if $tpl_data.price }}
                    <span class="watch-time">
                        <i class="watch"></i>
                        {{ if $tpl_data.expire_time }}
                            {{ $tpl_data.expire_time }}天随时看
                        {{ else }}
                            随时看
                        {{ /if }}
                    </span>
                {{ /if }}

                {{ include file="common/variable/videoLanguage.html" scope=parent }}
                <span class="language">
                    <span>语言：</span>{{ $video_language[$tpl_data.language] }}
                </span>
            </li>

            <li class="button-box">
                {{ if $tpl_data.has_buy_course }}
                    <button class="btn btn-success start">
                        开始学习
                    </button>
                {{ else if $tpl_data.can_study || $tpl_data.price == 0 }}
                    {{ if $tpl_data.price == 0 }}
                    <button class="btn btn-default join">
                        加入我的视频课
                    </button>
                    {{ /if }}

                    <button class="btn btn-success start">
                        开始学习
                    </button>
                {{ else }}
                    {{ if $tpl_data.first_trial_url }}
                        <a href="{{ $tpl_data.first_trial_url }}" target="_blank" class="btn btn-default audition">
                            免费试听
                        </a>
                    {{ /if }}
                    <button class="btn btn-primary buy">
                        立即购买
                    </button>
                {{ /if }}
            </li>
        </ul>
    </div>
</div>

{{ /strip }}