{{ *

@file 播放视频
@author xuzheng
@date 2015.10.21

* }}

{{ extends file="common/base.html" }}

{{ block name="data" }}
{{ $need_im = false }}
{{ $smarty.block.parent }}

{{ $script_path = "video/player" }}
{{ **后端返回的视频上报相关数据** }}
<!--{{ $script_data.report = $tpl_data.report }}
{{ $script_data.play_url = $tpl_data.play_url }}
{{ $script_data.video_info = $tpl_data.video_info }}
{{ $script_data.video_url = $tpl_data.video_info.urls[0].url }}
{{ $script_data.video_id = $tpl_data.video_unique }}-->
{{ $script_data.token = $tpl_data.play_token }}
{{ $script_data.vid = $tpl_data.fid }}
{{ $script_data.video_info = $tpl_data.video_info }}

{{ /block }}


{{ block name="title" prepend }}
{{ strip }}

{{ if isset($tpl_data.video_title) }}
    {{ $tpl_data.video_title }}
{{ else }}
    播放视频
{{ /if }}

{{ /strip }}
{{ /block }}

{{ block name="style" }}
{{ strip }}
<link href="http://www.baijiacloud.com/web/asset/playback/player.css?v={{ $smarty.now }}"
          rel="stylesheet">
<style>
    html,
    body {
        height: 100%;
        width: 100%;
        margin: 0;
    }

</style>
{{ /strip }}
{{ /block }}

{{ block name="body" }}
{{ strip }}
<!--<script>
    var videoVod;

    (function () {
        var ready_swf = {};
        var wait_swf = {};
        window.flash_ready = function (swf_id) {
            var objectElements = document.getElementsByTagName('object');
            for (var i = 0; i < objectElements.length; i++) {
                if (objectElements[i].getAttribute('data-id') == swf_id) {
                    ready_swf[swf_id] = objectElements[i];
                    if (wait_swf[swf_id]) {
                        wait_swf[swf_id](objectElements[i]);
                    }
                    break;
                }
            }
        };
        window.getFlash = function (swf_id, callback) {
            if (ready_swf[swf_id]) {
                callback(ready_swf[swf_id]);
            } else {
                wait_swf[swf_id] = callback;
            }
        };
    })();
</script>-->
<!--{{ if isset($tpl_data.play_url) && $tpl_data.play_url }}
    <div id="main">
        {{ if $is_mobile_platform }}

            {{ * 水印 * }}
            {{ if isset($tpl_data.video_info.watermark) && $tpl_data.video_info.watermark }}
                <img class="watermark" src="{{ $tpl_data.video_info.watermark }}@1e_74w_74h_1c_0i_1o_90Q_1x.png"/>
            {{ /if }}

            <video id="video"
                    controls="controls"
                    preload="none"
                    src=""
                    {{ if $is_ios }}
                        poster="{{ $tpl_data.video_info.cover }}"
                    {{ else }}
                        bkg="{{ $tpl_data.video_info.cover }}"
                    {{ /if }}></video>

            {{ if !$is_ios }}
                <script>
                    var screenWidth = screen.width;
                    var video = document.getElementById('video');
                    video.style.background = "url("
                        + video.getAttribute('bkg')
                        + "@" + screenWidth + "w_70Q.jpg) 50% 50% no-repeat transparent";
                </script>
            {{ /if }}

        {{ else }}

            {{ if !empty($tpl_data.logourl) }}
                {{ $params['logourl'] = $tpl_data.logourl }}
            {{ /if }}
            {{ $params['tailurl'] = 'http://d.gsxservice.com/video/files/over.flv' }}

            {{ $params['picStartUrl'] = 'http://d.gsxservice.com/video/files/video_bg.png' }}
            {{ $params['autoplay'] = 0 }}

            {{ if !empty($smarty.get.definition) }}
                {{ $params['definition'] = $smarty.get.definition }}
            {{ /if }}

            {{ * foreach $tpl_data.video_info.urls as $item * }}
                {{ * $params[$item.definition|cat:'_url'] = $item.url * }}
                {{ * $params[$item.definition|cat:'_width'] = $item.width * }}
                {{ * $params[$item.definition|cat:'_height'] = $item.height * }}
            {{ * /foreach * }}

            {{ * 水印 * }}
            {{ if isset($tpl_data.video_info.watermark) }}
                {{ $params['watermark'] = $tpl_data.video_info.watermark }}
            {{ /if }}

            {{ $params['_url'] = $tpl_data.play_url }}

            {{ $params['swf_id'] = $tpl_data.video_unique }}

            {{ $file_root = 'http://d.gsxservice.com/video/'|cat: $env|cat: '/player' }}

            {{ if isset($user_data) && $user_data.user_number }}
                {{ $params['userno'] = $user_data.user_number }}
            {{ /if }}

            {{ $swf_url = $file_root|cat: '/GSXPlayer.swf?t='|cat: $smarty.now }}

            {{ * 测试 * }}
            {{ * $swf_url = 'http://123.56.4.1:8080/sunyong/GSXPlayer.swf' * }}
            {{ * 测试 end * }}

            <object id="BJHLPlayer"
                    name="BJHLPlayer"
                    type="application/x-shockwave-flash"
                    data="{{ $swf_url }}"
                    data-id="{{ $tpl_data.video_unique }}"
                    width="100%"
                    height="100%">
                <param name="wmode" value="transparent">
                <param name="movie" value="{{ $swf_url }}">
                <param name="quality" value="high">
                <param name="menu" value="false">
                <param name="allowScriptAccess" value="always">
                <param name="allowFullScreen" value="true">
                <param name="flashvars" value="{{ http_build_query($params) }}">
            </object>
        {{ /if }}

    </div>
{{ else }}

    <div>{{ $tpl_data.error_msg }}</div>

{{ /if }}-->

<div class="video-container" style="height: 100%; width: 100%;">

</div>


{{ if $env == 'test' }}
    <script src="http://test-www.baijiacloud.com/web/asset/playback/player.js?v={{ $smarty.now }}"></script>
{{ else }}
    <script src="http://www.baijiacloud.com/web/asset/playback/player.js?v={{ $smarty.now }}"></script>
{{ /if }}
{{ include file="common/script.html" }}
{{ /strip }}
{{ /block }}