define('cobble/form/Select',['require','exports','module','../ui/ComboBox','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return i.init(this,e);}var n=require('../ui/ComboBox'),t=require('../function/jquerify'),i=require('../function/lifeCycle');return e.prototype={constructor:e,type:'Select',init:function(){var e=this,t=e.element,i='<input type="hidden" name="'+e.name+'"';if(null!=e.value)i+=' value="'+e.value+'"';if(t.attr('required'))i+=' required';i+=' />';var o=e.input=$(i);t.append(o),e.comboBox=new n({element:t,button:t.find(e.buttonSelector),menu:t.find(e.menuSelector),data:e.data,value:e.value,show:e.show,hide:e.hide,defaultText:e.defaultText,template:e.template,renderTemplate:e.renderTemplate,activeClass:e.activeClass,openClass:e.openClass,setText:$.proxy(e.setText,e),onChange:function(n,t){if(e.setValue(t.value),!e.silence)e.emit('change',t);},onAfterShow:function(){t.trigger('focusin');},onAfterHide:function(){t.trigger('focusout');}});},disable:function(){var e=this,n=e.element;n.find(e.buttonSelector).prop('disabled',!0);},enable:function(){var e=this,n=e.element;n.find(e.buttonSelector).prop('disabled',!1);},getValue:function(){return this.value;},setValue:function(e,n){var t=this;if(n=n||{},n.force||e!=t.value)t.value=e,t.input.val(null==e?'':e),t.silence=n.silence,t.comboBox.setValue(e),delete t.silence;},refresh:function(e){this.comboBox.refresh(e);},dispose:function(){var e=this;i.dispose(e),e.comboBox.dispose(),e.input=e.element=e.comboBox=null;}},t(e.prototype),e.defaultOptions={defaultText:'请选择',buttonSelector:'.btn-default',menuSelector:'.dropdown-menu',labelSelector:'.btn-default span',activeClass:'active',openClass:'open',renderTemplate:function(e){var n=[];return $.each(e,function(e,t){var i=[];$.each(t,function(e,n){if('text'!==e&&null!=n)i.push('data-'+e+'="'+n+'"');}),n.push('<li '+i.join(' ')+'>'+t.text+'</li>');}),n.join('');},setText:function(e){this.element.find(this.labelSelector).html(e);}},e;}),define('cobble/function/contains',['require','exports','module'],function(){'use strict';return function(e,n){if(e=e.jquery?e[0]:e,n=n.jquery?n[0]:n,!e||!n)return!1;if(e===n)return!0;else return $.contains(e,n);};}),define('cobble/function/isHidden',['require','exports','module'],function(){'use strict';return function(e){e.css('display');return'none'===e.css('display')||0==e.css('opacity')||'hidden'===e.css('visibility');};}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var n=$.prototype,t={on:function(){return n.on.apply(e(this),arguments),this;},off:function(){return n.off.apply(e(this),arguments),this;},emit:function(t,i){var o=this,r=e(o);if(r){if(!t[$.expando])t='string'===$.type(t)?$.Event(t):$.Event(null,t);t.cobble=o;var u=[t];if(i)u.push(i);var a=o[$.camelCase('on-'+t.type)];if($.isFunction(a)&&a.apply(o,u)===!1)t.preventDefault();if(!t.isPropagationStopped())n.trigger.apply(r,u);return t;}},before:function(n){e(this).before(n);},after:function(n){e(this).after(n);},appendTo:function(n){e(this).appendTo(n);},prependTo:function(n){e(this).prependTo(n);}};return function(e){$.each(t,function(n,t){if(null==e[n])e[n]=t;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,n){var t=e.constructor,i='__cobble__'+t.prototype.type,o=n.element;if(o&&o.data(i))e=o.data(i);else if($.extend(e,t.defaultOptions,n),e.init(),o)o.data(i,e);return e;},exports.dispose=function(e){var n='__cobble__'+e.constructor.prototype.type,t=e.element;if(t)t.removeData(n);};}),define('cobble/function/split',['require','exports','module'],function(){'use strict';return function(e,n){var t=[];return $.each(e.split(n),function(e,n){if(n=$.trim(n))t.push(n);}),t;};}),define('cobble/helper/Popup',['require','exports','module','../function/split','../function/isHidden','../function/contains','../function/jquerify','../function/lifeCycle','../util/instance'],function(require){'use strict';function e(e){return T.init(this,e);}function n(e,n){$.each(e.showConfigList,function(t,i){i[n](e);});}function t(e,n){$.each(e.hideConfigList,function(t,i){i[n](e);});}function i(e,n){if(e)e.type=n;else e=n;return e;}function o(e){var n=e.currentTarget;return n&&'HTML'===n.tagName?null:n;}function r(e,n){return e.emit(i(n,'beforeShow'));}function u(e,i){return e.layer.data(H,o(i)),n(e,'off'),t(e,'on'),e.emit('afterShow');}function a(e,n){return e.emit(i(n,'beforeHide'));}function c(e){return e.layer.removeData(H),t(e,'off'),n(e,'on'),e.emit('afterHide');}function l(){return $.now();}function f(e){return'__'+e+'Handler__';}function s(e,n){return null==e[n];}function d(e,n){return e.layer.data(H)!==o(n);}function h(e,n,t){return!n||n(e,t);}function p(e,n){return n-e[j]>50;}function m(n,t){return function(i){var o=i.data,r=l(i);if(s(o,k)&&d(o,i)&&h(o,t,i))o[j]=r,g({popup:o,delay:o.show.delay,toggle:e.trigger.show[n].delay,timer:k,success:function(){var e=function(){o.open(i);},n=o[q];if(n)n.done(e);else e();}});};}function v(n,t){return function(i){var o=i.data,r=l(i);if(s(o,L)&&h(o,t,i)&&p(o,r))o[j]=r,o[q]=$.Deferred(),g({popup:o,delay:o.hide.delay,toggle:e.trigger.hide[n].delay,timer:L,success:function(){o.close(i),o[q].resolve();},fail:function(){o[q]=null;}});};}function g(e){var n=e.delay,t=e.success;if(n>0){var i=e.popup,o=e.timer,r=e.toggle||{},u=r.on||$.noop,a=r.off||$.noop,c=e.fail||$.noop,l=function(){clearTimeout(i[o]),a(i,f),i[o]=null;},f=function(e){var n=i[o];if(n)l();if(n&&e===j)t();else c();};u(i,f),i[o]=setTimeout(function(){f(j);},n);}else t();}function y(e){var n=this,t=n.type,i=n.handler,o=f(t);if(e[o]!==i)e.element.on(t,e.selector,e,i),e[o]=i;}function b(e){var n=this;if(!e.selector){var t=n.type;e.element.off(t,n.handler),e[f(t)]=null;}}var x=require('../function/split'),C=require('../function/isHidden'),S=require('../function/contains'),w=require('../function/jquerify'),T=require('../function/lifeCycle'),_=require('../util/instance');e.prototype={constructor:e,type:'Popup',init:function(){var i=this,o=i.showConfigList=[],r=i.hideConfigList=[],u=i.show.trigger,a=i.hide.trigger;if(u)$.each(x(u,','),function(n,t){var i=e.trigger.show[t];if(i)o.push(i);});if(a)$.each(x(i.hide.trigger,','),function(n,t){var i=e.trigger.hide[t];if(i)r.push(i);});if(i.hidden=C(i.layer))n(i,'on');else t(i,'on');},open:function(){var e=this,n=arguments[0];if(!n)e[j]=l();if(n=r(e,n),!n.isDefaultPrevented()){var t=e.layer,i=e.show.animation;if($.isFunction(i))i.call(e,t);else t.show();e.hidden=!1,u(e,n);}},close:function(){var e=this;if(!e.hidden){var n=arguments[0];if(!n)e[j]=l();if(n=a(e,n),!n.isDefaultPrevented()){var t=e.layer,i=e.hide.animation;if($.isFunction(i))i.call(e,t);else t.hide();e.hidden=!0,c(e);}}},dispose:function(){var e=this;T.dispose(e),e.close(),n(e,'off'),e.element=e.layer=null;}},w(e.prototype),e.defaultOptions={show:{trigger:'click'},hide:{trigger:'click'}};var q='__hidePromise__',k='__showTimer__',L='__hideTimer__',j='__lastTriggerTime__',H='__sourceElement__',B=function(e,n){if(!n)return!1;else return S(e.layer,n);};return e.trigger={show:{focus:{type:'focusin',handler:m('focus'),on:y,off:b},click:{type:'click',handler:m('click'),on:y,off:b},over:{type:'mouseenter',handler:m('over'),on:y,off:b,delay:{on:function(e,n){e.element.on('mouseleave',e.selector,n);},off:function(e,n){e.element.off('mouseleave',n);}}},context:{type:'contextmenu',handler:m('context'),on:y,off:b}},hide:{blur:{type:'focusout',handler:v('blur'),on:y,off:b},click:{type:'click',handler:function(){return v(this.type,function(e,n){return!B(e,n.target);});},on:function(e){var n=this;_.document.on(n.type,e,e.clickHandler=n.handler());},off:function(e){_.document.off(this.type,e.clickHandler);}},out:{type:'mouseleave',handler:v('out'),on:function(e){var n=this.type,t=this.handler;e.layer.on(n,e,t),e.element.on(n,e.selector,e,t);},off:function(e){var n=this.type,t=this.handler;e.element.off(n,t),e.layer.off(n,t);},delay:{on:function(e,n){e.element.on('mouseenter',e.selector,n),e.layer.on('mouseenter',n);},off:function(e,n){e.element.off('mouseenter',n),e.layer.off('mouseenter',n);}}},context:{type:'contextmenu',handler:function(){return v('context',function(e,n){return!B(e,n.target);});},on:function(e){var n=this;_.document.on(n.type,e,e.contextHandler=n.handler());},off:function(e){_.document.off(this.type,e.contextHandler);}}}},e;}),define('cobble/ui/ComboBox',['require','exports','module','../function/jquerify','../function/lifeCycle','../helper/Popup'],function(require){'use strict';function e(e){return t.init(this,e);}var n=require('../function/jquerify'),t=require('../function/lifeCycle'),i=require('../helper/Popup');e.prototype={constructor:e,type:'ComboBox',init:function(){var e=this,n=e.button,t=e.menu,r=e.element||n,u=e.openClass,a=e.show,c=e.hide,l=a.animation;if($.isFunction(l))a.animation=$.proxy(l,e);if(l=c.animation,$.isFunction(l))c.animation=$.proxy(l,e);if(e.popup=new i({element:n,layer:t,show:a,hide:c,onBeforeShow:function(n){e.emit(n);},onBeforeHide:function(n){e.emit(n);},onAfterShow:function(n){if(u)r.addClass(u);e.emit(n);},onAfterHide:function(n){if(u)r.removeClass(u);e.emit(n);}}),null==e.value){var f=t.find('.'+e.activeClass);if(1===f.length)e.value=f.data('value');}if(e.data)t.html(e.renderTemplate(e.data,e.template));if(null!=e.value)e.setValue(e.value,{force:!0,silence:!0});t.on('click'+o,'[data-value]',function(){e.setValue($(this).data('value')),e.close();});},getValue:function(){return this.value;},setValue:function(e,n){var t,i=this,o=i.menu,r=o.find('[data-value="'+e+'"]');if(1===r.length){if(t=r.data(),null==t.text)t.text=r.html();}else t={};if(n=n||{},n.force||e!=i.value){var u=i.activeClass;if(u)o.find('.'+u).removeClass(u);if(1===r.length){if(i.value=e,u)r.addClass(u);}else i.value=null;if(!n.silence)i.emit('change',t);}if($.isFunction(i.setText))i.setText(t.text||i.defaultText);},refresh:function(e){var n=this,t=n.value,i={};if(e){var o=e.data;if(o)n.menu.html(n.renderTemplate(o,n.template));if('value'in e)t=e.value,i.force=!0;}n.setValue(t,i);},open:function(){this.popup.open();},close:function(){this.popup.close();},dispose:function(){var e=this;t.dispose(e),e.menu.off(o),e.popup.dispose(),e.popup=e.element=e.button=e.menu=null;}},n(e.prototype),e.defaultOptions={show:{trigger:'click'},hide:{trigger:'click'}};var o='.cobble_ui_combobox';return e;}),define('cobble/util/instance',['require','exports','module'],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body);}),define('common/component/RegionSelect_28068924d5',['require','cobble/form/Select','common/service_9c322508d3','common/store_a1a35b3dfc'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}function n(e,n){setTimeout(function(){e.resolve(n);},0);}function t(){var e=$.Deferred();if(d)n(e,$.extend(!0,[],d));else l.getRegionList({filter:s}).done(function(t){d=t,n(e,$.extend(!0,[],t));});return e;}function i(e){var t=$.Deferred();if(!e)n(t,[]);else if(h[e])n(t,$.extend(!0,[],h[e]));else l.getRegionList({id:e,filter:s}).done(function(i){h[e]=i,n(t,$.extend(!0,[],i));});return t;}function o(e){var t=$.Deferred();if(!e)n(t,[]);else if(p[e])n(t,$.extend(!0,[],p[e]));else l.getRegionList({id:e,filter:s}).done(function(i){p[e]=i,n(t,$.extend(!0,[],i));});return t;}function r(e){var t=$.Deferred();if(!e)n(t,[]);else if(m[e])n(t,$.extend(!0,[],m[e]));else l.getRegionList({id:e,filter:s}).done(function(i){m[e]=i,n(t,$.extend(!0,[],i));});return t;}function u(e){return $.map(e||[],function(e){return{text:e.name,value:e.id};});}function a(e,n,t){e.refresh({data:u(n),value:null!=t?t:null});}var c=require('cobble/form/Select'),l=require('common/service_9c322508d3'),f=require('common/store_a1a35b3dfc'),s='';e.prototype={init:function(){var e=this,n=e.element;s=e.filter;var t=e.prefix||'';e.provinceSelect=new c({element:n.find('.province'),defaultText:e.provinceText||'- 省 -',name:t+'province',onChange:function(n,t){if(i(t.value).done(function(n){if('1'==f.get('user').globalDistrict)if(e.eachAll&&n.length>1)n.unshift({id:t.value,name:'全省'});a(e.citySelect,n,1===n.length?n[0].id:null);}),$.isFunction(e.onProvinceChange))e.onProvinceChange(t);}}),e.citySelect=new c({element:n.find('.city'),defaultText:e.cityText||'- 市 -',name:t+'city',onChange:function(n,t){if(o(t.value).done(function(n){if(e.eachAll)n.unshift({id:t.value,name:'全市'});a(e.areaSelect,n,null);}),$.isFunction(e.onCityChange))e.onCityChange(t);}}),e.areaSelect=new c({element:n.find('.area'),defaultText:e.areaText||'- 区 -',name:t+'area',onChange:function(n,t){if(r(t.value).done(function(n){if(e.eachAll)n.unshift({id:t.value,name:'全部'});a(e.countrySelect,n,null);}),$.isFunction(e.onAreaChange))e.onAreaChange(t);}}),e.countrySelect=new c({element:n.find('.country'),defaultText:e.countrySelect||'- 商圈 -',name:t+'country',onChange:function(n,t){if($.isFunction(e.onCountryChange))e.onCountryChange(t);}}),e.refresh();},refresh:function(e){var n=this;if(e)$.extend(n,e);var u=n.provinceSelect.onChange,c=n.citySelect.onChange,l=n.areaSelect.onChange,s=n.countrySelect.onChange;n.provinceSelect.onChange=n.citySelect.onChange=n.areaSelect.onChange=n.countrySelect.onChange=null,$.when(t(),i(n.provinceId),o(n.cityId),r(n.areaId)).done(function(e,t,i,o){if('1'==f.get('user').globalDistrict)if(n.eachAll)e.unshift({id:0,name:'全国'});if(a(n.provinceSelect,e,n.provinceId),a(n.citySelect,t,n.cityId),a(n.areaSelect,i,n.areaId),a(n.countrySelect,o,n.countryId),n.provinceSelect.onChange=u,n.citySelect.onChange=c,n.areaSelect.onChange=l,n.countrySelect.onChange=s,$.isFunction(n.callback))n.callback();});}};var d=null,h={},p={},m={};return e;}),define('studentCenter/profile/AccessRegion_5c5b3a68cd',['require','common/component/RegionSelect_28068924d5','common/service_9c322508d3'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}function n(e){var n=[];return $.each(e||[],function(e,i){n.push(t(i));}),n.join('');}function t(e){return'<li data-id="'+e.id+'" data-name="'+e.name+'">'+(e.text||e.name)+'</li>';}function i(e){var n=[];return $.each(e||[],function(e,t){n.push(o(t));}),n.join('');}function o(e){return'<li data-id="'+e.id+'" data-name="'+e.name+'">'+e.name+'<i class="icon icon-times"></i></li>';}var r=require('common/component/RegionSelect_28068924d5'),u=require('common/service_9c322508d3');return e.prototype={init:function(){var e=this,i=e.element,a=e.regionBox=i.find('.region-box'),c=e.areaList=i.find('.area-list'),l=e.countryList=i.find('.country-list'),f=e.regionList=i.find('.region-list'),s=e.selectedList=i.find('.selected-region'),d=(e.regionsSelect=new r({element:i,prefix:'region_',onProvinceChange:function(){c.html(''),l.html('');},onCityChange:function(e){var t=e.value;if(null!=t)u.getRegionList({id:t,includeSubway:!0}).done(function(e){var t=n(e);if(t.length>0)a.show();c.html(t),l.html('');});a.hide();}}),'active');i.on('click','.area-list li',function(e){var t=$(e.currentTarget);if(!t.hasClass(d)){var i=t.data();c.find('.'+d).removeClass(d),t.addClass(d),u.getRegionList({id:i.id,includeSubway:!0}).done(function(e){e.unshift({id:i.id,name:i.name,text:'全部'}),l.html(n(e)),l.find('[data-id="'+i.id+'"]').click(),f.find('li').each(function(){var e=$(this).data('id');l.find('[data-id="'+e+'"]').addClass(d);});});}}).on('click','.country-list li',function(e){var n=$(e.currentTarget);if(!n.hasClass(d)){var t=n.index(),i=l.find('li'),r=i.first(),u=r.hasClass(d);if(u){if(t>0)r.removeClass(d),f.find('[data-id="'+r.data('id')+'"]').remove();}else if(0===t)l.find('.'+d).each(function(){var e=$(this);e.removeClass(d),f.find('[data-id="'+e.data('id')+'"]').remove();});n.addClass(d);var a=n.data();if(0===f.find('[data-id="'+a.id+'"]').length)f.append(o(a));}}).on('click','.icon-times',function(e){var n=$(e.currentTarget).closest('li'),t=n.data();n.remove(),l.find('[data-id="'+t.id+'"]').removeClass(d);}).on('click','.btn-primary',function(){var n=[];f.find('li').each(function(){n.push(t($(this).data()));}),a.hide(),e.refresh(),s.show(),s.find('ul').html(n.join(''));}).on('click','.btn-default',function(){a.hide(),e.refresh();});},getValue:function(){var e=this,n=[];return e.selectedList.find('li').each(function(){n.push($(this).data('id'));}),n.join(',');},refresh:function(){var e=this,t=e.data||[];e.areaList.html(''),e.countryList.html(''),e.regionList.html(i(t)),e.regionBox.hide();var o=e.selectedList;if(o.find('ul').html(n(t)),t.length>0)o.show();else o.hide();e.regionsSelect.refresh({provinceId:null,cityId:null});}},e;});