define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return o.init(this,e);}function t(e,t){if(e.length>0){var n=e[0].element;if(n.is(':hidden'))n=n.parent();var i=n.offset().top;if(t>0)i-=t;window.scrollTo(window.scrollX,i);}}function n(e){var t=$.Deferred();return $.when.apply($,e).done(function(){t.resolve(arguments);}),t;}var i=require('../function/jquerify'),o=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var t=this,n=t.element,i='FORM'===n.prop('tagName')?n:n.find('form');if(i.length>0)i.attr('novalidate','novalidate').on('submit'+a,$.proxy(t.validate,t));$.each(t.fields,function(t,i){var o=n.find('[name="'+t+'"]'),a=i.type;if(!a)a=i.type=o.attr('type')||'text';var c=i.rules;if(!c)c=i.rules={};var s=e.type[a]||[];$.each(s,function(e,t){if(null==c[t]){var n=r[t];if($.isFunction(n))c[t]=n(o,i);}});});var o=t.groupSelector;if(n.on('focusin'+a,function(e){var n=$(e.target).closest(o),i=[t.successClass,t.errorClass,t.requiredClass].join(' ');n.removeClass($.trim(i));}),t.realtime)n.on('focusout'+a,function(e){var n=$(e.target),i=n.prop('name');if(!i)n=n.find('[name]'),i=n.prop('name');if(i)t.validate(i);});},validate:function(e,i){var o=this,r=o.emit('beforeValidate');if(!r.isDefaultPrevented()){var a,c=o.element,s=o.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))a=$.map(e,function(e){return c.find('[name="'+e+'"]').closest(s);});else if(a=c.find(s),'boolean'===$.type(e))i=e;var u=[],l=[];$.each(a,function(e,t){var n=o.validateGroup($(t));if(n){if(n.promise)l.push(n),n=n.data;$.merge(u,n);}});var e=[],f=[],d=function(){if($.each(u,function(t,n){if(n.error)f.push(n);e.push(n.element.prop('name'));}),i)t(f,o.scrollGap);o.emit('afterValidate',{fields:e,errors:f});};if(l.length>0)return n(l).done(d);else return d(),0===f.length;}},validateGroup:function(t){if(t.is(':visible')){var i=this,o=[],r=[],a=[];if(t.find('[name]').each(function(t){var n,c,s=this,u=s.name,l=s.value,f=s.disabled,d=$(s);if(!f){var p=i.fields[u];if(p){n=!0,p=$.extend(!0,{},p),p.form=i.element,p.value=$.trim(l);var m;if($.each(e.type[p.type]||[],function(t,n){var i=e.rule[n](p);if(i===!1)return m=n,!1;else if(''===p.value&&'required'===n)return!1;}),m){var h=p.errors;if(h)c=h[m];if(!c)throw new Error(u+' 字段 '+m+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var v=$.Deferred(),b=p.custom(d,function(e){v.resolve(e);});c=null==b||b.done?v:b;}}}if(n)if(t=o.push({element:d,error:c}),c&&c.promise)r.push(c),a.push(t-1);}),r.length>0){var c=n(r).done(function(e){$.each(e,function(e,t){o[a[e]].error=t;}),i.refreshGroup(t,o);});return c.data=o,c;}else return i.refreshGroup(t,o),o;}},refreshGroup:function(e,t){var n=this,i=n.successClass,o=n.errorClass;$.each(t,function(t,r){var a,c=r.element,s=r.error,u=n.errorSelector;if(u)a=e.find(u).eq(t);if(s&&'string'===$.type(s)){if(e.removeClass(i).addClass(o),a){var l=n.renderTemplate;if($.isFunction(l))s=l({text:s},n.errorTemplate);a.html(s).show();var f=n.errorPlacement;if($.isFunction(f))f(c,a);}}else if(r.error='',e.removeClass(o).addClass(i),a)a.html('').hide();});},dispose:function(){var e=this;o.dispose(e),e.element.off(a),e.element=null;}},i(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,t){return t.replace(/\${(\w+)}/g,function(t,n){return e[n]||'';});},errorPlacement:function(e,t){if('hidden'===e.prop('type'))e=e.parent();t.css({position:'static',width:'auto'});var n=t.outerWidth(!0)+5;t.css({position:'absolute',width:n});var i=e.parent();if(i.is('.placeholder-wrapper'))e=i;var o=e.position();t.css({left:o.left+e.outerWidth()-37,top:o.top-t.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var t=e.rules.pattern;if(t)return t.test(e.value);else return void 0;},minlength:function(e){var t=e.rules.minlength;if($.isNumeric(t))return e.value.length>=+t;else return void 0;},maxlength:function(e){var t=e.rules.maxlength;if($.isNumeric(t))return e.value.length<=+t;else return void 0;},min:function(e){var t=e.rules.min;if($.isNumeric(t))return e.value>=+t;else return void 0;},max:function(e){var t=e.rules.max;if($.isNumeric(t))return e.value<=+t;else return void 0;},step:function(e){var t=e.rules.step;if($.isNumeric(t)){var n=e.rules.min||1;return(e.value-n)%t===0;}},equals:function(e){var t=e.rules.equals;if(t){var n=e.form.find('[name="'+t+'"]');return e.value===$.trim(n.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var r={required:function(e){return'required'===e.attr('required');},pattern:function(t,n){var i=t.attr('pattern')||e.pattern[n.type];if('string'===$.type(i))i=new RegExp(i);return i;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},a='.cobble_form_validator';return e;}),define('cobble/function/around',['require','exports','module'],function(){'use strict';return function(e,t,n,i){var o='string'===$.type(t),r=o?e[t]:e;if(!o)i=n,n=t;var a=function(){var e,t=arguments;if($.isFunction(n))e=n.apply(this,t);if(e!==!1){if($.isFunction(r))e=r.apply(this,t);if($.isFunction(i)){var o=i.apply(this,t);if('undefined'!==$.type(o))e=o;}return e;}};return o?e[t]=a:a;};}),define('cobble/function/call',['require','exports','module'],function(){'use strict';return function(e,t,n){if($.isFunction(e)){var i=$.isArray(n)?'apply':'call';return e[i](t,n);}};}),define('cobble/function/contains',['require','exports','module'],function(){'use strict';return function(e,t){if(e=e.jquery?e[0]:e,t=t.jquery?t[0]:t,!e||!t)return!1;if(e===t)return!0;else return $.contains(e,t);};}),define('cobble/function/debounce',['require','exports','module'],function(){'use strict';return function(e,t){t='number'===$.type(t)?t:50;var n;return function(){if(!n){var i=arguments;n=setTimeout(function(){n=null,e.apply(null,$.makeArray(i));},t);}};};}),define('cobble/function/decimalLength',['require','exports','module'],function(){'use strict';return function(e){var t=(''+e).split('.');return 2===t.length?t[1].length:0;};}),define('cobble/function/disableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,n='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=function(){return!1;};};if(n)return function(e){e=e||document.body,e.style.MozUserSelect='none';};else return $.noop;}),define('cobble/function/divide',['require','exports','module','./decimalLength','./float2Int'],function(require){'use strict';var e=require('./decimalLength'),t=require('./float2Int');return function(n,i){var o=Math.max(e(n),e(i));return n=t(n,o),i=t(i,o),n/ i;};}),define('cobble/function/dragGlobal',['require','exports','module','../helper/Draggable','../util/instance','../util/dimension','./pin'],function(require){'use strict';{var e=require('../helper/Draggable'),t=require('../util/instance'),n=require('../util/dimension');require('./pin');}return function(i){return new e({element:i.element,container:t.body,draggingClass:i.draggingClass,handleSelector:i.handleSelector,cancelSelector:i.cancelSelector,rect:function(){var e=i.fixed,t=i.scrollable;return{x:e||t?0:n.getPageScrollLeft(),y:e||t?0:n.getPageScrollTop(),width:e||!t?n.getViewportWidth():n.getPageWidth(),height:e||!t?n.getViewportHeight():n.getPageHeight()};}});};}),define('cobble/function/enableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,n='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=null;};if(n)return function(e){e=e||document.body,e.style.MozUserSelect='';};else return $.noop;}),define('cobble/function/float2Int',['require','exports','module'],function(){'use strict';return function(e,t){var n,i=(''+e).split('.');if(t>=0);else t=0;if(1===i.length)n=e+new Array(t+1).join('0');else t=Math.max(0,t-i[1].length),n=i.join('')+new Array(t+1).join('0');return+n;};}),define('cobble/function/innerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var n=t.offset(),i=t.css('border-left-width'),o=t.css('border-top-width');return{left:n.left+e(i,0,'int'),top:n.top+e(o,0,'int')};};}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,n={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(n,i){var o=this,r=e(o);if(r){if(!n[$.expando])n='string'===$.type(n)?$.Event(n):$.Event(null,n);n.cobble=o;var a=[n];if(i)a.push(i);var c=o[$.camelCase('on-'+n.type)];if($.isFunction(c)&&c.apply(o,a)===!1)n.preventDefault();if(!n.isPropagationStopped())t.trigger.apply(r,a);return n;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(n,function(t,n){if(null==e[t])e[t]=n;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var n=e.constructor,i='__cobble__'+n.prototype.type,o=t.element;if(o&&o.data(i))e=o.data(i);else if($.extend(e,n.defaultOptions,t),e.init(),o)o.data(i,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,n=e.element;if(n)n.removeData(t);};}),define('cobble/function/minus',['require','exports','module','./decimalLength','./float2Int'],function(require){'use strict';var e=require('./decimalLength'),t=require('./float2Int');return function(n,i){var o=Math.max(e(n),e(i));return n=t(n,o),i=t(i,o),(n-i)/Math.pow(10,o);};}),define('cobble/function/offsetParent',['require','exports','module'],function(){'use strict';function e(e){return e.is('body')||'static'!==e.css('position');}return function(t){if(t.is('body'))return t;for(var n=t.parent();!e(n);)n=n.parent();return n;};}),define('cobble/function/outerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var n=t.offset(),i=e(t.css('margin-left'),0,'int'),o=e(t.css('margin-top'),0,'int');return{left:n.left-i,top:n.top-o};};}),define('cobble/function/page',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')<e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/pageHeight',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollHeight,t.clientHeight);};}),define('cobble/function/pageScrollLeft',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);};}),define('cobble/function/pageScrollTop',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollTop,document.documentElement.scrollTop);};}),define('cobble/function/pageWidth',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollWidth,t.clientWidth);};}),define('cobble/function/parsePercent',['require','exports','module','./divide'],function(require){'use strict';var e=require('./divide'),t=/(-?\d+(\.\d+)?)%/;return function(n){if(t.test(n))return e(RegExp.$1,100);else return void 0;};}),define('cobble/function/pin',['require','exports','module','../util/instance','./parsePercent'],function(require){'use strict';function e(e){var t=o[e.x];if(null==t)t=e.x;if('string'===$.type(t)){var n=i(t);if(null!=n)t=n*(e.width||e.element.outerWidth());}return t;}function t(e){var t=o[e.y];if(null==t)t=e.y;if('string'===$.type(t)){var n=i(t);if(null!=n)t=n*(e.height||e.element.outerHeight());}return t;}var n=require('../util/instance'),i=require('./parsePercent'),o={left:0,top:0,center:'50%',middle:'50%',right:'100%',bottom:'100%'};return function(i){var o=i.element,r=i.attachment||{};if(!r.element)r.element=n.body;var a=r.element.offset(),c=a.left+e(r),s=a.top+t(r),u=c-e(i),l=s-t(i),f=i.offset;if(f){if('number'===$.type(f.x))u+=f.x;if('number'===$.type(f.y))l+=f.y;}var d={left:u,top:l},p=o.css('position');if('absolute'!==p&&'fixed'!==p)d.position='absolute';if(i.silence)return d;else o.css(d);};}),define('cobble/function/pinGlobal',['require','exports','module','./pin','../util/dimension','../function/viewport'],function(require){'use strict';var e=require('./pin'),t=require('../util/dimension'),n=require('../function/viewport');return function(i){var o={silence:!0,element:i.element,x:'50%'===i.x?'50%':0,y:'50%'===i.y?'50%':0,attachment:{element:n(),width:t.getViewportWidth(),height:t.getViewportHeight(),x:i.x,y:i.y}};if(!i.fixed)o.offset={x:t.getPageScrollLeft(),y:t.getPageScrollTop()};return e(o);};}),define('cobble/function/plus',['require','exports','module','./decimalLength','./float2Int'],function(require){'use strict';var e=require('./decimalLength'),t=require('./float2Int');return function(n,i){var o=Math.max(e(n),e(i));return n=t(n,o),i=t(i,o),(n+i)/Math.pow(10,o);};}),define('cobble/function/position',['require','exports','module','./offsetParent'],function(require){'use strict';var e=require('./offsetParent');return function(t){var n=e(t),i=t.css('position'),o=parseInt(t.css('left'),10),r=parseInt(t.css('top'),10),a=isNaN(o),c=isNaN(r);if(a||c)if(1===n.length){var s=t.offset(),u=n.offset();if(a)o=s.left-u.left-(parseInt(n.css('border-left-width'),10)||0);if(c)r=s.top-u.top-(parseInt(n.css('border-top-width'),10)||0);}else o=r=0;if(!i||'static'===i)i='absolute';return{position:i,left:o,top:r};};}),define('cobble/function/restrain',['require','exports','module'],function(){'use strict';return function(e,t,n){if(t>e)e=t;else if(e>n)e=n;return e;};}),define('cobble/function/split',['require','exports','module'],function(){'use strict';return function(e,t){var n=[];return $.each(e.split(t),function(e,t){if(t=$.trim(t))n.push(t);}),n;};}),define('cobble/function/toNumber',['require','exports','module'],function(){'use strict';var e={'int':parseInt,'float':parseFloat};return function(t,n,i){if('number'!==$.type(t)){var o=e[i];if(t=o?o(t,10):+t,isNaN(t))t=n;}return t;};}),define('cobble/function/viewport',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')>e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/viewportHeight',['require','exports','module'],function(){'use strict';return function(){return window.innerHeight||document.documentElement.clientHeight;};}),define('cobble/function/viewportWidth',['require','exports','module'],function(){'use strict';return function(){return window.innerWidth||document.documentElement.clientWidth;};}),define('cobble/helper/Draggable',['require','exports','module','../function/page','../function/toNumber','../function/restrain','../function/position','../function/contains','../function/jquerify','../function/lifeCycle','../function/innerOffset','../function/outerOffset','../function/pageScrollLeft','../function/pageScrollTop','../function/enableSelection','../function/disableSelection','../util/instance','../util/mouse'],function(require){'use strict';function e(e){return u.init(this,e);}function t(e){var t=g(e),n=y(e);if(q.left!==t||q.top!==n){q.left=t,q.top=n;var i=e.data;if(1===++x){var o=i.draggingClass;if(o)i.element.addClass(o);i.emit('beforeDrag');}if(!i.silence)i.element.css(q);i.emit('drag',q);}}function n(e){m(),v.document.off(w);var t=e.data,n=t.draggingClass;if(n)t.element.removeClass(n);if(x>0)t.emit('afterDrag',q);x=g=y=null;}function i(e,t,n){var i=!1;if($.isArray(t))t=t.join(',');return e.find(t).each(function(){if(i=c(this,n))return!1;else return void 0;}),i;}var o=require('../function/page'),r=(require('../function/toNumber'),require('../function/restrain')),a=require('../function/position'),c=require('../function/contains'),s=require('../function/jquerify'),u=require('../function/lifeCycle'),l=require('../function/innerOffset'),f=require('../function/outerOffset'),d=require('../function/pageScrollLeft'),p=require('../function/pageScrollTop'),m=require('../function/enableSelection'),h=require('../function/disableSelection'),v=require('../util/instance'),b=require('../util/mouse');e.prototype={constructor:e,type:'Draggable',init:function(){var e=this,r=e.element;if(!e.container)e.container=o();r.css(a(r)),$.each(b,function(o,s){if(s.support)r.on(s.mousedown+w,function(u){var d=u.target,p=e.handleSelector,m=e.cancelSelector;if(!(p&&!i(r,p,d)||m&&i(r,m,d))){var b=C[o],$=f(r),S=b.absoluteX(u)-$.left,_=b.absoluteY(u)-$.top,N=e.container;if(c(N,r)){var P=l(N);S+=P.left,_+=P.top;}var T=a(r),A=T.position;q.left=T.left,q.top=T.top;var D=e.axis,j=e.getRectange(!0);g='y'===D?k.constant(q.left):k.change(b[A+'X'],S,j.x,j.x+j.width),y='x'===D?k.constant(q.top):k.change(b[A+'Y'],_,j.y,j.y+j.height),x=0,h(),v.document.on(s.mousemove+w,e,t).on(s.mouseup+w,e,n);}});});},getRectange:function(e){var t=this,n=t.rect;if($.isFunction(n))n=t.rect();if(e){var i=t.element,o=n.width-i.outerWidth(!0),r=n.height-i.outerHeight(!0);n.width=Math.max(0,o),n.height=Math.max(0,r);}return n;},setRectange:function(e){this.rect=e;},dispose:function(){var e=this;u.dispose(e),e.element.off(w),e.element=e.container=null;}},s(e.prototype),e.defaultOptions={rect:function(){var e=this,t=e.container,n={x:0,y:0,width:t.innerWidth(),height:t.innerHeight()};if(!c(t,e.element)){var i=l(t);n.x=i.left,n.y=i.top;}return n;}};var g,y,x,w='.cobble_helper_draggable',q={},k={constant:function(e){return function(){return e;};},change:function(e,t,n,i){return function(o){return r(e(o)-t,n,i);};}},C={};return $.each(b,function(e,t){if(t.support)C[e]={absoluteX:function(e){return t.clientX(e)+d();},absoluteY:function(e){return t.clientY(e)+p();},fixedX:function(e){return t.clientX(e);},fixedY:function(e){return t.clientY(e);}};}),e;}),define('cobble/helper/Input',['require','exports','module','../function/around','../function/jquerify','../function/lifeCycle','../util/keyboard','../util/input','./Keyboard'],function(require){'use strict';function e(e){return n.init(this,e);}var t=(require('../function/around'),require('../function/jquerify')),n=require('../function/lifeCycle'),i=require('../util/keyboard'),o=require('../util/input'),r=require('./Keyboard');e.prototype={constructor:e,type:'Input',init:function(){var e=this,t=e.element;o.init(t);var n=e.action;if(n)$.each(n,function(t,i){n[t]=$.proxy(i,e);});var c,s;e.keyboard=new r({element:t,action:n,longPress:e.longPress,onKeyDown:function(t){e.emit(t);},onKeyUp:function(t){e.emit(t);},onBeforeLongPress:function(){c=t.val(),s=!0,e.emit('beforeLongPress');},onAfterLongPress:function(n){if(s=!1,e.emit('afterLongPress'),c!==t.val()&&(i.isCharKey(n.keyCode)||i.isDeleteKey()))e.emit('change');}}),t.on('input'+a,function(){if(!s||!e.smart)e.emit('change');});},autoWidth:function(){var e=this,t=e.element;e.on('change',function(){if(t.scrollLeft()>0)t.width(t.prop('scrollWidth'));});},autoHeight:function(){var e=this,t=e.element;if('hidden'!==t.css('overflow-y'))t.css('overflow-y','hidden');var n,i=t.height(),o=i,r=parseInt(t.css('font-size'),10),a=t.innerHeight()-i;e.on('change',function(){if(o!==i)o=i,t.height(i);if(n=t.prop('scrollHeight')-a,Math.abs(n-o)>r)t.height(n),o=n;});},dispose:function(){var e=this;n.dispose(e);var t=e.element;o.dispose(t),t.off(a),e.keyboard.dispose(),e.element=e.keyboard=null;}},t(e.prototype),e.defaultOptions={smart:!0,longPress:!1};var a='.cobble_helper_input';return e;}),define('cobble/helper/Keyboard',['require','exports','module','../function/call','../function/split','../function/jquerify','../util/keyboard'],function(require){'use strict';function e(t){$.extend(this,e.defaultOptions,t),this.init();}function t(e){var t=[];return $.each(e,function(e,n){var i=[],o='plus',a=r(e.replace(/\$\+/g,o),'+');if($.each(c.combinationKey,function(e){if($.inArray(e,a)<0)a.push('!'+e);}),$.each(a,function(e,t){var n=0===t.indexOf('!');if(n)t=t.substr(1);if(t===o)t='$+';if(c.combinationKey[t])i.push((n?'!':'')+'e.'+t+'Key');else if(c[t])i.push('e.keyCode==='+c[t]);else return i.length=0,!1;}),i.length>0)t.push({test:new Function('e','return '+i.join('&')),handler:n});}),t;}function n(e){var t=e.data,n=e.keyCode,i=t.cache,r=i.counter;if(i.keyCode===n&&r>0){if(1===r)t.emit({type:'beforeLongPress',keyCode:n});r++;}else i.keyCode=n,r=1;if(i.counter=r,t.longPress||1===r)$.each(i.action,function(n,i){if(i.test(e))o(i.handler,t,e);});e.type='keyDown',t.emit(e);}function i(e){var t=e.data,n=t.cache;if(n.keyCode=null,n.counter>1)t.emit({type:'afterLongPress',keyCode:e.keyCode}),n.counter=0;e.type='keyUp',t.emit(e);}var o=require('../function/call'),r=require('../function/split'),a=require('../function/jquerify'),c=require('../util/keyboard');e.prototype={constructor:e,type:'Keyboard',init:function(){var e=this;e.cache={counter:0,action:t(e.action||{})},e.element.on('keydown'+s,e,n).on('keyup'+s,e,i);},dispose:function(){var e=this;e.element.off(s),e.element=e.cache=null;}},a(e.prototype),e.defaultOptions={longPress:!1};var s='.cobble_helper_keyboard';return e;}),define('cobble/helper/Switchable',['require','exports','module','../function/jquerify','../function/lifeCycle','../function/toNumber'],function(require){'use strict';function e(e){return n.init(this,e);}var t=require('../function/jquerify'),n=require('../function/lifeCycle'),i=require('../function/toNumber');e.prototype={constructor:e,type:'Switchable',init:function(){var e=this,t=e.element,n=e.selector,a=e.items=t.find(n),c=i(e.index,r),s=e.activeClass;if(c===r&&s)c=a.index(t.find('.'+s));if(n){var u=e.trigger;if('click'===u)t.on('click'+o,n,function(){e.to(a.index(this));});else if('over'===u)t.on('mouseenter'+o,n,function(){var t=this;e.timer=setTimeout(function(){if(e.element)e.to(a.index(t));},150);}),t.on('mouseleave'+o,n,function(){if(e.timer)clearTimeout(e.timer),e.timer=null;});}if(e.index=r,c>=0)e.to(c);},to:function(e){var t=this;e=i(e,r);var n=t.index;if(e!==n){var o=t.activeClass,a=t.items;if(o){if(n>=0)a.eq(n).removeClass(o);if(e>=0)a.eq(e).addClass(o);}t.index=e,t.change({from:n,to:e});}},dispose:function(){var e=this;n.dispose(e),e.element.off(o),e.element=e.items=null;}},t(e.prototype),e.defaultOptions={index:0,trigger:'click'};var o='.cobble_helper_switchable',r=-1;return e;}),define('cobble/ui/Dialog',['require','exports','module','../util/instance','../util/dimension','../function/jquerify','../function/lifeCycle','../function/offsetParent','../function/debounce','../function/pinGlobal','../function/dragGlobal'],function(require){'use strict';function e(e){return o.init(this,e);}var t=require('../util/instance'),n=require('../util/dimension'),i=require('../function/jquerify'),o=require('../function/lifeCycle'),r=require('../function/offsetParent'),a=require('../function/debounce'),c=require('../function/pinGlobal'),s=require('../function/dragGlobal');e.prototype={constructor:e,type:'Dialog',init:function(){var e=this,n=e.element||(e.element=$(e.template)),i=[],o=e.skinClass;if(o)i.push(o);var a=e.draggableClass;if(e.draggable&&a)i.push(a);if(i.length>0)n.addClass(i.join(' '));var c=e.removeOnEmpty,s=e.title;if(s)n.find(e.titleSelector).html(s);else if(c)n.find(e.headerSelector).remove();var l=e.content,f=n.find(e.bodySelector);if(l)f.html(l);else if(c)f.remove();var d=e.closeSelector,p=$.proxy(e.hide,e);if(d)n.on('click'+u,d,p);var m={};if(e.width)m.width=e.width;var h=e.fixed?'fixed':'absolute';if(n.css('position')!==h)m.position=h;if(!r(n).is('body'))t.body.append(n);if(e.modal){var v=e.mask||(e.mask=$(e.maskTemplate));if(n.before(v),e.hideOnClickMask)v.on('click'+u,p);var b='zIndex',g=e[b];if(!$.isNumeric(g))if(g=v.css(b),!$.isNumeric(g))g='auto';var y={overflow:'hidden'};y[b]=g,v.css(y),m[b]=g;}if(n.css(m),!e.hidden)e.hidden=!0,e.show();},show:function(){var e=this;if(e.hidden!==!1){var n=e.emit('beforeShow');if(!n.isDefaultPrevented()){var i=e.element,o=e.scrollable;if(e.draggable)e.drager=s({element:i,handleSelector:e.draggableHandleSelector,cancelSelector:e.draggableCancelSelector,draggingClass:e.draggingClass,fixed:e.fixed,scrollable:o});if(e.refresh(),e.showAnimation(),e.mask)e.showMaskAnimation();e.hidden=!1,t.window.resize(e.resizer=a(function(){e.refresh(!0);},50)),e.emit('afterShow');}}},hide:function(){var e=this;if(e.hidden!==!0){var n=e.emit('beforeHide');if(!n.isDefaultPrevented()){if(e.resizer)t.window.off('resize',e.resizer),e.resizer=null;if(e.drager)e.drager.dispose(),e.drager=null;if(e.hideAnimation(),e.mask)e.hideMaskAnimation();if(e.hidden=!0,e.emit('afterHide'),e.disposeOnHide)e.dispose();}}},refresh:function(){var e=this,t=arguments[0];if(!t||e.positionOnResize){var i=e.element,o=c({element:i,x:e.x,y:e.y,fixed:e.fixed});if(t)e.resizeAnimation(o);else i.css(o);}var r=e.mask;if(r)r.css({width:n.getPageWidth(),height:n.getPageHeight()});},dispose:function(){var e=this;if(o.dispose(e),!e.hidden)e.disposeOnHide=!1,e.hide();var t=e.element,n=e.mask;if(t.off(u),n)n.off(u);if(e.removeOnDispose)if(t.remove(),n)n.remove();e.element=e.mask=null;}},i(e.prototype),e.defaultOptions={x:'50%',y:'50%',modal:!0,fixed:!0,hidden:!1,draggable:!0,scrollable:!0,removeOnEmpty:!0,disposeOnHide:!0,removeOnDispose:!0,hideOnClickMask:!1,positionOnResize:!0,draggableClass:'draggable',draggableHandleSelector:'.dialog-header',draggableCancelSelector:['.dialog-header h1','.dialog-close'],headerSelector:'.dialog-header',titleSelector:'.dialog-header h1',closeSelector:'.dialog-close',bodySelector:'.dialog-body',template:'<div class="dialog"><i class="dialog-close">&times;</i><div class="dialog-header"><h1></h1></div><div class="dialog-body"></div></div>',maskTemplate:'<div class="dialog-mask"></div>',showAnimation:function(){this.element.show();},hideAnimation:function(){this.element.hide();},showMaskAnimation:function(){this.mask.show();},hideMaskAnimation:function(){this.mask.hide();},resizeAnimation:function(e){this.element.css(e);}};{var u='.cobble_ui_dialog';t.html.css('overflow'),t.body.css('overflow');}return e;}),define('cobble/ui/Tab',['require','exports','module','../function/jquerify','../function/lifeCycle','../helper/Switchable'],function(require){'use strict';function e(e){return n.init(this,e);}var t=require('../function/jquerify'),n=require('../function/lifeCycle'),i=require('../helper/Switchable');return e.prototype={constructor:e,type:'Tab',init:function(){var e=this,t=e.element;e.switcher=new i({element:t,index:e.index,trigger:e.trigger,selector:e.navSelector,activeClass:e.navActiveClass,change:function(n){var i=n.from,o=n.to;if($.isFunction(e.animation))e.animation(n);else{var r=t.find(e.contentSelector);if(1!==r.length){var a=e.contentActiveClass;if(a)r.eq(i).removeClass(a),r.eq(o).addClass(a);else r.eq(i).hide(),r.eq(o).show();}}if(e.index=o,i!==o)e.emit('change',n);}});},to:function(e){this.switcher.to(e);},dispose:function(){var e=this;n.dispose(e),e.switcher.dispose(),e.element=e.switcher=null;}},t(e.prototype),e.defaultOptions={trigger:'click',navActiveClass:'active',navSelector:'.nav-item',contentSelector:'.tab-panel'},e;}),define('cobble/util/dimension',['require','exports','module','../function/pageScrollTop','../function/pageScrollLeft','../function/pageWidth','../function/pageHeight','../function/viewportWidth','../function/viewportHeight'],function(require,exports){'use strict';var e=require('../function/pageScrollTop'),t=require('../function/pageScrollLeft'),n=require('../function/pageWidth'),i=require('../function/pageHeight'),o=require('../function/viewportWidth'),r=require('../function/viewportHeight');exports.getPageScrollTop=e,exports.getPageScrollLeft=t,exports.getPageWidth=n,exports.getPageHeight=i,exports.getViewportWidth=o,exports.getViewportHeight=r;}),define('cobble/util/input',['require','exports','module','../function/around'],function(require,exports){'use strict';function e(){}function t(e){var t=e.val(),i=!1;e.on('propertychange'+r,function(n){if(i)return void(i=!1);if('value'===n.originalEvent.propertyName){var o=e.val();if(o!==t)e.trigger('input'),t=o;}}),n(e,'val',function(){if(0!==arguments.length)i=!0;});}var n=require('../function/around'),i=$('<input type="text" />')[0],o='oninput'in i;i=null;var r='.cobble_util_input';exports.init=o?e:t,exports.dispose=function(e){e.off(r);};}),define('cobble/util/instance',['require','exports','module'],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body);}),define('cobble/util/keyboard',['require','exports','module'],function(require,exports){'use strict';function e(e){var t={};return $.each(e,function(e,n){t[n]=e;}),t;}var t={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,'`':192,'-':173,'=':61,'[':219,']':221,'\\':220,';':59,"'":222,',':188,'.':190,'/':191,$0:96,$1:97,$2:98,$3:99,$4:100,$5:101,$6:102,$7:103,$8:104,$9:105,'$.':110,'$+':107,'$-':109,'$*':106,'$/':111,space:32,tab:9},n={backspace:8,'delete':46},i={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,enter:13,esc:27,capslock:20,insert:45,home:36,end:35,pageup:33,pagedown:34,left:37,right:39,up:38,down:40},o={shift:16,ctrl:17,meta:91,alt:18};$.extend(exports,t,i,o),exports.charKey=t,exports.deleteKey=n,exports.functionKey=i,exports.combinationKey=o,exports.isCharKey=function(n){return n in e(t);},exports.isDeleteKey=function(t){return t in e(n);},exports.isFunctionKey=function(t){return t in e(i);},exports.isCombinationKey=function(t){return t in e(o);};}),define('cobble/util/mouse',['require','exports','module'],function(){'use strict';function e(e){return e.originalEvent.changedTouches[0];}var t=document.createElement('div'),n={support:'ontouchend'in t,click:'touchstart',mousedown:'touchstart',mousemove:'touchmove',mouseup:'touchend',pageX:function(t){return e(t).pageX;},pageY:function(t){return e(t).pageY;},clientX:function(t){return e(t).clientX;},clientY:function(t){return e(t).clientY;}},i={support:'onclick'in t,click:'click',mousedown:'mousedown',mousemove:'mousemove',mouseup:'mouseup',pageX:function(e){return e.pageX;},pageY:function(e){return e.pageY;},clientX:function(e){return e.clientX;},clientY:function(e){return e.clientY;}};return t=null,{touch:n,mouse:i};}),define('cobble/util/redirect',['require','exports','module','../util/url'],function(require,exports){'use strict';function e(e,n){var i=t.parse(e),o='<form action="'+i.origin+i.pathname+'" target="_blank"';if(n)o+=' accept-charset="'+n+'" onsubmit="document.charset=\''+n+'\';"';return o+='>',$.each(t.parseQuery(i.search),function(e,t){o+='<input type="hidden" name="'+e+'" value="'+t+'" />';}),o+='</form>',$(o);}var t=require('../util/url');exports.openForm=function(t,n){var i=e(t,n);i.appendTo('body'),i.submit();},exports.openLink=function(e){var t=$('<a href="'+e+'" target="_blank"><b></b></a>');t.appendTo('body');try{t.find('b')[0].click();}catch(n){exports.openForm(e);}};}),define('cobble/util/url',['require','exports','module'],function(require,exports){'use strict';exports.parseQuery=function(e){var t={};if('string'===$.type(e)&&e.length>1){var n=0,i=e.charAt(0);if('?'===i)n=1;else if('#'===i){n=1;var o=e.charAt(1);if('/'===o)n=2;}if(n>0)e=e.substr(n);$.each(e.split('&'),function(e,n){var i=n.split('=');if(2===i.length){var o=$.trim(i[0]);if(o)t[o]=decodeURIComponent($.trim(i[1]));}});}return t;},exports.getOrigin=function(e){if(!e)e=document.URL;return exports.parse(e).origin;},exports.parse=function(e){var t=document.createElement('a');t.href=e,e=t.href;var n='';if(t.protocol&&t.host)n=t.protocol+'//'+t.host;else if(/^(http[s]?:\/\/[^\/]+)(?=\/)/.test(e))n=RegExp.$1;var i=n.split(':');if(0===n.indexOf('http:')&&3===i.length&&80==i[2])i.length=2,n=i.join(':');var o=t.pathname;if(o&&'/'!==o.charAt(0))o='/'+o;return{origin:n,pathname:o,search:t.search};};}),define('common/component/CodeButton_edf3c78096',['require'],function(){'use strict';function e(e){$.extend(this,e),this.init();}return e.prototype={init:function(){var e=this,t=e.element;e.isCounting=!1,e.origin=t.html();var n=function(){e.sendCode();};if(e.container)e.container.on('click',function(e){if(e.target===t[0])n();});else t.click(n);},countDown:function(e){var t=this,n=this.element;t.isCounting=!0;var i=function(e){if(n.html(e+' 秒后再次发送'),$.isFunction(t.onTextChange))t.onTextChange();};n.prop('disabled',!0),t.timer=setInterval(function(){if(e--,e>0)i(e);else t.reset();},1000),i(e);},reset:function(){var e=this;e.isCounting=!1;var t=e.element;if(clearInterval(e.timer),t.html(e.origin),t.prop('disabled',!1),$.isFunction(e.onTextChange))e.onTextChange();if($.isFunction(e.onFinish))e.onFinish();},dispose:function(){if(this.element.off(),this.timer)clearInterval(this.timer);},sendCode:function(){var e=this,t=e.element;t.prop('disabled',!0);var n=e.send();if(n)n.done(function(n){if(0===n.code)e.countDown(60);else t.prop('disabled',!1);});else t.prop('disabled',!1);return n;}},e;}),define('common/component/SaveButton_b1f301d041',['require'],function(){'use strict';function e(e){$.extend(this,e),this.init();}return e.prototype={init:function(){var e=this,t=e.element,n=t.html();if('BUTTON'!==t.prop('tagName'))throw new Error('SaveButton 必须使用 button 标签');var i=function(){var i=e.save();if(i)t.focus(),t.prop('disabled',!0),t.html(e.saveText||'正在保存...'),i.always(function(){setTimeout(function(){t.prop('disabled',!1),t.html(n);},10);});return!1;};if(t.click(i),e.form)e.form.submit(function(){return i(),!1;});}},e;}),define('common/form_2ef59f4d41',['require','exports','cobble/form/Validator'],function(require,exports){'use strict';function e(e){var t={},n=e.find('[name]');return n.each(function(){var e=this.name,n=this.value,i='radio'===this.type||'checkbox'===this.type;if(i){if(this.checked)t[e]=n;}else{var o=t[e];if(null==o)t[e]=n;else o=t[e]=[o],o.push(n);}}),$.each(t,function(e,n){t[e]=$.isArray(n)?n.join(','):$.trim(n);}),t;}function t(e,t){$.each(t,function(t,i){if(i){var o=e.find('[name="'+t+'"]'),r=o.closest('.form-group');r.removeClass('has-success').addClass('has-error');var a=r.find('.error');a.html(i),n.defaultOptions.errorPlacement(o,a);}});}var n=require('cobble/form/Validator');exports.parse=function(t){return e(t);},exports.get=function(n,i){return $.ajax({url:i,type:'get',dataType:'json',data:n.jquery?e(n):n}).done(function(e){if(e.code){var i=e.data;if(i)t(n,i);}return e;});},exports.post=function(n,i){return $.ajax({url:i,type:'post',dataType:'json',data:n.jquery?e(n):n}).done(function(e){if(e.code){var i=e.data;if(i)t(n,i);}return e;});};}),define('pay/common/component/SetPasswordDialog_e0be80bfb5',['require','exports','cobble/ui/Dialog','cobble/form/Validator','common/form_2ef59f4d41','common/component/CodeButton_edf3c78096','common/component/SaveButton_b1f301d041','common/service_9c322508d3'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}function t(){var e=$.trim(i.find('input[name="mobile"]').val());if(!e)alert('请输入手机号');else alert({title:'获取语音校验码',content:'校验码将以电话形式通知到你\uFF0C请注意接听',buttons:[{text:'获取',type:'primary',handler:function(){this.hide(),u.sendVoiceSMS({mobile:e});}},{text:'取消',handler:function(){this.hide();}}]});}var n,i,o=require('cobble/ui/Dialog'),r=require('cobble/form/Validator'),a=require('common/form_2ef59f4d41'),c=require('common/component/CodeButton_edf3c78096'),s=require('common/component/SaveButton_b1f301d041'),u=require('common/service_9c322508d3');return e.prototype={init:function(){var e=this,l='<div class="form"><div class="form-group mobile-input"><label class="form-label">当前手机号\uFF1A</label><div class="form-controls"><div class="form-static">'+e.mobile_mask+'<input type="hidden" name="mobile" value="'+e.mobile+'" /></div></div></div><div class="form-group"><label class="form-label">校验码\uFF1A</label><div class="form-controls"><input class="form-text" type="text" name="verify_code" required /><button type="button" id="pay-password-send" class="btn btn-info">获取校验码</button><span class="error"></span><div class="form-block"><div class="voice-code-link hidden"><span class="btn-link text-info">没有收到校验码\uFF1F</span></div></div></div></div><div class="form-group"><label class="form-label">支付密码\uFF1A</label><div class="form-controls"><input class="form-text" type="password" name="pay_password" required minlength="6" maxlength="6" pattern="^\\s*\\d{6}\\s*$" /><div class="form-static"><span class="form-hint"><i class="icon icon-info-circle"></i>支付密码由6位数字组成</span></div><span class="error"></span></div></div><div class="form-group"><label class="form-label">确认支付密码\uFF1A</label><div class="form-controls"><input class="form-text" type="password" name="pay_password_confirm" required equals="pay_password" minlength="6" maxlength="6" /><span class="error"></span></div></div><div class="form-action"><button class="btn-primary btn-save" id="pay-password-submit">保存</button><button class="btn-default btn-cancel">取消</button></div></div>',f=new o({title:'设置支付密码',content:l,width:565,onBeforeHide:function(){this.element.off();}});i=f.element,n=i.find('.voice-code-link span'),n.on('click',t);{var d=new r({element:i.find('.form'),fields:{verify_code:{errors:{required:'请输入校验码'}},pay_password:{errors:{required:'请输入支付密码',minlength:'支付密码要求是 6 位数字',maxlength:'支付密码要求是 6 位数字',pattern:'支付密码要求是 6 位数字'}},pay_password_confirm:{errors:{required:'请输入确认密码',minlength:'两次密码不一致',maxlength:'两次密码不一致',equals:'两次密码不一致'}}}});new c({element:i.find('#pay-password-send'),send:function(){var e=$.trim($('.dialog-body').find('input[name="mobile"]').val());if(0!=e.indexOf('00'))n.parent().show();return u.sendPayMobileCode({mobile:e}).done(function(e){if(0===e.code)success('校验码发送成功\uFF0C请注意查收');});}}),new s({element:i.find('#pay-password-submit'),save:function(){if(d.validate()){var t=a.parse(d.element);u.setPayPassword({mobile:t.mobile,verifyCode:t.verify_code,payPassword:t.pay_password,payPasswordConfirm:t.pay_password_confirm}).done(function(n){if(0===n.code){if($.isFunction(e.onSuccess))e.onSuccess({password:t.pay_password});f.hide();}});}}});}i.on('click','.btn-cancel',function(){f.hide();});}},e;}),define('pay/order/internalPay_1ba80d6d15',['require','exports','cobble/function/minus','cobble/function/plus','cobble/helper/Input','cobble/ui/Tab','cobble/ui/Dialog','common/service_9c322508d3','../common/component/SetPasswordDialog_e0be80bfb5','common/form_2ef59f4d41','common/store_a1a35b3dfc','cobble/util/redirect'],function(require,exports){'use strict';function e(){var e=v.get('payAmount'),t=v.get('coursesection');if(t)if($('.isSms')[0])if(Number(e/t)>=1)$('.isSms').prop('display','block');else $('.isSms').hide();if(x.html(Number(e).toFixed(2)),w.html(Number(v.get('couponAmount')).toFixed(2)),q.html(Number(v.get('balanceAmount')).toFixed(2)),e>0)$('.pay-approach').show();else $('.pay-approach').hide();if(v.get('useCoupon'))$('.account-coupon .box').show();}function t(){var e=Number(v.get('price')),t=(Number(v.get('balance')),Number(v.get('coupon')||0)),n=0,i=0,o=0,r=e,a=v.get('useCoupon');if(v.get('couponFreezed'))i=v.get('couponAmount');else if(a)if(t>=e)i=e,r=0;else i=t,r=f(e,i);if(v.get('useDiscount'))o=Number(v.get('discount'))||0,r=f(e,o);v.set({balanceAmount:n,couponAmount:i,payAmount:r,discountAmount:o});}function n(){var e=b.find('.pay-amount-value').text().replace(/,/g,''),t=v.get('periods'),n=v.get('choice_fenqi'),i=b.find('.stage :checkbox'),o=!1;if(i[0]&&i[0].checked)o=!0;if(n)if(Number(e)<500){var r='<label class="form-checkbox disabled"><input type="checkbox" disabled="disabled">花呗分期</label><span class="warning">订单金额低于500不能进行分期</span>';y.html(r);}else{if(o)var r='<label class="form-checkbox checked"><input type="checkbox" checked="checked">花呗分期</label><span class="stage-detail">\xA5<span class="repayment-period">70</span> x<span class="periods">12</span>期</span><span class="change-stage">修改分期</span>';else var r='<label class="form-checkbox checked"><input type="checkbox">花呗分期</label><span class="stage-detail">\xA5<span class="repayment-period">70</span> x<span class="periods">12</span>期</span><span class="change-stage">修改分期</span>';y.html(r),h.getStageData({money:e,courseNum:v.get('courseNumber'),courseType:v.get('courseType')}).done(function(e){if(0===e.code){var n=e.data.fenqi_detail,i=!1;if($.each(n,function(e,n){if(n.periods==t)i=!0,y.find('.repayment-period').html(n.every_periods_repayment),y.find('.periods').html(n.periods);}),!i){var o=n[0];y.find('.repayment-period').html(o.every_periods_repayment),y.find('.periods').html(o.periods);}}});}}function i(){v.set('useCoupon',!0),t(),e();}function o(){v.set('useCoupon',!1),t(),e();}function r(){v.set('useDiscount',!0),t(),e();}function a(){v.set('useDiscount',!1),t(),e();}function c(){if(l)l.find('input[type="radio"]').prop('checked',!1),l.removeClass('text-primary'),l=null;}function s(){if(v.get('useCoupon')){for(var e=b.find('.account-coupon .available :radio'),t=v.get('couponPrice'),n=0,o=0,r=0;r<e.length;r++){var a=e[r].attributes['data-value'].value;if(Number(a)==t){n=r;break;}else if(Number(a)>o)o=a,n=r;}e[n].checked=!0,v.set('useCoupon',!0),v.set('coupon',e[n].value),v.set('couponId',e[n].attributes['data-id'].value),b.find('.account-other :checkbox').prop('checked',!0),C.show(),i();}}var u,l,f=require('cobble/function/minus'),d=(require('cobble/function/plus'),require('cobble/helper/Input')),p=require('cobble/ui/Tab'),m=require('cobble/ui/Dialog'),h=require('common/service_9c322508d3'),v=(require('../common/component/SetPasswordDialog_e0be80bfb5'),require('common/form_2ef59f4d41'),require('common/store_a1a35b3dfc')),h=require('common/service_9c322508d3'),b=(require('cobble/util/redirect'),$('.order-money')),g=$('#coupon-code'),y=b.find('.stage'),x=b.find('.pay-amount-value'),w=b.find('#coupon-deducts'),q=b.find('#balance-deducts'),k=$('.pay-password'),C=$('.account-other > div');exports.init=function(e){u=e.validator;v.get('user').mobile,v.get('mobile');v.set({payAmount:v.get('price')}),new d({element:g,onChange:function(){var e=this.element.val();b.find('.account-coupon :checkbox').prop('checked',''!==e),b.find('#coupon-code').prop('disabled','');}}),b.on('change','.account-other :checkbox',function(){if(this.checked)C.show(),i();else C.hide(),o();n();});var t=b.find('#use-coupon'),r=b.find('#disuse-coupon');t.on('click',function(){var e=($(this),g.val());if(!e)return alert('请输入优惠券密码\uFF01'),!1;else return b.find('.account-coupon .form-radio :radio').prop('checked',!0),void h.checkFavCode({code:e,pay_money:v.get('price'),teacher_id:v.get('teacherId'),lesson_way:v.get('lessonWay'),course_type:v.get('type'),subject_id:v.get('subjectId'),course_number:v.get('courseNumber')}).done(function(n){var o=b.find('.coupon-tips');if(0===n.code)t.prop('disabled',!0),r.prop('disabled',!1),o.show(),c(),b.find('#coupon-code').prop('disabled',!0),v.set('useCoupon',!0),v.set('coupon',n.data.money),v.set('couponCode',e),v.set('couponId',n.data.fav_id),i(),o.html('<i class="icon icon-check"></i>已成功使用优惠券折抵'+v.get('couponAmount')+'元');else b.find('.coupon-tips').html('');});}),r.on('click',function(){t.prop('disabled',!1),g.prop('disabled',!1),r.prop('disabled',!0),v.set('coupon',null),v.set('couponCode',null),v.set('couponId',null),b.find('.coupon-tips').html(''),i();}),b.on('click','.btn-pay',function(){var e=$.trim($('[name="password"]').val());if(b.find('.pay-password').is(':visible')&&!e)return void alert('请输入支付密码');else return void pay({purchaseId:v.get('purchaseId'),useCoupon:v.get('useCoupon'),approach:data.approach,bankNum:data.bankNum,balanceAmount:v.get('balanceAmount'),couponAmount:v.get('couponAmount'),payAmount:v.get('payAmount'),password:e,couponCode:v.get('couponCode')});}).on('click','.account-coupon .available :radio',function(){var e=$(this).parents('tr').addClass('text-primary'),t=$(this).val(),o=$(this).data('id');if(l)l.removeClass('text-primary');if(l=e,t)v.set('coupon',t),v.set('couponId',o),v.set('useCoupon',!0),i();n();}),y.on('click','.change-stage',function(){var e=b.find('.pay-amount-value').text().replace(/,/g,''),t=y.find('.periods').text();h.getStageData({money:e,courseNum:v.get('courseNumber'),courseType:v.get('courseType')}).done(function(e){if(0===e.code){var n=e.data.fenqi_detail,i=n.length,o=e.data.fenqi.tiexi_info;if(3!=i)var r='<div class="inner-box">';else var r='<div class="inner-box three-items">';$.each(n,function(e,n){var i='';if(n.periods==t&&(1==e||3==e))i=' selected special';else if(n.periods==t)i=' selected';else if(1==e||3==e)i=' special';var a='含利息\uFFE5'+n.every_period_fee+'/期';if(o.indexOf(n.periods)>-1)a='含利息\uFFE50.00/期';r+='<div class="stage-item'+i+'" data-periods="'+n.periods+'" data-period-pay="'+n.every_periods_repayment+'"><span class="stage-detail">\xA5 '+n.every_periods_repayment+' x '+n.periods+'期<span>'+a+'</span></div>';}),r+='<div class="confirm-choice">确定</div>',r+='</div>';var a=new m({title:'花呗分期',content:r,width:703,skinClass:'stage-dialog'}),c=a.element;c.on('click','.confirm-choice',function(){var e=c.find('.selected').data('periods');h.sendStageChoice({courseNum:v.get('courseNumber'),courseType:v.get('type'),periods:e}).done(function(e){if(0===e.code){var t=c.find('.selected').data('period-pay'),n=c.find('.selected').data('periods');y.find('.repayment-period').html(t),y.find('.periods').html(n),a.hide(),y.find('input[type=checkbox]').prop('checked',!0);}});}).on('click','.stage-item',function(){c.find('.stage-item').removeClass('selected'),$(this).addClass('selected');});}});}),b.on('change','.stage :checkbox',function(){if(this.checked){var e=y.find('.periods').text();h.sendStageChoice({courseNum:v.get('courseNumber'),courseType:v.get('type'),periods:e});}else h.sendStageChoice({courseNum:v.get('courseNumber'),courseType:v.get('type'),periods:0});}),new p({element:b.find('.account-coupon .box'),navSelector:'.box-tabs li',contentSelector:'.box-body > div',navActiveClass:'active'}),s();},exports.getData=function(){var e,t,n=[];if(v.get('useCoupon'))n.push('9:'+v.get('couponAmount')),t=v.get('couponId');return n=n.join('_'),{payType:n,payPassword:e,activityId:t,payAmount:v.get('payAmount')};},exports.validate=function(){if(k.is(':visible'))return u.validate('passowrd',!0);else return!0;},exports.setDiscount=function(e){var t=b.find('.account-other :checkbox'),i=t.closest('.account-other');if(e)C.hide(),o(),t.prop('checked',!1).prop('disabled',!0),v.set('discount',e),r(),i.prepend('<span class="tip">课程已经享受活动价\uFF0C不可再使用优惠券\uFF01</span>');else t.prop('disabled',!1),v.set('discount',0),a(),i.find('.tip').remove();n();},exports.maxCouponDiscount=function(){if(v.get('useCoupon')){for(var e=b.find('.account-coupon .available :radio'),t=v.get('couponPrice'),n=0,i=0;i<e.length;i++){var o=e[i].attributes['data-value'].value;if(Number(o)==t){n=o;break;}else if(Number(o)>n)n=o;}return n;}else return 0;};});