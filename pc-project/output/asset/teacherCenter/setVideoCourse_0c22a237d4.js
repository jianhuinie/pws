define('cobble/form/Select',['require','exports','module','../ui/ComboBox','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return n.init(this,e);}var t=require('../ui/ComboBox'),i=require('../function/jquerify'),n=require('../function/lifeCycle');return e.prototype={constructor:e,type:'Select',init:function(){var e=this,i=e.element,n='<input type="hidden" name="'+e.name+'"';if(null!=e.value)n+=' value="'+e.value+'"';if(i.attr('required'))n+=' required';n+=' />';var o=e.input=$(n);i.append(o),e.comboBox=new t({element:i,button:i.find(e.buttonSelector),menu:i.find(e.menuSelector),data:e.data,value:e.value,show:e.show,hide:e.hide,defaultText:e.defaultText,template:e.template,renderTemplate:e.renderTemplate,activeClass:e.activeClass,openClass:e.openClass,setText:$.proxy(e.setText,e),onChange:function(t,i){if(e.setValue(i.value),!e.silence)e.emit('change',i);},onAfterShow:function(){i.trigger('focusin');},onAfterHide:function(){i.trigger('focusout');}});},disable:function(){var e=this,t=e.element;t.find(e.buttonSelector).prop('disabled',!0);},enable:function(){var e=this,t=e.element;t.find(e.buttonSelector).prop('disabled',!1);},getValue:function(){return this.value;},setValue:function(e,t){var i=this;if(t=t||{},t.force||e!=i.value)i.value=e,i.input.val(null==e?'':e),i.silence=t.silence,i.comboBox.setValue(e),delete i.silence;},refresh:function(e){this.comboBox.refresh(e);},dispose:function(){var e=this;n.dispose(e),e.comboBox.dispose(),e.input=e.element=e.comboBox=null;}},i(e.prototype),e.defaultOptions={defaultText:'请选择',buttonSelector:'.btn-default',menuSelector:'.dropdown-menu',labelSelector:'.btn-default span',activeClass:'active',openClass:'open',renderTemplate:function(e){var t=[];return $.each(e,function(e,i){var n=[];$.each(i,function(e,t){if('text'!==e&&null!=t)n.push('data-'+e+'="'+t+'"');}),t.push('<li '+n.join(' ')+'>'+i.text+'</li>');}),t.join('');},setText:function(e){this.element.find(this.labelSelector).html(e);}},e;}),define('cobble/form/Text',['require','exports','../helper/Input','../helper/Placeholder','../function/init','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return r.init(this,e);}var t=require('../helper/Input'),i=require('../helper/Placeholder'),n=require('../function/init'),o=require('../function/jquerify'),r=require('../function/lifeCycle');return e.prototype={constructor:e,type:'Text',init:function(){var e=this,n=e.element;e.placeholder=new i({element:n,simple:e.placeholderSimple,nativeFirst:e.placeholderNativeFirst,placeholderSelector:e.placeholderSelector,template:e.template});var o=e.action;if(o)$.each(o,function(t,i){o[t]=$.proxy(i,e);});e.input=new t({element:n,onChange:function(t){e.emit(t);},onKeyDown:function(t){e.emit(t);},action:o});},getValue:function(){return $.trim(this.element.val());},setValue:function(e,t){var i=this;if(t=t||{},t.force||i.getValue()!==e){if(i.element.val(e),i.placeholder)i.placeholder.refresh();if(!t.silence)i.emit('change');}},dispose:function(){var e=this;r.dispose(e),e.input.dispose(),e.placeholder.dispose(),e.element=e.input=e.placeholder=null;}},o(e.prototype),e.defaultOptions={simple:!1,nativeFirst:!0,placeholderSelector:'.placeholder',template:'<div class="placeholder-wrapper"><div class="placeholder"></div></div>'},e.init=n(e),e;}),define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return o.init(this,e);}function t(e,t){if(e.length>0){var i=e[0].element;if(i.is(':hidden'))i=i.parent();var n=i.offset().top;if(t>0)n-=t;window.scrollTo(window.scrollX,n);}}function i(e){var t=$.Deferred();return $.when.apply($,e).done(function(){t.resolve(arguments);}),t;}var n=require('../function/jquerify'),o=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var t=this,i=t.element,n='FORM'===i.prop('tagName')?i:i.find('form');if(n.length>0)n.attr('novalidate','novalidate').on('submit'+a,$.proxy(t.validate,t));$.each(t.fields,function(t,n){var o=i.find('[name="'+t+'"]'),a=n.type;if(!a)a=n.type=o.attr('type')||'text';var s=n.rules;if(!s)s=n.rules={};var l=e.type[a]||[];$.each(l,function(e,t){if(null==s[t]){var i=r[t];if($.isFunction(i))s[t]=i(o,n);}});});var o=t.groupSelector;if(i.on('focusin'+a,function(e){var i=$(e.target).closest(o),n=[t.successClass,t.errorClass,t.requiredClass].join(' ');i.removeClass($.trim(n));}),t.realtime)i.on('focusout'+a,function(e){var i=$(e.target),n=i.prop('name');if(!n)i=i.find('[name]'),n=i.prop('name');if(n)t.validate(n);});},validate:function(e,n){var o=this,r=o.emit('beforeValidate');if(!r.isDefaultPrevented()){var a,s=o.element,l=o.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))a=$.map(e,function(e){return s.find('[name="'+e+'"]').closest(l);});else if(a=s.find(l),'boolean'===$.type(e))n=e;var u=[],c=[];$.each(a,function(e,t){var i=o.validateGroup($(t));if(i){if(i.promise)c.push(i),i=i.data;$.merge(u,i);}});var e=[],f=[],d=function(){if($.each(u,function(t,i){if(i.error)f.push(i);e.push(i.element.prop('name'));}),n)t(f,o.scrollGap);o.emit('afterValidate',{fields:e,errors:f});};if(c.length>0)return i(c).done(d);else return d(),0===f.length;}},validateGroup:function(t){if(t.is(':visible')){var n=this,o=[],r=[],a=[];if(t.find('[name]').each(function(t){var i,s,l=this,u=l.name,c=l.value,f=l.disabled,d=$(l);if(!f){var p=n.fields[u];if(p){i=!0,p=$.extend(!0,{},p),p.form=n.element,p.value=$.trim(c);var m;if($.each(e.type[p.type]||[],function(t,i){var n=e.rule[i](p);if(n===!1)return m=i,!1;else if(''===p.value&&'required'===i)return!1;}),m){var h=p.errors;if(h)s=h[m];if(!s)throw new Error(u+' 字段 '+m+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var v=$.Deferred(),g=p.custom(d,function(e){v.resolve(e);});s=null==g||g.done?v:g;}}}if(i)if(t=o.push({element:d,error:s}),s&&s.promise)r.push(s),a.push(t-1);}),r.length>0){var s=i(r).done(function(e){$.each(e,function(e,t){o[a[e]].error=t;}),n.refreshGroup(t,o);});return s.data=o,s;}else return n.refreshGroup(t,o),o;}},refreshGroup:function(e,t){var i=this,n=i.successClass,o=i.errorClass;$.each(t,function(t,r){var a,s=r.element,l=r.error,u=i.errorSelector;if(u)a=e.find(u).eq(t);if(l&&'string'===$.type(l)){if(e.removeClass(n).addClass(o),a){var c=i.renderTemplate;if($.isFunction(c))l=c({text:l},i.errorTemplate);a.html(l).show();var f=i.errorPlacement;if($.isFunction(f))f(s,a);}}else if(r.error='',e.removeClass(o).addClass(n),a)a.html('').hide();});},dispose:function(){var e=this;o.dispose(e),e.element.off(a),e.element=null;}},n(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,t){return t.replace(/\${(\w+)}/g,function(t,i){return e[i]||'';});},errorPlacement:function(e,t){if('hidden'===e.prop('type'))e=e.parent();t.css({position:'static',width:'auto'});var i=t.outerWidth(!0)+5;t.css({position:'absolute',width:i});var n=e.parent();if(n.is('.placeholder-wrapper'))e=n;var o=e.position();t.css({left:o.left+e.outerWidth()-37,top:o.top-t.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var t=e.rules.pattern;if(t)return t.test(e.value);else return void 0;},minlength:function(e){var t=e.rules.minlength;if($.isNumeric(t))return e.value.length>=+t;else return void 0;},maxlength:function(e){var t=e.rules.maxlength;if($.isNumeric(t))return e.value.length<=+t;else return void 0;},min:function(e){var t=e.rules.min;if($.isNumeric(t))return e.value>=+t;else return void 0;},max:function(e){var t=e.rules.max;if($.isNumeric(t))return e.value<=+t;else return void 0;},step:function(e){var t=e.rules.step;if($.isNumeric(t)){var i=e.rules.min||1;return(e.value-i)%t===0;}},equals:function(e){var t=e.rules.equals;if(t){var i=e.form.find('[name="'+t+'"]');return e.value===$.trim(i.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var r={required:function(e){return'required'===e.attr('required');},pattern:function(t,i){var n=t.attr('pattern')||e.pattern[i.type];if('string'===$.type(n))n=new RegExp(n);return n;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},a='.cobble_form_validator';return e;}),define('cobble/function/around',['require','exports','module'],function(){'use strict';return function(e,t,i,n){var o='string'===$.type(t),r=o?e[t]:e;if(!o)n=i,i=t;var a=function(){var e,t=arguments;if($.isFunction(i))e=i.apply(this,t);if(e!==!1){if($.isFunction(r))e=r.apply(this,t);if($.isFunction(n)){var o=n.apply(this,t);if('undefined'!==$.type(o))e=o;}return e;}};return o?e[t]=a:a;};}),define('cobble/function/call',['require','exports','module'],function(){'use strict';return function(e,t,i){if($.isFunction(e)){var n=$.isArray(i)?'apply':'call';return e[n](t,i);}};}),define('cobble/function/contains',['require','exports','module'],function(){'use strict';return function(e,t){if(e=e.jquery?e[0]:e,t=t.jquery?t[0]:t,!e||!t)return!1;if(e===t)return!0;else return $.contains(e,t);};}),define('cobble/function/debounce',['require','exports','module'],function(){'use strict';return function(e,t){t='number'===$.type(t)?t:50;var i;return function(){if(!i){var n=arguments;i=setTimeout(function(){i=null,e.apply(null,$.makeArray(n));},t);}};};}),define('cobble/function/decimalLength',['require','exports','module'],function(){'use strict';return function(e){var t=(''+e).split('.');return 2===t.length?t[1].length:0;};}),define('cobble/function/disableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,i='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=function(){return!1;};};if(i)return function(e){e=e||document.body,e.style.MozUserSelect='none';};else return $.noop;}),define('cobble/function/divide',['require','exports','module','./decimalLength','./float2Int'],function(require){'use strict';var e=require('./decimalLength'),t=require('./float2Int');return function(i,n){var o=Math.max(e(i),e(n));return i=t(i,o),n=t(n,o),i/n;};}),define('cobble/function/dragGlobal',['require','exports','module','../helper/Draggable','../util/instance','../util/dimension','./pin'],function(require){'use strict';{var e=require('../helper/Draggable'),t=require('../util/instance'),i=require('../util/dimension');require('./pin');}return function(n){return new e({element:n.element,container:t.body,draggingClass:n.draggingClass,handleSelector:n.handleSelector,cancelSelector:n.cancelSelector,rect:function(){var e=n.fixed,t=n.scrollable;return{x:e||t?0:i.getPageScrollLeft(),y:e||t?0:i.getPageScrollTop(),width:e||!t?i.getViewportWidth():i.getPageWidth(),height:e||!t?i.getViewportHeight():i.getPageHeight()};}});};}),define('cobble/function/enableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,i='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=null;};if(i)return function(e){e=e||document.body,e.style.MozUserSelect='';};else return $.noop;}),define('cobble/function/float2Int',['require','exports','module'],function(){'use strict';return function(e,t){var i,n=(''+e).split('.');if(t>=0);else t=0;if(1===n.length)i=e+new Array(t+1).join('0');else t=Math.max(0,t-n[1].length),i=n.join('')+new Array(t+1).join('0');return+i;};}),define('cobble/function/init',['require','exports','module'],function(){'use strict';return function(e){return function(t,i){var n=[];return t.each(function(){n.push(new e($.extend({element:$(this)},i)));}),n;};};}),define('cobble/function/innerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var i=t.offset(),n=t.css('border-left-width'),o=t.css('border-top-width');return{left:i.left+e(n,0,'int'),top:i.top+e(o,0,'int')};};}),define('cobble/function/isHidden',['require','exports','module'],function(){'use strict';return function(e){e.css('display');return'none'===e.css('display')||0==e.css('opacity')||'hidden'===e.css('visibility');};}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,i={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(i,n){var o=this,r=e(o);if(r){if(!i[$.expando])i='string'===$.type(i)?$.Event(i):$.Event(null,i);i.cobble=o;var a=[i];if(n)a.push(n);var s=o[$.camelCase('on-'+i.type)];if($.isFunction(s)&&s.apply(o,a)===!1)i.preventDefault();if(!i.isPropagationStopped())t.trigger.apply(r,a);return i;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(i,function(t,i){if(null==e[t])e[t]=i;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var i=e.constructor,n='__cobble__'+i.prototype.type,o=t.element;if(o&&o.data(n))e=o.data(n);else if($.extend(e,i.defaultOptions,t),e.init(),o)o.data(n,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,i=e.element;if(i)i.removeData(t);};}),define('cobble/function/offsetParent',['require','exports','module'],function(){'use strict';function e(e){return e.is('body')||'static'!==e.css('position');}return function(t){if(t.is('body'))return t;for(var i=t.parent();!e(i);)i=i.parent();return i;};}),define('cobble/function/outerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var i=t.offset(),n=e(t.css('margin-left'),0,'int'),o=e(t.css('margin-top'),0,'int');return{left:i.left-n,top:i.top-o};};}),define('cobble/function/page',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')<e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/pageHeight',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollHeight,t.clientHeight);};}),define('cobble/function/pageScrollLeft',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);};}),define('cobble/function/pageScrollTop',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollTop,document.documentElement.scrollTop);};}),define('cobble/function/pageWidth',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollWidth,t.clientWidth);};}),define('cobble/function/parsePercent',['require','exports','module','./divide'],function(require){'use strict';var e=require('./divide'),t=/(-?\d+(\.\d+)?)%/;return function(i){if(t.test(i))return e(RegExp.$1,100);else return void 0;};}),define('cobble/function/pin',['require','exports','module','../util/instance','./parsePercent'],function(require){'use strict';function e(e){var t=o[e.x];if(null==t)t=e.x;if('string'===$.type(t)){var i=n(t);if(null!=i)t=i*(e.width||e.element.outerWidth());}return t;}function t(e){var t=o[e.y];if(null==t)t=e.y;if('string'===$.type(t)){var i=n(t);if(null!=i)t=i*(e.height||e.element.outerHeight());}return t;}var i=require('../util/instance'),n=require('./parsePercent'),o={left:0,top:0,center:'50%',middle:'50%',right:'100%',bottom:'100%'};return function(n){var o=n.element,r=n.attachment||{};if(!r.element)r.element=i.body;var a=r.element.offset(),s=a.left+e(r),l=a.top+t(r),u=s-e(n),c=l-t(n),f=n.offset;if(f){if('number'===$.type(f.x))u+=f.x;if('number'===$.type(f.y))c+=f.y;}var d={left:u,top:c},p=o.css('position');if('absolute'!==p&&'fixed'!==p)d.position='absolute';if(n.silence)return d;else o.css(d);};}),define('cobble/function/pinGlobal',['require','exports','module','./pin','../util/dimension','../function/viewport'],function(require){'use strict';var e=require('./pin'),t=require('../util/dimension'),i=require('../function/viewport');return function(n){var o={silence:!0,element:n.element,x:'50%'===n.x?'50%':0,y:'50%'===n.y?'50%':0,attachment:{element:i(),width:t.getViewportWidth(),height:t.getViewportHeight(),x:n.x,y:n.y}};if(!n.fixed)o.offset={x:t.getPageScrollLeft(),y:t.getPageScrollTop()};return e(o);};}),define('cobble/function/position',['require','exports','module','./offsetParent'],function(require){'use strict';var e=require('./offsetParent');return function(t){var i=e(t),n=t.css('position'),o=parseInt(t.css('left'),10),r=parseInt(t.css('top'),10),a=isNaN(o),s=isNaN(r);if(a||s)if(1===i.length){var l=t.offset(),u=i.offset();if(a)o=l.left-u.left-(parseInt(i.css('border-left-width'),10)||0);if(s)r=l.top-u.top-(parseInt(i.css('border-top-width'),10)||0);}else o=r=0;if(!n||'static'===n)n='absolute';return{position:n,left:o,top:r};};}),define('cobble/function/replaceWith',['require'],function(){'use strict';return function(e,t){e=e[0],t=t[0],e.parentNode.replaceChild(t,e);};}),define('cobble/function/restrain',['require','exports','module'],function(){'use strict';return function(e,t,i){if(t>e)e=t;else if(e>i)e=i;return e;};}),define('cobble/function/split',['require','exports','module'],function(){'use strict';return function(e,t){var i=[];return $.each(e.split(t),function(e,t){if(t=$.trim(t))i.push(t);}),i;};}),define('cobble/function/toNumber',['require','exports','module'],function(){'use strict';var e={'int':parseInt,'float':parseFloat};return function(t,i,n){if('number'!==$.type(t)){var o=e[n];if(t=o?o(t,10):+t,isNaN(t))t=i;}return t;};}),define('cobble/function/viewport',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')>e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/viewportHeight',['require','exports','module'],function(){'use strict';return function(){return window.innerHeight||document.documentElement.clientHeight;};}),define('cobble/function/viewportWidth',['require','exports','module'],function(){'use strict';return function(){return window.innerWidth||document.documentElement.clientWidth;};}),define('cobble/helper/AjaxUploader',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return u.init(this,e);}function t(e,t){var i=new FormData();$.each(e.data,function(e,t){i.append(e,t);}),i.append(e.fileName,t.nativeFile),t.xhr.send(i);}function i(t,i){var n=i.nativeFile,o=i.file.size,r=i.chunk;if(!r)r=i.chunk={index:0,uploaded:0};var a=r.index,s=t.chunkSize,l=s*a,u=s*(a+1);if(u>o)u=o;if(r.uploading=u-l,r.uploading<=0)return void setTimeout(function(){t.emit('uploadError',{fileItem:i,errorCode:e.ERROR_CHUNK_SIZE});});var c='bytes '+(l+1)+'-'+u+'/'+o,f=i.xhr;f.setRequestHeader('Content-Type',''),f.setRequestHeader('X_FILENAME',encodeURIComponent(n.name)),f.setRequestHeader('Content-Range',c),f.send(n.slice(l,u));}function n(t,i){var n=i.xhr;if(n)$.each(d,function(e,t){n['on'+t.type]=null;}),$.each(p,function(e,t){n.upload['on'+t.type]=null;}),delete i.xhr;if(t.emit('uploadComplete',{fileItem:i}),i.status===e.STATUS_UPLOAD_SUCCESS||i.status===e.STATUS_UPLOAD_ERROR&&t.ignoreError){var r=i.index+1;if(r<t.fileQueue.files.length)t.fileQueue.index=r,t.upload();else o(t,[]);}}function o(t,i){var n=t.fileQueue;n.index=0,n.files=$.map(i,function(t,i){return{index:i,file:s(t),nativeFile:t,status:e.STATUS_WAITING};});}function r(e){var t=e.fileQueue,i=t.index;if(t.files&&'number'===$.type(i))return t.files[i];else return void 0;}function a(e){var t=[];return $.each(e,function(e,i){if(f[i])t.push(f[i]);}),$.unique(t).join(',');}function s(e){var t=e.name,i=t.split('.'),n=i.length>0?i.pop().toLowerCase():'';return{name:t,type:n,size:e.size};}var l=require('../function/jquerify'),u=require('../function/lifeCycle');e.prototype={constructor:e,type:'AjaxUploader',init:function(){var e=this;e.fileQueue={};var t=e.element;if(!t.is(':file'))throw new Error('AjaxUploader element must be <input type="file" />');var i=e.faker=$('<form></form>');t.replaceWith(i),i.append(t);var n={};if(e.accept)n.accept=a(e.accept);if(e.multiple)n.multiple=!0;t.prop(n),t.on('change'+c,function(){o(e,t.prop('files')),e.emit('fileChange');}),e.emit('ready');},getFiles:function(){return this.fileQueue.files||[];},setAction:function(e){this.action=e;},setData:function(e){$.extend(this.data,e);},reset:function(){this.faker[0].reset();},upload:function(n){var o=this,a=o.useChunk?e.STATUS_UPLOADING:e.STATUS_WAITING;if(n=n||r(o),n&&!(n.status>a)){var s=new XMLHttpRequest();if(o.xhrProps)$.extend(s,o.xhrProps);n.xhr=s,$.each(d,function(e,t){s['on'+t.type]=function(e){t.handler(o,e);};}),$.each(p,function(e,t){s.upload['on'+t.type]=function(e){t.handler(o,e);};}),s.open('post',o.action,!0);var l=o.useChunk?i:t;l(o,n);}},stop:function(){var t=this,i=r(t);if(i&&i.status===e.STATUS_UPLOADING)i.xhr.abort();t.reset();},enable:function(){this.element.prop('disabled',!1);},disable:function(){this.element.prop('disabled',!0);},dispose:function(){var e=this;u.dispose(e),e.stop(),e.element.off(c),e.faker=e.element=e.fileQueue=null;}},l(e.prototype),e.defaultOptions={data:{},multiple:!1,fileName:'Filedata',ignoreError:!1},e.supportChunk='undefined'!=typeof FileReader,e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_CHUNK_SIZE=-1;var c='.cobble_helper_ajaxuploader',f={html:'text/html',htm:'text/html',shtml:'text/html',xml:'text/xml',css:'text/css',js:'application/x-javascript',json:'application/json',atom:'application/atom+xml',rss:'application/rss+xml',mml:'text/mathml',txt:'text/plain',jad:'text/vnd.sun.j2me.app-descriptor',wml:'text/vnd.wap.wml',htc:'text/x-component',jpg:'image/jpeg',jpeg:'image/jpeg',png:'image/png',gif:'image/gif',tif:'image/tiff',tiff:'image/tiff',wbmp:'image/vnd.wap.wbmp',ico:'image/x-icon',jng:'image/x-jng',bmp:'image/x-ms-bmp',svg:'image/svg+xml',svgz:'image/svg+xml',webp:'image/webp',mp3:'audio/mpeg',wma:'audio/x-ms-wma',wav:'audio/x-wav',mid:'audio/midi',midd:'audio/midi',kar:'audio/midi',ogg:'audio/ogg',m4a:'audio/x-m4a',ra:'audio/x-realaudio',ram:'audio/x-pn-realaudio',mod:'audio/mod','3gp':'video/3gpp','3gpp':'video/3gpp',mp4:'video/mp4',mpeg:'video/mpeg',mpg:'video/mpeg',mov:'video/quicktime',webm:'video/webm',flv:'video/x-flv',m4v:'video/x-m4v',mng:'video/x-mng',asx:'video/x-ms-asf',asf:'video/x-ms-asf',wmv:'video/x-ms-wmv',avi:'video/x-msvideo',rm:'video/vnd.rn-realvideo',rmvb:'video/vnd.rn-realvideo',ts:'video/MP2T',dv:'video/x-dv',mkv:'video/x-matroska',jar:'application/java-archive',war:'application/java-archive',ear:'application/java-archive',hqx:'application/mac-binhex40',pdf:'application/pdf',ps:'application/postscript',eps:'application/postscript',ai:'application/postscript',rtf:'application/rtf',wmlc:'application/vnd.wap.wmlc',kml:'application/vnd.google-earth.kml+xml',kmz:'application/vnd.google-earth.kmz','7z':'application/x-7z-compressed',cco:'application/x-cocoa',jardiff:'application/x-java-archive-diff',jnlp:'application/x-java-jnlp-file',run:'application/x-makeself',pl:'application/x-perl',pm:'application/x-perl',prc:'application/x-pilot',pdb:'application/x-pilot',rar:'application/x-rar-compressed',rpm:'application/x-redhat-package-manager',sea:'application/x-sea',swf:'application/x-shockwave-flash',sit:'application/x-stuffit',tcl:'application/x-tcl',tk:'application/x-tcl',der:'application/x-x509-ca-cert',pem:'application/x-x509-ca-cert',crt:'application/x-x509-ca-cert',xpi:'application/x-xpinstall',xhtml:'application/xhtml+xml',zip:'application/zip',bin:'application/octet-stream',exe:'application/octet-stream',dll:'application/octet-stream',deb:'application/octet-stream',dmg:'application/octet-stream',eot:'application/octet-stream',iso:'application/octet-stream',img:'application/octet-stream',msi:'application/octet-stream',msp:'application/octet-stream',msm:'application/octet-stream',doc:'application/msword',xls:'application/vnd.ms-excel',ppt:'application/vnd.ms-powerpoint',docx:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',xlsx:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',pptx:'application/vnd.openxmlformats-officedocument.presentationml.presentation'},d={uploadStart:{type:'loadstart',handler:function(t){var i=r(t);i.status=e.STATUS_UPLOADING,t.emit('uploadStart',{fileItem:i});}},uploadSuccess:{type:'load',handler:function(t,i){var o=r(t),a={fileItem:o,responseText:o.xhr.responseText},s=o.chunk;if(s){var l=s.uploaded;if(l<o.file.size){var i=t.emit('chunkUploadSuccess',a);if(!i.isDefaultPrevented())if(s.index++,s.uploaded=l+s.uploading,s.uploaded<o.file.size)t.upload();else return o.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',a),void n(t,o);return;}}o.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',a),n(t,o);}},uploadError:{type:'error',handler:function(t,i,o){var a=r(t);a.status=e.STATUS_UPLOAD_ERROR,t.emit('uploadError',{fileItem:a,errorCode:o}),n(t,a);}},uploadStop:{type:'abort',handler:function(t,i){d.uploadError.handler(t,i,e.ERROR_CANCEL);}}},p={uploadProgress:{type:'progress',handler:function(e,t){var i=r(e),n=i.file.size,o=t.loaded,a=i.chunk;if(a)o+=a.uploaded;var s=o/(n||1);if(s>=0&&1>=s);else if(0>s)s=0;else if(s>1)s=1;s=parseInt(100*s,10)+'%',e.emit('uploadProgress',{fileItem:i,uploaded:o,total:n,percent:s});}}};return e;}),define('cobble/helper/Draggable',['require','exports','module','../function/page','../function/toNumber','../function/restrain','../function/position','../function/contains','../function/jquerify','../function/lifeCycle','../function/innerOffset','../function/outerOffset','../function/pageScrollLeft','../function/pageScrollTop','../function/enableSelection','../function/disableSelection','../util/instance','../util/mouse'],function(require){'use strict';function e(e){return u.init(this,e);}function t(e){var t=b(e),i=x(e);if(w.left!==t||w.top!==i){w.left=t,w.top=i;var n=e.data;if(1===++y){var o=n.draggingClass;if(o)n.element.addClass(o);n.emit('beforeDrag');}if(!n.silence)n.element.css(w);n.emit('drag',w);}}function i(e){m(),v.document.off(C);var t=e.data,i=t.draggingClass;if(i)t.element.removeClass(i);if(y>0)t.emit('afterDrag',w);y=b=x=null;}function n(e,t,i){var n=!1;if($.isArray(t))t=t.join(',');return e.find(t).each(function(){if(n=s(this,i))return!1;else return void 0;}),n;}var o=require('../function/page'),r=(require('../function/toNumber'),require('../function/restrain')),a=require('../function/position'),s=require('../function/contains'),l=require('../function/jquerify'),u=require('../function/lifeCycle'),c=require('../function/innerOffset'),f=require('../function/outerOffset'),d=require('../function/pageScrollLeft'),p=require('../function/pageScrollTop'),m=require('../function/enableSelection'),h=require('../function/disableSelection'),v=require('../util/instance'),g=require('../util/mouse');e.prototype={constructor:e,type:'Draggable',init:function(){var e=this,r=e.element;if(!e.container)e.container=o();r.css(a(r)),$.each(g,function(o,l){if(l.support)r.on(l.mousedown+C,function(u){var d=u.target,p=e.handleSelector,m=e.cancelSelector;if(!(p&&!n(r,p,d)||m&&n(r,m,d))){var g=k[o],$=f(r),_=g.absoluteX(u)-$.left,T=g.absoluteY(u)-$.top,q=e.container;if(s(q,r)){var j=c(q);_+=j.left,T+=j.top;}var I=a(r),U=I.position;w.left=I.left,w.top=I.top;var R=e.axis,O=e.getRectange(!0);b='y'===R?S.constant(w.left):S.change(g[U+'X'],_,O.x,O.x+O.width),x='x'===R?S.constant(w.top):S.change(g[U+'Y'],T,O.y,O.y+O.height),y=0,h(),v.document.on(l.mousemove+C,e,t).on(l.mouseup+C,e,i);}});});},getRectange:function(e){var t=this,i=t.rect;if($.isFunction(i))i=t.rect();if(e){var n=t.element,o=i.width-n.outerWidth(!0),r=i.height-n.outerHeight(!0);i.width=Math.max(0,o),i.height=Math.max(0,r);}return i;},setRectange:function(e){this.rect=e;},dispose:function(){var e=this;u.dispose(e),e.element.off(C),e.element=e.container=null;}},l(e.prototype),e.defaultOptions={rect:function(){var e=this,t=e.container,i={x:0,y:0,width:t.innerWidth(),height:t.innerHeight()};if(!s(t,e.element)){var n=c(t);i.x=n.left,i.y=n.top;}return i;}};var b,x,y,C='.cobble_helper_draggable',w={},S={constant:function(e){return function(){return e;};},change:function(e,t,i,n){return function(o){return r(e(o)-t,i,n);};}},k={};return $.each(g,function(e,t){if(t.support)k[e]={absoluteX:function(e){return t.clientX(e)+d();},absoluteY:function(e){return t.clientY(e)+p();},fixedX:function(e){return t.clientX(e);},fixedY:function(e){return t.clientY(e);}};}),e;}),define('cobble/helper/FlashUploader',['require','exports','module','../util/supload/supload','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return n.init(this,e);}require('../util/supload/supload');var t=window.Supload,i=require('../function/jquerify'),n=require('../function/lifeCycle');e.prototype={constructor:e,type:'FlashUploader',init:function(){var e=this,i={flashUrl:e.flashUrl,element:e.element[0],action:e.action,accept:e.accept,multiple:e.multiple,data:e.data,fileName:e.fileName,ignoreError:e.ignoreError,customSettings:{uploader:e}};$.each(o,function(e,t){e=$.camelCase('on-'+e),i[e]=t;}),e.supload=new t(i);},getFiles:function(){return this.supload.getFiles();},setAction:function(e){this.supload.setAction(e);},setData:function(e){this.supload.setData(e);},reset:function(){this.supload.reset();},upload:function(){this.supload.upload();},stop:function(){this.supload.cancel();},enable:function(){this.supload.enable();},disable:function(){this.supload.disable();},dispose:function(){var e=this;n.dispose(e),e.supload.dispose(),e.supload=e.element=null;}},i(e.prototype),e.defaultOptions={multiple:!1,fileName:'Filedata',ignoreError:!1,flashUrl:require.toUrl('../util/supload/supload.swf')},e.STATUS_WAITING=t.STATUS_WAITING,e.STATUS_UPLOADING=t.STATUS_UPLOADING,e.STATUS_UPLOAD_SUCCESS=t.STATUS_UPLOAD_SUCCESS,e.STATUS_UPLOAD_ERROR=t.STATUS_UPLOAD_ERROR,e.ERROR_CANCEL=t.ERROR_CANCEL,e.ERROR_SECURITY=t.ERROR_SECURITY,e.ERROR_IO=t.ERROR_IO;var o={ready:function(){var e=this.customSettings.uploader;e.emit('ready');},fileChange:function(){var e=this.customSettings.uploader;e.emit('fileChange');},uploadStart:function(e){var t=this.customSettings.uploader;t.emit('uploadStart',e);},uploadProgress:function(e){var t=this.customSettings.uploader,i=e.uploaded/(e.total||1);if(i>=0&&1>=i);else i=0;e.percent=parseInt(100*i,10)+'%',t.emit('uploadProgress',e);},uploadSuccess:function(e){var t=this.customSettings.uploader;t.emit('uploadSuccess',e);},uploadError:function(e){var t=this.customSettings.uploader;t.emit('uploadError',e);},uploadComplete:function(e){var t=this.customSettings.uploader;t.emit('uploadComplete',e);}};return e;}),define('cobble/helper/Input',['require','exports','module','../function/around','../function/jquerify','../function/lifeCycle','../util/keyboard','../util/input','./Keyboard'],function(require){'use strict';function e(e){return i.init(this,e);}var t=(require('../function/around'),require('../function/jquerify')),i=require('../function/lifeCycle'),n=require('../util/keyboard'),o=require('../util/input'),r=require('./Keyboard');e.prototype={constructor:e,type:'Input',init:function(){var e=this,t=e.element;o.init(t);var i=e.action;if(i)$.each(i,function(t,n){i[t]=$.proxy(n,e);});var s,l;e.keyboard=new r({element:t,action:i,longPress:e.longPress,onKeyDown:function(t){e.emit(t);},onKeyUp:function(t){e.emit(t);},onBeforeLongPress:function(){s=t.val(),l=!0,e.emit('beforeLongPress');},onAfterLongPress:function(i){if(l=!1,e.emit('afterLongPress'),s!==t.val()&&(n.isCharKey(i.keyCode)||n.isDeleteKey()))e.emit('change');}}),t.on('input'+a,function(){if(!l||!e.smart)e.emit('change');});},autoWidth:function(){var e=this,t=e.element;e.on('change',function(){if(t.scrollLeft()>0)t.width(t.prop('scrollWidth'));});},autoHeight:function(){var e=this,t=e.element;if('hidden'!==t.css('overflow-y'))t.css('overflow-y','hidden');var i,n=t.height(),o=n,r=parseInt(t.css('font-size'),10),a=t.innerHeight()-n;e.on('change',function(){if(o!==n)o=n,t.height(n);if(i=t.prop('scrollHeight')-a,Math.abs(i-o)>r)t.height(i),o=i;});},dispose:function(){var e=this;i.dispose(e);var t=e.element;o.dispose(t),t.off(a),e.keyboard.dispose(),e.element=e.keyboard=null;}},t(e.prototype),e.defaultOptions={smart:!0,longPress:!1};var a='.cobble_helper_input';return e;}),define('cobble/helper/Keyboard',['require','exports','module','../function/call','../function/split','../function/jquerify','../util/keyboard'],function(require){'use strict';function e(t){$.extend(this,e.defaultOptions,t),this.init();}function t(e){var t=[];return $.each(e,function(e,i){var n=[],o='plus',a=r(e.replace(/\$\+/g,o),'+');if($.each(s.combinationKey,function(e){if($.inArray(e,a)<0)a.push('!'+e);}),$.each(a,function(e,t){var i=0===t.indexOf('!');if(i)t=t.substr(1);if(t===o)t='$+';if(s.combinationKey[t])n.push((i?'!':'')+'e.'+t+'Key');else if(s[t])n.push('e.keyCode==='+s[t]);else return n.length=0,!1;}),n.length>0)t.push({test:new Function('e','return '+n.join('&')),handler:i});}),t;}function i(e){var t=e.data,i=e.keyCode,n=t.cache,r=n.counter;if(n.keyCode===i&&r>0){if(1===r)t.emit({type:'beforeLongPress',keyCode:i});r++;}else n.keyCode=i,r=1;if(n.counter=r,t.longPress||1===r)$.each(n.action,function(i,n){if(n.test(e))o(n.handler,t,e);});e.type='keyDown',t.emit(e);}function n(e){var t=e.data,i=t.cache;if(i.keyCode=null,i.counter>1)t.emit({type:'afterLongPress',keyCode:e.keyCode}),i.counter=0;e.type='keyUp',t.emit(e);}var o=require('../function/call'),r=require('../function/split'),a=require('../function/jquerify'),s=require('../util/keyboard');e.prototype={constructor:e,type:'Keyboard',init:function(){var e=this;e.cache={counter:0,action:t(e.action||{})},e.element.on('keydown'+l,e,i).on('keyup'+l,e,n);},dispose:function(){var e=this;e.element.off(l),e.element=e.cache=null;}},a(e.prototype),e.defaultOptions={longPress:!1};var l='.cobble_helper_keyboard';return e;}),define('cobble/helper/Placeholder',['require','exports','module','../function/init','../function/jquerify','../function/lifeCycle','../function/replaceWith','../util/input'],function(require){'use strict';function e(e){return n.init(this,e);}var t=require('../function/init'),i=require('../function/jquerify'),n=require('../function/lifeCycle'),o=require('../function/replaceWith'),r=require('../util/input');e.prototype={constructor:e,type:'Placeholder',init:function(){var e=this,t=e.element,i=t.attr('placeholder');if(null==e.value)e.value=i||'';var n;if(l)if(e.nativeFirst)n='native';else if(i)t.removeAttr('placeholder');if(!n)n=e.simple?'simple':'complex';if(n=u[n],$.extend(e,n),n.init)e.init();if(e.refresh)e.refresh();}},i(e.prototype),e.defaultOptions={simple:!1,nativeFirst:!0,simpleClass:'placeholder-active',placeholderSelector:'.placeholder',template:'<div class="placeholder-wrapper"><div class="placeholder"></div></div>'},e.init=t(e);var a='.cobble_helper_placeholder',s=$('<input type="text" />')[0],l='placeholder'in s;s=null;var u={'native':{show:$.noop,hide:$.noop,refresh:$.noop,dispose:function(){var e=this;n.dispose(e),e.element=null;}},simple:{init:function(){var e=this,t=$.proxy(e.refresh,e);e.element.on('focus'+a,t).on('blur'+a,t);},show:function(){var e=this;e.element.addClass(e.simpleClass).val(e.value);},hide:function(){var e=this;e.element.removeClass(e.simpleClass).val('');},refresh:function(){var e=this,t=e.element;if(document.activeElement===t[0]){if(t.hasClass(e.simpleClass))e.hide();}else if(!t.val())e.show();},dispose:function(){var e=this;n.dispose(e),e.element.off(a),e.element=null;}},complex:{init:function(){var e=this,t=e.element,i=$(e.template);o(t,i),i.append(t),e.faker=i.find(e.placeholderSelector);var n=$.proxy(e.refresh,e);r.init(t),t.on('focus'+a,n).on('blur'+a,n).on('input'+a,n);},show:function(){var e=this;e.faker.html(e.value).show();},hide:function(){this.faker.hide();},refresh:function(){var e=this,t=e.element.val();if($.trim(t))e.hide();else e.show();},dispose:function(){var e=this;n.dispose(e);var t=e.element;r.dispose(t),t.off(a),e.faker=e.element=null;}}};return e;}),define('cobble/helper/Popup',['require','exports','module','../function/split','../function/isHidden','../function/contains','../function/jquerify','../function/lifeCycle','../util/instance'],function(require){'use strict';function e(e){return k.init(this,e);}function t(e,t){$.each(e.showConfigList,function(i,n){n[t](e);});}function i(e,t){$.each(e.hideConfigList,function(i,n){n[t](e);});}function n(e,t){if(e)e.type=t;else e=t;return e;}function o(e){var t=e.currentTarget;return t&&'HTML'===t.tagName?null:t;}function r(e,t){return e.emit(n(t,'beforeShow'));}function a(e,n){return e.layer.data(U,o(n)),t(e,'off'),i(e,'on'),e.emit('afterShow');}function s(e,t){return e.emit(n(t,'beforeHide'));}function l(e){return e.layer.removeData(U),i(e,'off'),t(e,'on'),e.emit('afterHide');}function u(){return $.now();}function c(e){return'__'+e+'Handler__';}function f(e,t){return null==e[t];}function d(e,t){return e.layer.data(U)!==o(t);}function p(e,t,i){return!t||t(e,i);}function m(e,t){return t-e[I]>50;}function h(t,i){return function(n){var o=n.data,r=u(n);if(f(o,q)&&d(o,n)&&p(o,i,n))o[I]=r,g({popup:o,delay:o.show.delay,toggle:e.trigger.show[t].delay,timer:q,success:function(){var e=function(){o.open(n);},t=o[T];if(t)t.done(e);else e();}});};}function v(t,i){return function(n){var o=n.data,r=u(n);if(f(o,j)&&p(o,i,n)&&m(o,r))o[I]=r,o[T]=$.Deferred(),g({popup:o,delay:o.hide.delay,toggle:e.trigger.hide[t].delay,timer:j,success:function(){o.close(n),o[T].resolve();},fail:function(){o[T]=null;}});};}function g(e){var t=e.delay,i=e.success;if(t>0){var n=e.popup,o=e.timer,r=e.toggle||{},a=r.on||$.noop,s=r.off||$.noop,l=e.fail||$.noop,u=function(){clearTimeout(n[o]),s(n,c),n[o]=null;},c=function(e){var t=n[o];if(t)u();if(t&&e===I)i();else l();};a(n,c),n[o]=setTimeout(function(){c(I);},t);}else i();}function b(e){var t=this,i=t.type,n=t.handler,o=c(i);if(e[o]!==n)e.element.on(i,e.selector,e,n),e[o]=n;}function x(e){var t=this;if(!e.selector){var i=t.type;e.element.off(i,t.handler),e[c(i)]=null;}}var y=require('../function/split'),C=require('../function/isHidden'),w=require('../function/contains'),S=require('../function/jquerify'),k=require('../function/lifeCycle'),_=require('../util/instance');e.prototype={constructor:e,type:'Popup',init:function(){var n=this,o=n.showConfigList=[],r=n.hideConfigList=[],a=n.show.trigger,s=n.hide.trigger;if(a)$.each(y(a,','),function(t,i){var n=e.trigger.show[i];if(n)o.push(n);});if(s)$.each(y(n.hide.trigger,','),function(t,i){var n=e.trigger.hide[i];if(n)r.push(n);});if(n.hidden=C(n.layer))t(n,'on');else i(n,'on');},open:function(){var e=this,t=arguments[0];if(!t)e[I]=u();if(t=r(e,t),!t.isDefaultPrevented()){var i=e.layer,n=e.show.animation;if($.isFunction(n))n.call(e,i);else i.show();e.hidden=!1,a(e,t);}},close:function(){var e=this;if(!e.hidden){var t=arguments[0];if(!t)e[I]=u();if(t=s(e,t),!t.isDefaultPrevented()){var i=e.layer,n=e.hide.animation;if($.isFunction(n))n.call(e,i);else i.hide();e.hidden=!0,l(e);}}},dispose:function(){var e=this;k.dispose(e),e.close(),t(e,'off'),e.element=e.layer=null;}},S(e.prototype),e.defaultOptions={show:{trigger:'click'},hide:{trigger:'click'}};var T='__hidePromise__',q='__showTimer__',j='__hideTimer__',I='__lastTriggerTime__',U='__sourceElement__',R=function(e,t){if(!t)return!1;else return w(e.layer,t);};return e.trigger={show:{focus:{type:'focusin',handler:h('focus'),on:b,off:x},click:{type:'click',handler:h('click'),on:b,off:x},over:{type:'mouseenter',handler:h('over'),on:b,off:x,delay:{on:function(e,t){e.element.on('mouseleave',e.selector,t);},off:function(e,t){e.element.off('mouseleave',t);}}},context:{type:'contextmenu',handler:h('context'),on:b,off:x}},hide:{blur:{type:'focusout',handler:v('blur'),on:b,off:x},click:{type:'click',handler:function(){return v(this.type,function(e,t){return!R(e,t.target);});},on:function(e){var t=this;_.document.on(t.type,e,e.clickHandler=t.handler());},off:function(e){_.document.off(this.type,e.clickHandler);}},out:{type:'mouseleave',handler:v('out'),on:function(e){var t=this.type,i=this.handler;e.layer.on(t,e,i),e.element.on(t,e.selector,e,i);},off:function(e){var t=this.type,i=this.handler;e.element.off(t,i),e.layer.off(t,i);},delay:{on:function(e,t){e.element.on('mouseenter',e.selector,t),e.layer.on('mouseenter',t);},off:function(e,t){e.element.off('mouseenter',t),e.layer.off('mouseenter',t);}}},context:{type:'contextmenu',handler:function(){return v('context',function(e,t){return!R(e,t.target);});},on:function(e){var t=this;_.document.on(t.type,e,e.contextHandler=t.handler());},off:function(e){_.document.off(this.type,e.contextHandler);}}}},e;}),define('cobble/helper/Range',['require','exports','module'],function(){'use strict';function e(e){this.element=e;}function t(){var e=this.element;return{start:e.selectionStart,end:e.selectionEnd};}function i(e,t){var i=this.element;i.focus(),i.setSelectionRange(e,t);}function n(){var e=this.element;e.focus();var t=document.selection.createRange().getBookmark(),i=e.createTextRange();i.moveToBookmark(t);var n=i.duplicate();n.setEndPoint('StartToStart',i);for(var o=e.value,r=0;0!==n.moveStart('character',-1);r++)if('\n'===o.charAt(r))r++;return{start:r,end:r+i.text.length};}function o(e,t){var i=this.element;if(!(i.value.length<t)){var n=i.createTextRange();n.collapse(!0),n.moveStart('character',e),n.moveEnd('character',t-1),n.select();}}var r=!window.getSelection;return e.prototype={constructor:e,getRange:r?n:t,setRange:r?o:i,getText:function(){var e=this.element.value,t=this.getRange();return e.substring(t.start,t.end);},setText:function(e){var t=this.element,i=t.value,n=this.getRange();t.value=i.substring(0,n.start)+e+i.substr(n.end);},dispose:function(){this.element=null;}},r=null,e;}),define('cobble/ui/ComboBox',['require','exports','module','../function/jquerify','../function/lifeCycle','../helper/Popup'],function(require){'use strict';function e(e){return i.init(this,e);}var t=require('../function/jquerify'),i=require('../function/lifeCycle'),n=require('../helper/Popup');e.prototype={constructor:e,type:'ComboBox',init:function(){var e=this,t=e.button,i=e.menu,r=e.element||t,a=e.openClass,s=e.show,l=e.hide,u=s.animation;if($.isFunction(u))s.animation=$.proxy(u,e);if(u=l.animation,$.isFunction(u))l.animation=$.proxy(u,e);if(e.popup=new n({element:t,layer:i,show:s,hide:l,onBeforeShow:function(t){e.emit(t);},onBeforeHide:function(t){e.emit(t);},onAfterShow:function(t){if(a)r.addClass(a);e.emit(t);},onAfterHide:function(t){if(a)r.removeClass(a);e.emit(t);}}),null==e.value){var c=i.find('.'+e.activeClass);if(1===c.length)e.value=c.data('value');}if(e.data)i.html(e.renderTemplate(e.data,e.template));if(null!=e.value)e.setValue(e.value,{force:!0,silence:!0});i.on('click'+o,'[data-value]',function(){e.setValue($(this).data('value')),e.close();});},getValue:function(){return this.value;},setValue:function(e,t){var i,n=this,o=n.menu,r=o.find('[data-value="'+e+'"]');if(1===r.length){if(i=r.data(),null==i.text)i.text=r.html();}else i={};if(t=t||{},t.force||e!=n.value){var a=n.activeClass;if(a)o.find('.'+a).removeClass(a);if(1===r.length){if(n.value=e,a)r.addClass(a);}else n.value=null;if(!t.silence)n.emit('change',i);}if($.isFunction(n.setText))n.setText(i.text||n.defaultText);},refresh:function(e){var t=this,i=t.value,n={};if(e){var o=e.data;if(o)t.menu.html(t.renderTemplate(o,t.template));if('value'in e)i=e.value,n.force=!0;}t.setValue(i,n);},open:function(){this.popup.open();},close:function(){this.popup.close();},dispose:function(){var e=this;i.dispose(e),e.menu.off(o),e.popup.dispose(),e.popup=e.element=e.button=e.menu=null;}},t(e.prototype),e.defaultOptions={show:{trigger:'click'},hide:{trigger:'click'}};var o='.cobble_ui_combobox';return e;}),define('cobble/ui/Dialog',['require','exports','module','../util/instance','../util/dimension','../function/jquerify','../function/lifeCycle','../function/offsetParent','../function/debounce','../function/pinGlobal','../function/dragGlobal'],function(require){'use strict';function e(e){return o.init(this,e);}var t=require('../util/instance'),i=require('../util/dimension'),n=require('../function/jquerify'),o=require('../function/lifeCycle'),r=require('../function/offsetParent'),a=require('../function/debounce'),s=require('../function/pinGlobal'),l=require('../function/dragGlobal');e.prototype={constructor:e,type:'Dialog',init:function(){var e=this,i=e.element||(e.element=$(e.template)),n=[],o=e.skinClass;if(o)n.push(o);var a=e.draggableClass;if(e.draggable&&a)n.push(a);if(n.length>0)i.addClass(n.join(' '));var s=e.removeOnEmpty,l=e.title;if(l)i.find(e.titleSelector).html(l);else if(s)i.find(e.headerSelector).remove();var c=e.content,f=i.find(e.bodySelector);if(c)f.html(c);else if(s)f.remove();var d=e.closeSelector,p=$.proxy(e.hide,e);if(d)i.on('click'+u,d,p);var m={};if(e.width)m.width=e.width;var h=e.fixed?'fixed':'absolute';if(i.css('position')!==h)m.position=h;if(!r(i).is('body'))t.body.append(i);if(e.modal){var v=e.mask||(e.mask=$(e.maskTemplate));if(i.before(v),e.hideOnClickMask)v.on('click'+u,p);var g='zIndex',b=e[g];if(!$.isNumeric(b))if(b=v.css(g),!$.isNumeric(b))b='auto';var x={overflow:'hidden'};x[g]=b,v.css(x),m[g]=b;}if(i.css(m),!e.hidden)e.hidden=!0,e.show();},show:function(){var e=this;if(e.hidden!==!1){var i=e.emit('beforeShow');if(!i.isDefaultPrevented()){var n=e.element,o=e.scrollable;if(e.draggable)e.drager=l({element:n,handleSelector:e.draggableHandleSelector,cancelSelector:e.draggableCancelSelector,draggingClass:e.draggingClass,fixed:e.fixed,scrollable:o});if(e.refresh(),e.showAnimation(),e.mask)e.showMaskAnimation();e.hidden=!1,t.window.resize(e.resizer=a(function(){e.refresh(!0);},50)),e.emit('afterShow');}}},hide:function(){var e=this;if(e.hidden!==!0){var i=e.emit('beforeHide');if(!i.isDefaultPrevented()){if(e.resizer)t.window.off('resize',e.resizer),e.resizer=null;if(e.drager)e.drager.dispose(),e.drager=null;if(e.hideAnimation(),e.mask)e.hideMaskAnimation();if(e.hidden=!0,e.emit('afterHide'),e.disposeOnHide)e.dispose();}}},refresh:function(){var e=this,t=arguments[0];if(!t||e.positionOnResize){var n=e.element,o=s({element:n,x:e.x,y:e.y,fixed:e.fixed});if(t)e.resizeAnimation(o);else n.css(o);}var r=e.mask;if(r)r.css({width:i.getPageWidth(),height:i.getPageHeight()});},dispose:function(){var e=this;if(o.dispose(e),!e.hidden)e.disposeOnHide=!1,e.hide();var t=e.element,i=e.mask;if(t.off(u),i)i.off(u);if(e.removeOnDispose)if(t.remove(),i)i.remove();e.element=e.mask=null;}},n(e.prototype),e.defaultOptions={x:'50%',y:'50%',modal:!0,fixed:!0,hidden:!1,draggable:!0,scrollable:!0,removeOnEmpty:!0,disposeOnHide:!0,removeOnDispose:!0,hideOnClickMask:!1,positionOnResize:!0,draggableClass:'draggable',draggableHandleSelector:'.dialog-header',draggableCancelSelector:['.dialog-header h1','.dialog-close'],headerSelector:'.dialog-header',titleSelector:'.dialog-header h1',closeSelector:'.dialog-close',bodySelector:'.dialog-body',template:'<div class="dialog"><i class="dialog-close">&times;</i><div class="dialog-header"><h1></h1></div><div class="dialog-body"></div></div>',maskTemplate:'<div class="dialog-mask"></div>',showAnimation:function(){this.element.show();},hideAnimation:function(){this.element.hide();},showMaskAnimation:function(){this.mask.show();},hideMaskAnimation:function(){this.mask.hide();},resizeAnimation:function(e){this.element.css(e);}};{var u='.cobble_ui_dialog';t.html.css('overflow'),t.body.css('overflow');}return e;}),define('cobble/ui/Uploader',['require','exports','module','../helper/AjaxUploader','../helper/FlashUploader'],function(require){'use strict';function e(){return'files'in $('<input type="file" />')[0];}function t(){if(!XMLHttpRequest)return!1;var e=new XMLHttpRequest();return'upload'in e&&'onprogress'in e.upload;}return e()&&t()?require('../helper/AjaxUploader'):require('../helper/FlashUploader');}),define('cobble/util/cookie',['require','exports','module'],function(require,exports){'use strict';function e(e){if(0===e.indexOf('"'))e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');var t={};try{e=decodeURIComponent(e.replace(/\+/g,' ')),$.each(e.split(';'),function(e,i){var n=i.split('='),o=$.trim(n[0]),r=$.trim(n[1]);if(o)t[o]=r;});}catch(i){}return t;}function t(e,t,n){var o=n.expires;if($.isNumeric(o)){var r=o;o=new Date(),o.setTime(o.getTime()+r*i);}document.cookie=[encodeURIComponent(e),'=',encodeURIComponent(t),o?';expires='+o.toUTCString():'',n.path?';path='+n.path:'',n.domain?';domain='+n.domain:'',n.secure?';secure':''].join('');}var i=3600000;exports.get=function(t){var i=e(document.cookie);return'string'===$.type(t)?i[t]:i;},exports.set=function(e,i,n){if($.isPlainObject(e))n=i,i=null;if(n=$.extend({},exports.defaultOptions,n),null===i)$.each(e,function(e,i){t(e,i,n);});else t(e,i,n);},exports.remove=function(e,i){if(null!=e)i=i||{},i.expires=-1,t(e,'',$.extend({},exports.defaultOptions,i));},exports.defaultOptions={path:'/'};}),define('cobble/util/dimension',['require','exports','module','../function/pageScrollTop','../function/pageScrollLeft','../function/pageWidth','../function/pageHeight','../function/viewportWidth','../function/viewportHeight'],function(require,exports){'use strict';var e=require('../function/pageScrollTop'),t=require('../function/pageScrollLeft'),i=require('../function/pageWidth'),n=require('../function/pageHeight'),o=require('../function/viewportWidth'),r=require('../function/viewportHeight');exports.getPageScrollTop=e,exports.getPageScrollLeft=t,exports.getPageWidth=i,exports.getPageHeight=n,exports.getViewportWidth=o,exports.getViewportHeight=r;}),define('cobble/util/input',['require','exports','module','../function/around'],function(require,exports){'use strict';function e(){}function t(e){var t=e.val(),n=!1;e.on('propertychange'+r,function(i){if(n)return void(n=!1);if('value'===i.originalEvent.propertyName){var o=e.val();if(o!==t)e.trigger('input'),t=o;}}),i(e,'val',function(){if(0!==arguments.length)n=!0;});}var i=require('../function/around'),n=$('<input type="text" />')[0],o='oninput'in n;n=null;var r='.cobble_util_input';exports.init=o?e:t,exports.dispose=function(e){e.off(r);};}),define('cobble/util/instance',['require','exports','module'],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body);}),define('cobble/util/json',['require','exports','module'],function(require,exports,module){if('object'!=typeof JSON)JSON={};return function(){'use strict';function f(e){return 10>e?'0'+e:e;}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return'string'==typeof t?t:'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+e+'"';}function str(e,t){var i,n,o,r,a,s=gap,l=t[e];if(l&&'object'==typeof l&&'function'==typeof l.toJSON)l=l.toJSON(e);if('function'==typeof rep)l=rep.call(t,e,l);switch(typeof l){case'string':return quote(l);case'number':return isFinite(l)?String(l):'null';case'boolean':case'null':return String(l);case'object':if(!l)return'null';if(gap+=indent,a=[],'[object Array]'===Object.prototype.toString.apply(l)){for(r=l.length,i=0;r>i;i+=1)a[i]=str(i,l)||'null';return o=0===a.length?'[]':gap?'[\n'+gap+a.join(',\n'+gap)+'\n'+s+']':'['+a.join(',')+']',gap=s,o;}if(rep&&'object'==typeof rep){for(r=rep.length,i=0;r>i;i+=1)if('string'==typeof rep[i])if(n=rep[i],o=str(n,l))a.push(quote(n)+(gap?': ':':')+o);}else for(n in l)if(Object.prototype.hasOwnProperty.call(l,n))if(o=str(n,l))a.push(quote(n)+(gap?': ':':')+o);return o=0===a.length?'{}':gap?'{\n'+gap+a.join(',\n'+gap)+'\n'+s+'}':'{'+a.join(',')+'}',gap=s,o;}}if('function'!=typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();};var cx,escapable,gap,indent,meta,rep;if('function'!=typeof JSON.stringify)escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},JSON.stringify=function(e,t,i){var n;if(gap='',indent='','number'==typeof i)for(n=0;i>n;n+=1)indent+=' ';else if('string'==typeof i)indent=i;if(rep=t,t&&'function'!=typeof t&&('object'!=typeof t||'number'!=typeof t.length))throw new Error('JSON.stringify');return str('',{'':e});};if('function'!=typeof JSON.parse)cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var i,n,o=e[t];if(o&&'object'==typeof o)for(i in o)if(Object.prototype.hasOwnProperty.call(o,i))if(n=walk(o,i),void 0!==n)o[i]=n;else delete o[i];return reviver.call(e,t,o);}var j;if(text=String(text),cx.lastIndex=0,cx.test(text))text=text.replace(cx,function(e){return'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')))return j=eval('('+text+')'),'function'==typeof reviver?walk({'':j},''):j;throw new SyntaxError('JSON.parse');};}(),JSON;}),define('cobble/util/keyboard',['require','exports','module'],function(require,exports){'use strict';function e(e){var t={};return $.each(e,function(e,i){t[i]=e;}),t;}var t={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,'`':192,'-':173,'=':61,'[':219,']':221,'\\':220,';':59,"'":222,',':188,'.':190,'/':191,$0:96,$1:97,$2:98,$3:99,$4:100,$5:101,$6:102,$7:103,$8:104,$9:105,'$.':110,'$+':107,'$-':109,'$*':106,'$/':111,space:32,tab:9},i={backspace:8,'delete':46},n={f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,enter:13,esc:27,capslock:20,insert:45,home:36,end:35,pageup:33,pagedown:34,left:37,right:39,up:38,down:40},o={shift:16,ctrl:17,meta:91,alt:18};$.extend(exports,t,n,o),exports.charKey=t,exports.deleteKey=i,exports.functionKey=n,exports.combinationKey=o,exports.isCharKey=function(i){return i in e(t);},exports.isDeleteKey=function(t){return t in e(i);},exports.isFunctionKey=function(t){return t in e(n);},exports.isCombinationKey=function(t){return t in e(o);};}),define('cobble/util/localStorage',['require','exports','module'],function(require,exports){'use strict';function e(e,t){if($.isPlainObject(e))$.each(e,function(e,t){exports.set(e,t);});else try{localStorage[e]=t;}catch(i){}}function t(e){var t='';try{t=localStorage[e];}catch(i){}return t;}function i(e){try{localStorage.removeItem(e);}catch(t){}}if(localStorage)exports.set=e,exports.get=t,exports.remove=i;else exports.set=exports.get=exports.remove=$.noop;}),define('cobble/util/mouse',['require','exports','module'],function(){'use strict';function e(e){return e.originalEvent.changedTouches[0];}var t=document.createElement('div'),i={support:'ontouchend'in t,click:'touchstart',mousedown:'touchstart',mousemove:'touchmove',mouseup:'touchend',pageX:function(t){return e(t).pageX;},pageY:function(t){return e(t).pageY;},clientX:function(t){return e(t).clientX;},clientY:function(t){return e(t).clientY;}},n={support:'onclick'in t,click:'click',mousedown:'mousedown',mousemove:'mousemove',mouseup:'mouseup',pageX:function(e){return e.pageX;},pageY:function(e){return e.pageY;},clientX:function(e){return e.clientX;},clientY:function(e){return e.clientY;}};return t=null,{touch:i,mouse:n};}),define('cobble/util/supload/supload',['require','exports','module','../cookie','../json'],function(require){function e(e){$.extend(this,e),this.init();}function t(){return'_Supload_'+o++;}if(window.Supload===e)return window.Supload;var i=require('../cookie'),n=require('../json');e.prototype={constructor:e,init:function(){var n=t();this.movieName=n;var o=this.element;if('string'===$.type(o))o=document.getElementById(o);var r=this.data||(this.data={});$.each(i.get(),function(e,t){if('undefined'===$.type(r[e]))r[e]=t;});var a=e.createSWF(n,this.flashUrl,this.getFlashVars());o.parentNode.replaceChild(a,o),this.element=a,this.onLog=function(e){console.log(e);},e.instances[n]=this;},getFlashVars:function(){var t=this,i=[];return $.each(['movieName','action','accept','multiple','fileName','data','ignoreError'],function(e,o){var r=t[o];if(null!=r){if($.isPlainObject(r))r=n.stringify(r);else if($.isArray(r))r=r.join(',');i.push(o+'='+encodeURIComponent(r));}}),i.push('projectName='+e.projectName),i.join('&amp;');},getFiles:function(){return this.element.getFiles&&this.element.getFiles()||[];},setAction:function(e){this.element.setAction&&this.element.setAction(e);},setData:function(e){this.element.setData&&this.element.setData(e);},reset:function(){this.element.reset&&this.element.reset();},upload:function(){this.element.upload&&this.element.upload();},cancel:function(){this.element.cancel&&this.element.cancel();},enable:function(){this.element.enable&&this.element.enable();},disable:function(){this.element.disable&&this.element.disable();},dispose:function(){this.element.dispose&&this.element.dispose(),e.instances[this.movieName]=null,window[this.movieName]=null;}},e.projectName='Supload',e.createSWF=function(t,i,n){var o='<object id="'+t+'" class="'+e.projectName.toLowerCase()+'" type="application/x-shockwave-flash" data="'+i+'"><param name="movie" value="'+i+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+n+'" /></object>';return $(o)[0];},e.instances={},e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_SECURITY=1,e.ERROR_IO=2;var o=178245;return window.Supload=e,e;}),define('imageCrop/imageCrop',['require','cobble/util/json'],function(require){'use strict';function e(t){$.extend(this,e.defaultOptions,t),this.init();}if(window.ImageCrop)return window.ImageCrop;var t=require('cobble/util/json');e.prototype={constructor:e,init:function(){var t=this;t.movieName='_ImageCrop_'+i++,e.instances[t.movieName]=t;var n=$(t.getFlashHTML());t.element.replaceWith(n),t.swf=n[0];},getFlashHTML:function(){var e=this,t=e.flashUrl;return['<object id="',e.movieName,'" type="application/x-shockwave-flash" data="',t,'" width="',e.width,'" height="',e.height,'" class="imagecrop">','<param name="wmode" value="transparent" />','<param name="movie" value="',t,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value=\''+e.getFlashVars()+"' />",'</object>'].join('');},getFlashVars:function(){var e=this;return['movieName='+encodeURIComponent(e.movieName),'action='+encodeURIComponent(e.action),'accept='+encodeURIComponent(e.accept),'adaptive='+encodeURIComponent(e.adaptive),'original='+encodeURIComponent(e.original),'encoder='+encodeURIComponent(e.encoder),'header='+(e.header?encodeURIComponent(t.stringify(e.header)):''),'button='+(e.button?encodeURIComponent(t.stringify(e.button)):''),'minSize='+('number'===$.type(e.minSize)?e.minSize:''),'maxSize='+('number'===$.type(e.maxSize)?e.maxSize:''),'minWidth='+('number'===$.type(e.minWidth)?e.minWidth:''),'maxWidth='+('number'===$.type(e.maxWidth)?e.maxWidth:''),'minHeight='+('number'===$.type(e.minHeight)?e.minHeight:''),'maxHeight='+('number'===$.type(e.maxHeight)?e.maxHeight:''),'src='+encodeURIComponent(t.stringify(e.src)),'dest='+encodeURIComponent(t.stringify(e.dest))].join('&amp;');},upload:function(){var e=this.swf;if(e.upload)e.upload();},leftRotate:function(){var e=this.swf;if(e.leftRotate)e.leftRotate();},rightRotate:function(){var e=this.swf;if(e.rightRotate)e.rightRotate();},isReady:function(){var e=this.swf;if(e.isReady)return e.isReady();else return void 0;},dispose:function(){var t=this,i=t.swf;if(i.dispose)i.dispose();t.swf=t.element=window[this.movieName]=e.instances[t.movieName]=null;}},e.defaultOptions={flashUrl:require.toUrl('./imageCrop.swf'),original:!0,encoder:'jpg'},e.instances={},e.version='0.0.1';var i=0;return window.ImageCrop=e,e;}),define('common/component/Editor_c19cafc60f',['require','cobble/form/Text'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}var t=require('cobble/form/Text');e.prototype={constructor:e,init:function(){var e=this,i=this.element,n=this.minLength||0,o=this.maxLength,r=(this.flexHeight||!1,this.autoHint||!1),a=i.find('.form-hint');if(n)a.html('还需要输入<strong>'+n+'</strong>个字');else if(!r)a.html('还可以输入<strong>'+o+'</strong>个字');var s=this.textarea=i.find('textarea'),l=function(){var t,i=s.val();if(i.length<n)t=n-i.length,a.html('还需要输入<strong>'+t+'</strong>个字');else if(i.length>=n&&i.length<=o)if(!r||i.length>=r)t=o-i.length,a.html('还可以输入<strong>'+t+'</strong>个字');else a.html('');else if(o<i.length)t=i.length-o,a.html('<span class="text-error">已超出<strong>'+t+'</strong>个字</span>');e.autoHeight();};this.textInput=new t({element:s,placeholderNativeFirst:!1,placeholderSimple:!1,onChange:l}),l();},getValue:function(){return this.textarea.val();},setValue:function(e){this.textInput.setValue(e),this.autoHeight();},autoHeight:function(){if(this.flexHeight){var e=this.textarea[0].scrollHeight+'px';this.textarea.css('height',e);}},validate:function(){return this.maxLength>=this.getValue().length;}};return e;}),define('common/component/TagInput_4bd86dd88e',['cobble/helper/Range'],function(){'use strict';function e(e){$.extend(this,e),this.init();}function t(e){return $('<label class="label label-primary small" data-value="'+e+'">'+e+'<i class="icon icon-times"></i></label>');}function i(e,t){var i=''!==t;if(i){if(e.tagList.find('[data-value="'+t+'"]').length>0)i=!1;if(i&&$.isFunction(e.validate))i=e.validate(t);}return i;}var n=require('cobble/helper/Range');e.prototype={init:function(){var e=this,t=e.element,i=$(o);t.replaceWith(i),i.append(t);var r=t.prop('name');if(r)t.removeAttr('name');var a=$('<input type="hidden" name="'+r+'" />'),s=i.find('.tag-list');i.append(a),e.wrapper=i,e.tagList=s,e.input=a;var l=new n(t[0]);t.on('keydown',function(i){var n=i.keyCode,o=$.trim(t.val());if(o&&32===n)if(e.appendTag(o))t.val('');else return!1;else if(8===n){var r=l.getRange();if(r.start===r.end&&0===r.start)if(s.length>0){var a=s.find('.label').last();e.removeTag(a.data('value'));}}}).on('focus',function(){i.addClass('active');}).on('blur',function(){i.removeClass('active');}),i.on('click','.icon-times',function(t){var i=$(t.currentTarget).closest('.label');e.removeTag(i.data('value'));});},setValue:function(e){var t=this,i=t.tagList;i.find('.label').each(function(){t.removeTag($(this).data('value'));}),$.each(e.split(','),function(e,i){if(i)t.appendTag(i);});},getValue:function(){var e=this,t=e.getTags();if('number'!==$.type(e.max)||t.length<e.max){var n=$.trim(e.element.val());if(i(e,n))t.push(n);}return t.join(',');},getTags:function(){var e=[];return this.tagList.find('.label').each(function(){e.push($(this).data('value'));}),e;},appendTag:function(e){var n=this,o=i(n,e);if(o){var r=n.getTags();if('number'===$.type(n.max))o=r.length<n.max;if(o)r.push(e),n.tagList.append(t(e)),n.input.val(r.join(','));}return o;},removeTag:function(e){var t=this,i=t.tagList;i.find('.label').each(function(){var i=$(this);if(i.data('value')===e)return i.remove(),t.input.val(t.getTags().join(',')),!1;else return void 0;});}};var o='<div class="tag-input"><div class="tag-list"></></div>';return e;}),define('common/component/UploadVideoCourse_fc9db9d90f',['require','exports','cobble/util/localStorage','cobble/ui/Uploader','common/service_9c322508d3','common/store_a1a35b3dfc','common/component/VideoVod_02c356ba9d'],function(require){'use strict';function e(e){return decodeURIComponent(e.name)+'_'+e.size;}function t(e){$.extend(this,e),this.init();}function i(){var e=!0,t=$('.video-upload');if(t.find('.icon-info-circle').each(function(t,i){if(!$(i).hasClass('pass'))e=!1;}),e)t.parent().find('.wrong-title').addClass('pass').hide();}var n=require('cobble/util/localStorage'),o=require('cobble/ui/Uploader'),r=require('common/service_9c322508d3'),a=require('common/store_a1a35b3dfc'),s=require('common/component/VideoVod_02c356ba9d'),l=0,u=1048576,c={FlashUploader:{value:200*u,text:'你的浏览器最大支持上传 200M 的视频\uFF0C可使用 <a href="http://www.baidu.com/s?wd=Chrome%20%E6%B5%8F%E8%A7%88%E5%99%A8" target="_blank">Chrome 浏览器</a> 获得 2G 超大文件上传体验\uFF01'},AjaxUploader:{value:2048*u,text:'上传的视频不能超过 2G'}},f=['wmv','avi','dat','asf','rm','rmvb','ram','mpg','mpeg','3gp','mov','mp4','m4v','dvix','dv','mkv','flv','vob','qt','divx','cpk','fli','flc','mod'];return t.prototype={init:function(){var t=this,d=t.element,p=t.uploadQueue,m=t.queueIndex,h=$('<input type="file" />');d.append(h),t.videoProgress=d.parent().prev(),t.fileItem=null,t.uploadId=null,t.videoId=null,t.testMax=6,t.testCount=0,t.testTimer,t.useChunk=o.supportChunk,t.chunkSize=5*u,t.failCount=0,t.resumeFlag=!1,t.uploader=new o({element:h,multiple:!1,useChunk:t.useChunk,chunkSize:t.chunkSize,onFileChange:function(){if(t.fileItem=t.uploader.getFiles()[0],t.fileItem){t.failCount=0;var i,o=t.fileItem.file,s=$.inArray(o.type,f);if(-1===s)i='文件格式错误\uFF0C请上传 '+f.join('\u3001')+' 等格式的视频';else if(o.size>c[t.uploader.type].value)i=c[t.uploader.type].text;if(i)return alert({content:i,width:300}),void t.uploader.reset();var l=$('.video-upload').find('li'),u=!1;if(l.each(function(e,t){var i=$(t);if(!i.hasClass('add-lesson-video')){var n=i.data('filename');if(n==o.name)alert('不能上传重复文件\uFF01'),u=!0;}}),!u){var d=0;for(var h in p)d++;if(d>=10)return void alert('上传和排队中的视频总数不能超过10个\uFF01');var v={fileName:o.name,fileSize:o.size};if(p[m]=t,d>0){var g='<div class="progress-bar"><span class="txt">排队中</span><div class="progress-box"><div class="progress-status"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>';return t.videoProgress.html(g),void t.element.hide();}if(t.useChunk){var b=n.get(e(o));if(b&&b.split('|')[2]&&new Date().getTime()-b.split('|')[2]<86400000)return v.videoId=b.split('|')[1],void t.resumeUpload(v);else v.chunk=!0;}v.userNumber=a.get('number'),r.getVideoCourseUploadUrl(v,{errorHandler:{200204:function(){confirm({title:'温馨提示',content:'您的云存储空间不足\uFF0C无法上传视频\u3002<br>请删除一部分无用的文件\uFF0C或者购买更多的云存储空间\u3002',width:450,buttons:[{text:'购买空间',type:'primary',handler:function(){this.hide(),location.href='/teacher_center/storage_space';}},{text:'取消',handler:function(){this.hide(),delete t.uploadQueue[t.queueIndex];}}]});}}}).done(function(e){if(0===e.code){var i=e.data;t.toUploadStatus({id:i.id,url:i.upload_url});}});}}},onUploadStart:t.useChunk?function(i,o){var r=o.fileItem,u=r.file,c=r.chunk.index;if(!u.size)c=0,t.uploader.stop();if(n.set(e(u),c+'|'+t.uploadId+'|'+new Date().getTime()),!u.size)return void alert('上传失败\uFF0C请重新上传~');var f=a.get('report');if(t.videoVod=new s({user_number:f.user_number,user_role:f.user_role,video_id:t.uploadId,client:f.client,app:f.app,version:f.version}),l=new Date().getTime(),t.videoProgress.html().indexOf('上传中')<0){var d='';d='<div class="progress-bar"><span class="txt">上传中</span><div class="progress-box"><div class="progress-status" style="width:0%;"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>',t.videoProgress.html(d);}}:null,onUploadProgress:function(e,i){if(!t.videoProgress.find('.percent')[0]){var n='';n='<div class="progress-bar"><span class="txt">上传中</span><div class="progress-box"><div class="progress-status" style="width:0%;"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>',t.videoProgress.html(n);}var o=t.videoProgress.find('.percent'),r=t.videoProgress.find('.progress-status');o.html(i.percent),r.width(i.percent);},onUploadSuccess:function(){if(t.videoId=t.uploadId,t.useChunk)n.remove(e(t.fileItem.file));var o='<span class="status"><i class="icon icon-check-circle"></i>上传成功</span><span class="title">'+(t.fileItem.file.name.length>13?t.fileItem.file.name.substr(0,13)+'...':t.fileItem.file.name)+'</span><a class="del">删除</a>';t.videoProgress.html(o);var s={},u=t.element.parent().parent();u.data('videoid',t.videoId),u.data('filename',t.fileItem.file.name),u.data('filesize',t.fileItem.file.size),s.userNumber=a.get('user').number,s.number=a.get('number'),s.sectionId=u.data('sectionid')?u.data('sectionid'):'',s.videoId=t.videoId,s.name=u.find('.section-title span').text(),s.fileName=u.data('filename'),s.index=u.index()+1,s.payStatus=a.get('price')?u.find(':radio:eq(0)').prop('checked')?2:3:1,s.type=1,r.setVideoCourseSection(s).done(function(e){if(0===e.code){if(u.data('sectionid',e.data.section_id),u.data('terror')&&u.data('cerror'))if(u.hasClass('tpass'))u.find('.icon-info-circle').addClass('pass').hide(),i();else u.addClass('cpass');else if(u.data('cerror'))u.find('.icon-info-circle').addClass('pass').hide(),i();if(!t.resumeFlag)t.videoVod.send(8,t.fileItem.file.size,new Date().getTime()-l);}}),t.element.hide(),delete t.uploadQueue[t.queueIndex];var c=0,f=100000;for(var d in p)if(c++,parseInt(d)<f)f=parseInt(d);if(c>0){var m=p[f],s={fileName:m.fileItem.file.name,fileSize:m.fileItem.file.size};m.startQueueUpload(s);}},onChunkUploadSuccess:function(e,i){var n=i.fileItem,o=$.parseJSON(i.responseText);if(!o)return void(t.failCount=0);if(!o.code)if(e.preventDefault(),t.failCount++,t.failCount<4)setTimeout(function(){t.uploader.upload(n);},500);else alert('上传失败'),t.videoVod.send(9);else t.failCount=0;}});},startQueueUpload:function(t){var i=this,o=i.fileItem.file;if(i.useChunk){var s=n.get(e(o));if(s&&s.split('|')[2]&&new Date().getTime()-s.split('|')[2]<86400000)return t.videoId=s.split('|')[1],void i.resumeUpload(t);else t.chunk=!0;}t.userNumber=a.get('number'),r.getVideoCourseUploadUrl(t,{errorHandler:{200204:function(){confirm({title:'温馨提示',content:'您的云存储空间不足\uFF0C无法上传视频\u3002<br>请删除一部分无用的文件\uFF0C或者购买更多的云存储空间\u3002',width:450,buttons:[{text:'购买空间',type:'primary',handler:function(){this.hide(),location.href='/teacher_center/storage_space';}},{text:'取消',handler:function(){this.hide(),delete i.uploadQueue[i.queueIndex];}}]});}}}).done(function(e){if(0===e.code){var t=e.data;i.toUploadStatus({id:t.id,url:t.upload_url});}});},toUploadStatus:function(e){var t=this;t.uploadId=e.id,t.videoId=null;var i=e.url;t.uploader.setAction(i),t.uploader.upload(t.fileItem),t.element.attr('disabled',!0);var n=t.videoProgress.find('.txt');if(n[0])n.html('上传中');},resumeUpload:function(e){var t=this;t.resumeFlag=!0;var e={userNumber:a.get('user').number,videoId:e.videoId};r.getVideoCourseResumeUploadUrl(e).done(function(i){if(0===i.code){var n=i.data,o=n.upload_size||0,r=parseInt(o/t.chunkSize,10);t.fileItem.chunk={index:r,uploaded:o},t.toUploadStatus({id:n.id,url:n.upload_url});}else{if(0===t.testCount)t.toWaitResumeUploadStatus();if(t.testCount++,t.testCount<t.testMax)t.testTimer=setTimeout(function(){t.resumeUpload(e);},10000);else alert('续传失败,请重新上传'),t.cancelResumeUpload();}});},toWaitResumeUploadStatus:function(){var e=this,t='<span class="status">正在尝试断点续传\uFF0C请稍等...</span><a class="cancel-resume">取消续传</a>';e.videoProgress.html(t),e.element.hide();},cancelResumeUpload:function(){var t=this;if(t.testTimer)clearTimeout(t.testTimer),t.testTimer=null;n.remove(e(t.fileItem.file));}},t;}),define('common/component/VideoCropDialog_ebe8c1a1c9',['require','cobble/ui/Dialog','imageCrop'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}var t=require('cobble/ui/Dialog'),i=require('imageCrop');return e.prototype={init:function(){var e=this,n=825,o=465;e.dialog=new t({title:'上传封面',content:'<div style="width: '+n+'px;height: '+o+'px;"><div class="image-crop"></div><div class="actions"><div class="rotate"></div><div class="save-cancel"><!--<button class="btn-default">选择图片</button>--></div></div></div>'});{var r=e.dialog.element;new i({element:r.find('.image-crop'),width:n,height:o,action:'/user/previewBinaryImage',accept:'png,jpg,jpeg,gif',minSize:1,maxSize:5242880,button:{select:{x:160,y:430,width:80,height:30,text:'选择图片'},upload:{x:260,y:430,width:80,height:30,text:'保存图片'},leftRotate:{x:0,y:430,width:40,height:30,text:'左转'},rightRotate:{x:460,y:430,width:40,height:30,text:'右转'}},src:{x:0,y:0,width:500,height:400},dest:[{x:520,y:0,width:300,height:200,text:'300x200'},{x:580,y:230,width:180,height:120,text:'180x120'},{x:620,y:380,width:100,height:66,text:'100x66'}],onValidateError:function(){},onUploadComplete:function(t){var i=t.data;if('string'===$.type(i))i=$.parseJSON(i);if(0!==i.code&&i.msg)alert(i.msg);if($.isFunction(e.onUploadComplete))e.onUploadComplete(i);}});}},hide:function(){this.dialog.hide();}},e;}),define('common/component/VideoVod_02c356ba9d',['require','common/store_a1a35b3dfc'],function(require){'use strict';function e(t){$.extend(this,e.defaultOptions,t),this.init();}var t=require('common/store_a1a35b3dfc'),i='video_vod',n='',o='',r=WAT.getCookie('__guid__'),a='',s='',l='',u='',c='',f='',d='',p='',m='32891392',h={},v='';if(h.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),h.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),h.opera=/opera/.test(navigator.userAgent.toLowerCase()),h.msie=/msie/.test(navigator.userAgent.toLowerCase()),h.safari=/safari/.test(navigator.userAgent.toLowerCase()),h.opera)v=1;else if(h.msie)v=2;else if(h.webkit)v=3;else if(h.safari)v=4;else if(h.mozilla)v=5;return e.prototype={init:function(){var e=this,i=t.get('env');if('dev'==i||'test'==i)m='32891152';else if('beta'==i||'www'==i)m='32891392';n=e.user_number,o=e.user_role,a=e.video_type,s=e.video_id,l=e.client,u=e.app,c=e.cdn,v=e.browser,f=e.net,d=e.resolution,p=e.version;},send:function(t,c,h,g,b){var x=(e.prototype,{type:i,user_number:n,user_role:o,info:t,guid:r,video_type:a,video_id:s,client:l,app:u,cdn:c,browser:v,net:f,resolution:e.getResolution?e.getResolution():d,version:p,partner_id:m,_timestamp:Date.now()});if(1==t);else if(2==t)x.buffer_time=h;else if(4==t)x.error_code=h;else if(5==t);else if(6==t)x.play_time=h,x.buffer_num=g,x.pause_time=b;else if(7==t)x.buffer_time=h;else if(8==t)x.file_size=h,x.file_time=g;else if(9==t);WAT.send(WAT.toUrl('pb0.genshuixue.com','/gs.gif'),x);}},e.defaultOptions={type:'video_vod',user_number:'',user_role:'',info:'',guid:WAT.getCookie('__guid__'),video_type:'',video_id:'',client:'',app:0,cdn:'',browser:v,net:'',resolution:'',version:'',partner_id:m,_timestamp:$.now()},e;}),define('teacherCenter/setVideoCourse_0c22a237d4',['require','exports','common/component/VideoCropDialog_ebe8c1a1c9','common/component/UploadVideoCourse_fc9db9d90f','common/service_9c322508d3','common/store_a1a35b3dfc','common/component/Editor_c19cafc60f','common/component/TagInput_4bd86dd88e','cobble/form/Select','cobble/form/Validator'],function(require,exports){'use strict';var e=require('common/component/VideoCropDialog_ebe8c1a1c9'),t=require('common/component/UploadVideoCourse_fc9db9d90f'),i=require('common/service_9c322508d3'),n=require('common/store_a1a35b3dfc'),o=require('common/component/Editor_c19cafc60f'),r=require('common/component/TagInput_4bd86dd88e'),a=require('cobble/form/Select'),s=require('cobble/form/Validator');exports.init=function(){function l(e){if(T[e]){var t=$.Deferred();return setTimeout(function(){t.resolve(T[e]);},0),t;}return i.getSubjectList({id:e}).done(function(t){if(0===t.code)T[e]=t;return t;});}function u(e){return $.map(e,function(e){return{text:e.name,value:e.id};});}function c(e){var t=k.find('li');if(1==e)t.each(function(e,t){var i=$(t),n=i.find('.section-title').next();if(!i.hasClass('add-lesson-video')){if(i.find(':radio:eq(0)').prop('checked'))i.find('.lesson').addClass('lesson-cost'),n.html('');else i.find('.lesson').addClass('lesson-try'),n.html('试听课').removeClass('status2').addClass('status1');i.find('.free').hide(),i.find('label').show();}});if(2==e)t.each(function(e,t){var i=$(t);if(!i.hasClass('add-lesson-video')){i.find('.lesson').removeClass('lesson-try').removeClass('lesson-cost'),i.find('.free').show(),i.find('label').hide();var n=i.find('.section-title').next();n.html('免费课').removeClass('status1').addClass('status2');}});}function f(){n.set('price',0),w.find('.course-price').val(''),w.find('.course-time').val('').prop('disabled',!0),w.find('#free-time').prop('checked',!1).prop('disabled',!0),w.find('.course-time').parent().removeClass('has-error'),c(2);}function d(){n.set('price',w.find('.course-price').val()),w.find('#free-course').prop('checked',!1),w.find('.course-time').prop('disabled',!1);var e=w.find('#free-time');if(!e.val())e.prop('checked',!0);e.prop('disabled',!1),c(1);}function p(){var e=k.find('li');e.each(function(e,t){var i=$(t);if(e%2==0)i.removeClass('right-side');else i.addClass('right-side');i.find('.num').html(e+1);});}function m(){var e;k.find('.video-progress .txt').each(function(t,i){if('上传中'==$(i).text())e=$(i).parent().parent().data('queueindex');});var t=0,i=100000;for(var n in N)if(parseInt(n)!=e)if(t++,parseInt(n)<i)i=parseInt(n);if(t>0){var o=N[i],r={fileName:o.fileItem.file.name,fileSize:o.fileItem.file.size};o.startQueueUpload(r);}}function h(){var e=!0;if(k.find('.icon-info-circle').each(function(t,i){if(!$(i).hasClass('pass'))e=!1;}),e)k.parent().find('.wrong-title').addClass('pass').hide();}function v(){w.find('.course-title').val(w.find('.video-course-title p').html()),w.find('.course-summary').val(w.find('.video-course-summary p').html());var e=w.find('.tag-item'),t=[];e.each(function(e,i){t.push($(i).html());}),q.setValue(t.join(',')),A.setValue(w.find('.video-course-language p').data('lid'));var i=w.find('.video-course-category p').data('cid'),o=i.split(',');U.setValue(o[0]),R.setValue(o[1]),O.setValue(o[2]),n.set('portrait',n.get('portraitCopy')),w.find('.front-cover-img').prop('src',n.get('portraitCopy'));var r=w.find('.video-course-price p').text();if('免费课'==r)f();else w.find('.course-price').val(r.substr(1)),d();var a=w.find('.video-course-time p').text();if('该视频课永久有效'==a){if(n.get('price'))w.find('#free-time').prop('checked',!0);w.find('.course-time').val('');}else w.find('#free-time').prop('checked',!1),w.find('.course-time').val(a.substr(0,a.indexOf('天')));}function g(){if(n.get('portrait'))return!0;if(w.find('.course-title').val())return!0;if(w.find('.course-price').val())return!0;if($('#free-time').is(':checked')||w.find('.course-time').val())return!0;if(w.find('.course-summary').val())return!0;if(n.get('subjectid1')||n.get('subjectid2')||n.get('subjectid3'))return!0;else return!1;}function b(e){if(n.get('portrait')!=n.get('portraitCopy'))if(e)w.find('.video-course-cover .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-cover .error-tip').hide();else return!0;if(w.find('.course-title').val()!=w.find('.video-course-title p').html())if(e)w.find('.video-course-title .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-title .error-tip').hide();else return!0;if(w.find('.course-summary').val()!=w.find('.video-course-summary p').html())if(e)w.find('.video-course-summary .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-summary .error-tip').hide();else return!0;var t=w.find('.tag-item'),i=[];if(t.each(function(e,t){i.push($(t).html());}),q.getValue()!=i.join(','))if(e)w.find('.video-course-tags .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-tags .error-tip').hide();else return!0;if(n.get('language').value!=w.find('.video-course-language p').data('lid'))if(e)w.find('.video-course-language .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-language .error-tip').hide();else return!0;if(n.get('subjectid1')+','+n.get('subjectid2')+','+n.get('subjectid3')!=w.find('.video-course-category p').data('cid'))if(e)w.find('.video-course-category .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-category .error-tip').hide();else return!0;var o=w.find('.video-course-price p').text();if('免费课'==o){if(n.get('price'))if(e)w.find('.video-course-price .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-price .error-tip').hide();else return!0;}else if(w.find('.course-price').val()!=o.substr(1))if(e)w.find('.video-course-price .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-price .error-tip').hide();else return!0;var r=w.find('.video-course-time p').text();if('该视频课永久有效'==r){if(n.get('price')&&!w.find('#free-time').is(':checked'))if(e)w.find('.video-course-time .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-time .error-tip').hide();else return!0;}else{{w.find('#free-time').is(':checked'),w.find('.course-time').val()!=r.substr(0,r.indexOf('天'));}if(w.find('.course-time').val()!=r.substr(0,r.indexOf('天'))||w.find('#free-time').is(':checked'))if(e)w.find('.video-course-time .icon-info-circle').addClass('pass').removeClass('icon-info-circle'),w.find('.video-course-time .error-tip').hide();else return!0;}if(e){var a=!0;if(w.find('.icon-info-circle').each(function(e,t){if(!$(t).hasClass('pass'))a=!1;}),a)w.parent().find('.wrong-title').addClass('pass').hide();}return!1;}function x(e){var t=[];if(1==e){if(!w.parent().hasClass('no-edit'))t.push(1);if(!k.parent().hasClass('no-edit'))t.push(2);if(!S.parent().hasClass('no-edit')||V&&!V.getContent()||!S.find('.content').html())t.push(3);if(t.length>0)return alert('请先保存 \u201C第'+t.join(',')+'步\u201D 信息\uFF01'),!1;else return!0;}if(2==e){if(!w.parent().hasClass('no-edit'))t.push(1);if(!k.parent().hasClass('no-edit'))t.push(2);if(!S.parent().hasClass('no-edit')&&V&&V.getContent())t.push(3);if(t.length>0)return alert('请先保存 \u201C第'+t.join(',')+'步\u201D 信息\uFF01'),!1;else return!0;}if(3==e){if(!w.parent().hasClass('no-edit')&&g())t.push(1);if(!k.parent().hasClass('no-edit')&&k.find('li').length>1)t.push(2);if(!S.parent().hasClass('no-edit')&&V&&V.getContent())t.push(3);if(t.length>0)return!1;else return!0;}if(4==e){if(!w.parent().hasClass('no-edit'))t.push(1);if(t.length>0)return alert('请先保存 \u201C第'+t.join(',')+'步\u201D 信息\uFF01'),!1;else return!0;}if(5==e){var i=k.find('li'),n=!1;if(i.each(function(e,t){var i=$(t);if(!(i.hasClass('add-section')||i.find('.section-title span').html()&&i.find('.title').html()))n=!0;}),n)return alert('请先完善课节信息\uFF01'),!1;else return!0;}if(6==e){if(!k.parent().hasClass('no-edit'))return alert('请先保存 \u201C第2步\u201D 信息\uFF01'),!1;if(V&&!V.getContent())return alert('请先完善课程详情信息\uFF01'),!1;else return!0;}}function y(){$(window).on('beforeunload',function(){if(!x(3))return'老师\uFF0C你还有课程信息未保存\uFF0C\u201C离开此页\u201D 将导致未保存的信息丢失哦\uFF01';else return void 0;});}var C=$('#content'),w=C.find('.video-info'),S=C.find('.video-content'),k=C.find('.video-upload'),_=!1,T={};new o({element:w.find('.course-summary').parent(),maxLength:200}),new o({element:w.find('.course-title').parent(),maxLength:20});var q=new r({element:w.find('.course-tag'),max:8,validate:function(e){if(e.length>8)return!1;else return/^[\w\u4e00-\u9fa5]+$/.test(e);}});if(n.get('taglist'))q.setValue(n.get('taglist')||'');var j=new s({element:w,realtime:!0,fields:{course_title:{rules:{required:!0,maxlength:20},errors:{required:'请输入课程标题',maxlength:'请不要超过 20 个字'}},course_price:{errors:{required:'请输入课程价格',pattern:'价格格式错误',min:'价格最低为0元',max:'价格最高位 999999 元'},custom:function(e){var t=e.val();if(!isNaN(t)&&t>0)t=parseFloat(t).toFixed(2);e.val(t);}},course_time:{errors:{required:'请输入观看期限',pattern:'观看期限格式错误',min:'观看期限最少为1天',max:'观看期限最多 999999 天'}},course_summary:{rules:{required:!0,maxlength:200},errors:{required:'请输入课程简介',maxlength:'请不要超过 200 个字'}}}}),I=null;if(n.get('category'))I=n.get('category').split(',');var U=new a({element:w.find('.category1'),name:'category1',onChange:function(e,t){n.set('subjectid1',t.value),n.set('subjectid1text',t.text),n.set('subjectid2',''),n.set('subjectid2text',''),n.set('subjectid3',''),n.set('subjectid3text',''),R.setValue(''),O.setValue(''),$('.category2 .dropdown-menu').html(''),$('.category3 .dropdown-menu').html(''),l(t.value).done(function(e){if(0===e.code)if(R.refresh({data:u(e.data.list)}),I&&I[1])R.setValue(I[1]);});}}),R=new a({element:w.find('.category2'),name:'category2',onChange:function(e,t){n.set('subjectid2',t.value),n.set('subjectid2text',t.text),n.set('subjectid3',''),n.set('subjectid3text',''),O.setValue(''),$('.category3 .dropdown-menu').html(''),l(t.value).done(function(e){if(0===e.code)if(O.refresh({data:u(e.data.list)}),I&&I[2])O.setValue(I[2]);});}}),O=new a({element:w.find('.category3'),name:'category3',onChange:function(e,t){n.set('subjectid3',t.value),n.set('subjectid3text',t.text);}});l().done(function(e){if(0===e.code)if(U.refresh({data:u(e.data.list)}),I&&I[0])U.setValue(I[0]);});var A=new a({element:w.find('.language'),name:'language',onChange:function(e,t){n.set('language',{value:t.value,text:t.text});}});if(n.get('language'))A.setValue(n.get('language'));else A.setValue(1);w.on('click','.front-cover, .change-front-cover',function(){var t=new e({onUploadComplete:function(e){if(0===e.code){success('保存成功'),t.hide();var i=e.data;n.set('portrait',i.url);var o=w.find('.front-cover-box'),r=o.find('.front-cover'),a=o.find('img'),s=o.find('.change-front-cover');o.find('.point').hide(),o.find('.txt').hide(),r.hide();var l=i.url+'@1e_180w_120h_1c_0i_1o_90Q_1x';a.css({display:'block'}).attr('src',l),s.css({display:'block'});}}});}).on('click','#free-course',function(){f();}).on('keyup','.course-price',function(){var e=$(this);if(e.val())d();if('0'===e.val())f(),w.find('.course-price').val('0'),w.find('#free-course').prop('checked',!0);}).on('click','#free-time',function(){var e=$(this);if(e.prop('checked'))w.find('.course-time').val('');}).on('keyup','.course-time',function(){var e=$(this);if(e.val())w.find('#free-time').prop('checked',!1);else w.find('#free-time').prop('checked',!0);}).on('click','.price-list div',function(){w.find('.price-list div').removeClass('active'),$(this).addClass('active');});var N={},P={},E=0;k.on('blur','textarea',function(){var e=$(this),t=e.parent(),o=e.val();if(o){t.removeClass('has-error');var r=e.next().next();e.val(o.substr(0,20));var a=!1;if(r.find('.section-title span').html()!=o.substr(0,20))a=!0;r.find('.section-title span').html(o.substr(0,20)),r.show(),e.hide();var s={};if(t.data('videoid'))s.userNumber=n.get('user').number,s.number=n.get('number'),s.sectionId=t.data('sectionid'),s.videoId=t.data('videoid'),s.name=t.find('.section-title span').text(),s.fileName=t.data('filename'),s.index=t.index()+1,s.payStatus=n.get('price')?t.find(':radio:eq(0)').prop('checked')?2:3:1,s.type=2,i.setVideoCourseSection(s).done(function(e){if(0===e.code)if(a)if(t.data('terror')&&t.data('cerror'))if(t.hasClass('cpass'))t.find('.icon-info-circle').addClass('pass').hide(),h();else t.addClass('tpass');else if(t.data('terror'))t.find('.icon-info-circle').addClass('pass').hide(),h();});}}).on('click','.change-title',function(){var e=$(this),t=e.parent();t.hide();var i=t.prev().prev();if('textarea'!=i[0].nodeName.toLowerCase()){var n=[];n.push('<textarea class="form-text lesson-title" placeholder="请输入长度在20个字以内的课节标题">',t.find('.section-title span').text(),'</textarea><span class="error"><i class="icon icon-times-circle"></i>&nbsp;请输入课节标题</span>'),t.before($(n.join(''))),t.parent().find('textarea').focus();}else i.show(),i.focus();}).on('click','.cancel-upload',function(){var e=$(this).parent();confirm({content:'您确认取消上传该视频吗\uFF1F',title:'温馨提示',width:330}).done(function(){var t=e.data('queueindex');P[t].uploader.stop(),P[t].element.show(),P[t].element.attr('disabled',!1),delete N[t],e.html(''),m();});}).on('click','.cancel-resume',function(){var e=$(this).parent();confirm({content:'您确认取消上传该视频吗\uFF1F',title:'温馨提示',width:330}).done(function(){var t=e.data('queueindex');P[t].cancelResumeUpload(),P[t].element.show(),P[t].element.attr('disabled',!1),delete N[t],e.html(''),m();});}).on('click','.close',function(e){var t=$(e.target);confirm({content:'您确认删除该视频吗\uFF1F',title:'温馨提示',width:330}).done(function(){var e=null;if(t.hasClass('close'))e=t.parent();else e=t.parent().parent();var o=e.find('.video-progress'),r=o.data('queueindex'),a={};if(a.userNumber=n.get('user').number,a.number=n.get('number'),a.sectionId=e.data('sectionid'),a.videoId=e.data('videoid'),a.sectionId&&a.videoId)a.name=e.find('.section-title span').text(),a.index=e.index()+1,a.fileName=e.data('filename'),a.payStatus=n.get('price')?e.find(':radio:eq(0)').prop('checked')?2:3:1,a.type=3,i.setVideoCourseSection(a).done(function(t){if(0===t.code){if(P[r])P[r].uploader.dispose(),delete N[r],delete P[r];e.remove(),p(),m(),h();}});else{if(P[r])P[r].uploader.dispose(),delete N[r],delete P[r];e.remove(),p(),m(),h();}});}).on('click','.del',function(){var e=$(this),i=e.parent().parent(),n=i.find('.upload-video-course');e.prev().html('');var o=e.parent().find('.status');if(o[0])o.html('');if(n[0])n.show().attr('disabled',!1);else{++E,i.find('.action').prepend($('<span class="btn btn-default upload-video-course">上传视频</span>'));var r=i.find('.upload-video-course');r.attr('disabled',!1);var a=i.find('.video-progress');P[E]=new t({element:r,uploadQueue:N,queueIndex:E}),a.data('queueindex',E);}i.data('filename','');}).on('click','.add-lesson-video',function(){if(x(4)){if(!_)alert('视频课最多允许添加100个课节\uFF01'),_=!0;if(k.find('li').length>=101)return alert('视频课最多允许添加100个课节\uFF01'),!1;k.closest('.section').removeClass('no-edit');var e=$(this),i=e.index(),o=[],r='<label for="cost-course'+(i+1)+'" style="display:none;"><input name="video-course-radio'+(i+1)+'" type="radio" id="cost-course'+(i+1)+'" checked="checked">付费</label><label for="try-listen'+(i+1)+'" style="display:none;"><input name="video-course-radio'+(i+1)+'" type="radio" id="try-listen'+(i+1)+'">试听</label><span class="free">免费</span>';if(n.get('price'))r='<label for="cost-course'+(i+1)+'"><input name="video-course-radio'+(i+1)+'" type="radio" id="cost-course'+(i+1)+'" checked="checked">付费</label><label for="try-listen'+(i+1)+'"><input name="video-course-radio'+(i+1)+'" type="radio" id="try-listen'+(i+1)+'">试听</label><span class="free" style="display:none;">免费</span>';o.push('<div class="close"></div>','<div class="lesson'+(n.get('price')?' lesson-cost':'')+'">','<div>','<span class="num">'+(i+1)+'</span><span class="txt">课节</span>','</div>','</div>','<textarea class="form-text lesson-title" placeholder="请输入长度在20个字以内的课节标题"></textarea>','<span class="error"><i class="icon icon-times-circle"></i>&nbsp;请输入课节标题</span>','<div class="info" style="display:none;">','<div class="section-title"><span></span></div>','<span></span>','<button class="btn btn-default change-title">更改</button>','</div>','<div class="video-progress"></div>','<div class="action">','<span class="btn btn-default upload-video-course">上传视频</span>',r,'</div>');var a=$('<li></li>');a.html(o.join('')),a.insertBefore(e),++E;var s=a.find('.upload-video-course'),l=a.find('.video-progress'),u=a.find('.section-title').next();if(!n.get('price'))u.html('免费课').removeClass('status1').addClass('status2');P[E]=new t({element:s,uploadQueue:N,queueIndex:E}),l.data('queueindex',E),p();}}).on('click','.upload-video-course',function(){var e=$(this),t=e.closest('li'),i=t.find('textarea'),n=t.find('.section-title span').text();if(!$.trim(i.val())&&!$.trim(n))return t.addClass('has-error'),!1;else t.removeClass('has-error');}).on('click',':radio',function(){var e=$(this),t=e.parent().parent().parent(),o=t.find('.section-title').next();if(e.prop('id').indexOf('try-listen')>-1)t.find('.lesson').removeClass('lesson-cost').addClass('lesson-try'),o.html('试听课').addClass('status1');else t.find('.lesson').removeClass('lesson-try').addClass('lesson-cost'),o.html('').removeClass('status1');if(t.data('videoid')){var r={};r.userNumber=n.get('user').number,r.number=n.get('number'),r.sectionId=t.data('sectionid'),r.videoId=t.data('videoid'),r.name=t.find('.section-title span').text(),r.fileName=t.data('filename'),r.index=t.index()+1,r.payStatus=n.get('price')?t.find(':radio:eq(0)').prop('checked')?2:3:1,r.type=2,i.setVideoCourseSection(r).done(function(e){if(0===e.code);});}});var V=null;if(1==n.get('status'))V=new UE.ui.Editor({initialFrameHeight:400,maximumWords:5000}),V.render(C.find('.editor')[0]),V.addListener('contentchange',function(){x(6);});if(y(),C.on('click','.save-course',function(){if(!n.get('portrait'))return void alert('请添加课程封面');if(j.validate('course_title'))if($('#free-course').is(':checked')||j.validate('course_price')){if(!$('#free-course').is(':checked'))if(!$('#free-time').is(':checked')&&!j.validate('course_time'))return;if(j.validate('course_summary')){if(!n.get('subjectid1')||!n.get('subjectid2')||!n.get('subjectid3'))return void alert('请选择课程分类');if(!n.get('language'))return void alert('请选择课程语言');var e={};e.userNumber=n.get('user').number,e.number=n.get('number'),e.title=w.find('.course-title').val(),e.portrait=n.get('portrait'),e.introduce=w.find('.course-summary').val(),e.price=!$('#free-course').is(':checked')?w.find('.course-price').val():'0',e.expireTime=e.price?!$('#free-time').is(':checked')?w.find('.course-time').val():'0':'0',e.subjectId=n.get('subjectid1')+','+n.get('subjectid2')+','+n.get('subjectid3')+','+n.get('subjectid1text')+','+n.get('subjectid2text')+','+n.get('subjectid3text'),e.language=n.get('language').value,e.labelIds=q.getValue(),i.setVideoCourseInfo(e,{errorHandler:{100061:function(e){var t={title:'课程标题',introduce:'课程简介',label_ids:'课程标签'},i=e.data,n='你';$.each(i,function(e,i){if(i.length)n+='<span class="sensitive">在<em>'+t[e]+'</em>中输入的内容包含',$.each(i,function(e,t){n+='\u201C<em>'+t+'</em>\u201D';}),n+='\uFF1B</span><br />';}),n+='请删除后重新输入',alert({title:'温馨提示',content:n,width:450,buttons:[{text:'确定',type:'primary',handler:function(){this.hide();}}]});}}}).done(function(t){if(0===t.code){success('保存成功\uFF01'),b(!0),n.set('number',t.data.number),w.parent().removeClass('update-unpublish-mode').removeClass('update-publish-mode').addClass('no-edit'),n.set('portraitCopy',n.get('portrait')),w.find('.video-course-title p').html(e.title);var i='';if(parseInt(e.price)){if(i='<span class="num" data-price="'+e.price+'"><em>\uFFE5</em>'+e.price+'</span>',e.price_ios)i+='<em class="num-ios" data-price="'+e.price_ios+'">\uFF08苹果设备上售价\uFFE5'+e.price_ios+'\uFF09</em>';}else i='免费课';w.find('.video-course-price p').html(i),w.find('.video-course-time p').html(parseInt(e.expireTime)?'<span class="num">'+e.expireTime+'<i>天</i></span>':'该视频课永久有效'),w.find('.video-course-summary p').html(e.introduce),w.find('.video-course-category p').html(n.get('subjectid1text')+'/'+n.get('subjectid2text')+'/'+n.get('subjectid3text')).data('cid',n.get('subjectid1')+','+n.get('subjectid2')+','+n.get('subjectid3')),w.find('.video-course-language p').html(n.get('language').text).data('lid',n.get('language').value);var o=w.find('.video-course-tags .video-tag-list');if(q.getValue()){for(var r=e.labelIds.split(','),a=[],s=0;s<r.length;s++)a.push('<li class="tag-item">'+r[s]+'</li>');o.html(a.join('')),o.show();}else o.hide();n.set('firstSaveInfo',!0);}});}}}).on('click','.not-save-course',function(){if(b())confirm({content:'你所更新的信息都将丢失\uFF0C确认不保存\uFF1F',title:'温馨提示',width:330}).done(function(){if(1==n.get('status')&&!n.get('firstSaveInfo')){w.find('input').val(''),w.find('textarea').val(''),q.setValue(''),A.setValue(''),U.setValue(''),R.setValue(''),O.setValue('');var e=w.find('.front-cover-box');e.find('.front-cover').show(),e.find('img').hide(),e.find('.point').show(),e.find('.txt').show(),w.find('strong:eq(0)').html('20'),w.find('strong:eq(1)').html('200'),n.set('portrait',null),n.set('subjectid1',null),n.set('subjectid2',null),n.set('subjectid3',null),n.set('subjectid1text',null),n.set('subjectid2text',null),n.set('subjectid3text',null),n.set('language',null);}else w.parent().removeClass('update-unpublish-mode').removeClass('update-publish-mode').addClass('no-edit'),v();});else w.parent().removeClass('update-unpublish-mode').removeClass('update-publish-mode').addClass('no-edit'),v();}).on('click','.save-lesson',function(){if(x(4))if(x(5)){var e={},t=k.find('li'),o=[];if(t.each(function(e,t){o.push($(t).data('sectionid'));}),o.length<2)return void alert('请先完善课节信息\uFF01');e.userNumber=n.get('user').number,e.number=n.get('number'),e.sectionIds=o.join(','),i.setAllVideoCourseSection(e).done(function(e){if(0===e.code)k.parent().addClass('no-edit');});}}).on('click','.save-detail',function(){if(x(6)){var e=V.getContent(),t=V.getContentLength(!0);if(t.length>5000)return void alert('请不要输入超过 5000 个字');var o=V.iframe,r=o.contentDocument||o.contentWindow.document,a=!1;if($('img',r).each(function(){if($(this).attr({width:this.width,height:this.height}),this.width>790)a=!0;}),a)return void alert({title:'温馨提示',content:'插入的图片宽度大于最大展现宽度 790px\uFF0C请进行缩小处理吧',width:400});var s={};s.userNumber=n.get('user').number,s.number=n.get('number'),s.brief=e,i.setVideoCourseBrief(s,{errorHandler:{100061:function(e){var t={brief:'课程详情'},i=e.data,n='你';$.each(i,function(e,i){if(i.length)n+='<span class="sensitive">在<em>'+t[e]+'</em>中输入的内容包含',$.each(i,function(e,t){n+='\u201C<em>'+t+'</em>\u201D';}),n+='\uFF1B</span><br />';}),n+='请删除后重新输入',alert({title:'温馨提示',content:n,width:450,buttons:[{text:'确定',type:'primary',handler:function(){this.hide();}}]});}}}).done(function(t){if(0===t.code){if(success('保存成功\uFF01'),e!=S.find('.content').html())S.parent().find('.wrong-reason').hide();S.find('.content').html(e).show(),S.parent().addClass('no-edit');}});}}).on('click','.not-save-detail',function(){if(V.getContent()!=S.find('.content').html())confirm({content:'你所更新的信息都将丢失\uFF0C确认不保存\uFF1F',title:'温馨提示',width:330}).done(function(){S.parent().addClass('no-edit'),V.setContent(S.find('.content').html()),V.hide(),S.find('.content').show();});else S.parent().addClass('no-edit'),V.setContent(S.find('.content').html()),V.hide(),S.find('.content').show();}).on('click','.publish-course, .pre-publish-course',function(){var e=$(this);if(!e.hasClass('publish-course')||x(1))if(!e.hasClass('pre-publish-course')||x(2)){var t={};if(t.userNumber=n.get('user').number,t.number=n.get('number'),e.hasClass('pre-publish-course'))t.type=2;else{t.type=1;var o=k.parent().find('.wrong-title'),r=w.parent().find('.wrong-title');if(r[0]&&!r.hasClass('pass'))return alert({title:'温馨提示',content:'还有审核不通过的课程内容未修改哦~',width:450,buttons:[{text:'马上修改',type:'primary',handler:function(){this.hide();}}]}),!1;if(o[0]&&!o.hasClass('pass')){var a=k.data('status'),s='马上替换',l='还有未转码成功的视频课节没有替换哦~';if(4==a)s='马上修改',l='还有审核不通过的课程内容未修改哦~';return alert({title:'温馨提示',content:l,width:450,buttons:[{text:s,type:'primary',handler:function(){this.hide();}}]}),!1;}}i.saveVideoCourse(t).done(function(t){if(0===t.code)if(e.hasClass('pre-publish-course'))success('保存至待发布列表成功\uFF01'),location.href='/video_course/getcourselist?type=4&page=1&page_size=10';else location.href='/video_course/getcourselist?type=1&page=1&page_size=10';});}}).on('click','.video-info-edit, .video-upload-edit, .video-content-edit',function(){var e=$(this),t=null;if(e.hasClass('video-info-edit')){if(t=w.parent(),3==n.get('status'))t.addClass('update-publish-mode');if(2==n.get('status'))t.addClass('update-unpublish-mode');if(t.removeClass('no-edit'),n.get('price'))w.find('');else w.find('#free-course').prop('checked',!0),w.find('#free-time').prop('checked',!1).prop('disabled',!0),w.find('.course-time').val('').prop('disabled',!0);}else if(e.hasClass('video-upload-edit'))t=k.parent(),t.removeClass('no-edit');else{if(t=S.parent(),!V)S.find('textarea').show(),S.find('.content').hide(),V=new UE.ui.Editor({initialFrameHeight:400,maximumWords:5000}),V.render(C.find('.editor')[0]);else V.show(),S.find('.content').hide(),V.setContent(S.find('.content').html());t.removeClass('no-edit');}}),n.get('edit_info'))$('.video-info-edit').click();if(n.get('edit_video')){$('.video-upload-edit').click();var L=$('.video-upload .add-section').prev();if(L.find('.change-title')[0])L.find('.change-title').click();}};});