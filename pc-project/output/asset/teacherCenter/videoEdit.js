define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return i.init(this,e);}function t(e,t){if(e.length>0){var r=e[0].element;if(r.is(':hidden'))r=r.parent();var n=r.offset().top;if(t>0)n-=t;window.scrollTo(window.scrollX,n);}}function r(e){var t=$.Deferred();return $.when.apply($,e).done(function(){t.resolve(arguments);}),t;}var n=require('../function/jquerify'),i=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var t=this,r=t.element,n='FORM'===r.prop('tagName')?r:r.find('form');if(n.length>0)n.attr('novalidate','novalidate').on('submit'+o,$.proxy(t.validate,t));$.each(t.fields,function(t,n){var i=r.find('[name="'+t+'"]'),o=n.type;if(!o)o=n.type=i.attr('type')||'text';var u=n.rules;if(!u)u=n.rules={};var l=e.type[o]||[];$.each(l,function(e,t){if(null==u[t]){var r=a[t];if($.isFunction(r))u[t]=r(i,n);}});});var i=t.groupSelector;if(r.on('focusin'+o,function(e){var r=$(e.target).closest(i),n=[t.successClass,t.errorClass,t.requiredClass].join(' ');r.removeClass($.trim(n));}),t.realtime)r.on('focusout'+o,function(e){var r=$(e.target),n=r.prop('name');if(!n)r=r.find('[name]'),n=r.prop('name');if(n)t.validate(n);});},validate:function(e,n){var i=this,a=i.emit('beforeValidate');if(!a.isDefaultPrevented()){var o,u=i.element,l=i.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))o=$.map(e,function(e){return u.find('[name="'+e+'"]').closest(l);});else if(o=u.find(l),'boolean'===$.type(e))n=e;var s=[],c=[];$.each(o,function(e,t){var r=i.validateGroup($(t));if(r){if(r.promise)c.push(r),r=r.data;$.merge(s,r);}});var e=[],f=[],d=function(){if($.each(s,function(t,r){if(r.error)f.push(r);e.push(r.element.prop('name'));}),n)t(f,i.scrollGap);i.emit('afterValidate',{fields:e,errors:f});};if(c.length>0)return r(c).done(d);else return d(),0===f.length;}},validateGroup:function(t){if(t.is(':visible')){var n=this,i=[],a=[],o=[];if(t.find('[name]').each(function(t){var r,u,l=this,s=l.name,c=l.value,f=l.disabled,d=$(l);if(!f){var p=n.fields[s];if(p){r=!0,p=$.extend(!0,{},p),p.form=n.element,p.value=$.trim(c);var m;if($.each(e.type[p.type]||[],function(t,r){var n=e.rule[r](p);if(n===!1)return m=r,!1;else if(''===p.value&&'required'===r)return!1;}),m){var v=p.errors;if(v)u=v[m];if(!u)throw new Error(s+' 字段 '+m+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var h=$.Deferred(),g=p.custom(d,function(e){h.resolve(e);});u=null==g||g.done?h:g;}}}if(r)if(t=i.push({element:d,error:u}),u&&u.promise)a.push(u),o.push(t-1);}),a.length>0){var u=r(a).done(function(e){$.each(e,function(e,t){i[o[e]].error=t;}),n.refreshGroup(t,i);});return u.data=i,u;}else return n.refreshGroup(t,i),i;}},refreshGroup:function(e,t){var r=this,n=r.successClass,i=r.errorClass;$.each(t,function(t,a){var o,u=a.element,l=a.error,s=r.errorSelector;if(s)o=e.find(s).eq(t);if(l&&'string'===$.type(l)){if(e.removeClass(n).addClass(i),o){var c=r.renderTemplate;if($.isFunction(c))l=c({text:l},r.errorTemplate);o.html(l).show();var f=r.errorPlacement;if($.isFunction(f))f(u,o);}}else if(a.error='',e.removeClass(i).addClass(n),o)o.html('').hide();});},dispose:function(){var e=this;i.dispose(e),e.element.off(o),e.element=null;}},n(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,t){return t.replace(/\${(\w+)}/g,function(t,r){return e[r]||'';});},errorPlacement:function(e,t){if('hidden'===e.prop('type'))e=e.parent();t.css({position:'static',width:'auto'});var r=t.outerWidth(!0)+5;t.css({position:'absolute',width:r});var n=e.parent();if(n.is('.placeholder-wrapper'))e=n;var i=e.position();t.css({left:i.left+e.outerWidth()-37,top:i.top-t.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var t=e.rules.pattern;if(t)return t.test(e.value);else return void 0;},minlength:function(e){var t=e.rules.minlength;if($.isNumeric(t))return e.value.length>=+t;else return void 0;},maxlength:function(e){var t=e.rules.maxlength;if($.isNumeric(t))return e.value.length<=+t;else return void 0;},min:function(e){var t=e.rules.min;if($.isNumeric(t))return e.value>=+t;else return void 0;},max:function(e){var t=e.rules.max;if($.isNumeric(t))return e.value<=+t;else return void 0;},step:function(e){var t=e.rules.step;if($.isNumeric(t)){var r=e.rules.min||1;return(e.value-r)%t===0;}},equals:function(e){var t=e.rules.equals;if(t){var r=e.form.find('[name="'+t+'"]');return e.value===$.trim(r.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var a={required:function(e){return'required'===e.attr('required');},pattern:function(t,r){var n=t.attr('pattern')||e.pattern[r.type];if('string'===$.type(n))n=new RegExp(n);return n;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},o='.cobble_form_validator';return e;}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,r={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(r,n){var i=this,a=e(i);if(a){if(!r[$.expando])r='string'===$.type(r)?$.Event(r):$.Event(null,r);r.cobble=i;var o=[r];if(n)o.push(n);var u=i[$.camelCase('on-'+r.type)];if($.isFunction(u)&&u.apply(i,o)===!1)r.preventDefault();if(!r.isPropagationStopped())t.trigger.apply(a,o);return r;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(r,function(t,r){if(null==e[t])e[t]=r;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var r=e.constructor,n='__cobble__'+r.prototype.type,i=t.element;if(i&&i.data(n))e=i.data(n);else if($.extend(e,r.defaultOptions,t),e.init(),i)i.data(n,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,r=e.element;if(r)r.removeData(t);};}),define('cobble/helper/Range',['require','exports','module'],function(){'use strict';function e(e){this.element=e;}function t(){var e=this.element;return{start:e.selectionStart,end:e.selectionEnd};}function r(e,t){var r=this.element;r.focus(),r.setSelectionRange(e,t);}function n(){var e=this.element;e.focus();var t=document.selection.createRange().getBookmark(),r=e.createTextRange();r.moveToBookmark(t);var n=r.duplicate();n.setEndPoint('StartToStart',r);for(var i=e.value,a=0;0!==n.moveStart('character',-1);a++)if('\n'===i.charAt(a))a++;return{start:a,end:a+r.text.length};}function i(e,t){var r=this.element;if(!(r.value.length<t)){var n=r.createTextRange();n.collapse(!0),n.moveStart('character',e),n.moveEnd('character',t-1),n.select();}}var a=!window.getSelection;return e.prototype={constructor:e,getRange:a?n:t,setRange:a?i:r,getText:function(){var e=this.element.value,t=this.getRange();return e.substring(t.start,t.end);},setText:function(e){var t=this.element,r=t.value,n=this.getRange();t.value=r.substring(0,n.start)+e+r.substr(n.end);},dispose:function(){this.element=null;}},a=null,e;}),define('common/component/TagInput_4bd86dd88e',['cobble/helper/Range'],function(){'use strict';function e(e){$.extend(this,e),this.init();}function t(e){return $('<label class="label label-primary small" data-value="'+e+'">'+e+'<i class="icon icon-times"></i></label>');}function r(e,t){var r=''!==t;if(r){if(e.tagList.find('[data-value="'+t+'"]').length>0)r=!1;if(r&&$.isFunction(e.validate))r=e.validate(t);}return r;}var n=require('cobble/helper/Range');e.prototype={init:function(){var e=this,t=e.element,r=$(i);t.replaceWith(r),r.append(t);var a=t.prop('name');if(a)t.removeAttr('name');var o=$('<input type="hidden" name="'+a+'" />'),u=r.find('.tag-list');r.append(o),e.wrapper=r,e.tagList=u,e.input=o;var l=new n(t[0]);t.on('keydown',function(r){var n=r.keyCode,i=$.trim(t.val());if(i&&32===n)if(e.appendTag(i))t.val('');else return!1;else if(8===n){var a=l.getRange();if(a.start===a.end&&0===a.start)if(u.length>0){var o=u.find('.label').last();e.removeTag(o.data('value'));}}}).on('focus',function(){r.addClass('active');}).on('blur',function(){r.removeClass('active');}),r.on('click','.icon-times',function(t){var r=$(t.currentTarget).closest('.label');e.removeTag(r.data('value'));});},setValue:function(e){var t=this,r=t.tagList;r.find('.label').each(function(){t.removeTag($(this).data('value'));}),$.each(e.split(','),function(e,r){if(r)t.appendTag(r);});},getValue:function(){var e=this,t=e.getTags();if('number'!==$.type(e.max)||t.length<e.max){var n=$.trim(e.element.val());if(r(e,n))t.push(n);}return t.join(',');},getTags:function(){var e=[];return this.tagList.find('.label').each(function(){e.push($(this).data('value'));}),e;},appendTag:function(e){var n=this,i=r(n,e);if(i){var a=n.getTags();if('number'===$.type(n.max))i=a.length<n.max;if(i)a.push(e),n.tagList.append(t(e)),n.input.val(a.join(','));}return i;},removeTag:function(e){var t=this,r=t.tagList;r.find('.label').each(function(){var r=$(this);if(r.data('value')===e)return r.remove(),t.input.val(t.getTags().join(',')),!1;else return void 0;});}};var i='<div class="tag-input"><div class="tag-list"></></div>';return e;}),define('common/form_2ef59f4d41',['require','exports','cobble/form/Validator'],function(require,exports){'use strict';function e(e){var t={},r=e.find('[name]');return r.each(function(){var e=this.name,r=this.value,n='radio'===this.type||'checkbox'===this.type;if(n){if(this.checked)t[e]=r;}else{var i=t[e];if(null==i)t[e]=r;else i=t[e]=[i],i.push(r);}}),$.each(t,function(e,r){t[e]=$.isArray(r)?r.join(','):$.trim(r);}),t;}function t(e,t){$.each(t,function(t,n){if(n){var i=e.find('[name="'+t+'"]'),a=i.closest('.form-group');a.removeClass('has-success').addClass('has-error');var o=a.find('.error');o.html(n),r.defaultOptions.errorPlacement(i,o);}});}var r=require('cobble/form/Validator');exports.parse=function(t){return e(t);},exports.get=function(r,n){return $.ajax({url:n,type:'get',dataType:'json',data:r.jquery?e(r):r}).done(function(e){if(e.code){var n=e.data;if(n)t(r,n);}return e;});},exports.post=function(r,n){return $.ajax({url:n,type:'post',dataType:'json',data:r.jquery?e(r):r}).done(function(e){if(e.code){var n=e.data;if(n)t(r,n);}return e;});};}),define('teacherCenter/videoEdit',['require','exports','common/component/TagInput_4bd86dd88e','common/service_9c322508d3','common/form_2ef59f4d41','common/store_a1a35b3dfc'],function(require,exports){'use strict';var e=require('common/component/TagInput_4bd86dd88e'),t=require('common/service_9c322508d3'),r=require('common/form_2ef59f4d41'),n=require('common/store_a1a35b3dfc');exports.init=function(){var i=$('#content .edit-form'),a=new e({element:i.find('[name="labels"]')});a.setValue(n.get('labels')||'');var o=i.find('[name="category"]'),u=o.filter('[value="0"]'),l=o.filter('[value="1"]'),s=o.filter('[value="2"]'),c=o.filter('[value="3"]'),f=o.filter('[value="4"]'),d=n.get('category'),p={0:u,1:l,2:s,3:c,4:f};o=p[d],o.click(),i.on('click','.all-pics li',function(e){var t=$(e.currentTarget),r=t.closest('.all-pics');if(!t.hasClass('active')){r.find('li').each(function(e,t){if($(t).hasClass('active'))$(t).removeClass('active');}),t.addClass('active');var n=t.find('img').attr('src');i.find('.preview img').attr('src',n);}}).on('click','.btn-save',function(){var e=r.parse(i),n=a.getValue();if(!e.title)return void alert('请输入视频标题');if(null==e.category)return void alert('请选择视频分类');if(0===n.length)return void alert('请输入视频标签');else return void t.createVideo({edit:1,id:e.id,title:e.title,category:e.category,labels:n,url:i.find('.preview img').attr('src')}).done(function(e){if(0===e.code)success('保存成功',function(){location.href='/teacher_center/video';});});});};});