define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return o.init(this,e);}function t(e,t){if(e.length>0){var n=e[0].element;if(n.is(':hidden'))n=n.parent();var i=n.offset().top;if(t>0)i-=t;window.scrollTo(window.scrollX,i);}}function n(e){var t=$.Deferred();return $.when.apply($,e).done(function(){t.resolve(arguments);}),t;}var i=require('../function/jquerify'),o=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var t=this,n=t.element,i='FORM'===n.prop('tagName')?n:n.find('form');if(i.length>0)i.attr('novalidate','novalidate').on('submit'+a,$.proxy(t.validate,t));$.each(t.fields,function(t,i){var o=n.find('[name="'+t+'"]'),a=i.type;if(!a)a=i.type=o.attr('type')||'text';var s=i.rules;if(!s)s=i.rules={};var l=e.type[a]||[];$.each(l,function(e,t){if(null==s[t]){var n=r[t];if($.isFunction(n))s[t]=n(o,i);}});});var o=t.groupSelector;if(n.on('focusin'+a,function(e){var n=$(e.target).closest(o),i=[t.successClass,t.errorClass,t.requiredClass].join(' ');n.removeClass($.trim(i));}),t.realtime)n.on('focusout'+a,function(e){var n=$(e.target),i=n.prop('name');if(!i)n=n.find('[name]'),i=n.prop('name');if(i)t.validate(i);});},validate:function(e,i){var o=this,r=o.emit('beforeValidate');if(!r.isDefaultPrevented()){var a,s=o.element,l=o.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))a=$.map(e,function(e){return s.find('[name="'+e+'"]').closest(l);});else if(a=s.find(l),'boolean'===$.type(e))i=e;var c=[],u=[];$.each(a,function(e,t){var n=o.validateGroup($(t));if(n){if(n.promise)u.push(n),n=n.data;$.merge(c,n);}});var e=[],f=[],d=function(){if($.each(c,function(t,n){if(n.error)f.push(n);e.push(n.element.prop('name'));}),i)t(f,o.scrollGap);o.emit('afterValidate',{fields:e,errors:f});};if(u.length>0)return n(u).done(d);else return d(),0===f.length;}},validateGroup:function(t){if(t.is(':visible')){var i=this,o=[],r=[],a=[];if(t.find('[name]').each(function(t){var n,s,l=this,c=l.name,u=l.value,f=l.disabled,d=$(l);if(!f){var p=i.fields[c];if(p){n=!0,p=$.extend(!0,{},p),p.form=i.element,p.value=$.trim(u);var h;if($.each(e.type[p.type]||[],function(t,n){var i=e.rule[n](p);if(i===!1)return h=n,!1;else if(''===p.value&&'required'===n)return!1;}),h){var m=p.errors;if(m)s=m[h];if(!s)throw new Error(c+' 字段 '+h+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var v=$.Deferred(),g=p.custom(d,function(e){v.resolve(e);});s=null==g||g.done?v:g;}}}if(n)if(t=o.push({element:d,error:s}),s&&s.promise)r.push(s),a.push(t-1);}),r.length>0){var s=n(r).done(function(e){$.each(e,function(e,t){o[a[e]].error=t;}),i.refreshGroup(t,o);});return s.data=o,s;}else return i.refreshGroup(t,o),o;}},refreshGroup:function(e,t){var n=this,i=n.successClass,o=n.errorClass;$.each(t,function(t,r){var a,s=r.element,l=r.error,c=n.errorSelector;if(c)a=e.find(c).eq(t);if(l&&'string'===$.type(l)){if(e.removeClass(i).addClass(o),a){var u=n.renderTemplate;if($.isFunction(u))l=u({text:l},n.errorTemplate);a.html(l).show();var f=n.errorPlacement;if($.isFunction(f))f(s,a);}}else if(r.error='',e.removeClass(o).addClass(i),a)a.html('').hide();});},dispose:function(){var e=this;o.dispose(e),e.element.off(a),e.element=null;}},i(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,t){return t.replace(/\${(\w+)}/g,function(t,n){return e[n]||'';});},errorPlacement:function(e,t){if('hidden'===e.prop('type'))e=e.parent();t.css({position:'static',width:'auto'});var n=t.outerWidth(!0)+5;t.css({position:'absolute',width:n});var i=e.parent();if(i.is('.placeholder-wrapper'))e=i;var o=e.position();t.css({left:o.left+e.outerWidth()-37,top:o.top-t.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var t=e.rules.pattern;if(t)return t.test(e.value);else return void 0;},minlength:function(e){var t=e.rules.minlength;if($.isNumeric(t))return e.value.length>=+t;else return void 0;},maxlength:function(e){var t=e.rules.maxlength;if($.isNumeric(t))return e.value.length<=+t;else return void 0;},min:function(e){var t=e.rules.min;if($.isNumeric(t))return e.value>=+t;else return void 0;},max:function(e){var t=e.rules.max;if($.isNumeric(t))return e.value<=+t;else return void 0;},step:function(e){var t=e.rules.step;if($.isNumeric(t)){var n=e.rules.min||1;return(e.value-n)%t===0;}},equals:function(e){var t=e.rules.equals;if(t){var n=e.form.find('[name="'+t+'"]');return e.value===$.trim(n.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var r={required:function(e){return'required'===e.attr('required');},pattern:function(t,n){var i=t.attr('pattern')||e.pattern[n.type];if('string'===$.type(i))i=new RegExp(i);return i;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},a='.cobble_form_validator';return e;}),define('cobble/function/contains',['require','exports','module'],function(){'use strict';return function(e,t){if(e=e.jquery?e[0]:e,t=t.jquery?t[0]:t,!e||!t)return!1;if(e===t)return!0;else return $.contains(e,t);};}),define('cobble/function/debounce',['require','exports','module'],function(){'use strict';return function(e,t){t='number'===$.type(t)?t:50;var n;return function(){if(!n){var i=arguments;n=setTimeout(function(){n=null,e.apply(null,$.makeArray(i));},t);}};};}),define('cobble/function/decimalLength',['require','exports','module'],function(){'use strict';return function(e){var t=(''+e).split('.');return 2===t.length?t[1].length:0;};}),define('cobble/function/disableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,n='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=function(){return!1;};};if(n)return function(e){e=e||document.body,e.style.MozUserSelect='none';};else return $.noop;}),define('cobble/function/divide',['require','exports','module','./decimalLength','./float2Int'],function(require){'use strict';var e=require('./decimalLength'),t=require('./float2Int');return function(n,i){var o=Math.max(e(n),e(i));return n=t(n,o),i=t(i,o),n/ i;};}),define('cobble/function/dragGlobal',['require','exports','module','../helper/Draggable','../util/instance','../util/dimension','./pin'],function(require){'use strict';{var e=require('../helper/Draggable'),t=require('../util/instance'),n=require('../util/dimension');require('./pin');}return function(i){return new e({element:i.element,container:t.body,draggingClass:i.draggingClass,handleSelector:i.handleSelector,cancelSelector:i.cancelSelector,rect:function(){var e=i.fixed,t=i.scrollable;return{x:e||t?0:n.getPageScrollLeft(),y:e||t?0:n.getPageScrollTop(),width:e||!t?n.getViewportWidth():n.getPageWidth(),height:e||!t?n.getViewportHeight():n.getPageHeight()};}});};}),define('cobble/function/enableSelection',['require','exports','module'],function(){'use strict';var e=$('<i></i>')[0],t='onselectstart'in e,n='MozUserSelect'in e.style;if(e=null,t)return function(e){e=e||document,e.onselectstart=null;};if(n)return function(e){e=e||document.body,e.style.MozUserSelect='';};else return $.noop;}),define('cobble/function/float2Int',['require','exports','module'],function(){'use strict';return function(e,t){var n,i=(''+e).split('.');if(t>=0);else t=0;if(1===i.length)n=e+new Array(t+1).join('0');else t=Math.max(0,t-i[1].length),n=i.join('')+new Array(t+1).join('0');return+n;};}),define('cobble/function/innerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var n=t.offset(),i=t.css('border-left-width'),o=t.css('border-top-width');return{left:n.left+e(i,0,'int'),top:n.top+e(o,0,'int')};};}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,n={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(n,i){var o=this,r=e(o);if(r){if(!n[$.expando])n='string'===$.type(n)?$.Event(n):$.Event(null,n);n.cobble=o;var a=[n];if(i)a.push(i);var s=o[$.camelCase('on-'+n.type)];if($.isFunction(s)&&s.apply(o,a)===!1)n.preventDefault();if(!n.isPropagationStopped())t.trigger.apply(r,a);return n;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(n,function(t,n){if(null==e[t])e[t]=n;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var n=e.constructor,i='__cobble__'+n.prototype.type,o=t.element;if(o&&o.data(i))e=o.data(i);else if($.extend(e,n.defaultOptions,t),e.init(),o)o.data(i,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,n=e.element;if(n)n.removeData(t);};}),define('cobble/function/offsetParent',['require','exports','module'],function(){'use strict';function e(e){return e.is('body')||'static'!==e.css('position');}return function(t){if(t.is('body'))return t;for(var n=t.parent();!e(n);)n=n.parent();return n;};}),define('cobble/function/outerOffset',['require','exports','module','./toNumber'],function(require){'use strict';var e=require('./toNumber');return function(t){var n=t.offset(),i=e(t.css('margin-left'),0,'int'),o=e(t.css('margin-top'),0,'int');return{left:n.left-i,top:n.top-o};};}),define('cobble/function/page',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')<e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/pageHeight',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollHeight,t.clientHeight);};}),define('cobble/function/pageScrollLeft',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollLeft,document.documentElement.scrollLeft);};}),define('cobble/function/pageScrollTop',['require','exports','module'],function(){'use strict';return function(){return Math.max(document.body.scrollTop,document.documentElement.scrollTop);};}),define('cobble/function/pageWidth',['require','exports','module','./page'],function(require){'use strict';var e=require('./page');return function(){var t=e()[0];return Math.max(t.scrollWidth,t.clientWidth);};}),define('cobble/function/parsePercent',['require','exports','module','./divide'],function(require){'use strict';var e=require('./divide'),t=/(-?\d+(\.\d+)?)%/;return function(n){if(t.test(n))return e(RegExp.$1,100);else return void 0;};}),define('cobble/function/pin',['require','exports','module','../util/instance','./parsePercent'],function(require){'use strict';function e(e){var t=o[e.x];if(null==t)t=e.x;if('string'===$.type(t)){var n=i(t);if(null!=n)t=n*(e.width||e.element.outerWidth());}return t;}function t(e){var t=o[e.y];if(null==t)t=e.y;if('string'===$.type(t)){var n=i(t);if(null!=n)t=n*(e.height||e.element.outerHeight());}return t;}var n=require('../util/instance'),i=require('./parsePercent'),o={left:0,top:0,center:'50%',middle:'50%',right:'100%',bottom:'100%'};return function(i){var o=i.element,r=i.attachment||{};if(!r.element)r.element=n.body;var a=r.element.offset(),s=a.left+e(r),l=a.top+t(r),c=s-e(i),u=l-t(i),f=i.offset;if(f){if('number'===$.type(f.x))c+=f.x;if('number'===$.type(f.y))u+=f.y;}var d={left:c,top:u},p=o.css('position');if('absolute'!==p&&'fixed'!==p)d.position='absolute';if(i.silence)return d;else o.css(d);};}),define('cobble/function/pinGlobal',['require','exports','module','./pin','../util/dimension','../function/viewport'],function(require){'use strict';var e=require('./pin'),t=require('../util/dimension'),n=require('../function/viewport');return function(i){var o={silence:!0,element:i.element,x:'50%'===i.x?'50%':0,y:'50%'===i.y?'50%':0,attachment:{element:n(),width:t.getViewportWidth(),height:t.getViewportHeight(),x:i.x,y:i.y}};if(!i.fixed)o.offset={x:t.getPageScrollLeft(),y:t.getPageScrollTop()};return e(o);};}),define('cobble/function/position',['require','exports','module','./offsetParent'],function(require){'use strict';var e=require('./offsetParent');return function(t){var n=e(t),i=t.css('position'),o=parseInt(t.css('left'),10),r=parseInt(t.css('top'),10),a=isNaN(o),s=isNaN(r);if(a||s)if(1===n.length){var l=t.offset(),c=n.offset();if(a)o=l.left-c.left-(parseInt(n.css('border-left-width'),10)||0);if(s)r=l.top-c.top-(parseInt(n.css('border-top-width'),10)||0);}else o=r=0;if(!i||'static'===i)i='absolute';return{position:i,left:o,top:r};};}),define('cobble/function/restrain',['require','exports','module'],function(){'use strict';return function(e,t,n){if(t>e)e=t;else if(e>n)e=n;return e;};}),define('cobble/function/toNumber',['require','exports','module'],function(){'use strict';var e={'int':parseInt,'float':parseFloat};return function(t,n,i){if('number'!==$.type(t)){var o=e[i];if(t=o?o(t,10):+t,isNaN(t))t=n;}return t;};}),define('cobble/function/viewport',['require','exports','module','../util/instance'],function(require){'use strict';var e=require('../util/instance');return function(){if(e.body.prop('clientHeight')>e.html.prop('clientHeight'))return e.html;else return e.body;};}),define('cobble/function/viewportHeight',['require','exports','module'],function(){'use strict';return function(){return window.innerHeight||document.documentElement.clientHeight;};}),define('cobble/function/viewportWidth',['require','exports','module'],function(){'use strict';return function(){return window.innerWidth||document.documentElement.clientWidth;};}),define('cobble/helper/AjaxUploader',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return c.init(this,e);}function t(e,t){var n=new FormData();$.each(e.data,function(e,t){n.append(e,t);}),n.append(e.fileName,t.nativeFile),t.xhr.send(n);}function n(t,n){var i=n.nativeFile,o=n.file.size,r=n.chunk;if(!r)r=n.chunk={index:0,uploaded:0};var a=r.index,s=t.chunkSize,l=s*a,c=s*(a+1);if(c>o)c=o;if(r.uploading=c-l,r.uploading<=0)return void setTimeout(function(){t.emit('uploadError',{fileItem:n,errorCode:e.ERROR_CHUNK_SIZE});});var u='bytes '+(l+1)+'-'+c+'/'+o,f=n.xhr;f.setRequestHeader('Content-Type',''),f.setRequestHeader('X_FILENAME',encodeURIComponent(i.name)),f.setRequestHeader('Content-Range',u),f.send(i.slice(l,c));}function i(t,n){var i=n.xhr;if(i)$.each(d,function(e,t){i['on'+t.type]=null;}),$.each(p,function(e,t){i.upload['on'+t.type]=null;}),delete n.xhr;if(t.emit('uploadComplete',{fileItem:n}),n.status===e.STATUS_UPLOAD_SUCCESS||n.status===e.STATUS_UPLOAD_ERROR&&t.ignoreError){var r=n.index+1;if(r<t.fileQueue.files.length)t.fileQueue.index=r,t.upload();else o(t,[]);}}function o(t,n){var i=t.fileQueue;i.index=0,i.files=$.map(n,function(t,n){return{index:n,file:s(t),nativeFile:t,status:e.STATUS_WAITING};});}function r(e){var t=e.fileQueue,n=t.index;if(t.files&&'number'===$.type(n))return t.files[n];else return void 0;}function a(e){var t=[];return $.each(e,function(e,n){if(f[n])t.push(f[n]);}),$.unique(t).join(',');}function s(e){var t=e.name,n=t.split('.'),i=n.length>0?n.pop().toLowerCase():'';return{name:t,type:i,size:e.size};}var l=require('../function/jquerify'),c=require('../function/lifeCycle');e.prototype={constructor:e,type:'AjaxUploader',init:function(){var e=this;e.fileQueue={};var t=e.element;if(!t.is(':file'))throw new Error('AjaxUploader element must be <input type="file" />');var n=e.faker=$('<form></form>');t.replaceWith(n),n.append(t);var i={};if(e.accept)i.accept=a(e.accept);if(e.multiple)i.multiple=!0;t.prop(i),t.on('change'+u,function(){o(e,t.prop('files')),e.emit('fileChange');}),e.emit('ready');},getFiles:function(){return this.fileQueue.files||[];},setAction:function(e){this.action=e;},setData:function(e){$.extend(this.data,e);},reset:function(){this.faker[0].reset();},upload:function(i){var o=this,a=o.useChunk?e.STATUS_UPLOADING:e.STATUS_WAITING;if(i=i||r(o),i&&!(i.status>a)){var s=new XMLHttpRequest();if(o.xhrProps)$.extend(s,o.xhrProps);i.xhr=s,$.each(d,function(e,t){s['on'+t.type]=function(e){t.handler(o,e);};}),$.each(p,function(e,t){s.upload['on'+t.type]=function(e){t.handler(o,e);};}),s.open('post',o.action,!0);var l=o.useChunk?n:t;l(o,i);}},stop:function(){var t=this,n=r(t);if(n&&n.status===e.STATUS_UPLOADING)n.xhr.abort();t.reset();},enable:function(){this.element.prop('disabled',!1);},disable:function(){this.element.prop('disabled',!0);},dispose:function(){var e=this;c.dispose(e),e.stop(),e.element.off(u),e.faker=e.element=e.fileQueue=null;}},l(e.prototype),e.defaultOptions={data:{},multiple:!1,fileName:'Filedata',ignoreError:!1},e.supportChunk='undefined'!=typeof FileReader,e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_CHUNK_SIZE=-1;var u='.cobble_helper_ajaxuploader',f={html:'text/html',htm:'text/html',shtml:'text/html',xml:'text/xml',css:'text/css',js:'application/x-javascript',json:'application/json',atom:'application/atom+xml',rss:'application/rss+xml',mml:'text/mathml',txt:'text/plain',jad:'text/vnd.sun.j2me.app-descriptor',wml:'text/vnd.wap.wml',htc:'text/x-component',jpg:'image/jpeg',jpeg:'image/jpeg',png:'image/png',gif:'image/gif',tif:'image/tiff',tiff:'image/tiff',wbmp:'image/vnd.wap.wbmp',ico:'image/x-icon',jng:'image/x-jng',bmp:'image/x-ms-bmp',svg:'image/svg+xml',svgz:'image/svg+xml',webp:'image/webp',mp3:'audio/mpeg',wma:'audio/x-ms-wma',wav:'audio/x-wav',mid:'audio/midi',midd:'audio/midi',kar:'audio/midi',ogg:'audio/ogg',m4a:'audio/x-m4a',ra:'audio/x-realaudio',ram:'audio/x-pn-realaudio',mod:'audio/mod','3gp':'video/3gpp','3gpp':'video/3gpp',mp4:'video/mp4',mpeg:'video/mpeg',mpg:'video/mpeg',mov:'video/quicktime',webm:'video/webm',flv:'video/x-flv',m4v:'video/x-m4v',mng:'video/x-mng',asx:'video/x-ms-asf',asf:'video/x-ms-asf',wmv:'video/x-ms-wmv',avi:'video/x-msvideo',rm:'video/vnd.rn-realvideo',rmvb:'video/vnd.rn-realvideo',ts:'video/MP2T',dv:'video/x-dv',mkv:'video/x-matroska',jar:'application/java-archive',war:'application/java-archive',ear:'application/java-archive',hqx:'application/mac-binhex40',pdf:'application/pdf',ps:'application/postscript',eps:'application/postscript',ai:'application/postscript',rtf:'application/rtf',wmlc:'application/vnd.wap.wmlc',kml:'application/vnd.google-earth.kml+xml',kmz:'application/vnd.google-earth.kmz','7z':'application/x-7z-compressed',cco:'application/x-cocoa',jardiff:'application/x-java-archive-diff',jnlp:'application/x-java-jnlp-file',run:'application/x-makeself',pl:'application/x-perl',pm:'application/x-perl',prc:'application/x-pilot',pdb:'application/x-pilot',rar:'application/x-rar-compressed',rpm:'application/x-redhat-package-manager',sea:'application/x-sea',swf:'application/x-shockwave-flash',sit:'application/x-stuffit',tcl:'application/x-tcl',tk:'application/x-tcl',der:'application/x-x509-ca-cert',pem:'application/x-x509-ca-cert',crt:'application/x-x509-ca-cert',xpi:'application/x-xpinstall',xhtml:'application/xhtml+xml',zip:'application/zip',bin:'application/octet-stream',exe:'application/octet-stream',dll:'application/octet-stream',deb:'application/octet-stream',dmg:'application/octet-stream',eot:'application/octet-stream',iso:'application/octet-stream',img:'application/octet-stream',msi:'application/octet-stream',msp:'application/octet-stream',msm:'application/octet-stream',doc:'application/msword',xls:'application/vnd.ms-excel',ppt:'application/vnd.ms-powerpoint',docx:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',xlsx:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',pptx:'application/vnd.openxmlformats-officedocument.presentationml.presentation'},d={uploadStart:{type:'loadstart',handler:function(t){var n=r(t);n.status=e.STATUS_UPLOADING,t.emit('uploadStart',{fileItem:n});}},uploadSuccess:{type:'load',handler:function(t,n){var o=r(t),a={fileItem:o,responseText:o.xhr.responseText},s=o.chunk;if(s){var l=s.uploaded;if(l<o.file.size){var n=t.emit('chunkUploadSuccess',a);if(!n.isDefaultPrevented())if(s.index++,s.uploaded=l+s.uploading,s.uploaded<o.file.size)t.upload();else return o.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',a),void i(t,o);return;}}o.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',a),i(t,o);}},uploadError:{type:'error',handler:function(t,n,o){var a=r(t);a.status=e.STATUS_UPLOAD_ERROR,t.emit('uploadError',{fileItem:a,errorCode:o}),i(t,a);}},uploadStop:{type:'abort',handler:function(t,n){d.uploadError.handler(t,n,e.ERROR_CANCEL);}}},p={uploadProgress:{type:'progress',handler:function(e,t){var n=r(e),i=n.file.size,o=t.loaded,a=n.chunk;if(a)o+=a.uploaded;var s=o/(i||1);if(s>=0&&1>=s);else if(0>s)s=0;else if(s>1)s=1;s=parseInt(100*s,10)+'%',e.emit('uploadProgress',{fileItem:n,uploaded:o,total:i,percent:s});}}};return e;}),define('cobble/helper/Draggable',['require','exports','module','../function/page','../function/toNumber','../function/restrain','../function/position','../function/contains','../function/jquerify','../function/lifeCycle','../function/innerOffset','../function/outerOffset','../function/pageScrollLeft','../function/pageScrollTop','../function/enableSelection','../function/disableSelection','../util/instance','../util/mouse'],function(require){'use strict';function e(e){return c.init(this,e);}function t(e){var t=b(e),n=y(e);if(S.left!==t||S.top!==n){S.left=t,S.top=n;var i=e.data;if(1===++x){var o=i.draggingClass;if(o)i.element.addClass(o);i.emit('beforeDrag');}if(!i.silence)i.element.css(S);i.emit('drag',S);}}function n(e){h(),v.document.off(w);var t=e.data,n=t.draggingClass;if(n)t.element.removeClass(n);if(x>0)t.emit('afterDrag',S);x=b=y=null;}function i(e,t,n){var i=!1;if($.isArray(t))t=t.join(',');return e.find(t).each(function(){if(i=s(this,n))return!1;else return void 0;}),i;}var o=require('../function/page'),r=(require('../function/toNumber'),require('../function/restrain')),a=require('../function/position'),s=require('../function/contains'),l=require('../function/jquerify'),c=require('../function/lifeCycle'),u=require('../function/innerOffset'),f=require('../function/outerOffset'),d=require('../function/pageScrollLeft'),p=require('../function/pageScrollTop'),h=require('../function/enableSelection'),m=require('../function/disableSelection'),v=require('../util/instance'),g=require('../util/mouse');e.prototype={constructor:e,type:'Draggable',init:function(){var e=this,r=e.element;if(!e.container)e.container=o();r.css(a(r)),$.each(g,function(o,l){if(l.support)r.on(l.mousedown+w,function(c){var d=c.target,p=e.handleSelector,h=e.cancelSelector;if(!(p&&!i(r,p,d)||h&&i(r,h,d))){var g=C[o],$=f(r),R=g.absoluteX(c)-$.left,T=g.absoluteY(c)-$.top,E=e.container;if(s(E,r)){var O=u(E);R+=O.left,T+=O.top;}var A=a(r),j=A.position;S.left=A.left,S.top=A.top;var U=e.axis,q=e.getRectange(!0);b='y'===U?k.constant(S.left):k.change(g[j+'X'],R,q.x,q.x+q.width),y='x'===U?k.constant(S.top):k.change(g[j+'Y'],T,q.y,q.y+q.height),x=0,m(),v.document.on(l.mousemove+w,e,t).on(l.mouseup+w,e,n);}});});},getRectange:function(e){var t=this,n=t.rect;if($.isFunction(n))n=t.rect();if(e){var i=t.element,o=n.width-i.outerWidth(!0),r=n.height-i.outerHeight(!0);n.width=Math.max(0,o),n.height=Math.max(0,r);}return n;},setRectange:function(e){this.rect=e;},dispose:function(){var e=this;c.dispose(e),e.element.off(w),e.element=e.container=null;}},l(e.prototype),e.defaultOptions={rect:function(){var e=this,t=e.container,n={x:0,y:0,width:t.innerWidth(),height:t.innerHeight()};if(!s(t,e.element)){var i=u(t);n.x=i.left,n.y=i.top;}return n;}};var b,y,x,w='.cobble_helper_draggable',S={},k={constant:function(e){return function(){return e;};},change:function(e,t,n,i){return function(o){return r(e(o)-t,n,i);};}},C={};return $.each(g,function(e,t){if(t.support)C[e]={absoluteX:function(e){return t.clientX(e)+d();},absoluteY:function(e){return t.clientY(e)+p();},fixedX:function(e){return t.clientX(e);},fixedY:function(e){return t.clientY(e);}};}),e;}),define('cobble/helper/FlashUploader',['require','exports','module','../util/supload/supload','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return i.init(this,e);}require('../util/supload/supload');var t=window.Supload,n=require('../function/jquerify'),i=require('../function/lifeCycle');e.prototype={constructor:e,type:'FlashUploader',init:function(){var e=this,n={flashUrl:e.flashUrl,element:e.element[0],action:e.action,accept:e.accept,multiple:e.multiple,data:e.data,fileName:e.fileName,ignoreError:e.ignoreError,customSettings:{uploader:e}};$.each(o,function(e,t){e=$.camelCase('on-'+e),n[e]=t;}),e.supload=new t(n);},getFiles:function(){return this.supload.getFiles();},setAction:function(e){this.supload.setAction(e);},setData:function(e){this.supload.setData(e);},reset:function(){this.supload.reset();},upload:function(){this.supload.upload();},stop:function(){this.supload.cancel();},enable:function(){this.supload.enable();},disable:function(){this.supload.disable();},dispose:function(){var e=this;i.dispose(e),e.supload.dispose(),e.supload=e.element=null;}},n(e.prototype),e.defaultOptions={multiple:!1,fileName:'Filedata',ignoreError:!1,flashUrl:require.toUrl('../util/supload/supload.swf')},e.STATUS_WAITING=t.STATUS_WAITING,e.STATUS_UPLOADING=t.STATUS_UPLOADING,e.STATUS_UPLOAD_SUCCESS=t.STATUS_UPLOAD_SUCCESS,e.STATUS_UPLOAD_ERROR=t.STATUS_UPLOAD_ERROR,e.ERROR_CANCEL=t.ERROR_CANCEL,e.ERROR_SECURITY=t.ERROR_SECURITY,e.ERROR_IO=t.ERROR_IO;var o={ready:function(){var e=this.customSettings.uploader;e.emit('ready');},fileChange:function(){var e=this.customSettings.uploader;e.emit('fileChange');},uploadStart:function(e){var t=this.customSettings.uploader;t.emit('uploadStart',e);},uploadProgress:function(e){var t=this.customSettings.uploader,n=e.uploaded/(e.total||1);if(n>=0&&1>=n);else n=0;e.percent=parseInt(100*n,10)+'%',t.emit('uploadProgress',e);},uploadSuccess:function(e){var t=this.customSettings.uploader;t.emit('uploadSuccess',e);},uploadError:function(e){var t=this.customSettings.uploader;t.emit('uploadError',e);},uploadComplete:function(e){var t=this.customSettings.uploader;t.emit('uploadComplete',e);}};return e;}),define('cobble/ui/Dialog',['require','exports','module','../util/instance','../util/dimension','../function/jquerify','../function/lifeCycle','../function/offsetParent','../function/debounce','../function/pinGlobal','../function/dragGlobal'],function(require){'use strict';function e(e){return o.init(this,e);}var t=require('../util/instance'),n=require('../util/dimension'),i=require('../function/jquerify'),o=require('../function/lifeCycle'),r=require('../function/offsetParent'),a=require('../function/debounce'),s=require('../function/pinGlobal'),l=require('../function/dragGlobal');e.prototype={constructor:e,type:'Dialog',init:function(){var e=this,n=e.element||(e.element=$(e.template)),i=[],o=e.skinClass;if(o)i.push(o);var a=e.draggableClass;if(e.draggable&&a)i.push(a);if(i.length>0)n.addClass(i.join(' '));var s=e.removeOnEmpty,l=e.title;if(l)n.find(e.titleSelector).html(l);else if(s)n.find(e.headerSelector).remove();var u=e.content,f=n.find(e.bodySelector);if(u)f.html(u);else if(s)f.remove();var d=e.closeSelector,p=$.proxy(e.hide,e);if(d)n.on('click'+c,d,p);var h={};if(e.width)h.width=e.width;var m=e.fixed?'fixed':'absolute';if(n.css('position')!==m)h.position=m;if(!r(n).is('body'))t.body.append(n);if(e.modal){var v=e.mask||(e.mask=$(e.maskTemplate));if(n.before(v),e.hideOnClickMask)v.on('click'+c,p);var g='zIndex',b=e[g];if(!$.isNumeric(b))if(b=v.css(g),!$.isNumeric(b))b='auto';var y={overflow:'hidden'};y[g]=b,v.css(y),h[g]=b;}if(n.css(h),!e.hidden)e.hidden=!0,e.show();},show:function(){var e=this;if(e.hidden!==!1){var n=e.emit('beforeShow');if(!n.isDefaultPrevented()){var i=e.element,o=e.scrollable;if(e.draggable)e.drager=l({element:i,handleSelector:e.draggableHandleSelector,cancelSelector:e.draggableCancelSelector,draggingClass:e.draggingClass,fixed:e.fixed,scrollable:o});if(e.refresh(),e.showAnimation(),e.mask)e.showMaskAnimation();e.hidden=!1,t.window.resize(e.resizer=a(function(){e.refresh(!0);},50)),e.emit('afterShow');}}},hide:function(){var e=this;if(e.hidden!==!0){var n=e.emit('beforeHide');if(!n.isDefaultPrevented()){if(e.resizer)t.window.off('resize',e.resizer),e.resizer=null;if(e.drager)e.drager.dispose(),e.drager=null;if(e.hideAnimation(),e.mask)e.hideMaskAnimation();if(e.hidden=!0,e.emit('afterHide'),e.disposeOnHide)e.dispose();}}},refresh:function(){var e=this,t=arguments[0];if(!t||e.positionOnResize){var i=e.element,o=s({element:i,x:e.x,y:e.y,fixed:e.fixed});if(t)e.resizeAnimation(o);else i.css(o);}var r=e.mask;if(r)r.css({width:n.getPageWidth(),height:n.getPageHeight()});},dispose:function(){var e=this;if(o.dispose(e),!e.hidden)e.disposeOnHide=!1,e.hide();var t=e.element,n=e.mask;if(t.off(c),n)n.off(c);if(e.removeOnDispose)if(t.remove(),n)n.remove();e.element=e.mask=null;}},i(e.prototype),e.defaultOptions={x:'50%',y:'50%',modal:!0,fixed:!0,hidden:!1,draggable:!0,scrollable:!0,removeOnEmpty:!0,disposeOnHide:!0,removeOnDispose:!0,hideOnClickMask:!1,positionOnResize:!0,draggableClass:'draggable',draggableHandleSelector:'.dialog-header',draggableCancelSelector:['.dialog-header h1','.dialog-close'],headerSelector:'.dialog-header',titleSelector:'.dialog-header h1',closeSelector:'.dialog-close',bodySelector:'.dialog-body',template:'<div class="dialog"><i class="dialog-close">&times;</i><div class="dialog-header"><h1></h1></div><div class="dialog-body"></div></div>',maskTemplate:'<div class="dialog-mask"></div>',showAnimation:function(){this.element.show();},hideAnimation:function(){this.element.hide();},showMaskAnimation:function(){this.mask.show();},hideMaskAnimation:function(){this.mask.hide();},resizeAnimation:function(e){this.element.css(e);}};{var c='.cobble_ui_dialog';t.html.css('overflow'),t.body.css('overflow');}return e;}),define('cobble/ui/Uploader',['require','exports','module','../helper/AjaxUploader','../helper/FlashUploader'],function(require){'use strict';function e(){return'files'in $('<input type="file" />')[0];}function t(){if(!XMLHttpRequest)return!1;var e=new XMLHttpRequest();return'upload'in e&&'onprogress'in e.upload;}return e()&&t()?require('../helper/AjaxUploader'):require('../helper/FlashUploader');}),define('cobble/util/cookie',['require','exports','module'],function(require,exports){'use strict';function e(e){if(0===e.indexOf('"'))e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');var t={};try{e=decodeURIComponent(e.replace(/\+/g,' ')),$.each(e.split(';'),function(e,n){var i=n.split('='),o=$.trim(i[0]),r=$.trim(i[1]);if(o)t[o]=r;});}catch(n){}return t;}function t(e,t,i){var o=i.expires;if($.isNumeric(o)){var r=o;o=new Date(),o.setTime(o.getTime()+r*n);}document.cookie=[encodeURIComponent(e),'=',encodeURIComponent(t),o?';expires='+o.toUTCString():'',i.path?';path='+i.path:'',i.domain?';domain='+i.domain:'',i.secure?';secure':''].join('');}var n=3600000;exports.get=function(t){var n=e(document.cookie);return'string'===$.type(t)?n[t]:n;},exports.set=function(e,n,i){if($.isPlainObject(e))i=n,n=null;if(i=$.extend({},exports.defaultOptions,i),null===n)$.each(e,function(e,n){t(e,n,i);});else t(e,n,i);},exports.remove=function(e,n){if(null!=e)n=n||{},n.expires=-1,t(e,'',$.extend({},exports.defaultOptions,n));},exports.defaultOptions={path:'/'};}),define('cobble/util/dimension',['require','exports','module','../function/pageScrollTop','../function/pageScrollLeft','../function/pageWidth','../function/pageHeight','../function/viewportWidth','../function/viewportHeight'],function(require,exports){'use strict';var e=require('../function/pageScrollTop'),t=require('../function/pageScrollLeft'),n=require('../function/pageWidth'),i=require('../function/pageHeight'),o=require('../function/viewportWidth'),r=require('../function/viewportHeight');exports.getPageScrollTop=e,exports.getPageScrollLeft=t,exports.getPageWidth=n,exports.getPageHeight=i,exports.getViewportWidth=o,exports.getViewportHeight=r;}),define('cobble/util/etpl',function(){function e(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e;}function t(){this.raw=[],this.length=0;}function n(){return'___'+E++;}function i(e,t){var n=new Function();n.prototype=t.prototype,e.prototype=new n(),e.prototype.constructor=e;}function o(e){return O[e];}function r(e){return'"'+e.replace(/\x5C/g,'\\\\').replace(/"/g,'\\"').replace(/\x0A/g,'\\n').replace(/\x09/g,'\\t').replace(/\x0D/g,'\\r')+'"';}function a(e){return e.replace(/[\^\[\]\$\(\)\{\}\?\*\.\+]/g,function(e){return'\\'+e;});}function s(e){var t=arguments;return e.replace(/\{([0-9]+)\}/g,function(e,n){return t[n-0+1];});}function l(e){return e=e.replace(/^\s*\*/,''),s('gv({0},["{1}"])',r(e),e.replace(/\[['"]?([^'"]+)['"]?\]/g,function(e,t){return'.'+t;}).split('.').join('","'));}function c(e,t,n,i,o,r){for(var a=n.length,s=e.split(t),l=0,c=[],u=0,f=s.length;f>u;u++){var d=s[u];if(u){var p=1;for(l++;;){var h=d.indexOf(n);if(0>h){c.push(l>1&&p?t:'',d);break;}if(l=i?l-1:0,c.push(l>0&&p?t:'',d.slice(0,h),l>0?n:''),d=d.slice(h+a),p=0,0===l)break;}if(0===l)o(c.join('')),r(d),c=[];}else d&&r(d);}if(l>0&&c.length>0)r(t),r(c.join(''));}function u(e,t,n){var i,o=[],a=t.options,s='',f='',d='',p='';if(n)s='ts(',f=')',d=U,p=q,i=a.defaultFilter;return c(e,a.variableOpen,a.variableClose,1,function(e){if(n&&e.indexOf('|')<0&&i)e+='|'+i;var r=e.indexOf('|'),a=(r>0?e.slice(0,r):e).replace(/^\s+/,'').replace(/\s+$/,''),c=r>0?e.slice(r+1):'',h=0===a.indexOf('*'),m=[h?'':s,l(a),h?'':f];if(c){c=u(c,t);for(var v=c.split('|'),g=0,b=v.length;b>g;g++){var y=v[g];if(/^\s*([a-z0-9_-]+)(\((.*)\))?\s*$/i.test(y)){if(m.unshift('fs["'+RegExp.$1+'"]('),RegExp.$3)m.push(',',RegExp.$3);m.push(')');}}}o.push(d,m.join(''),p);},function(e){o.push(d,n?r(e):e,p);}),o.join('');}function f(e,t){this.value=e,this.engine=t;}function d(e,t){this.value=e,this.engine=t,this.children=[],this.cloneProps=[];}function p(e,t){var n=e.stack,i=t?n.find(function(e){return e instanceof t;}):n.bottom();if(i){for(var o;(o=n.top())!==i;){if(!o.autoClose)throw new Error(o.type+' must be closed manually: '+o.value);o.autoClose(e);}i.close(e);}return i;}function h(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(\s*master\s*=\s*([a-z0-9\/_-]+)\s*\))?\s*/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.master=RegExp.$3,this.name=RegExp.$1,d.call(this,e,t),this.blocks={};}function m(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.name=RegExp.$1,d.call(this,e,t),this.cloneProps=['name'];}function v(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*$/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.name=RegExp.$1,d.call(this,e,t),this.cloneProps=['name','state','blocks'],this.blocks={};}function g(e,t){if(!/^\s*([a-z0-9_]+)\s*=([\s\S]*)$/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.name=RegExp.$1,this.expr=RegExp.$2,d.call(this,e,t),this.cloneProps=['name','expr'];}function b(e,t){if(!/^\s*([a-z0-9_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,e,t),this.cloneProps=['name','args'];}function y(e,t){if(!/^\s*([a-z0-9\/_-]+)\s*(\(([\s\S]*)\))?\s*$/i.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.name=RegExp.$1,this.args=RegExp.$3,d.call(this,e,t),this.cloneProps=['name','args'];}function x(e,t){var n=new RegExp(s('^\\s*({0}[\\s\\S]+{1})\\s+as\\s+{0}([0-9a-z_]+){1}\\s*(,\\s*{0}([0-9a-z_]+){1})?\\s*$',a(t.options.variableOpen),a(t.options.variableClose)),'i');if(!n.test(e))throw new Error('Invalid '+this.type+' syntax: '+e);this.list=RegExp.$1,this.item=RegExp.$2,this.index=RegExp.$4,d.call(this,e,t),this.cloneProps=['list','item','index'];}function w(e,t){d.call(this,e,t);}function S(e,t){w.call(this,e,t);}function $(e,t){d.call(this,e,t);}function k(e,t){t.target=e;var n=t.engine,i=e.name;if(n.targets[i])switch(n.options.namingConflict){case'override':n.targets[i]=e,t.targets.push(i);case'ignore':break;default:throw new Error('Target exists: '+i);}else n.targets[i]=e,t.targets.push(i);}function C(e,t){P[e]=t,t.prototype.type=e;}function R(t){this.options={commandOpen:'<!--',commandClose:'-->',commandSyntax:/^\s*(\/)?([a-z]+)\s*(?::([\s\S]*))?$/,variableOpen:'${',variableClose:'}',defaultFilter:'html'},this.config(t),this.targets={},this.filters=e({},A);}function T(e,n){function i(){var e;if(h.length>0&&(e=h.join(''))){var t=new f(e,n);if(t.beforeAdd(u),l.top().addChild(t),h=[],n.options.strip&&u.current instanceof d)t.value=e.replace(/^[\x20\t\r]*\n/,'');u.current=t;}}var o,r=n.options.commandOpen,a=n.options.commandClose,s=n.options.commandSyntax,l=new t(),u={engine:n,targets:[],stack:l,target:null},h=[];return c(e,r,a,0,function(e){var t=s.exec(e);if(t&&(o=P[t[2].toLowerCase()])&&'function'==typeof o){i();var l=u.current;if(n.options.strip&&l instanceof f)l.value=l.value.replace(/\r?\n[\x20\t]*$/,'\n');if(t[1])l=p(u,o);else{if(l=new o(t[3],n),'function'==typeof l.beforeOpen)l.beforeOpen(u);l.open(u);}u.current=l;}else if(!/^\s*\/\//.test(e))h.push(r,e,a);o=null;},function(e){h.push(e);}),i(),p(u),u.targets;}t.prototype={push:function(e){this.raw[this.length++]=e;},pop:function(){if(this.length>0){var e=this.raw[--this.length];return this.raw.length=this.length,e;}},top:function(){return this.raw[this.length-1];},bottom:function(){return this.raw[0];},find:function(e){for(var t=this.length;t--;){var n=this.raw[t];if(e(n))return n;}}};var E=178245,O={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'},A={html:function(e){return e.replace(/[&<>"']/g,o);},url:encodeURIComponent,raw:function(e){return e;}},j='var r="";',U='r+=',q=';',_='return r;';if('undefined'!=typeof navigator&&/msie\s*([0-9]+)/i.test(navigator.userAgent)&&RegExp.$1-0<8)j='var r=[],ri=0;',U='r[ri++]=',_='return r.join("");';f.prototype={getRendererBody:function(){var e=this.value,t=this.engine.options;if(!e||t.strip&&/^\s*$/.test(e))return'';else return u(e,this.engine,1);},clone:function(){return this;}},d.prototype={addChild:function(e){this.children.push(e);},open:function(e){var t=e.stack.top();t&&t.addChild(this),e.stack.push(this);},close:function(e){if(e.stack.top()===this)e.stack.pop();},getRendererBody:function(){for(var e=[],t=this.children,n=0;n<t.length;n++)e.push(t[n].getRendererBody());return e.join('');},clone:function(){for(var e=new this.constructor(this.value,this.engine),t=0,n=this.children.length;n>t;t++)e.addChild(this.children[t].clone());for(var t=0,n=this.cloneProps.length;n>t;t++){var i=this.cloneProps[t];e[i]=this[i];}return e;}};var D='data=data||{};var v={},fs=engine.filters,hg=typeof data.get=="function",gv=function(n,ps){var p=ps[0],d=v[p];if(d==null){if(hg){return data.get(n);}d=data[p];}for(var i=1,l=ps.length;i<l;i++)if(d!=null)d = d[ps[i]];return d;},ts=function(s){if(typeof s==="string"){return s;}if(s==null){s="";}return ""+s;};';i(h,d),i(m,d),i(v,d),i(g,d),i(b,d),i(y,d),i(x,d),i(w,d),i(S,w),i($,w);var N={READING:1,READED:2,APPLIED:3,READY:4};v.prototype.applyMaster=h.prototype.applyMaster=function(e){function t(e){var i=e.children;if(i instanceof Array)for(var o=0,r=i.length;r>o;o++){var a=i[o];if(a instanceof m&&n[a.name])a=i[o]=n[a.name];t(a);}}if(this.state>=N.APPLIED)return 1;var n=this.blocks,i=this.engine.targets[e];if(i&&i.applyMaster(i.master))return this.children=i.clone().children,t(this),this.state=N.APPLIED,1;else return void 0;},h.prototype.isReady=function(){function e(i){for(var o=0,r=i.children.length;r>o;o++){var a=i.children[o];if(a instanceof v){var s=t.targets[a.name];n=n&&s&&s.isReady(t);}else if(a instanceof d)e(a);}}if(this.state>=N.READY)return 1;var t=this.engine,n=1;if(this.applyMaster(this.master))return e(this),n&&(this.state=N.READY),n;else return void 0;},h.prototype.getRenderer=function(){if(this.renderer)return this.renderer;if(this.isReady()){var e=new Function('data','engine',[D,j,this.getRendererBody(),_].join('\n')),t=this.engine;return this.renderer=function(n){return e(n,t);},this.renderer;}return null;},h.prototype.open=function(e){p(e),d.prototype.open.call(this,e),this.state=N.READING,k(this,e);},g.prototype.open=y.prototype.open=function(e){e.stack.top().addChild(this);},m.prototype.open=function(e){d.prototype.open.call(this,e),(e.imp||e.target).blocks[this.name]=this;},S.prototype.open=function(e){var t=new $();t.open(e);var n=p(e,w);n.addChild(this),e.stack.push(this);},$.prototype.open=function(e){var t=p(e,w);t.addChild(this),e.stack.push(this);},v.prototype.open=function(e){this.parent=e.stack.top(),this.target=e.target,d.prototype.open.call(this,e),this.state=N.READING,e.imp=this;},y.prototype.close=g.prototype.close=function(){},v.prototype.close=function(e){d.prototype.close.call(this,e),this.state=N.READED,e.imp=null;},h.prototype.close=function(e){d.prototype.close.call(this,e),this.state=this.master?N.READED:N.APPLIED,e.target=null;},v.prototype.autoClose=function(e){var t=this.parent.children;t.push.apply(t,this.children),this.children.length=0;for(var n in this.blocks)this.target.blocks[n]=this.blocks[n];this.blocks={},this.close(e);},y.prototype.beforeOpen=v.prototype.beforeOpen=g.prototype.beforeOpen=x.prototype.beforeOpen=b.prototype.beforeOpen=m.prototype.beforeOpen=w.prototype.beforeOpen=f.prototype.beforeAdd=function(e){if(!e.stack.bottom()){var t=new h(n(),e.engine);t.open(e);}},v.prototype.getRendererBody=function(){return this.applyMaster(this.name),d.prototype.getRendererBody.call(this);},y.prototype.getRendererBody=function(){return s('{0}engine.render({2},{{3}}){1}',U,q,r(this.name),u(this.args,this.engine).replace(/(^|,)\s*([a-z0-9_]+)\s*=/gi,function(e,t,n){return(t||'')+r(n)+':';}));},g.prototype.getRendererBody=function(){if(this.expr)return s('v[{0}]={1};',r(this.name),u(this.expr,this.engine));else return'';},w.prototype.getRendererBody=function(){return s('if({0}){{1}}',u(this.value,this.engine),d.prototype.getRendererBody.call(this));},$.prototype.getRendererBody=function(){return s('}else{{0}',d.prototype.getRendererBody.call(this));},x.prototype.getRendererBody=function(){return s('var {0}={1};if({0} instanceof Array)for (var {4}=0,{5}={0}.length;{4}<{5};{4}++){v[{2}]={4};v[{3}]={0}[{4}];{6}}else if(typeof {0}==="object")for(var {4} in {0}){v[{2}]={4};v[{3}]={0}[{4}];{6}}',n(),u(this.list,this.engine),r(this.index||n()),r(this.item),n(),n(),d.prototype.getRendererBody.call(this));},b.prototype.getRendererBody=function(){var e=this.args;return s('{2}fs[{5}]((function(){{0}{4}{1}})(){6}){3}',j,_,U,q,d.prototype.getRendererBody.call(this),r(this.name),e?','+u(e,this.engine):'');};var P={};C('target',h),C('block',m),C('import',v),C('use',y),C('var',g),C('for',x),C('if',w),C('elif',S),C('else',$),C('filter',b),R.prototype.config=function(t){e(this.options,t);},R.prototype.compile=R.prototype.parse=function(e){if(e){var t=T(e,this);if(t.length)return this.targets[t[0]].getRenderer();}return new Function('return ""');},R.prototype.getRenderer=function(e){var t=this.targets[e];if(t)return t.getRenderer();else return void 0;},R.prototype.render=function(e,t){var n=this.getRenderer(e);if(n)return n(t);else return'';},R.prototype.addFilter=function(e,t){if('function'==typeof t)this.filters[e]=t;};var F=new R();return F.Engine=R,F;}),define('cobble/util/instance',['require','exports','module'],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body);}),define('cobble/util/json',['require','exports','module'],function(require,exports,module){if('object'!=typeof JSON)JSON={};return function(){'use strict';function f(e){return 10>e?'0'+e:e;}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return'string'==typeof t?t:'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+e+'"';}function str(e,t){var n,i,o,r,a,s=gap,l=t[e];if(l&&'object'==typeof l&&'function'==typeof l.toJSON)l=l.toJSON(e);if('function'==typeof rep)l=rep.call(t,e,l);switch(typeof l){case'string':return quote(l);case'number':return isFinite(l)?String(l):'null';case'boolean':case'null':return String(l);case'object':if(!l)return'null';if(gap+=indent,a=[],'[object Array]'===Object.prototype.toString.apply(l)){for(r=l.length,n=0;r>n;n+=1)a[n]=str(n,l)||'null';return o=0===a.length?'[]':gap?'[\n'+gap+a.join(',\n'+gap)+'\n'+s+']':'['+a.join(',')+']',gap=s,o;}if(rep&&'object'==typeof rep){for(r=rep.length,n=0;r>n;n+=1)if('string'==typeof rep[n])if(i=rep[n],o=str(i,l))a.push(quote(i)+(gap?': ':':')+o);}else for(i in l)if(Object.prototype.hasOwnProperty.call(l,i))if(o=str(i,l))a.push(quote(i)+(gap?': ':':')+o);return o=0===a.length?'{}':gap?'{\n'+gap+a.join(',\n'+gap)+'\n'+s+'}':'{'+a.join(',')+'}',gap=s,o;}}if('function'!=typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();};var cx,escapable,gap,indent,meta,rep;if('function'!=typeof JSON.stringify)escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},JSON.stringify=function(e,t,n){var i;if(gap='',indent='','number'==typeof n)for(i=0;n>i;i+=1)indent+=' ';else if('string'==typeof n)indent=n;if(rep=t,t&&'function'!=typeof t&&('object'!=typeof t||'number'!=typeof t.length))throw new Error('JSON.stringify');return str('',{'':e});};if('function'!=typeof JSON.parse)cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var n,i,o=e[t];if(o&&'object'==typeof o)for(n in o)if(Object.prototype.hasOwnProperty.call(o,n))if(i=walk(o,n),void 0!==i)o[n]=i;else delete o[n];return reviver.call(e,t,o);}var j;if(text=String(text),cx.lastIndex=0,cx.test(text))text=text.replace(cx,function(e){return'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')))return j=eval('('+text+')'),'function'==typeof reviver?walk({'':j},''):j;throw new SyntaxError('JSON.parse');};}(),JSON;}),define('cobble/util/mouse',['require','exports','module'],function(){'use strict';function e(e){return e.originalEvent.changedTouches[0];}var t=document.createElement('div'),n={support:'ontouchend'in t,click:'touchstart',mousedown:'touchstart',mousemove:'touchmove',mouseup:'touchend',pageX:function(t){return e(t).pageX;},pageY:function(t){return e(t).pageY;},clientX:function(t){return e(t).clientX;},clientY:function(t){return e(t).clientY;}},i={support:'onclick'in t,click:'click',mousedown:'mousedown',mousemove:'mousemove',mouseup:'mouseup',pageX:function(e){return e.pageX;},pageY:function(e){return e.pageY;},clientX:function(e){return e.clientX;},clientY:function(e){return e.clientY;}};return t=null,{touch:n,mouse:i};}),define('cobble/util/supload/supload',['require','exports','module','../cookie','../json'],function(require){function e(e){$.extend(this,e),this.init();}function t(){return'_Supload_'+o++;}if(window.Supload===e)return window.Supload;var n=require('../cookie'),i=require('../json');e.prototype={constructor:e,init:function(){var i=t();this.movieName=i;var o=this.element;if('string'===$.type(o))o=document.getElementById(o);var r=this.data||(this.data={});$.each(n.get(),function(e,t){if('undefined'===$.type(r[e]))r[e]=t;});var a=e.createSWF(i,this.flashUrl,this.getFlashVars());o.parentNode.replaceChild(a,o),this.element=a,this.onLog=function(e){console.log(e);},e.instances[i]=this;},getFlashVars:function(){var t=this,n=[];return $.each(['movieName','action','accept','multiple','fileName','data','ignoreError'],function(e,o){var r=t[o];if(null!=r){if($.isPlainObject(r))r=i.stringify(r);else if($.isArray(r))r=r.join(',');n.push(o+'='+encodeURIComponent(r));}}),n.push('projectName='+e.projectName),n.join('&amp;');},getFiles:function(){return this.element.getFiles&&this.element.getFiles()||[];},setAction:function(e){this.element.setAction&&this.element.setAction(e);},setData:function(e){this.element.setData&&this.element.setData(e);},reset:function(){this.element.reset&&this.element.reset();},upload:function(){this.element.upload&&this.element.upload();},cancel:function(){this.element.cancel&&this.element.cancel();},enable:function(){this.element.enable&&this.element.enable();},disable:function(){this.element.disable&&this.element.disable();},dispose:function(){this.element.dispose&&this.element.dispose(),e.instances[this.movieName]=null,window[this.movieName]=null;}},e.projectName='Supload',e.createSWF=function(t,n,i){var o='<object id="'+t+'" class="'+e.projectName.toLowerCase()+'" type="application/x-shockwave-flash" data="'+n+'"><param name="movie" value="'+n+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+i+'" /></object>';return $(o)[0];},e.instances={},e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_SECURITY=1,e.ERROR_IO=2;var o=178245;return window.Supload=e,e;}),define('teacherCenter/netdisk',['require','exports','./netdisk/FileUploadDialog_612b735031','./netdisk/FileMoveDialog_c70d3db142','cobble/ui/Uploader','underscore','common/service_9c322508d3','common/store_a1a35b3dfc','./netdisk/formatFiles_6a8cbc02aa','./netdisk/formatFileSize_fe93900919','./netdisk/formatFileType_0ac2d41d9b','./netdisk/NetdiskTipDialog_20b340ee5e','cobble/ui/Dialog','cobble/form/Validator','cobble/function/pageScrollTop'],function(require,exports){'use strict';function e(e){var t=q.find('.card-header'),n=$('<div class="top-reminder"><div><i class="icon icon-info-circle"></i>'+e+'</div></div>');t.append(n),n.slideDown(200),setTimeout(function(){n.slideUp(200,function(){n.remove();});},2000);}function t(t,n){var i=R.get('storageEnv'),o='none',r=n.length,a=k.findWhere(n,{type:'folder'}),s=k.findWhere(n,{storageEnv:D,type:'folder'});if(i===D)if('move'===t||'rename'===t||'new-folder'===t)return e('不支持该文件夹下的'+F[t]),!1;if(a&&('move'==t||'download'==t))return e('不支持文件夹的'+F[t]),!1;if(s&&('move'===t||'rename'===t||'delete'===t))return e('不支持直播课件文件夹的'+F[t]),!1;if(r>0)if(r>1)o='multiple';else o='single';if(-1==$.inArray(t,P[o])){switch(o){case'none':e('请选择文件');break;case'single':break;case'multiple':e('只能对单个文件\uFF08夹\uFF09'+F[t]);}return!1;}else return!0;}function n(e){return k.map(e,function(e){var t=$(e).closest('tr');return{path:t.data('path'),name:t.data('name'),size:E(t.data('size')),type:O(t.data('type')),el:t,shareCourses:t.data('share-courses')?t.data('share-courses'):void 0,storageEnv:t.data('isLive')?D:_};});}function i(e,t){switch(e){case'download':u(t);break;case'move':new w({files:t,onSuccess:function(){f();}});break;case'rename':o(t[0],'rename');break;case'delete':l(t);break;case'new-folder':o({name:'',path:R.get('path'),type:'folder',el:a()},'new-folder'),$('html,body').animate({scrollTop:0},1000,'easeOutCirc');}}function o(e,t){var n=e.el.prop('offsetTop')+q.find('#netdisk-table table').prop('offsetTop')+11,i='folder'==e.type,o=e.el.find('.name').text();b.css('top',n),b[0].reset(),b.off('.edit').show(),b.find('input').off('.edit').val(i?o:e.name).data('orgin',i?o:e.name).data('file',e).focus();var a;if('rename'==t)a=r;else if('new-folder'==t)a=s;b.on('submit.edit',a).find('input').on('blur.edit',a);}function r(e){e.stopPropagation();var t=b.find('input'),n=t.val(),i=t.data('file');if(''!=n&&n!=t.data('orgin')){if(!N.validate())return!1;C.netdiskRename({path:i.path,rename:n}).done(function(e){if(0===e.code)b.hide(),f();});}else b.hide();return!1;}function a(){var e=$('<tr data-path="'+R.get('path')+'"><td class="left"><label><input type="checkbox"><i class="icon icon-file-folder small"></i><span class="name"></span></label></td><td></td><td></td></tr>');return q.find('#netdisk-table tbody').prepend(e),e;}function s(e){if(e.stopPropagation(),''==n)b.hide(),i.el.remove();else{if(!N.validate())return!1;var t=b.find('input'),n=t.val(),i=t.data('file');C.netdiskCreateDir({path:i.path+n+'/'}).done(function(e){if(0===e.code)b.hide(),f();});}return!1;}function l(e){var t=[],n=k.map(e,function(e){if(e.shareCourses){var n=e.shareCourses.split(',');t=t.concat(n);}return e.path;});if(n=n.join(','),t=k.uniq(t),t.length>0)return void alert({title:'温馨提示',width:450,content:'该文件已被'+t.length+'门课程共享\uFF0C删除将使文件共享失效\uFF0C具体班课为\uFF1A<br>'+t.join('<br>'),buttons:[{text:'确定',type:'primary',handler:function(){var e=this;C.netdiskDelete({paths:n},{errorHandler:{810002:function(){alert({type:'confirm',content:'文件已在视频课或直播回放使用\uFF0C暂时无法删除'});}}}).done(function(t){if(0===t.code)e.hide(),f();});}},{text:'取消',handler:function(){this.hide();}}]});else c(n);}function c(e){var t=new A({type:'confirm',message:'资料删除后不可恢复\uFF0C确认需要删除吗\uFF1F',onSuccess:function(){C.netdiskDelete({paths:e},{errorHandler:{810002:function(){alert({type:'confirm',content:'文件已在视频课或直播回放使用\uFF0C暂时无法删除'});}}}).done(function(e){if(0===e.code)t.hide(),f();});}});}function u(e){var t=k.map(e,function(e){return e.path;});t=t.join(','),C.netdiskDownload({list:t}).done(function(e){if(0===e.code){var t=e.data.download_url,n=$('<a href="'+t+'" download="'+t+'"></a>').appendTo('body');n[0].click(),n.remove();}});}function f(e,t,n){e=e||R.get('path'),C.netdiskSort({path:e,sortBy:t,direction:n}).done(function(t){if(0===t.code){var n=t.data;m(n.tpl.objects,!0,n.bar_hidden),R.set('path',e),R.set('mode',{type:'path',value:e}),q.find('.tool-bar .new-folder').show();var i=q.find('.card-body');if(i.removeClass('no-result-body empty-body'),!n.objects.length||0==n.objects.length)if(n.bar_hidden)i.addClass('empty-body').find('.empty').html('<div>暂时没有相关视频文件</div>');else i.addClass('empty-body').find('.empty').html('<img src="/asset/img/teacher-center/add-class-course.jpg" ><div>点击左上角的\u201C添加资料\u201D按钮开启你的跟谁学资料库之旅吧</div>');h(n);}});}function d(e,t,n){C.netdiskSort({type:e,sortBy:t,direction:n}).done(function(t){if(0===t.code){m(t.data.tpl.objects,!1,t.data.bar_hidden),R.set('path',null),R.set('mode',{type:'cat',value:e}),q.find('.tool-bar .new-folder').hide();var n=q.find('.card-body');if(n.removeClass('no-result-body empty-body'),!t.data.objects.length||0==t.data.objects.length)n.addClass('no-result-body');h(data);}});}function p(e,t,n){C.netdiskSort({query:e,sortBy:t,direction:n}).done(function(t){if(0===t.code){m(t.data.tpl.objects,!1,t.data.bar_hidden),R.set('path',null),R.set('mode',{type:'search',value:e}),q.find('.tool-bar .new-folder').hide();var n=q.find('.card-body');if(n.removeClass('no-result-body empty-body'),!t.data.objects.length||0==t.data.objects.length)n.addClass('no-result-body');h(data);}});}function h(e){if(e){if(e.is_live_course_ware_path)R.set('storageEnv',D);else R.set('storageEnv',_);g();}}function m(e,t,n){var i=q.find('.table-container').html(e);if(t)v(i);var o=q.find('.tool-bar');if(n)o.hide();else o.show();}function v(e){var t=k.map(e.find('tbody tr'),function(e){var t,e=$(e);if('folder'==e.data('type'))t=e.find('.name').text();else t=e.data('name');return{name:t,type:O(e.data('type'))};});R.set('curFiles',t);}function g(){var e,t,n;C.getUserBasicInfo().done(function(i){if(0===i.code){var o=i.data;n=o.user_number;var r=R.get('storageEnv');if(r===D)e=['jpg','jpeg','png','doc','ppt','docx','pptx','pdf','gif','bmp'],t='/live/document',o={action:'uploadFile',user_number:n};else{if(e=['xml','txt','jpg','jpeg','png','gif','bmp','svg','mp3','wma','wav','mid','m4a','pdf','ps','ai','rar','swf','zip','doc','xls','ppt','docx','xlsx','pptx'],'test'==y)t='/netdisk/upload';else t='http://upload-file.genshuixue.com/netdisk/upload';o={path:R.get('path'),user_number:n};}if(exports.uploader)exports.uploader.dispose();var a=exports.uploader=new S({element:exports.toolbar.find(':file'),multiple:!0,accept:e,action:t,data:o,onFileChange:function(){var n=this.getFiles();if(n=T(n),!k.every(n,function(e){return e.size<=25000000;}))return new A({message:'抱歉\uFF0C目前暂不支持上传超过25MB的文件\uFF0C请重新选择文件'}),void a.reset();var i=R.get('curFiles'),r=[];if(!k.every(n,function(e){var t=k.findWhere(i,{name:e.name,type:e.type});if(t)r.push(t.name);return!t;})){var s='你上传的资料<span class="text-primary">'+r.join(';')+'</span>在当前目录下存在重名文件\uFF08夹\uFF09\uFF0C请修改后再上传';return new A({message:s}),void a.reset();}if(!k.every(n,function(e){return!/[,%]/.test(e.name);}))return new A({message:'请勿上传文件名带有英文逗号\uFF0C百分号的文件'}),void a.reset();if(n.length>0)new x({files:n,outerUploader:a,otherFiles:i,action:t,accept:e,data:o,onAfterHide:function(){f();}});}});}});}var b,y,x=require('./netdisk/FileUploadDialog_612b735031'),w=require('./netdisk/FileMoveDialog_c70d3db142'),S=require('cobble/ui/Uploader'),k=require('underscore'),C=require('common/service_9c322508d3'),R=require('common/store_a1a35b3dfc'),T=require('./netdisk/formatFiles_6a8cbc02aa'),E=require('./netdisk/formatFileSize_fe93900919'),O=require('./netdisk/formatFileType_0ac2d41d9b'),A=require('./netdisk/NetdiskTipDialog_20b340ee5e'),j=(require('cobble/ui/Dialog'),require('cobble/form/Validator')),U=require('cobble/function/pageScrollTop'),q=$('#content'),_='private',D='public',N=new j({element:q.find('#edit-form'),realtime:!1,fields:{name:{custom:function(e){var t=e.val();if(''==t)return!0;var n=R.get('curFiles'),i=e.data('file');if(/[,%]/.test(t))return'请勿输入英文逗号\uFF0C百分号';if(k.findWhere(n,{name:t,type:i.type}))return'该目录已存在重名文件\uFF08夹\uFF09';else return!0;}}}}),P={none:['add','new-folder'],single:['add','download','share','rename','move','delete','new-folder'],multiple:['add','download','share','move','delete','new-folder']},F={rename:'重命名',move:'移动','new-folder':'新建文件夹','delete':'删除',download:'下载'};exports.init=function(){y=R.get('env'),b=q.find('#edit-form');var e=(exports.toolbar=q.find('.tool-bar'),q.find('#netdisk-table')),o=q.find('.card');$(window).scroll(function(){if(U()>=170)o.addClass('fixed-card');else o.removeClass('fixed-card');}),v(e),R.set('mode',{type:'path',value:R.get('path')}),g(),q.on('click','.tool-bar button',function(){var o=$(this).data('action'),r=e.find('tbody :checkbox:checked'),a=n(r);if(t(o,a))i(o,a);}).on('click','.dilatation',function(){if(R.get('isOrgTeacher'))alert({title:'温馨提示',content:'机构老师不可以单独扩容'});}).on('click','#netdisk-table tr .actions .icon',function(){var e=$(this).data('action'),o=n($(this));if(t(e,o))i(e,o);}).on('change','#netdisk-table thead :checkbox',function(){var t=e.find('tbody :checkbox');if(this.checked)t.prop('checked',!0);else t.prop('checked',!1);}).on('click','#netdisk-table .header .path b',function(){var e=$(this).data('path');f(e);}).on('click','#netdisk-table tr .folder-trigger',function(){var e=$(this).closest('tr').data('path');f(e);}).on('click','#netdisk-table .cat b',function(){var e=$(this).data('cat');d(e);}).on('click','#netdisk-table thead .sort',function(){var e=$(this).data('direction');if(!e)e='asc';else if('asc'==e)e='desc';else e='asc';var t=$(this).data('sortby'),n=R.get('mode');switch(n.type){case'path':f(null,t,e);break;case'cat':d(n.value,t,e);break;case'search':p(n.value,t,e);}});var r=q.find('#search-form input'),a=function(e){e.preventDefault();var t=r.val();if(!t)return!1;else return void p(t);};q.on('submit','#search-form',a).on('click','#search-btn',a);};}),define('teacherCenter/netdisk/FileMoveDialog_c70d3db142',['require','exports','cobble/ui/Dialog','cobble/util/etpl','common/service_9c322508d3','underscore'],function(require){'use strict';function e(e,t){var n=e.parentsUntil('.tree','ul').length,i=$(o.compile(l)({folders:t,left:20*n}));if(e.is('.root'))e.append(i);else e.find(' > ul').append(i);}function t(t,n,i){var o=''==n;r.netdiskDir({path:n}).done(function(r){if(0===r.code){var s=r.data,l=s.list,c=[];if(o)c.push({path:s.path,name:'我的资料库',alias:''}),e(t,c);else if(l.length>0)c=a.filter(l,function(e){return/\/$/.test(e.Key);}),c=a.map(c,function(e){return i[e.Key]=!1,i[n]=!0,{path:e.Key,name:e.Name,alias:e.Alias};}),e(t,c);}});}function n(e){$.extend(this,e),this.init();}var i=require('cobble/ui/Dialog'),o=require('cobble/util/etpl'),r=require('common/service_9c322508d3'),a=require('underscore'),s='<div class="header"><i class="icon icon-file-${file.type} small"></i><div><!-- if: ${count} > 1 --><div class="name">${file.name}等${count}个文件</div><!-- else --><div class="name">${file.name}</div><!-- /if --><div class="size">${file.size}</div></div></div><div class="dest"><div class="header">移动到\uFF1A<span class="path-name"></span></div><div class="tree-container"><div class="tree"><ul class="root"></ul></div></div></div><div class="action"><button class="btn-primary new confirm">确认</button><button class="btn-default cancel">取消</button></div>',l='<!-- for: ${folders} as ${folder} --><li><div class="node" data-path="${folder.path}" data-name="${folder.name}" style="padding-left:${left}px" }><i class="trigger icon icon-caret-down"></i><i class="trigger icon icon-caret-right"></i><i class="icon icon-file-folder tiny"></i><!-- if: ${folder.alias} --><span class="name">${folder.alias}</span><!-- else --><span class="name">${folder.name}</span><!-- /if --></div><ul></ul></li><!-- /for -->';return n.prototype={init:function(){var e=this,n={},l='',c=new i({title:'选择存储位置',content:o.compile(s)({file:e.files[0],count:e.files.length}),width:425,skinClass:'file-move-dialog'}),u=c.element.find('.dest .path-name'),f=c.element.find('.tree > ul');t(f,'',n),c.element.on('click','.node',function(){var e=$(this).closest('.node'),i=e.data('path'),o=$(this).closest('li');if(u.text(e.data('name')),u.data('path',e.data('path')),e.toggleClass('expend'),l&&l!=i)f.find('.node[data-path="'+l+'"]').removeClass('active'),f.find('.node[data-path="'+i+'"]').addClass('active');if(l=i,!n[i])t(o,i,n);}).on('click','.confirm',function(){var t=u.data('path'),n=a.map(e.files,function(e){return e.path;});if(n=n.join(','),!t)return void error('请先选择要移动到的文件夹');else return void r.netdiskMove({srcPath:n,destPath:t}).done(function(t){if(0===t.code){if($.isFunction(e.onSuccess))e.onSuccess();c.hide();}});}).on('click','.cancel',function(){c.hide();});}},n;}),define('teacherCenter/netdisk/FileUploadDialog_612b735031',['require','exports','cobble/ui/Dialog','cobble/util/etpl','cobble/ui/Uploader','./formatFiles_6a8cbc02aa','common/store_a1a35b3dfc','./NetdiskTipDialog_20b340ee5e','underscore'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}function t(e,t,n){$.each(e,function(e,i){var o=$(c.compile(g)({file:i}));t.append(o),n[i.name]=o;});}function n(e,t,n){var i='';$.each(v,function(e,t){i+=' '+t.icon;}),e.find('.status').find('.icon').removeClass(i).addClass(v[t].icon).find('+span').text(n?n:v[t].text);}function i(e,t){t.find('.add').addClass('disabled'),e.disable();}function o(e,t){t.find('.add').removeClass('disabled'),e.enable();}function r(e){confirm({title:'温馨提示',content:'你还有资料未上传完成\uFF0C关闭窗口后资料将上传失败</br>确认要关闭窗口吗\uFF1F'}).done(e);}function a(){$(window).on('beforeunload'+m,function(){return'您有未上传完成的文件\uFF0C确定要关闭资料库吗\uFF1F';});}function s(){$(window).off('beforeunload'+m);}var l=require('cobble/ui/Dialog'),c=require('cobble/util/etpl'),u=require('cobble/ui/Uploader'),f=require('./formatFiles_6a8cbc02aa'),d=require('common/store_a1a35b3dfc'),p=require('./NetdiskTipDialog_20b340ee5e'),h=require('underscore'),m='.fileUploadDialog',v={wait:{icon:'icon-clock',text:'等待上传'},error:{icon:'icon-info-circle',text:'上传失败'},success:{icon:'icon-check-circle',text:'上传成功'},progress:{icon:'',text:''}},g='<tr data-name=${file.name}><td class="left"><div class="name"><i class="icon icon-file-${file.type} tiny"></i>${file.name}</div></td><td>${file.sizeStr}</td><td class="status"><i class="icon icon-clock"></i><span>等待上传</span></td><!-- <td><i class="icon icon-upload-cancel"></i></td> --></tr>',b='<table class="table fix-header"><thead><tr><th class="left" width="50%">名称</th><th width="15%">大小</th><th width="15%">状态</th><!--             <th width="10%">操作</th> --></tr></thead></table><div class="table-container"><div class="wrapper"><table class="table"><colgroup><col width="50%"></col><col width="15%"></col><col width="15%"></col><!-- <col width="10%"></col> --></colgroup><tbody><!-- for: ${files} as ${file} -->'+g+'<!-- /for --></tbody></table><div class="progress"></div></div></div><div class="action"><input type="file" name="files" multiple><button class="btn-primary new small add"><i class="icon icon-plus"></i>添加资料</button><span class="hint text-info"><i class="icon icon-info-circle"></i>严禁存储\u3001处理\u3001传输\u3001发布任何涉密\u3001色情\u3001暴力\u3001侵权等违法违规内容</span></div>';return e.prototype={init:function(){var e=this,v={},g=!0,y=!1;a(),e.otherFiles&&$.each(e.otherFiles,function(e,t){v[t.name]={};});var x=new l({title:'添加到当前位置',content:c.compile(b)(),skinClass:'file-upload-dialog',width:642,disposeOnHide:!1,onBeforeHide:function(){if(g)return r(function(){g=!1,x.hide();}),!1;else return e.outerUploader.stop(),C.off(m),C.dispose(),e.outerUploader.off(m),void $(window).off(m);},onAfterHide:e.onAfterHide}),w=x.element,S=w.find('tbody');t(e.files,S,v);var k=w.find('.action'),C=new u({element:w.find('.action :file'),multiple:!0,accept:e.accept,action:e.action,data:e.data,onFileChange:function(){var e=this.getFiles();e=f(e);var n=[];if(!h.every(e,function(e){var t=Boolean(v[e.name]);if(t)n.push(e.name);return!t;})){var o='你上传的资料<span class="text-primary">'+n.join(';')+'</span>在当前目录下存在重名文件\uFF08夹\uFF09\uFF0C请修改后再上传';return new p({message:o}),void C.reset();}if(!h.every(e,function(e){return e.size<=25000000;}))return new p({message:'抱歉\uFF0C目前暂不支持上传超过25MB的文件\uFF0C请重新选择文件'}),void C.reset();if(!h.every(e,function(e){return!/[,%]/.test(e.name);}))return new p({message:'请勿上传文件名带有英文逗号\uFF0C百分号的文件'}),void C.reset();if(e.length>0)t(e,S,v),i(C,k),this.upload(),g=!0,a();},onReady:function(){i(this,k);}}),R=w.find('.progress'),T={error:function(e,t){var i=v[t.fileItem.file.name];n(i,'error'),delete v[t.fileItem.file.name];},uploadStart:function(e,t){var n=v[t.fileItem.file.name],i=n.prop('offsetTop');R.css('top',i),R.show();},uploadProgress:function(e,t){var i=v[t.fileItem.file.name];R.css('width',t.percent),n(i,'progress',t.percent);},success:function(e,t){var i=$.parseJSON(t.responseText),o=v[t.fileItem.file.name];if(0===i.code)n(o,'success');else if(n(o,'error'),delete v[t.fileItem.file.name],'200204'==i.code)y=!0;},complete:function(e){return function(t,n){v[n.fileItem.file.name];R.hide();var i=e.getFiles().length,r=n.fileItem.index;if(r==i-1)if(o(C,k),g=!1,s(),y)if(y=!1,d.get('isOrgTeacher'))alert({title:'温馨提示',content:'亲\uFF0C空间已经占满了\uFF0C删除一些不必要的文件\uFF0C或联系您的机构购买或升级机构会员\uFF0C马上可获得更多空间\u3002',width:400});else new p({type:'dilatation',message:'您的云存储空间不足\uFF0C无法上传视频\u3002<br>请删除一部分无用的文件\uFF0C或者购买更多的云存储空间\u3002',width:450,onSuccess:function(){location.href='/teacher_center/storage_space';}});};}};e.outerUploader.on('uploadError'+m,T.error).on('uploadSuccess'+m,T.success).on('uploadStart'+m,T.uploadStart).on('uploadProgress'+m,T.uploadProgress).on('uploadComplete'+m,T.complete(e.outerUploader)),C.on('uploadError'+m,T.error).on('uploadSuccess'+m,T.success).on('uploadStart'+m,T.uploadStart).on('uploadProgress'+m,T.uploadProgress).on('uploadComplete'+m,T.complete(C)),e.outerUploader.upload();}},e;}),define('teacherCenter/netdisk/NetdiskTipDialog_20b340ee5e',['require','exports','cobble/ui/Dialog'],function(require){'use strict';function e(e){$.extend(this,e),this.init();}var t=require('cobble/ui/Dialog');return e.prototype={init:function(){var e=this,n='<div class="message"><i class="icon icon-info-circle text-info"></i><p>'+e.message+'</p></div>',i='<div class="action"><button class="btn-info cancel">我知道了</button></div>',o='<div class="action"><button class="btn-info confirm">确认</button><button class="btn-default cancel">取消</button></div>',r='<div class="action"><button class="btn-primary dilatation">购买空间</button><button class="btn-default cancel">取消</button></div>';if('confirm'==e.type)n+=o;else if('dilatation'==e.type)n+=r;else n+=i;var a=e.dialog=new t({title:'温馨提示',content:n,width:e.width||400,skinClass:'netdisk-tip-dialog'});a.element.on('click','.action .cancel',function(){a.hide();}).on('click','.action .confirm',function(){if(a.hide(),$.isFunction(e.onSuccess))e.onSuccess();}).on('click','.action .dilatation',function(){if(a.hide(),$.isFunction(e.onSuccess))e.onSuccess();});},hide:function(){this.dialog.hide();}},e;}),define('teacherCenter/netdisk/formatFileSize_fe93900919',['require','exports','cobble/function/divide'],function(require){'use strict';function e(e){var n;if(1024>e)n='B';else if(e<Math.pow(1024,2))e=t(e,1024),n='KB';else if(e<Math.pow(1024,3))e=t(e,Math.pow(1024,2)),n='MB';else e=t(e,Math.pow(1024,3)),n='GB';return e.toFixed(1)+n;}var t=require('cobble/function/divide');return e;}),define('teacherCenter/netdisk/formatFileType_0ac2d41d9b',['require','exports'],function(){'use strict';function e(e){if(-1!=$.inArray(e,t))return e;else return'other';}var t=['folder','other','txt','zip','rar','doc','docx','ppt','pptx','xls','xlsx','pdf','jpg','png','mp4','avi','flv','mkv','mp3','wav','all'];return e;}),define('teacherCenter/netdisk/formatFiles_6a8cbc02aa',['require','exports','./formatFileSize_fe93900919','./formatFileType_0ac2d41d9b'],function(require){'use strict';function e(e){return $.map(e,function(e){return{name:e.file.name,sizeStr:t(e.file.size),size:e.file.size,type:n(e.file.type)};});}var t=require('./formatFileSize_fe93900919'),n=require('./formatFileType_0ac2d41d9b');return e;});