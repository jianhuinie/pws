define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return i.init(this,e);}function t(e,t){if(e.length>0){var r=e[0].element;if(r.is(':hidden'))r=r.parent();var n=r.offset().top;if(t>0)n-=t;window.scrollTo(window.scrollX,n);}}function r(e){var t=$.Deferred();return $.when.apply($,e).done(function(){t.resolve(arguments);}),t;}var n=require('../function/jquerify'),i=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var t=this,r=t.element,n='FORM'===r.prop('tagName')?r:r.find('form');if(n.length>0)n.attr('novalidate','novalidate').on('submit'+a,$.proxy(t.validate,t));$.each(t.fields,function(t,n){var i=r.find('[name="'+t+'"]'),a=n.type;if(!a)a=n.type=i.attr('type')||'text';var u=n.rules;if(!u)u=n.rules={};var s=e.type[a]||[];$.each(s,function(e,t){if(null==u[t]){var r=o[t];if($.isFunction(r))u[t]=r(i,n);}});});var i=t.groupSelector;if(r.on('focusin'+a,function(e){var r=$(e.target).closest(i),n=[t.successClass,t.errorClass,t.requiredClass].join(' ');r.removeClass($.trim(n));}),t.realtime)r.on('focusout'+a,function(e){var r=$(e.target),n=r.prop('name');if(!n)r=r.find('[name]'),n=r.prop('name');if(n)t.validate(n);});},validate:function(e,n){var i=this,o=i.emit('beforeValidate');if(!o.isDefaultPrevented()){var a,u=i.element,s=i.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))a=$.map(e,function(e){return u.find('[name="'+e+'"]').closest(s);});else if(a=u.find(s),'boolean'===$.type(e))n=e;var l=[],f=[];$.each(a,function(e,t){var r=i.validateGroup($(t));if(r){if(r.promise)f.push(r),r=r.data;$.merge(l,r);}});var e=[],c=[],d=function(){if($.each(l,function(t,r){if(r.error)c.push(r);e.push(r.element.prop('name'));}),n)t(c,i.scrollGap);i.emit('afterValidate',{fields:e,errors:c});};if(f.length>0)return r(f).done(d);else return d(),0===c.length;}},validateGroup:function(t){if(t.is(':visible')){var n=this,i=[],o=[],a=[];if(t.find('[name]').each(function(t){var r,u,s=this,l=s.name,f=s.value,c=s.disabled,d=$(s);if(!c){var p=n.fields[l];if(p){r=!0,p=$.extend(!0,{},p),p.form=n.element,p.value=$.trim(f);var m;if($.each(e.type[p.type]||[],function(t,r){var n=e.rule[r](p);if(n===!1)return m=r,!1;else if(''===p.value&&'required'===r)return!1;}),m){var v=p.errors;if(v)u=v[m];if(!u)throw new Error(l+' 字段 '+m+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var h=$.Deferred(),g=p.custom(d,function(e){h.resolve(e);});u=null==g||g.done?h:g;}}}if(r)if(t=i.push({element:d,error:u}),u&&u.promise)o.push(u),a.push(t-1);}),o.length>0){var u=r(o).done(function(e){$.each(e,function(e,t){i[a[e]].error=t;}),n.refreshGroup(t,i);});return u.data=i,u;}else return n.refreshGroup(t,i),i;}},refreshGroup:function(e,t){var r=this,n=r.successClass,i=r.errorClass;$.each(t,function(t,o){var a,u=o.element,s=o.error,l=r.errorSelector;if(l)a=e.find(l).eq(t);if(s&&'string'===$.type(s)){if(e.removeClass(n).addClass(i),a){var f=r.renderTemplate;if($.isFunction(f))s=f({text:s},r.errorTemplate);a.html(s).show();var c=r.errorPlacement;if($.isFunction(c))c(u,a);}}else if(o.error='',e.removeClass(i).addClass(n),a)a.html('').hide();});},dispose:function(){var e=this;i.dispose(e),e.element.off(a),e.element=null;}},n(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,t){return t.replace(/\${(\w+)}/g,function(t,r){return e[r]||'';});},errorPlacement:function(e,t){if('hidden'===e.prop('type'))e=e.parent();t.css({position:'static',width:'auto'});var r=t.outerWidth(!0)+5;t.css({position:'absolute',width:r});var n=e.parent();if(n.is('.placeholder-wrapper'))e=n;var i=e.position();t.css({left:i.left+e.outerWidth()-37,top:i.top-t.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var t=e.rules.pattern;if(t)return t.test(e.value);else return void 0;},minlength:function(e){var t=e.rules.minlength;if($.isNumeric(t))return e.value.length>=+t;else return void 0;},maxlength:function(e){var t=e.rules.maxlength;if($.isNumeric(t))return e.value.length<=+t;else return void 0;},min:function(e){var t=e.rules.min;if($.isNumeric(t))return e.value>=+t;else return void 0;},max:function(e){var t=e.rules.max;if($.isNumeric(t))return e.value<=+t;else return void 0;},step:function(e){var t=e.rules.step;if($.isNumeric(t)){var r=e.rules.min||1;return(e.value-r)%t===0;}},equals:function(e){var t=e.rules.equals;if(t){var r=e.form.find('[name="'+t+'"]');return e.value===$.trim(r.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var o={required:function(e){return'required'===e.attr('required');},pattern:function(t,r){var n=t.attr('pattern')||e.pattern[r.type];if('string'===$.type(n))n=new RegExp(n);return n;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},a='.cobble_form_validator';return e;}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,r={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(r,n){var i=this,o=e(i);if(o){if(!r[$.expando])r='string'===$.type(r)?$.Event(r):$.Event(null,r);r.cobble=i;var a=[r];if(n)a.push(n);var u=i[$.camelCase('on-'+r.type)];if($.isFunction(u)&&u.apply(i,a)===!1)r.preventDefault();if(!r.isPropagationStopped())t.trigger.apply(o,a);return r;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(r,function(t,r){if(null==e[t])e[t]=r;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var r=e.constructor,n='__cobble__'+r.prototype.type,i=t.element;if(i&&i.data(n))e=i.data(n);else if($.extend(e,r.defaultOptions,t),e.init(),i)i.data(n,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,r=e.element;if(r)r.removeData(t);};}),define('common/center/account/password_d33971cd56',['require','exports','cobble/form/Validator','common/component/CodeButton_edf3c78096','common/component/SaveButton_b1f301d041','common/service_9c322508d3'],function(require,exports){'use strict';var e=require('cobble/form/Validator'),t=require('common/component/CodeButton_edf3c78096'),r=require('common/component/SaveButton_b1f301d041'),n=require('common/service_9c322508d3'),i={old_password:{errors:{required:'请输入当前登录密码'}},password:{errors:{required:'请输入新密码',minlength:'请输入6-20位密码',maxlength:'请输入6-20位密码'},custom:function(e){var t=e.val(),r=/\d/,n=/[a-z]/i,i=/[~!@#$%^&*()_+-=[]{}';:",.<>]/;if(!r.test(t)&&!n.test(t)||!r.test(t)&&!i.test(t)||!n.test(t)&&!i.test(t))return'密码必须包含字母数字或符号\uFF0C至少两种字符';else return'';}},password_confirm:{errors:{required:'请再次确认密码',equals:'两次输入的密码不相同'}}};exports.init=function(){{var o=$('#content .item-password'),a=o.find('#form-password'),u=new e({element:a,fields:i});new t({element:a.find('#password-send'),send:function(){var e='mobile';if(u.validate(e)){var t=$.trim(a.find('[name="'+e+'"]').val());return n.validateMobile({mobile:t}).done(function(e){if(0===e.code)return n.getSMSCode({mobile:t}).done(function(e){if(0===e.code)success('校验码发送成功\uFF0C请注意查收');});else return void 0;});}}}),new r({element:a.find('#password-submit'),save:function(){var e=this.element,t=e.closest('.item-body');if(u.validate()){var r=a.find('input[name="old_password"]').val(),i=a.find('input[name="password"]').val(),o=a.find('input[name="password_confirm"]').val();return n.saveNewpwd({old_password:r,password:i,password_confirm:o}).done(function(e){if(0===e.code)success('登录密码修改成功'),t.hide(),a[0].reset();});}}});}};}),define('common/component/CodeButton_edf3c78096',['require'],function(){'use strict';function e(e){$.extend(this,e),this.init();}return e.prototype={init:function(){var e=this,t=e.element;e.isCounting=!1,e.origin=t.html();var r=function(){e.sendCode();};if(e.container)e.container.on('click',function(e){if(e.target===t[0])r();});else t.click(r);},countDown:function(e){var t=this,r=this.element;t.isCounting=!0;var n=function(e){if(r.html(e+' 秒后再次发送'),$.isFunction(t.onTextChange))t.onTextChange();};r.prop('disabled',!0),t.timer=setInterval(function(){if(e--,e>0)n(e);else t.reset();},1000),n(e);},reset:function(){var e=this;e.isCounting=!1;var t=e.element;if(clearInterval(e.timer),t.html(e.origin),t.prop('disabled',!1),$.isFunction(e.onTextChange))e.onTextChange();if($.isFunction(e.onFinish))e.onFinish();},dispose:function(){if(this.element.off(),this.timer)clearInterval(this.timer);},sendCode:function(){var e=this,t=e.element;t.prop('disabled',!0);var r=e.send();if(r)r.done(function(r){if(0===r.code)e.countDown(60);else t.prop('disabled',!1);});else t.prop('disabled',!1);return r;}},e;}),define('common/component/SaveButton_b1f301d041',['require'],function(){'use strict';function e(e){$.extend(this,e),this.init();}return e.prototype={init:function(){var e=this,t=e.element,r=t.html();if('BUTTON'!==t.prop('tagName'))throw new Error('SaveButton 必须使用 button 标签');var n=function(){var n=e.save();if(n)t.focus(),t.prop('disabled',!0),t.html(e.saveText||'正在保存...'),n.always(function(){setTimeout(function(){t.prop('disabled',!1),t.html(r);},10);});return!1;};if(t.click(n),e.form)e.form.submit(function(){return n(),!1;});}},e;});