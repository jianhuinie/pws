define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var t=$.prototype,i={on:function(){return t.on.apply(e(this),arguments),this;},off:function(){return t.off.apply(e(this),arguments),this;},emit:function(i,o){var n=this,a=e(n);if(a){if(!i[$.expando])i='string'===$.type(i)?$.Event(i):$.Event(null,i);i.cobble=n;var r=[i];if(o)r.push(o);var s=n[$.camelCase('on-'+i.type)];if($.isFunction(s)&&s.apply(n,r)===!1)i.preventDefault();if(!i.isPropagationStopped())t.trigger.apply(a,r);return i;}},before:function(t){e(this).before(t);},after:function(t){e(this).after(t);},appendTo:function(t){e(this).appendTo(t);},prependTo:function(t){e(this).prependTo(t);}};return function(e){$.each(i,function(t,i){if(null==e[t])e[t]=i;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,t){var i=e.constructor,o='__cobble__'+i.prototype.type,n=t.element;if(n&&n.data(o))e=n.data(o);else if($.extend(e,i.defaultOptions,t),e.init(),n)n.data(o,e);return e;},exports.dispose=function(e){var t='__cobble__'+e.constructor.prototype.type,i=e.element;if(i)i.removeData(t);};}),define('cobble/helper/AjaxUploader',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return u.init(this,e);}function t(e,t){var i=new FormData();$.each(e.data,function(e,t){i.append(e,t);}),i.append(e.fileName,t.nativeFile),t.xhr.send(i);}function i(t,i){var o=i.nativeFile,n=i.file.size,a=i.chunk;if(!a)a=i.chunk={index:0,uploaded:0};var r=a.index,s=t.chunkSize,l=s*r,u=s*(r+1);if(u>n)u=n;if(a.uploading=u-l,a.uploading<=0)return void setTimeout(function(){t.emit('uploadError',{fileItem:i,errorCode:e.ERROR_CHUNK_SIZE});});var p='bytes '+(l+1)+'-'+u+'/'+n,c=i.xhr;c.setRequestHeader('Content-Type',''),c.setRequestHeader('X_FILENAME',encodeURIComponent(o.name)),c.setRequestHeader('Content-Range',p),c.send(o.slice(l,u));}function o(t,i){var o=i.xhr;if(o)$.each(d,function(e,t){o['on'+t.type]=null;}),$.each(f,function(e,t){o.upload['on'+t.type]=null;}),delete i.xhr;if(t.emit('uploadComplete',{fileItem:i}),i.status===e.STATUS_UPLOAD_SUCCESS||i.status===e.STATUS_UPLOAD_ERROR&&t.ignoreError){var a=i.index+1;if(a<t.fileQueue.files.length)t.fileQueue.index=a,t.upload();else n(t,[]);}}function n(t,i){var o=t.fileQueue;o.index=0,o.files=$.map(i,function(t,i){return{index:i,file:s(t),nativeFile:t,status:e.STATUS_WAITING};});}function a(e){var t=e.fileQueue,i=t.index;if(t.files&&'number'===$.type(i))return t.files[i];else return void 0;}function r(e){var t=[];return $.each(e,function(e,i){if(c[i])t.push(c[i]);}),$.unique(t).join(',');}function s(e){var t=e.name,i=t.split('.'),o=i.length>0?i.pop().toLowerCase():'';return{name:t,type:o,size:e.size};}var l=require('../function/jquerify'),u=require('../function/lifeCycle');e.prototype={constructor:e,type:'AjaxUploader',init:function(){var e=this;e.fileQueue={};var t=e.element;if(!t.is(':file'))throw new Error('AjaxUploader element must be <input type="file" />');var i=e.faker=$('<form></form>');t.replaceWith(i),i.append(t);var o={};if(e.accept)o.accept=r(e.accept);if(e.multiple)o.multiple=!0;t.prop(o),t.on('change'+p,function(){n(e,t.prop('files')),e.emit('fileChange');}),e.emit('ready');},getFiles:function(){return this.fileQueue.files||[];},setAction:function(e){this.action=e;},setData:function(e){$.extend(this.data,e);},reset:function(){this.faker[0].reset();},upload:function(o){var n=this,r=n.useChunk?e.STATUS_UPLOADING:e.STATUS_WAITING;if(o=o||a(n),o&&!(o.status>r)){var s=new XMLHttpRequest();if(n.xhrProps)$.extend(s,n.xhrProps);o.xhr=s,$.each(d,function(e,t){s['on'+t.type]=function(e){t.handler(n,e);};}),$.each(f,function(e,t){s.upload['on'+t.type]=function(e){t.handler(n,e);};}),s.open('post',n.action,!0);var l=n.useChunk?i:t;l(n,o);}},stop:function(){var t=this,i=a(t);if(i&&i.status===e.STATUS_UPLOADING)i.xhr.abort();t.reset();},enable:function(){this.element.prop('disabled',!1);},disable:function(){this.element.prop('disabled',!0);},dispose:function(){var e=this;u.dispose(e),e.stop(),e.element.off(p),e.faker=e.element=e.fileQueue=null;}},l(e.prototype),e.defaultOptions={data:{},multiple:!1,fileName:'Filedata',ignoreError:!1},e.supportChunk='undefined'!=typeof FileReader,e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_CHUNK_SIZE=-1;var p='.cobble_helper_ajaxuploader',c={html:'text/html',htm:'text/html',shtml:'text/html',xml:'text/xml',css:'text/css',js:'application/x-javascript',json:'application/json',atom:'application/atom+xml',rss:'application/rss+xml',mml:'text/mathml',txt:'text/plain',jad:'text/vnd.sun.j2me.app-descriptor',wml:'text/vnd.wap.wml',htc:'text/x-component',jpg:'image/jpeg',jpeg:'image/jpeg',png:'image/png',gif:'image/gif',tif:'image/tiff',tiff:'image/tiff',wbmp:'image/vnd.wap.wbmp',ico:'image/x-icon',jng:'image/x-jng',bmp:'image/x-ms-bmp',svg:'image/svg+xml',svgz:'image/svg+xml',webp:'image/webp',mp3:'audio/mpeg',wma:'audio/x-ms-wma',wav:'audio/x-wav',mid:'audio/midi',midd:'audio/midi',kar:'audio/midi',ogg:'audio/ogg',m4a:'audio/x-m4a',ra:'audio/x-realaudio',ram:'audio/x-pn-realaudio',mod:'audio/mod','3gp':'video/3gpp','3gpp':'video/3gpp',mp4:'video/mp4',mpeg:'video/mpeg',mpg:'video/mpeg',mov:'video/quicktime',webm:'video/webm',flv:'video/x-flv',m4v:'video/x-m4v',mng:'video/x-mng',asx:'video/x-ms-asf',asf:'video/x-ms-asf',wmv:'video/x-ms-wmv',avi:'video/x-msvideo',rm:'video/vnd.rn-realvideo',rmvb:'video/vnd.rn-realvideo',ts:'video/MP2T',dv:'video/x-dv',mkv:'video/x-matroska',jar:'application/java-archive',war:'application/java-archive',ear:'application/java-archive',hqx:'application/mac-binhex40',pdf:'application/pdf',ps:'application/postscript',eps:'application/postscript',ai:'application/postscript',rtf:'application/rtf',wmlc:'application/vnd.wap.wmlc',kml:'application/vnd.google-earth.kml+xml',kmz:'application/vnd.google-earth.kmz','7z':'application/x-7z-compressed',cco:'application/x-cocoa',jardiff:'application/x-java-archive-diff',jnlp:'application/x-java-jnlp-file',run:'application/x-makeself',pl:'application/x-perl',pm:'application/x-perl',prc:'application/x-pilot',pdb:'application/x-pilot',rar:'application/x-rar-compressed',rpm:'application/x-redhat-package-manager',sea:'application/x-sea',swf:'application/x-shockwave-flash',sit:'application/x-stuffit',tcl:'application/x-tcl',tk:'application/x-tcl',der:'application/x-x509-ca-cert',pem:'application/x-x509-ca-cert',crt:'application/x-x509-ca-cert',xpi:'application/x-xpinstall',xhtml:'application/xhtml+xml',zip:'application/zip',bin:'application/octet-stream',exe:'application/octet-stream',dll:'application/octet-stream',deb:'application/octet-stream',dmg:'application/octet-stream',eot:'application/octet-stream',iso:'application/octet-stream',img:'application/octet-stream',msi:'application/octet-stream',msp:'application/octet-stream',msm:'application/octet-stream',doc:'application/msword',xls:'application/vnd.ms-excel',ppt:'application/vnd.ms-powerpoint',docx:'application/vnd.openxmlformats-officedocument.wordprocessingml.document',xlsx:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',pptx:'application/vnd.openxmlformats-officedocument.presentationml.presentation'},d={uploadStart:{type:'loadstart',handler:function(t){var i=a(t);i.status=e.STATUS_UPLOADING,t.emit('uploadStart',{fileItem:i});}},uploadSuccess:{type:'load',handler:function(t,i){var n=a(t),r={fileItem:n,responseText:n.xhr.responseText},s=n.chunk;if(s){var l=s.uploaded;if(l<n.file.size){var i=t.emit('chunkUploadSuccess',r);if(!i.isDefaultPrevented())if(s.index++,s.uploaded=l+s.uploading,s.uploaded<n.file.size)t.upload();else return n.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',r),void o(t,n);return;}}n.status=e.STATUS_UPLOAD_SUCCESS,t.emit('uploadSuccess',r),o(t,n);}},uploadError:{type:'error',handler:function(t,i,n){var r=a(t);r.status=e.STATUS_UPLOAD_ERROR,t.emit('uploadError',{fileItem:r,errorCode:n}),o(t,r);}},uploadStop:{type:'abort',handler:function(t,i){d.uploadError.handler(t,i,e.ERROR_CANCEL);}}},f={uploadProgress:{type:'progress',handler:function(e,t){var i=a(e),o=i.file.size,n=t.loaded,r=i.chunk;if(r)n+=r.uploaded;var s=n/(o||1);if(s>=0&&1>=s);else if(0>s)s=0;else if(s>1)s=1;s=parseInt(100*s,10)+'%',e.emit('uploadProgress',{fileItem:i,uploaded:n,total:o,percent:s});}}};return e;}),define('cobble/helper/FlashUploader',['require','exports','module','../util/supload/supload','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return o.init(this,e);}require('../util/supload/supload');var t=window.Supload,i=require('../function/jquerify'),o=require('../function/lifeCycle');e.prototype={constructor:e,type:'FlashUploader',init:function(){var e=this,i={flashUrl:e.flashUrl,element:e.element[0],action:e.action,accept:e.accept,multiple:e.multiple,data:e.data,fileName:e.fileName,ignoreError:e.ignoreError,customSettings:{uploader:e}};$.each(n,function(e,t){e=$.camelCase('on-'+e),i[e]=t;}),e.supload=new t(i);},getFiles:function(){return this.supload.getFiles();},setAction:function(e){this.supload.setAction(e);},setData:function(e){this.supload.setData(e);},reset:function(){this.supload.reset();},upload:function(){this.supload.upload();},stop:function(){this.supload.cancel();},enable:function(){this.supload.enable();},disable:function(){this.supload.disable();},dispose:function(){var e=this;o.dispose(e),e.supload.dispose(),e.supload=e.element=null;}},i(e.prototype),e.defaultOptions={multiple:!1,fileName:'Filedata',ignoreError:!1,flashUrl:require.toUrl('../util/supload/supload.swf')},e.STATUS_WAITING=t.STATUS_WAITING,e.STATUS_UPLOADING=t.STATUS_UPLOADING,e.STATUS_UPLOAD_SUCCESS=t.STATUS_UPLOAD_SUCCESS,e.STATUS_UPLOAD_ERROR=t.STATUS_UPLOAD_ERROR,e.ERROR_CANCEL=t.ERROR_CANCEL,e.ERROR_SECURITY=t.ERROR_SECURITY,e.ERROR_IO=t.ERROR_IO;var n={ready:function(){var e=this.customSettings.uploader;e.emit('ready');},fileChange:function(){var e=this.customSettings.uploader;e.emit('fileChange');},uploadStart:function(e){var t=this.customSettings.uploader;t.emit('uploadStart',e);},uploadProgress:function(e){var t=this.customSettings.uploader,i=e.uploaded/(e.total||1);if(i>=0&&1>=i);else i=0;e.percent=parseInt(100*i,10)+'%',t.emit('uploadProgress',e);},uploadSuccess:function(e){var t=this.customSettings.uploader;t.emit('uploadSuccess',e);},uploadError:function(e){var t=this.customSettings.uploader;t.emit('uploadError',e);},uploadComplete:function(e){var t=this.customSettings.uploader;t.emit('uploadComplete',e);}};return e;}),define('cobble/ui/Uploader',['require','exports','module','../helper/AjaxUploader','../helper/FlashUploader'],function(require){'use strict';function e(){return'files'in $('<input type="file" />')[0];}function t(){if(!XMLHttpRequest)return!1;var e=new XMLHttpRequest();return'upload'in e&&'onprogress'in e.upload;}return e()&&t()?require('../helper/AjaxUploader'):require('../helper/FlashUploader');}),define('cobble/util/cookie',['require','exports','module'],function(require,exports){'use strict';function e(e){if(0===e.indexOf('"'))e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');var t={};try{e=decodeURIComponent(e.replace(/\+/g,' ')),$.each(e.split(';'),function(e,i){var o=i.split('='),n=$.trim(o[0]),a=$.trim(o[1]);if(n)t[n]=a;});}catch(i){}return t;}function t(e,t,o){var n=o.expires;if($.isNumeric(n)){var a=n;n=new Date(),n.setTime(n.getTime()+a*i);}document.cookie=[encodeURIComponent(e),'=',encodeURIComponent(t),n?';expires='+n.toUTCString():'',o.path?';path='+o.path:'',o.domain?';domain='+o.domain:'',o.secure?';secure':''].join('');}var i=3600000;exports.get=function(t){var i=e(document.cookie);return'string'===$.type(t)?i[t]:i;},exports.set=function(e,i,o){if($.isPlainObject(e))o=i,i=null;if(o=$.extend({},exports.defaultOptions,o),null===i)$.each(e,function(e,i){t(e,i,o);});else t(e,i,o);},exports.remove=function(e,i){if(null!=e)i=i||{},i.expires=-1,t(e,'',$.extend({},exports.defaultOptions,i));},exports.defaultOptions={path:'/'};}),define('cobble/util/json',['require','exports','module'],function(require,exports,module){if('object'!=typeof JSON)JSON={};return function(){'use strict';function f(e){return 10>e?'0'+e:e;}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return'string'==typeof t?t:'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+e+'"';}function str(e,t){var i,o,n,a,r,s=gap,l=t[e];if(l&&'object'==typeof l&&'function'==typeof l.toJSON)l=l.toJSON(e);if('function'==typeof rep)l=rep.call(t,e,l);switch(typeof l){case'string':return quote(l);case'number':return isFinite(l)?String(l):'null';case'boolean':case'null':return String(l);case'object':if(!l)return'null';if(gap+=indent,r=[],'[object Array]'===Object.prototype.toString.apply(l)){for(a=l.length,i=0;a>i;i+=1)r[i]=str(i,l)||'null';return n=0===r.length?'[]':gap?'[\n'+gap+r.join(',\n'+gap)+'\n'+s+']':'['+r.join(',')+']',gap=s,n;}if(rep&&'object'==typeof rep){for(a=rep.length,i=0;a>i;i+=1)if('string'==typeof rep[i])if(o=rep[i],n=str(o,l))r.push(quote(o)+(gap?': ':':')+n);}else for(o in l)if(Object.prototype.hasOwnProperty.call(l,o))if(n=str(o,l))r.push(quote(o)+(gap?': ':':')+n);return n=0===r.length?'{}':gap?'{\n'+gap+r.join(',\n'+gap)+'\n'+s+'}':'{'+r.join(',')+'}',gap=s,n;}}if('function'!=typeof Date.prototype.toJSON)Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();};var cx,escapable,gap,indent,meta,rep;if('function'!=typeof JSON.stringify)escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},JSON.stringify=function(e,t,i){var o;if(gap='',indent='','number'==typeof i)for(o=0;i>o;o+=1)indent+=' ';else if('string'==typeof i)indent=i;if(rep=t,t&&'function'!=typeof t&&('object'!=typeof t||'number'!=typeof t.length))throw new Error('JSON.stringify');return str('',{'':e});};if('function'!=typeof JSON.parse)cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var i,o,n=e[t];if(n&&'object'==typeof n)for(i in n)if(Object.prototype.hasOwnProperty.call(n,i))if(o=walk(n,i),void 0!==o)n[i]=o;else delete n[i];return reviver.call(e,t,n);}var j;if(text=String(text),cx.lastIndex=0,cx.test(text))text=text.replace(cx,function(e){return'\\u'+('0000'+e.charCodeAt(0).toString(16)).slice(-4);});if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')))return j=eval('('+text+')'),'function'==typeof reviver?walk({'':j},''):j;throw new SyntaxError('JSON.parse');};}(),JSON;}),define('cobble/util/localStorage',['require','exports','module'],function(require,exports){'use strict';function e(e,t){if($.isPlainObject(e))$.each(e,function(e,t){exports.set(e,t);});else try{localStorage[e]=t;}catch(i){}}function t(e){var t='';try{t=localStorage[e];}catch(i){}return t;}function i(e){try{localStorage.removeItem(e);}catch(t){}}if(localStorage)exports.set=e,exports.get=t,exports.remove=i;else exports.set=exports.get=exports.remove=$.noop;}),define('cobble/util/supload/supload',['require','exports','module','../cookie','../json'],function(require){function e(e){$.extend(this,e),this.init();}function t(){return'_Supload_'+n++;}if(window.Supload===e)return window.Supload;var i=require('../cookie'),o=require('../json');e.prototype={constructor:e,init:function(){var o=t();this.movieName=o;var n=this.element;if('string'===$.type(n))n=document.getElementById(n);var a=this.data||(this.data={});$.each(i.get(),function(e,t){if('undefined'===$.type(a[e]))a[e]=t;});var r=e.createSWF(o,this.flashUrl,this.getFlashVars());n.parentNode.replaceChild(r,n),this.element=r,this.onLog=function(e){console.log(e);},e.instances[o]=this;},getFlashVars:function(){var t=this,i=[];return $.each(['movieName','action','accept','multiple','fileName','data','ignoreError'],function(e,n){var a=t[n];if(null!=a){if($.isPlainObject(a))a=o.stringify(a);else if($.isArray(a))a=a.join(',');i.push(n+'='+encodeURIComponent(a));}}),i.push('projectName='+e.projectName),i.join('&amp;');},getFiles:function(){return this.element.getFiles&&this.element.getFiles()||[];},setAction:function(e){this.element.setAction&&this.element.setAction(e);},setData:function(e){this.element.setData&&this.element.setData(e);},reset:function(){this.element.reset&&this.element.reset();},upload:function(){this.element.upload&&this.element.upload();},cancel:function(){this.element.cancel&&this.element.cancel();},enable:function(){this.element.enable&&this.element.enable();},disable:function(){this.element.disable&&this.element.disable();},dispose:function(){this.element.dispose&&this.element.dispose(),e.instances[this.movieName]=null,window[this.movieName]=null;}},e.projectName='Supload',e.createSWF=function(t,i,o){var n='<object id="'+t+'" class="'+e.projectName.toLowerCase()+'" type="application/x-shockwave-flash" data="'+i+'"><param name="movie" value="'+i+'" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="flashvars" value="'+o+'" /></object>';return $(n)[0];},e.instances={},e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_SECURITY=1,e.ERROR_IO=2;var n=178245;return window.Supload=e,e;}),define('common/component/UploadVideoCourse',['require','exports','cobble/util/localStorage','cobble/ui/Uploader','common/service_9c322508d3','common/store_a1a35b3dfc','common/component/VideoVod_02c356ba9d'],function(require){'use strict';function e(e){return decodeURIComponent(e.name)+'_'+e.size;}function t(e){$.extend(this,e),this.init();}function i(){var e=!0,t=$('.video-upload');if(t.find('.icon-info-circle').each(function(t,i){if(!$(i).hasClass('pass'))e=!1;}),e)t.parent().find('.wrong-title').addClass('pass').hide();}var o=require('cobble/util/localStorage'),n=require('cobble/ui/Uploader'),a=require('common/service_9c322508d3'),r=require('common/store_a1a35b3dfc'),s=require('common/component/VideoVod_02c356ba9d'),l=0,u=1048576,p={FlashUploader:{value:200*u,text:'你的浏览器最大支持上传 200M 的视频\uFF0C可使用 <a href="http://www.baidu.com/s?wd=Chrome%20%E6%B5%8F%E8%A7%88%E5%99%A8" target="_blank">Chrome 浏览器</a> 获得 2G 超大文件上传体验\uFF01'},AjaxUploader:{value:2048*u,text:'上传的视频不能超过 2G'}},c=['wmv','avi','dat','asf','rm','rmvb','ram','mpg','mpeg','3gp','mov','mp4','m4v','dvix','dv','mkv','flv','vob','qt','divx','cpk','fli','flc','mod'];return t.prototype={init:function(){var t=this,d=t.element,f=t.uploadQueue,m=t.queueIndex,v=$('<input type="file" />');d.append(v),t.videoProgress=d.parent().prev(),t.fileItem=null,t.uploadId=null,t.videoId=null,t.testMax=6,t.testCount=0,t.testTimer,t.useChunk=n.supportChunk,t.chunkSize=5*u,t.failCount=0,t.resumeFlag=!1,t.uploader=new n({element:v,multiple:!1,useChunk:t.useChunk,chunkSize:t.chunkSize,onFileChange:function(){if(t.fileItem=t.uploader.getFiles()[0],t.fileItem){t.failCount=0;var i,n=t.fileItem.file,s=$.inArray(n.type,c);if(-1===s)i='文件格式错误\uFF0C请上传 '+c.join('\u3001')+' 等格式的视频';else if(n.size>p[t.uploader.type].value)i=p[t.uploader.type].text;if(i)return alert({content:i,width:300}),void t.uploader.reset();var l=$('.video-upload').find('li'),u=!1;if(l.each(function(e,t){var i=$(t);if(!i.hasClass('add-lesson-video')){var o=i.data('filename');if(o==n.name)alert('不能上传重复文件\uFF01'),u=!0;}}),!u){var d=0;for(var v in f)d++;if(d>=10)return void alert('上传和排队中的视频总数不能超过10个\uFF01');var h={fileName:n.name,fileSize:n.size};if(f[m]=t,d>0){var g='<div class="progress-bar"><span class="txt">排队中</span><div class="progress-box"><div class="progress-status"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>';return t.videoProgress.html(g),void t.element.hide();}if(t.useChunk){var x=o.get(e(n));if(x&&x.split('|')[2]&&new Date().getTime()-x.split('|')[2]<86400000)return h.videoId=x.split('|')[1],void t.resumeUpload(h);else h.chunk=!0;}h.userNumber=r.get('number'),a.getVideoCourseUploadUrl(h,{errorHandler:{200204:function(){confirm({title:'温馨提示',content:'您的云存储空间不足\uFF0C无法上传视频\u3002<br>请删除一部分无用的文件\uFF0C或者购买更多的云存储空间\u3002',width:450,buttons:[{text:'购买空间',type:'primary',handler:function(){this.hide(),location.href='/teacher_center/storage_space';}},{text:'取消',handler:function(){this.hide(),delete t.uploadQueue[t.queueIndex];}}]});}}}).done(function(e){if(0===e.code){var i=e.data;t.toUploadStatus({id:i.id,url:i.upload_url});}});}}},onUploadStart:t.useChunk?function(i,n){var a=n.fileItem,u=a.file,p=a.chunk.index;if(!u.size)p=0,t.uploader.stop();if(o.set(e(u),p+'|'+t.uploadId+'|'+new Date().getTime()),!u.size)return void alert('上传失败\uFF0C请重新上传~');var c=r.get('report');if(t.videoVod=new s({user_number:c.user_number,user_role:c.user_role,video_id:t.uploadId,client:c.client,app:c.app,version:c.version}),l=new Date().getTime(),t.videoProgress.html().indexOf('上传中')<0){var d='';d='<div class="progress-bar"><span class="txt">上传中</span><div class="progress-box"><div class="progress-status" style="width:0%;"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>',t.videoProgress.html(d);}}:null,onUploadProgress:function(e,i){if(!t.videoProgress.find('.percent')[0]){var o='';o='<div class="progress-bar"><span class="txt">上传中</span><div class="progress-box"><div class="progress-status" style="width:0%;"></div></div><span class="percent">0%</span></div><a class="cancel-upload">取消上传</a>',t.videoProgress.html(o);}var n=t.videoProgress.find('.percent'),a=t.videoProgress.find('.progress-status');n.html(i.percent),a.width(i.percent);},onUploadSuccess:function(){if(t.videoId=t.uploadId,t.useChunk)o.remove(e(t.fileItem.file));var n='<span class="status"><i class="icon icon-check-circle"></i>上传成功</span><span class="title">'+(t.fileItem.file.name.length>13?t.fileItem.file.name.substr(0,13)+'...':t.fileItem.file.name)+'</span><a class="del">删除</a>';t.videoProgress.html(n);var s={},u=t.element.parent().parent();u.data('videoid',t.videoId),u.data('filename',t.fileItem.file.name),u.data('filesize',t.fileItem.file.size),s.userNumber=r.get('user').number,s.number=r.get('number'),s.sectionId=u.data('sectionid')?u.data('sectionid'):'',s.videoId=t.videoId,s.name=u.find('.section-title span').text(),s.fileName=u.data('filename'),s.index=u.index()+1,s.payStatus=r.get('price')?u.find(':radio:eq(0)').prop('checked')?2:3:1,s.type=1,a.setVideoCourseSection(s).done(function(e){if(0===e.code){if(u.data('sectionid',e.data.section_id),u.data('terror')&&u.data('cerror'))if(u.hasClass('tpass'))u.find('.icon-info-circle').addClass('pass').hide(),i();else u.addClass('cpass');else if(u.data('cerror'))u.find('.icon-info-circle').addClass('pass').hide(),i();if(!t.resumeFlag)t.videoVod.send(8,t.fileItem.file.size,new Date().getTime()-l);}}),t.element.hide(),delete t.uploadQueue[t.queueIndex];var p=0,c=100000;for(var d in f)if(p++,parseInt(d)<c)c=parseInt(d);if(p>0){var m=f[c],s={fileName:m.fileItem.file.name,fileSize:m.fileItem.file.size};m.startQueueUpload(s);}},onChunkUploadSuccess:function(e,i){var o=i.fileItem,n=$.parseJSON(i.responseText);if(!n)return void(t.failCount=0);if(!n.code)if(e.preventDefault(),t.failCount++,t.failCount<4)setTimeout(function(){t.uploader.upload(o);},500);else alert('上传失败'),t.videoVod.send(9);else t.failCount=0;}});},startQueueUpload:function(t){var i=this,n=i.fileItem.file;if(i.useChunk){var s=o.get(e(n));if(s&&s.split('|')[2]&&new Date().getTime()-s.split('|')[2]<86400000)return t.videoId=s.split('|')[1],void i.resumeUpload(t);else t.chunk=!0;}t.userNumber=r.get('number'),a.getVideoCourseUploadUrl(t,{errorHandler:{200204:function(){confirm({title:'温馨提示',content:'您的云存储空间不足\uFF0C无法上传视频\u3002<br>请删除一部分无用的文件\uFF0C或者购买更多的云存储空间\u3002',width:450,buttons:[{text:'购买空间',type:'primary',handler:function(){this.hide(),location.href='/teacher_center/storage_space';}},{text:'取消',handler:function(){this.hide(),delete i.uploadQueue[i.queueIndex];}}]});}}}).done(function(e){if(0===e.code){var t=e.data;i.toUploadStatus({id:t.id,url:t.upload_url});}});},toUploadStatus:function(e){var t=this;t.uploadId=e.id,t.videoId=null;var i=e.url;t.uploader.setAction(i),t.uploader.upload(t.fileItem),t.element.attr('disabled',!0);var o=t.videoProgress.find('.txt');if(o[0])o.html('上传中');},resumeUpload:function(e){var t=this;t.resumeFlag=!0;var e={userNumber:r.get('user').number,videoId:e.videoId};a.getVideoCourseResumeUploadUrl(e).done(function(i){if(0===i.code){var o=i.data,n=o.upload_size||0,a=parseInt(n/t.chunkSize,10);t.fileItem.chunk={index:a,uploaded:n},t.toUploadStatus({id:o.id,url:o.upload_url});}else{if(0===t.testCount)t.toWaitResumeUploadStatus();if(t.testCount++,t.testCount<t.testMax)t.testTimer=setTimeout(function(){t.resumeUpload(e);},10000);else alert('续传失败,请重新上传'),t.cancelResumeUpload();}});},toWaitResumeUploadStatus:function(){var e=this,t='<span class="status">正在尝试断点续传\uFF0C请稍等...</span><a class="cancel-resume">取消续传</a>';e.videoProgress.html(t),e.element.hide();},cancelResumeUpload:function(){var t=this;if(t.testTimer)clearTimeout(t.testTimer),t.testTimer=null;o.remove(e(t.fileItem.file));}},t;}),define('common/component/VideoVod_02c356ba9d',['require','common/store_a1a35b3dfc'],function(require){'use strict';function e(t){$.extend(this,e.defaultOptions,t),this.init();}var t=require('common/store_a1a35b3dfc'),i='video_vod',o='',n='',a=WAT.getCookie('__guid__'),r='',s='',l='',u='',p='',c='',d='',f='',m='32891392',v={},h='';if(v.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),v.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),v.opera=/opera/.test(navigator.userAgent.toLowerCase()),v.msie=/msie/.test(navigator.userAgent.toLowerCase()),v.safari=/safari/.test(navigator.userAgent.toLowerCase()),v.opera)h=1;else if(v.msie)h=2;else if(v.webkit)h=3;else if(v.safari)h=4;else if(v.mozilla)h=5;return e.prototype={init:function(){var e=this,i=t.get('env');if('dev'==i||'test'==i)m='32891152';else if('beta'==i||'www'==i)m='32891392';o=e.user_number,n=e.user_role,r=e.video_type,s=e.video_id,l=e.client,u=e.app,p=e.cdn,h=e.browser,c=e.net,d=e.resolution,f=e.version;},send:function(t,p,v,g,x){var S=(e.prototype,{type:i,user_number:o,user_role:n,info:t,guid:a,video_type:r,video_id:s,client:l,app:u,cdn:p,browser:h,net:c,resolution:e.getResolution?e.getResolution():d,version:f,partner_id:m,_timestamp:Date.now()});if(1==t);else if(2==t)S.buffer_time=v;else if(4==t)S.error_code=v;else if(5==t);else if(6==t)S.play_time=v,S.buffer_num=g,S.pause_time=x;else if(7==t)S.buffer_time=v;else if(8==t)S.file_size=v,S.file_time=g;else if(9==t);WAT.send(WAT.toUrl('pb0.genshuixue.com','/gs.gif'),S);}},e.defaultOptions={type:'video_vod',user_number:'',user_role:'',info:'',guid:WAT.getCookie('__guid__'),video_type:'',video_id:'',client:'',app:0,cdn:'',browser:h,net:'',resolution:'',version:'',partner_id:m,_timestamp:$.now()},e;});