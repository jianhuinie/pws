define("cobble/form/Select",["require","exports","module","../ui/ComboBox","../function/jquerify","../function/lifeCycle"],function(require){"use strict";function e(e){return i.init(this,e)}var t=require("../ui/ComboBox"),n=require("../function/jquerify"),i=require("../function/lifeCycle");return e.prototype={constructor:e,type:"Select",init:function(){var e=this,n=e.element,i='<input type="hidden" name="'+e.name+'"';if(null!=e.value)i+=' value="'+e.value+'"';if(n.attr("required"))i+=" required";i+=" />";var o=e.input=$(i);n.append(o),e.comboBox=new t({element:n,button:n.find(e.buttonSelector),menu:n.find(e.menuSelector),data:e.data,value:e.value,show:e.show,hide:e.hide,defaultText:e.defaultText,template:e.template,renderTemplate:e.renderTemplate,activeClass:e.activeClass,openClass:e.openClass,setText:$.proxy(e.setText,e),onChange:function(t,n){if(e.setValue(n.value),!e.silence)e.emit("change",n)},onAfterShow:function(){n.trigger("focusin")},onAfterHide:function(){n.trigger("focusout")}})},disable:function(){var e=this,t=e.element;t.find(e.buttonSelector).prop("disabled",!0)},enable:function(){var e=this,t=e.element;t.find(e.buttonSelector).prop("disabled",!1)},getValue:function(){return this.value},setValue:function(e,t){var n=this;if(t=t||{},t.force||e!=n.value)n.value=e,n.input.val(null==e?"":e),n.silence=t.silence,n.comboBox.setValue(e),delete n.silence},refresh:function(e){this.comboBox.refresh(e)},dispose:function(){var e=this;i.dispose(e),e.comboBox.dispose(),e.input=e.element=e.comboBox=null}},n(e.prototype),e.defaultOptions={defaultText:"请选择",buttonSelector:".btn-default",menuSelector:".dropdown-menu",labelSelector:".btn-default span",activeClass:"active",openClass:"open",renderTemplate:function(e){var t=[];return $.each(e,function(e,n){var i=[];$.each(n,function(e,t){if("text"!==e&&null!=t)i.push("data-"+e+'="'+t+'"')}),t.push("<li "+i.join(" ")+">"+n.text+"</li>")}),t.join("")},setText:function(e){this.element.find(this.labelSelector).html(e)}},e}),define("cobble/function/contains",["require","exports","module"],function(){"use strict";return function(e,t){if(e=e.jquery?e[0]:e,t=t.jquery?t[0]:t,!e||!t)return!1;if(e===t)return!0;else return $.contains(e,t)}}),define("cobble/function/isHidden",["require","exports","module"],function(){"use strict";return function(e){e.css("display");return"none"===e.css("display")||0==e.css("opacity")||"hidden"===e.css("visibility")}}),define("cobble/function/jquerify",["require","exports","module"],function(){"use strict";function e(e){return e.faker||e.element}var t=$.prototype,n={on:function(){return t.on.apply(e(this),arguments),this},off:function(){return t.off.apply(e(this),arguments),this},emit:function(n,i){var o=this,r=e(o);if(r){if(!n[$.expando])n="string"===$.type(n)?$.Event(n):$.Event(null,n);n.cobble=o;var u=[n];if(i)u.push(i);var a=o[$.camelCase("on-"+n.type)];if($.isFunction(a)&&a.apply(o,u)===!1)n.preventDefault();if(!n.isPropagationStopped())t.trigger.apply(r,u);return n}},before:function(t){e(this).before(t)},after:function(t){e(this).after(t)},appendTo:function(t){e(this).appendTo(t)},prependTo:function(t){e(this).prependTo(t)}};return function(e){$.each(n,function(t,n){if(null==e[t])e[t]=n})}}),define("cobble/function/lifeCycle",["require","exports"],function(require,exports){"use strict";exports.init=function(e,t){var n=e.constructor,i="__cobble__"+n.prototype.type,o=t.element;if(o&&o.data(i))e=o.data(i);else if($.extend(e,n.defaultOptions,t),e.init(),o)o.data(i,e);return e},exports.dispose=function(e){var t="__cobble__"+e.constructor.prototype.type,n=e.element;if(n)n.removeData(t)}}),define("cobble/function/split",["require","exports","module"],function(){"use strict";return function(e,t){var n=[];return $.each(e.split(t),function(e,t){if(t=$.trim(t))n.push(t)}),n}}),define("cobble/helper/Popup",["require","exports","module","../function/split","../function/isHidden","../function/contains","../function/jquerify","../function/lifeCycle","../util/instance"],function(require){"use strict";function e(e){return C.init(this,e)}function t(e,t){$.each(e.showConfigList,function(n,i){i[t](e)})}function n(e,t){$.each(e.hideConfigList,function(n,i){i[t](e)})}function i(e,t){if(e)e.type=t;else e=t;return e}function o(e){var t=e.currentTarget;return t&&"HTML"===t.tagName?null:t}function r(e,t){return e.emit(i(t,"beforeShow"))}function u(e,i){return e.layer.data(F,o(i)),t(e,"off"),n(e,"on"),e.emit("afterShow")}function a(e,t){return e.emit(i(t,"beforeHide"))}function f(e){return e.layer.removeData(F),n(e,"off"),t(e,"on"),e.emit("afterHide")}function l(){return $.now()}function c(e){return"__"+e+"Handler__"}function s(e,t){return null==e[t]}function d(e,t){return e.layer.data(F)!==o(t)}function p(e,t,n){return!t||t(e,n)}function h(e,t){return t-e[Y]>50}function m(t,n){return function(i){var o=i.data,r=l(i);if(s(o,q)&&d(o,i)&&p(o,n,i))o[Y]=r,y({popup:o,delay:o.show.delay,toggle:e.trigger.show[t].delay,timer:q,success:function(){var e=function(){o.open(i)},t=o[S];if(t)t.done(e);else e()}})}}function v(t,n){return function(i){var o=i.data,r=l(i);if(s(o,k)&&p(o,n,i)&&h(o,r))o[Y]=r,o[S]=$.Deferred(),y({popup:o,delay:o.hide.delay,toggle:e.trigger.hide[t].delay,timer:k,success:function(){o.close(i),o[S].resolve()},fail:function(){o[S]=null}})}}function y(e){var t=e.delay,n=e.success;if(t>0){var i=e.popup,o=e.timer,r=e.toggle||{},u=r.on||$.noop,a=r.off||$.noop,f=e.fail||$.noop,l=function(){clearTimeout(i[o]),a(i,c),i[o]=null},c=function(e){var t=i[o];if(t)l();if(t&&e===Y)n();else f()};u(i,c),i[o]=setTimeout(function(){c(Y)},t)}else n()}function g(e){var t=this,n=t.type,i=t.handler,o=c(n);if(e[o]!==i)e.element.on(n,e.selector,e,i),e[o]=i}function b(e){var t=this;if(!e.selector){var n=t.type;e.element.off(n,t.handler),e[c(n)]=null}}var x=require("../function/split"),D=require("../function/isHidden"),T=require("../function/contains"),w=require("../function/jquerify"),C=require("../function/lifeCycle"),_=require("../util/instance");e.prototype={constructor:e,type:"Popup",init:function(){var i=this,o=i.showConfigList=[],r=i.hideConfigList=[],u=i.show.trigger,a=i.hide.trigger;if(u)$.each(x(u,","),function(t,n){var i=e.trigger.show[n];if(i)o.push(i)});if(a)$.each(x(i.hide.trigger,","),function(t,n){var i=e.trigger.hide[n];if(i)r.push(i)});if(i.hidden=D(i.layer))t(i,"on");else n(i,"on")},open:function(){var e=this,t=arguments[0];if(!t)e[Y]=l();if(t=r(e,t),!t.isDefaultPrevented()){var n=e.layer,i=e.show.animation;if($.isFunction(i))i.call(e,n);else n.show();e.hidden=!1,u(e,t)}},close:function(){var e=this;if(!e.hidden){var t=arguments[0];if(!t)e[Y]=l();if(t=a(e,t),!t.isDefaultPrevented()){var n=e.layer,i=e.hide.animation;if($.isFunction(i))i.call(e,n);else n.hide();e.hidden=!0,f(e)}}},dispose:function(){var e=this;C.dispose(e),e.close(),t(e,"off"),e.element=e.layer=null}},w(e.prototype),e.defaultOptions={show:{trigger:"click"},hide:{trigger:"click"}};var S="__hidePromise__",q="__showTimer__",k="__hideTimer__",Y="__lastTriggerTime__",F="__sourceElement__",H=function(e,t){if(!t)return!1;else return T(e.layer,t)};return e.trigger={show:{focus:{type:"focusin",handler:m("focus"),on:g,off:b},click:{type:"click",handler:m("click"),on:g,off:b},over:{type:"mouseenter",handler:m("over"),on:g,off:b,delay:{on:function(e,t){e.element.on("mouseleave",e.selector,t)},off:function(e,t){e.element.off("mouseleave",t)}}},context:{type:"contextmenu",handler:m("context"),on:g,off:b}},hide:{blur:{type:"focusout",handler:v("blur"),on:g,off:b},click:{type:"click",handler:function(){return v(this.type,function(e,t){return!H(e,t.target)})},on:function(e){var t=this;_.document.on(t.type,e,e.clickHandler=t.handler())},off:function(e){_.document.off(this.type,e.clickHandler)}},out:{type:"mouseleave",handler:v("out"),on:function(e){var t=this.type,n=this.handler;e.layer.on(t,e,n),e.element.on(t,e.selector,e,n)},off:function(e){var t=this.type,n=this.handler;e.element.off(t,n),e.layer.off(t,n)},delay:{on:function(e,t){e.element.on("mouseenter",e.selector,t),e.layer.on("mouseenter",t)},off:function(e,t){e.element.off("mouseenter",t),e.layer.off("mouseenter",t)}}},context:{type:"contextmenu",handler:function(){return v("context",function(e,t){return!H(e,t.target)})},on:function(e){var t=this;_.document.on(t.type,e,e.contextHandler=t.handler())},off:function(e){_.document.off(this.type,e.contextHandler)}}}},e}),define("cobble/ui/ComboBox",["require","exports","module","../function/jquerify","../function/lifeCycle","../helper/Popup"],function(require){"use strict";function e(e){return n.init(this,e)}var t=require("../function/jquerify"),n=require("../function/lifeCycle"),i=require("../helper/Popup");e.prototype={constructor:e,type:"ComboBox",init:function(){var e=this,t=e.button,n=e.menu,r=e.element||t,u=e.openClass,a=e.show,f=e.hide,l=a.animation;if($.isFunction(l))a.animation=$.proxy(l,e);if(l=f.animation,$.isFunction(l))f.animation=$.proxy(l,e);if(e.popup=new i({element:t,layer:n,show:a,hide:f,onBeforeShow:function(t){e.emit(t)},onBeforeHide:function(t){e.emit(t)},onAfterShow:function(t){if(u)r.addClass(u);e.emit(t)},onAfterHide:function(t){if(u)r.removeClass(u);e.emit(t)}}),null==e.value){var c=n.find("."+e.activeClass);if(1===c.length)e.value=c.data("value")}if(e.data)n.html(e.renderTemplate(e.data,e.template));if(null!=e.value)e.setValue(e.value,{force:!0,silence:!0});n.on("click"+o,"[data-value]",function(){e.setValue($(this).data("value")),e.close()})},getValue:function(){return this.value},setValue:function(e,t){var n,i=this,o=i.menu,r=o.find('[data-value="'+e+'"]');if(1===r.length){if(n=r.data(),null==n.text)n.text=r.html()}else n={};if(t=t||{},t.force||e!=i.value){var u=i.activeClass;if(u)o.find("."+u).removeClass(u);if(1===r.length){if(i.value=e,u)r.addClass(u)}else i.value=null;if(!t.silence)i.emit("change",n)}if($.isFunction(i.setText))i.setText(n.text||i.defaultText)},refresh:function(e){var t=this,n=t.value,i={};if(e){var o=e.data;if(o)t.menu.html(t.renderTemplate(o,t.template));if("value"in e)n=e.value,i.force=!0}t.setValue(n,i)},open:function(){this.popup.open()},close:function(){this.popup.close()},dispose:function(){var e=this;n.dispose(e),e.menu.off(o),e.popup.dispose(),e.popup=e.element=e.button=e.menu=null}},t(e.prototype),e.defaultOptions={show:{trigger:"click"},hide:{trigger:"click"}};var o=".cobble_ui_combobox";return e}),define("cobble/util/date",["require","exports","module"],function(require,exports){"use strict";exports.parse=function(e,t,n){var i=!1;if($.isNumeric(e)&&$.isNumeric(t)&&$.isNumeric(n))i=!0;else if(1===arguments.length)if(i=!0,$.isPlainObject(e))n=e.date,t=e.month,e=e.year;else if("string"===$.type(e)){var o=e.split("-");e=o[0],t=o[1],n=o[2]}if(i)if(t>=1&&12>=t&&n>=1&&31>=n)return new Date(e,t-1,n)},exports.stringify=function(e){if("number"===$.type(e))e=new Date(e);var t=e.getFullYear(),n=e.getMonth()+1,e=e.getDate();if(10>n)n="0"+n;if(10>e)e="0"+e;return[t,n,e].join("-")},exports.simplify=function(e){if("number"===$.type(e))e=new Date(e);return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),day:e.getDay()}},exports.getWeekFirstDay=function(e,t){if("number"===$.type(e))e=new Date(e);var n=e.getDay();return n=n>=t?n:n+7,new Date(e.getTime()-(n-t)*exports.DAY)},exports.getWeekLastDay=function(e,t){return e=exports.getWeekFirstDay(e,t),e.setTime(e.getTime()+6*exports.DAY),e},exports.getMonthFirstDay=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e},exports.getMonthLastDay=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e.setMonth(e.getMonth()+1),e.setDate(0),e},exports.prevMonth=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e.setTime(e.getTime()-exports.WEEK),e},exports.nextMonth=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(28),e.setTime(e.getTime()+exports.WEEK),e},exports.prevWeek=function(e){return exports.subtract(e,7)},exports.nextWeek=function(e){return exports.add(e,7)},exports.add=function(e,t){if("date"===$.type(e))e=e.getTime();return new Date(e+t*exports.DAY)},exports.subtract=function(e,t){if("date"===$.type(e))e=e.getTime();return new Date(e-t*exports.DAY)},exports.DAY=864e5,exports.WEEK=7*exports.DAY}),define("cobble/util/instance",["require","exports","module"],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body)}),define("common/component/DateSelect",["require","cobble/form/Select","cobble/util/date"],function(require){"use strict";function e(t){$.extend(this,e.defaultOptions,t),this.init()}function t(e,t){if(e.setValue(null),null!=t)e.setValue(t)}function n(e,t,n){var i=[];if(n)i.push({text:"至今",value:-1});for(var o=t;o>=e;o--)i.push({text:o,value:o});return i}function i(){for(var e=[],t=1;12>=t;t++)e.push({text:t,value:t});return e}function o(e,t){for(var n=u.parse({year:e,month:t,date:1}),i=u.getMonthLastDay(n),o=i.getDate(),r=[],a=1;o>=a;a++)r.push({text:a,value:a});return r}var r=require("cobble/form/Select"),u=require("cobble/util/date");return e.prototype={init:function(){var e=this,t=this.element,u=e.prefix||"",a=e.defaultYearText||"- 年 -",f=e.defaultMonthText||"- 月 -",l=e.defaultDateText||"- 日 -",c=e.yearSelect=new r({element:t.find(".year"),defaultText:a,name:u+"year",onChange:function(){if(s.refresh({data:i(),value:e.month}),$.isFunction(e.onYearChange))e.onYearChange()}}),s=e.monthSelect=new r({element:t.find(".month"),defaultText:f,name:u+"month",onChange:function(){var t=c.getValue(),n=s.getValue(),i=n?o(t,n):[];if(d.refresh({data:i,value:e.date}),$.isFunction(e.onMonthChange))e.onMonthChange()}}),d=e.dateSelect=new r({element:t.find(".date"),defaultText:l,name:"date",onChange:function(){if($.isFunction(e.onDateChange))e.onDateChange()}});c.refresh({data:n(e.startYear,e.endYear,e.sofar)}),e.refresh()},refresh:function(e){var n=this;if(e)$.extend(n,e);t(n.dateSelect,n.date),t(n.monthSelect,n.month),t(n.yearSelect,n.year)}},e.defaultOptions={startYear:1914,endYear:2016},e.createYearData=n,e.createMonthData=i,e.createDateData=o,e});