define('course/detail/combo',['require','exports','common/store_a1a35b3dfc'],function(require,exports){'use strict';function e(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t);}function t(e,t){for(var n,o,i=e.data('discounts'),c=0,a=0,s=i.length;s>a;a++)if(i[a].course_amount==t){if(i[a].discount_ratio)return{discount:i[a].discount_ratio,type:'ratio'};else if(i[a].discount_point)return{discount:i[a].discount_point,type:'point'};}else if(i[a].course_amount<t)if(c<i[a].course_amount)if(c=i[a].course_amount,i[a].discount_ratio)n=i[a].discount_ratio,o='ratio';else if(i[a].discount_point)n=i[a].discount_point,o='point';return{discount:n,type:o};}function n(n){var o=n.find('.course-list'),c=(n.find('.course-more'),n.find('.combo-compute')),a=Number(i.get('price')),s=a,r=1,u=1;if(o.find('.course-item').each(function(e,t){var n=$(t).find(':checkbox');if(n.prop('checked'))a+=Number(n.val()),r++;}),u=t(n,r),'ratio'==u.type)s=s*u.discount/100,s=e(s,2),o.find('.course-item').each(function(t,n){var o=$(n).find(':checkbox');if(o.prop('checked')){var i=Number(o.val())*u.discount/100;s+=e(i,2);}});else if('point'==u.type)if(s=a-u.discount/100,0>s)s=0;c.find('.total-price em').text(e(s,2)),c.find('.ori-price em').text(e(a,2)),c.find('.save-price em').text(e(a-s,2));}function o(e){var t=e.closest('.tab-panel'),n=t.find('.course-more'),o=n.find('.icon-angle-up'),i=n.find('.icon-angle-down');if(0===e.prev('.item-group').length)o.addClass('disable');else o.removeClass('disable');if(0===e.next('.item-group').length)i.addClass('disable');else i.removeClass('disable');}var i=require('common/store_a1a35b3dfc'),c=$('#combo');exports.init=function(){c.on('click','.tab-nav b',function(e){var t=$(e.currentTarget),n=t.closest('.tab-nav');if(!t.hasClass('active')){n.find('b').each(function(e,t){$(t).removeClass('active');}),t.addClass('active');var o=t.data('num');n.next('.tab-content').find('.tab-panel').each(function(e,t){if($(t).data('num')==o)$(t).show();else $(t).hide();});}}).on('click',':checkbox',function(e){var t=$(e.currentTarget),o=t.closest('.tab-panel');n(o);}).on('click','.icon-angle-up',function(e){var t=$(e.currentTarget),n=t.closest('.tab-panel'),i=n.find('.course-list');if(!t.hasClass('disable')){var c=i.find('.show'),a=c.prev();if(a.length)c.removeClass('show'),a.addClass('show'),o(a);}}).on('click','.icon-angle-down',function(e){var t=$(e.currentTarget),n=t.closest('.tab-panel'),i=n.find('.course-list');if(!t.hasClass('disable')){var c=i.find('.show'),a=c.next();if(a.length)c.removeClass('show'),a.addClass('show'),o(a);}}).on('click','.combo-purchase',function(e){var t=$(e.currentTarget),n=t.closest('.tab-panel'),o=n.find('.course-list'),c=[];c.push(i.get('courseNum')),o.find('.course-item').each(function(e,t){var n=$(t).find(':checkbox');if(n.prop('checked'))c.push($(t).data('number'));}),location.href='/pay/productGroup?course_numbers='+c.join()+'&activity_id='+n.data('num');});};});