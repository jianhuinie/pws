define('cobble/form/Validator',['require','exports','module','../function/jquerify','../function/lifeCycle'],function(require){'use strict';function e(e){return i.init(this,e);}function r(e,r){if(e.length>0){var n=e[0].element;if(n.is(':hidden'))n=n.parent();var t=n.offset().top;if(r>0)t-=r;window.scrollTo(window.scrollX,t);}}function n(e){var r=$.Deferred();return $.when.apply($,e).done(function(){r.resolve(arguments);}),r;}var t=require('../function/jquerify'),i=require('../function/lifeCycle');e.prototype={constructor:e,type:'Validator',init:function(){var r=this,n=r.element,t='FORM'===n.prop('tagName')?n:n.find('form');if(t.length>0)t.attr('novalidate','novalidate').on('submit'+o,$.proxy(r.validate,r));$.each(r.fields,function(r,t){var i=n.find('[name="'+r+'"]'),o=t.type;if(!o)o=t.type=i.attr('type')||'text';var s=t.rules;if(!s)s=t.rules={};var l=e.type[o]||[];$.each(l,function(e,r){if(null==s[r]){var n=a[r];if($.isFunction(n))s[r]=n(i,t);}});});var i=r.groupSelector;if(n.on('focusin'+o,function(e){var n=$(e.target).closest(i),t=[r.successClass,r.errorClass,r.requiredClass].join(' ');n.removeClass($.trim(t));}),r.realtime)n.on('focusout'+o,function(e){var n=$(e.target),t=n.prop('name');if(!t)n=n.find('[name]'),t=n.prop('name');if(t)r.validate(t);});},validate:function(e,t){var i=this,a=i.emit('beforeValidate');if(!a.isDefaultPrevented()){var o,s=i.element,l=i.groupSelector;if('string'===$.type(e))e=[e];if($.isArray(e))o=$.map(e,function(e){return s.find('[name="'+e+'"]').closest(l);});else if(o=s.find(l),'boolean'===$.type(e))t=e;var u=[],c=[];$.each(o,function(e,r){var n=i.validateGroup($(r));if(n){if(n.promise)c.push(n),n=n.data;$.merge(u,n);}});var e=[],f=[],d=function(){if($.each(u,function(r,n){if(n.error)f.push(n);e.push(n.element.prop('name'));}),t)r(f,i.scrollGap);i.emit('afterValidate',{fields:e,errors:f});};if(c.length>0)return n(c).done(d);else return d(),0===f.length;}},validateGroup:function(r){if(r.is(':visible')){var t=this,i=[],a=[],o=[];if(r.find('[name]').each(function(r){var n,s,l=this,u=l.name,c=l.value,f=l.disabled,d=$(l);if(!f){var p=t.fields[u];if(p){n=!0,p=$.extend(!0,{},p),p.form=t.element,p.value=$.trim(c);var m;if($.each(e.type[p.type]||[],function(r,n){var t=e.rule[n](p);if(t===!1)return m=n,!1;else if(''===p.value&&'required'===n)return!1;}),m){var v=p.errors;if(v)s=v[m];if(!s)throw new Error(u+' 字段 '+m+' 类型错误信息未定义');}else if($.isFunction(p.custom)){var h=$.Deferred(),g=p.custom(d,function(e){h.resolve(e);});s=null==g||g.done?h:g;}}}if(n)if(r=i.push({element:d,error:s}),s&&s.promise)a.push(s),o.push(r-1);}),a.length>0){var s=n(a).done(function(e){$.each(e,function(e,r){i[o[e]].error=r;}),t.refreshGroup(r,i);});return s.data=i,s;}else return t.refreshGroup(r,i),i;}},refreshGroup:function(e,r){var n=this,t=n.successClass,i=n.errorClass;$.each(r,function(r,a){var o,s=a.element,l=a.error,u=n.errorSelector;if(u)o=e.find(u).eq(r);if(l&&'string'===$.type(l)){if(e.removeClass(t).addClass(i),o){var c=n.renderTemplate;if($.isFunction(c))l=c({text:l},n.errorTemplate);o.html(l).show();var f=n.errorPlacement;if($.isFunction(f))f(s,o);}}else if(a.error='',e.removeClass(i).addClass(t),o)o.html('').hide();});},dispose:function(){var e=this;i.dispose(e),e.element.off(o),e.element=null;}},t(e.prototype),e.defaultOptions={realtime:!1,scrollGap:100,groupSelector:'.form-group',successClass:'has-success',errorClass:'has-error',errorSelector:'.error',errorTemplate:'<i class="icon icon-times-circle"></i>&nbsp;${text}',requiredClass:'has-required',requiredSelector:'.required',requiredTemplate:'${text}',renderTemplate:function(e,r){return r.replace(/\${(\w+)}/g,function(r,n){return e[n]||'';});},errorPlacement:function(e,r){if('hidden'===e.prop('type'))e=e.parent();r.css({position:'static',width:'auto'});var n=r.outerWidth(!0)+5;r.css({position:'absolute',width:n});var t=e.parent();if(t.is('.placeholder-wrapper'))e=t;var i=e.position();r.css({left:i.left+e.outerWidth()-37,top:i.top-r.outerHeight()+8});}},e.type={text:['required','pattern','min','max','minlength','maxlength'],hidden:['required'],password:['required','pattern','minlength','maxlength','equals'],number:['required','pattern','min','max','step'],range:['required','pattern','min','max','step'],tel:['required','pattern'],url:['required','pattern'],email:['required','pattern'],mobile:['required','pattern'],money:['required','pattern','min','max'],idcard:['required','pattern'],'int':['required','pattern','min','max'],internationalMobile:['required','pattern']},e.rule={required:function(e){if(e.value.length>0)return!0;else if(e.rules.required)return!1;},pattern:function(e){var r=e.rules.pattern;if(r)return r.test(e.value);else return void 0;},minlength:function(e){var r=e.rules.minlength;if($.isNumeric(r))return e.value.length>=+r;else return void 0;},maxlength:function(e){var r=e.rules.maxlength;if($.isNumeric(r))return e.value.length<=+r;else return void 0;},min:function(e){var r=e.rules.min;if($.isNumeric(r))return e.value>=+r;else return void 0;},max:function(e){var r=e.rules.max;if($.isNumeric(r))return e.value<=+r;else return void 0;},step:function(e){var r=e.rules.step;if($.isNumeric(r)){var n=e.rules.min||1;return(e.value-n)%r===0;}},equals:function(e){var r=e.rules.equals;if(r){var n=e.form.find('[name="'+r+'"]');return e.value===$.trim(n.val());}}},e.pattern={number:/^[\d.]*$/,'int':/^\d+$/,url:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,tel:/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/,mobile:/^1[3-9]\d{9}$/,email:/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i,money:/^[\d.]*$/,idcard:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/i,internationalMobile:/^\d{7,20}$/};var a={required:function(e){return'required'===e.attr('required');},pattern:function(r,n){var t=r.attr('pattern')||e.pattern[n.type];if('string'===$.type(t))t=new RegExp(t);return t;},minlength:function(e){return e.attr('minlength');},maxlength:function(e){return e.attr('maxlength');},min:function(e){return e.attr('min');},max:function(e){return e.attr('max');},step:function(e){return e.attr('step');},equals:function(e){return e.attr('equals');}},o='.cobble_form_validator';return e;}),define('cobble/function/jquerify',['require','exports','module'],function(){'use strict';function e(e){return e.faker||e.element;}var r=$.prototype,n={on:function(){return r.on.apply(e(this),arguments),this;},off:function(){return r.off.apply(e(this),arguments),this;},emit:function(n,t){var i=this,a=e(i);if(a){if(!n[$.expando])n='string'===$.type(n)?$.Event(n):$.Event(null,n);n.cobble=i;var o=[n];if(t)o.push(t);var s=i[$.camelCase('on-'+n.type)];if($.isFunction(s)&&s.apply(i,o)===!1)n.preventDefault();if(!n.isPropagationStopped())r.trigger.apply(a,o);return n;}},before:function(r){e(this).before(r);},after:function(r){e(this).after(r);},appendTo:function(r){e(this).appendTo(r);},prependTo:function(r){e(this).prependTo(r);}};return function(e){$.each(n,function(r,n){if(null==e[r])e[r]=n;});};}),define('cobble/function/lifeCycle',['require','exports'],function(require,exports){'use strict';exports.init=function(e,r){var n=e.constructor,t='__cobble__'+n.prototype.type,i=r.element;if(i&&i.data(t))e=i.data(t);else if($.extend(e,n.defaultOptions,r),e.init(),i)i.data(t,e);return e;},exports.dispose=function(e){var r='__cobble__'+e.constructor.prototype.type,n=e.element;if(n)n.removeData(r);};}),define('cobble/util/redirect',['require','exports','module','../util/url'],function(require,exports){'use strict';function e(e,n){var t=r.parse(e),i='<form action="'+t.origin+t.pathname+'" target="_blank"';if(n)i+=' accept-charset="'+n+'" onsubmit="document.charset=\''+n+'\';"';return i+='>',$.each(r.parseQuery(t.search),function(e,r){i+='<input type="hidden" name="'+e+'" value="'+r+'" />';}),i+='</form>',$(i);}var r=require('../util/url');exports.openForm=function(r,n){var t=e(r,n);t.appendTo('body'),t.submit();},exports.openLink=function(e){var r=$('<a href="'+e+'" target="_blank"><b></b></a>');r.appendTo('body');try{r.find('b')[0].click();}catch(n){exports.openForm(e);}};}),define('cobble/util/url',['require','exports','module'],function(require,exports){'use strict';exports.parseQuery=function(e){var r={};if('string'===$.type(e)&&e.length>1){var n=0,t=e.charAt(0);if('?'===t)n=1;else if('#'===t){n=1;var i=e.charAt(1);if('/'===i)n=2;}if(n>0)e=e.substr(n);$.each(e.split('&'),function(e,n){var t=n.split('=');if(2===t.length){var i=$.trim(t[0]);if(i)r[i]=decodeURIComponent($.trim(t[1]));}});}return r;},exports.getOrigin=function(e){if(!e)e=document.URL;return exports.parse(e).origin;},exports.parse=function(e){var r=document.createElement('a');r.href=e,e=r.href;var n='';if(r.protocol&&r.host)n=r.protocol+'//'+r.host;else if(/^(http[s]?:\/\/[^\/]+)(?=\/)/.test(e))n=RegExp.$1;var t=n.split(':');if(0===n.indexOf('http:')&&3===t.length&&80==t[2])t.length=2,n=t.join(':');var i=r.pathname;if(i&&'/'!==i.charAt(0))i='/'+i;return{origin:n,pathname:i,search:r.search};};}),define('common/form_2ef59f4d41',['require','exports','cobble/form/Validator'],function(require,exports){'use strict';function e(e){var r={},n=e.find('[name]');return n.each(function(){var e=this.name,n=this.value,t='radio'===this.type||'checkbox'===this.type;if(t){if(this.checked)r[e]=n;}else{var i=r[e];if(null==i)r[e]=n;else i=r[e]=[i],i.push(n);}}),$.each(r,function(e,n){r[e]=$.isArray(n)?n.join(','):$.trim(n);}),r;}function r(e,r){$.each(r,function(r,t){if(t){var i=e.find('[name="'+r+'"]'),a=i.closest('.form-group');a.removeClass('has-success').addClass('has-error');var o=a.find('.error');o.html(t),n.defaultOptions.errorPlacement(i,o);}});}var n=require('cobble/form/Validator');exports.parse=function(r){return e(r);},exports.get=function(n,t){return $.ajax({url:t,type:'get',dataType:'json',data:n.jquery?e(n):n}).done(function(e){if(e.code){var t=e.data;if(t)r(n,t);}return e;});},exports.post=function(n,t){return $.ajax({url:t,type:'post',dataType:'json',data:n.jquery?e(n):n}).done(function(e){if(e.code){var t=e.data;if(t)r(n,t);}return e;});};}),define('common/map/baidu_b4abd6bbd1',['require'],function(require){'use strict';function e(e,r,n){e='.'+e;var t={offset:new BMap.Size(20,-30)},i=new BMap.Label(n,t);i.setStyle({color:'#3d3d3d',fontSize:'12px',height:'26px',lineHeight:'26px',borderColor:'#ff9900',paddingLeft:'5px',paddingRight:'5px',fontFamily:'微软雅黑'});var a=$(e);a.find('.BMap_Marker label').remove(),r.setLabel(i);var o=r.getPosition();a.find('input[name="lng"]').val(o.lng),a.find('input[name="lat"]').val(o.lat);var s=new BMap.Geocoder();s.getLocation(o,function(e){var r=e.addressComponents;a.find('input[name="bd_area_name"]').val(r.district);});}function r(e,r,t){function i(){var i=r.getPosition(),a=$('.new-address'),o=new BMap.Geocoder();if(o.getLocation(i,function(r){var n=r.addressComponents,t=n.city,i=a.find('.city .btn-default span').text();if(-1==t.indexOf(i))if('big-map'==e)$('.big-map').find('.btn-initial').click();else a.find('.btn-initial').click();}),n(e,r,i.lng,i.lat),t)$('.map-oper').show(),$('.map-oper').find('.btn-initial').show();}r.addEventListener('dragend',i);}function n(r,n,t,i){var a=new BMap.Point(t,i),o=new BMap.Geocoder();o.getLocation(a,function(t){var i=t.addressComponents,a=i.province;if(i.province!=i.city)a+=i.city;a+=i.district+i.street+i.streetNumber,e(r,n,a);});}var t,exports=$({});exports.init=function(e){if('undefined'==typeof BMap){if(!t)t=[],require(['js!http://api.map.baidu.com/api?v=2.0&ak=EMB0bKIvMeOd70lyyG92BZlu'],function(){$.each(t,function(e,r){r();}),t=null;});t.push(e);}else setTimeout(e);};var i={};return exports.getExistedMap=function(){return i;},exports.search=function(e,r,n,t){var a;if(null==n)n=116.404;if(null==t)t=39.915;if(i[e])a=i[e];else{var a=new BMap.Map(e);a.centerAndZoom(new BMap.Point(n,t),16);var o=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM});a.addControl(o),a.enableScrollWheelZoom(),i[e]=a;}var s=!1,l=new BMap.LocalSearch(a,{renderOptions:{map:a,selectFirstResult:!1},pageCapacity:1,onSearchComplete:function(e){var n=e.getNumPois();if(1>n){var t=r.split('-');if(!s&&t[0]&&t[0]!=r)s=!0,l.search(t[0]);else return a.clearOverlays(),a.reset(),!1;}}});l.search(r);},exports.areaCenter=function(e,r){var n;if(i[e])n=i[e],n.centerAndZoom(r,16);else{var n=new BMap.Map(e);n.centerAndZoom(r,16);var t=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM});n.addControl(t),n.enableScrollWheelZoom(),i[e]=n;}},exports.addrResolution=function(n,t,a){var o;if(i[n]){o=i[n];var s=new BMap.Geocoder();o.clearOverlays(),s.getPoint(t,function(i){if(i){o.centerAndZoom(i,16);var a=new BMap.Marker(i);e(n,a,t),r(n,a,!1),o.addOverlay(a),a.enableDragging();}},'北京市');}else{var o=new BMap.Map(n),s=new BMap.Geocoder();o.clearOverlays(),s.getPoint(t,function(i){if(i){o.centerAndZoom(i,16);var a=new BMap.Marker(i);e(n,a,t),r(n,a,!1),o.addOverlay(a),a.enableDragging();}},'北京市');var l=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM});if(o.addControl(l),a)o.enableScrollWheelZoom();else o.disableScrollWheelZoom();i[n]=o;}},exports.addrReso=function(n,t,a,o){var s,l,u=$('.set-address-dialog');if(u.length)l=u.find('.'+n);else l=$('.'+n+':visible');var c,f=l.find('.location-addr'),d=f.closest('.form-group'),p=f.find('.error'),m=f.find('.message-primary');if(i[n])s=i[n];else{var s=new BMap.Map(n),v=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM});s.addControl(v),s.enableScrollWheelZoom(),i[n]=s;}var h=new BMap.Geocoder();s.clearOverlays();var g='http://api.map.baidu.com/geocoder/v2/';if($.ajax(g,{async:!1,dataType:'jsonp',data:{output:'json',ak:'EMB0bKIvMeOd70lyyG92BZlu',address:t},success:function(e){if(0===e.status)if(c=e.result.confidence,60>c)d.addClass('has-error'),m.show(),p.hide();else d.removeClass('has-error'),m.hide();}}),exports.getConfidence=function(){return c;},a&&o){var b=new BMap.Point(a,o);s.centerAndZoom(b,16),h.getLocation(b,function(t){var i=t.addressComponents,a=i.province;if(i.province!=i.city)a+=i.city;a+=i.district+i.street+i.streetNumber;var o=new BMap.Marker(b);e(n,o,a),r(n,o,!0),s.addOverlay(o),o.enableDragging(),s.panTo(b);});}else h.getPoint(t,function(i){if(i){s.centerAndZoom(i,16);var a=new BMap.Marker(i);e(n,a,t),r(n,a,!0),s.addOverlay(a),a.enableDragging();}},'北京市');l.find('.amplify').show(),l.find('.map-oper').show();},exports.makeMarker=function(n,t){var a;if(i[n])a=i[n];else var a=new BMap.Map(n);var o=new BMap.Geocoder();a.clearOverlays(),o.getPoint(t,function(i){if(i){a.centerAndZoom(i,16);var o=new BMap.Marker(i);e(n,o,t),r(n,o,!0),a.addOverlay(o),o.enableDragging();}},'北京市');},exports.reAddress=function(e,r,n){if(null==r)r=116.404;if(null==n)n=39.915495;var t=new BMap.Point(r,n),i=new BMap.Geocoder();i.getLocation(t,function(r){var n=r.addressComponents,t=n.province+n.city+n.district+n.street+n.streetNumber;exports.addrResolution(e,t);});},exports.modifiedAddress=function(n,t,a,o){if(null==t)t=116.404;if(null==a)a=39.915495;var s=new BMap.Point(t,a),l=new BMap.Geocoder();l.getLocation(s,function(t){var a=t.addressComponents,l=a.province;if(a.province!=a.city)l+=a.city;l+=a.district+a.street+a.streetNumber;var u=new BMap.Marker(s);e(n,u,l),r(n,u,!1);var c=null;if(i[n])c=i[n],c.clearOverlays();else{c=new BMap.Map(n),c.clearOverlays(),c.centerAndZoom(s,16);var f=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_ZOOM});if(c.addControl(f),o)c.enableScrollWheelZoom();else c.disableScrollWheelZoom();}c.addOverlay(u),u.enableDragging(),c.panTo(s);});},exports;}),define('course/detail/address',['require','exports','common/map/baidu_b4abd6bbd1','common/form_2ef59f4d41','cobble/util/redirect','cobble/form/Validator'],function(require,exports){'use strict';var e=require('common/map/baidu_b4abd6bbd1'),r=require('common/form_2ef59f4d41'),n=require('cobble/util/redirect'),t=require('cobble/form/Validator'),i={1:'bt',2:'nav'};exports.init=function(){var a=$('#course-address'),o=a.find('#course-address-map').data('offline'),s=a.find('#course-address-map').data('address'),l=new t({element:a.find('.form'),realtime:!1,fields:{departure:{errors:{required:'请填写你的出发地点'}}}});if(o||s){if(o)e.modifiedAddress('course-address-map',o.lng,o.lat,!1);else e.addrResolution('course-address-map',s,!1);a.on('click','.form-action button',function(){if(l.validate()){var e=r.parse(a.find('.form'));if(e.departure){var t='http://map.baidu.com?newmap=1&ie=utf-8&s='+i[e.way];t+=encodeURIComponent('&wd1='+e.departure+'&wd2='+s),n.openLink(t);}}});}};});