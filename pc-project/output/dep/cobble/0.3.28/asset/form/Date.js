define("cobble/form/Date",["require","exports","module","../function/jquerify","../function/lifeCycle","../function/contains","../function/lpad","../function/init","../function/replaceWith","../ui/Calendar","../helper/Popup","../util/date"],function(require){"use strict";function e(e){return n.init(this,e)}var t=require("../function/jquerify"),n=require("../function/lifeCycle"),i=require("../function/contains"),r=require("../function/lpad"),o=require("../function/init"),a=require("../function/replaceWith"),u=require("../ui/Calendar"),c=require("../helper/Popup"),f=require("../util/date");return e.prototype={constructor:e,type:"Date",init:function(){var e,t=this,n=t.element,r=t.calendarSelector;if(1===n.find(r).length)e=n,n=t.element=e.find(":text");else e=$(t.template),a(n,e),a(e.find(":text"),n);var o=e.find(r);if(o.is(":visible"))o.hide();if("string"!==$.type(t.value))t.value=n.val();if(t.calendar=new u({element:o,mode:"month",date:t.date,today:t.today,template:t.calendarTemplate,renderTemplate:$.proxy(t.renderCalendarTemplate,t),prevSelector:t.prevSelector,nextSelector:t.nextSelector,onChange:function(){t.setValue(this.value)}}),t.popup=new c({element:n,layer:o,show:{trigger:"focus"},hide:{trigger:"click"},onBeforeHide:function(e){if("eventPhase"in e){var t=$(e.target);if(t[0]===n[0]||!i(document,t)||i(o,t))return!1}}}),t.value)t.setValue(t.value,{force:!0,silence:!0})},open:function(){this.popup.open()},close:function(){this.popup.close()},getValue:function(){return this.value},setValue:function(e,t){var n=this;e="string"===$.type(e)?$.trim(e):"",t=t||{};var i,r=e.match(n.pattern);if(r){if(r.length<4)throw new Error("[form/Date]pattern 必须包含 3 个分组.");i=f.parse(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10))}else e="";if(t.force||e!==n.value){n.value=e;var o=n.calendar;if(i&&!o.inRange(i))o.render(i);if(o.setValue(e,{silence:!0}),n.element.val(e),n.popup.close(),!t.silence)n.emit("change")}},render:function(e){this.calendar.render(e)},dispose:function(){var e=this;n.dispose(e),e.calendar.dispose(),e.popup.dispose(),e.calendar=e.popup=null}},t(e.prototype),e.defaultOptions={template:'<div class="form-date"><input type="text" /><div class="calendar"></div></div>',disablePast:!0,prevSelector:".icon-chevron-left",nextSelector:".icon-chevron-right",calendarSelector:".calendar",calendarTemplate:"",pattern:/^(\d{4})-(\d{2})-(\d{2})$/,renderCalendarTemplate:function(e){var t=this.disablePast;$.each(e.list,function(e,t){t.text=[t.year,r(t.month),r(t.date)].join("-")});var n=['<div class="calendar-header">','<i class="icon icon-chevron-left"></i>',"<strong>",e.year,"年",e.month,"月</strong>",'<i class="icon icon-chevron-right"></i>',"</div>","<table>","<thead>","<tr>","<th>一</th>","<th>二</th>","<th>三</th>","<th>四</th>","<th>五</th>","<th>六</th>","<th>日</th>","</tr>","</thead>","<tbody>"];return $.each(e.list,function(e,i){if(e%7===0)n.push(0===e?"<tr>":"</tr>");n.push('<td class="'+i.phase);var r=!t||"past"!==i.phase;if(!r)n.push(" date-disabled");if(n.push('"'),r)n.push(' data-value="'+i.text+'"');n.push(' data-year="'+i.year+'"'),n.push(' data-month="'+i.month+'"'),n.push(' data-date="'+i.date+'">'),n.push(i.date),n.push("</td>")}),n.push("</tbody></table>"),n.join("")}},e.init=o(e),e}),define("cobble/function/contains",["require","exports","module"],function(){"use strict";return function(e,t){if(e=e.jquery?e[0]:e,t=t.jquery?t[0]:t,!e||!t)return!1;if(e===t)return!0;else return $.contains(e,t)}}),define("cobble/function/init",["require","exports","module"],function(){"use strict";return function(e){return function(t,n){var i=[];return t.each(function(){i.push(new e($.extend({element:$(this)},n)))}),i}}}),define("cobble/function/isHidden",["require","exports","module"],function(){"use strict";return function(e){e.css("display");return"none"===e.css("display")||0==e.css("opacity")||"hidden"===e.css("visibility")}}),define("cobble/function/jquerify",["require","exports","module"],function(){"use strict";function e(e){return e.faker||e.element}var t=$.prototype,n={on:function(){return t.on.apply(e(this),arguments),this},off:function(){return t.off.apply(e(this),arguments),this},emit:function(n,i){var r=this,o=e(r);if(o){if(!n[$.expando])n="string"===$.type(n)?$.Event(n):$.Event(null,n);n.cobble=r;var a=[n];if(i)a.push(i);var u=r[$.camelCase("on-"+n.type)];if($.isFunction(u)&&u.apply(r,a)===!1)n.preventDefault();if(!n.isPropagationStopped())t.trigger.apply(o,a);return n}},before:function(t){e(this).before(t)},after:function(t){e(this).after(t)},appendTo:function(t){e(this).appendTo(t)},prependTo:function(t){e(this).prependTo(t)}};return function(e){$.each(n,function(t,n){if(null==e[t])e[t]=n})}}),define("cobble/function/lifeCycle",["require","exports"],function(require,exports){"use strict";exports.init=function(e,t){var n=e.constructor,i="__cobble__"+n.prototype.type,r=t.element;if(r&&r.data(i))e=r.data(i);else if($.extend(e,n.defaultOptions,t),e.init(),r)r.data(i,e);return e},exports.dispose=function(e){var t="__cobble__"+e.constructor.prototype.type,n=e.element;if(n)n.removeData(t)}}),define("cobble/function/lpad",["require","exports","module"],function(){"use strict";return function(e,t){if(null==t)t=2;var n=new Array(t-(""+e).length+1);return n.join("0")+e}}),define("cobble/function/replaceWith",["require"],function(){"use strict";return function(e,t){e=e[0],t=t[0],e.parentNode.replaceChild(t,e)}}),define("cobble/function/split",["require","exports","module"],function(){"use strict";return function(e,t){var n=[];return $.each(e.split(t),function(e,t){if(t=$.trim(t))n.push(t)}),n}}),define("cobble/helper/Popup",["require","exports","module","../function/split","../function/isHidden","../function/contains","../function/jquerify","../function/lifeCycle","../util/instance"],function(require){"use strict";function e(e){return T.init(this,e)}function t(e,t){$.each(e.showConfigList,function(n,i){i[t](e)})}function n(e,t){$.each(e.hideConfigList,function(n,i){i[t](e)})}function i(e,t){if(e)e.type=t;else e=t;return e}function r(e){var t=e.currentTarget;return t&&"HTML"===t.tagName?null:t}function o(e,t){return e.emit(i(t,"beforeShow"))}function a(e,i){return e.layer.data(H,r(i)),t(e,"off"),n(e,"on"),e.emit("afterShow")}function u(e,t){return e.emit(i(t,"beforeHide"))}function c(e){return e.layer.removeData(H),n(e,"off"),t(e,"on"),e.emit("afterHide")}function f(){return $.now()}function s(e){return"__"+e+"Handler__"}function l(e,t){return null==e[t]}function d(e,t){return e.layer.data(H)!==r(t)}function p(e,t,n){return!t||t(e,n)}function h(e,t){return t-e[j]>50}function m(t,n){return function(i){var r=i.data,o=f(i);if(l(r,q)&&d(r,i)&&p(r,n,i))r[j]=o,y({popup:r,delay:r.show.delay,toggle:e.trigger.show[t].delay,timer:q,success:function(){var e=function(){r.open(i)},t=r[k];if(t)t.done(e);else e()}})}}function v(t,n){return function(i){var r=i.data,o=f(i);if(l(r,W)&&p(r,n,i)&&h(r,o))r[j]=o,r[k]=$.Deferred(),y({popup:r,delay:r.hide.delay,toggle:e.trigger.hide[t].delay,timer:W,success:function(){r.close(i),r[k].resolve()},fail:function(){r[k]=null}})}}function y(e){var t=e.delay,n=e.success;if(t>0){var i=e.popup,r=e.timer,o=e.toggle||{},a=o.on||$.noop,u=o.off||$.noop,c=e.fail||$.noop,f=function(){clearTimeout(i[r]),u(i,s),i[r]=null},s=function(e){var t=i[r];if(t)f();if(t&&e===j)n();else c()};a(i,s),i[r]=setTimeout(function(){s(j)},t)}else n()}function g(e){var t=this,n=t.type,i=t.handler,r=s(n);if(e[r]!==i)e.element.on(n,e.selector,e,i),e[r]=i}function b(e){var t=this;if(!e.selector){var n=t.type;e.element.off(n,t.handler),e[s(n)]=null}}var D=require("../function/split"),x=require("../function/isHidden"),w=require("../function/contains"),_=require("../function/jquerify"),T=require("../function/lifeCycle"),C=require("../util/instance");e.prototype={constructor:e,type:"Popup",init:function(){var i=this,r=i.showConfigList=[],o=i.hideConfigList=[],a=i.show.trigger,u=i.hide.trigger;if(a)$.each(D(a,","),function(t,n){var i=e.trigger.show[n];if(i)r.push(i)});if(u)$.each(D(i.hide.trigger,","),function(t,n){var i=e.trigger.hide[n];if(i)o.push(i)});if(i.hidden=x(i.layer))t(i,"on");else n(i,"on")},open:function(){var e=this,t=arguments[0];if(!t)e[j]=f();if(t=o(e,t),!t.isDefaultPrevented()){var n=e.layer,i=e.show.animation;if($.isFunction(i))i.call(e,n);else n.show();e.hidden=!1,a(e,t)}},close:function(){var e=this;if(!e.hidden){var t=arguments[0];if(!t)e[j]=f();if(t=u(e,t),!t.isDefaultPrevented()){var n=e.layer,i=e.hide.animation;if($.isFunction(i))i.call(e,n);else n.hide();e.hidden=!0,c(e)}}},dispose:function(){var e=this;T.dispose(e),e.close(),t(e,"off"),e.element=e.layer=null}},_(e.prototype),e.defaultOptions={show:{trigger:"click"},hide:{trigger:"click"}};var k="__hidePromise__",q="__showTimer__",W="__hideTimer__",j="__lastTriggerTime__",H="__sourceElement__",M=function(e,t){if(!t)return!1;else return w(e.layer,t)};return e.trigger={show:{focus:{type:"focusin",handler:m("focus"),on:g,off:b},click:{type:"click",handler:m("click"),on:g,off:b},over:{type:"mouseenter",handler:m("over"),on:g,off:b,delay:{on:function(e,t){e.element.on("mouseleave",e.selector,t)},off:function(e,t){e.element.off("mouseleave",t)}}},context:{type:"contextmenu",handler:m("context"),on:g,off:b}},hide:{blur:{type:"focusout",handler:v("blur"),on:g,off:b},click:{type:"click",handler:function(){return v(this.type,function(e,t){return!M(e,t.target)})},on:function(e){var t=this;C.document.on(t.type,e,e.clickHandler=t.handler())},off:function(e){C.document.off(this.type,e.clickHandler)}},out:{type:"mouseleave",handler:v("out"),on:function(e){var t=this.type,n=this.handler;e.layer.on(t,e,n),e.element.on(t,e.selector,e,n)},off:function(e){var t=this.type,n=this.handler;e.element.off(t,n),e.layer.off(t,n)},delay:{on:function(e,t){e.element.on("mouseenter",e.selector,t),e.layer.on("mouseenter",t)},off:function(e,t){e.element.off("mouseenter",t),e.layer.off("mouseenter",t)}}},context:{type:"contextmenu",handler:function(){return v("context",function(e,t){return!M(e,t.target)})},on:function(e){var t=this;C.document.on(t.type,e,e.contextHandler=t.handler())},off:function(e){C.document.off(this.type,e.contextHandler)}}}},e}),define("cobble/ui/Calendar",["require","../function/jquerify","../function/lifeCycle","../util/date"],function(require){"use strict";function e(e){return i.init(this,e)}function t(e,t,n){for(var i,o=[],a=e;t>=a;a+=r.DAY){if(i=r.simplify(a),a>n)i.phase="future";else if(n>a)i.phase="past";else i.phase="today";o.push(i)}return o}var n=require("../function/jquerify"),i=require("../function/lifeCycle"),r=require("../util/date");e.prototype={constructor:e,type:"Calendar",init:function(){var e=this,t=e.today||new Date;if(e.today=t.setHours(0,0,0,0),e.render(e.date||new Date),e.value)e.setValue(e.value,{force:!0,silence:!0});var n="click"+o,i=e.element;i.on(n,"[data-value]",function(){var t,n=$(this),i=e.activeClass,r=n.hasClass(i);if(r)if(e.toggle)t="",n.removeClass(i);else return;else t=n.data("value");e.setValue(t)});var r=e.prevSelector;if(r)i.on(n,r,$.proxy(e.prev,e));var a=e.nextSelector;if(a)i.on(n,a,$.proxy(e.next,e))},getValue:function(){return this.value},setValue:function(e,t){var n=this,i=n.element,r=i.find('[data-value="'+e+'"]');if(1!==r.length)e="";if(t=t||{},t.force||n.value!=e){n.value=e;var o=n.activeClass,a=i.find("."+o);if(e){if(!n.multiple)a.removeClass(o);r.addClass(o)}else a.removeClass(o);if(!t.silence)n.emit("change")}},prev:function(){var e=this,t=e.date;t="week"===e.mode?r.prevWeek(t):r.prevMonth(t),e.render(t),e.emit("prev")},next:function(){var e=this,t=e.date;t="week"===e.mode?r.nextWeek(t):r.nextMonth(t),e.render(t),e.emit("next")},inRange:function(e){var t=this.data,n=r.parse(t.start),i=r.parse(t.end);return e>=n&&i>=e},createData:function(e){var n=this,i=n.firstDay;e=e.setHours(0,0,0,0);var o,a;if("week"===n.mode)o=r.getWeekFirstDay(e,i),a=r.getWeekLastDay(e,i);else{var u=r.getMonthFirstDay(e),c=r.getMonthLastDay(e);o=r.getWeekFirstDay(u,i),a=r.getWeekLastDay(c,i)}var f=t(+o,+a,n.today);return $.extend(r.simplify(e),{start:f[0],end:f[f.length-1],list:f})},render:function(e){var t=this;t.date=e;var n=t.data=t.createData(e);t.emit("beforeRender",n),t.element.html(t.renderTemplate(n,t.template)),t.emit("afterRender",n)},dispose:function(){var e=this;i.dispose(e),e.element.off(o),e.element=null}},n(e.prototype),e.defaultOptions={firstDay:1,mode:"month",toggle:!1,multiple:!1,activeClass:"active"};var o=".cobble_ui_calendar";return e}),define("cobble/util/date",["require","exports","module"],function(require,exports){"use strict";exports.parse=function(e,t,n){var i=!1;if($.isNumeric(e)&&$.isNumeric(t)&&$.isNumeric(n))i=!0;else if(1===arguments.length)if(i=!0,$.isPlainObject(e))n=e.date,t=e.month,e=e.year;else if("string"===$.type(e)){var r=e.split("-");e=r[0],t=r[1],n=r[2]}if(i)if(t>=1&&12>=t&&n>=1&&31>=n)return new Date(e,t-1,n)},exports.stringify=function(e){if("number"===$.type(e))e=new Date(e);var t=e.getFullYear(),n=e.getMonth()+1,e=e.getDate();if(10>n)n="0"+n;if(10>e)e="0"+e;return[t,n,e].join("-")},exports.simplify=function(e){if("number"===$.type(e))e=new Date(e);return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),day:e.getDay()}},exports.getWeekFirstDay=function(e,t){if("number"===$.type(e))e=new Date(e);var n=e.getDay();return n=n>=t?n:n+7,new Date(e.getTime()-(n-t)*exports.DAY)},exports.getWeekLastDay=function(e,t){return e=exports.getWeekFirstDay(e,t),e.setTime(e.getTime()+6*exports.DAY),e},exports.getMonthFirstDay=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e},exports.getMonthLastDay=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e.setMonth(e.getMonth()+1),e.setDate(0),e},exports.prevMonth=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(1),e.setTime(e.getTime()-exports.WEEK),e},exports.nextMonth=function(e){var t="number"===$.type(e)?e:e.getTime();return e=new Date(t),e.setDate(28),e.setTime(e.getTime()+exports.WEEK),e},exports.prevWeek=function(e){return exports.subtract(e,7)},exports.nextWeek=function(e){return exports.add(e,7)},exports.add=function(e,t){if("date"===$.type(e))e=e.getTime();return new Date(e+t*exports.DAY)},exports.subtract=function(e,t){if("date"===$.type(e))e=e.getTime();return new Date(e-t*exports.DAY)},exports.DAY=864e5,exports.WEEK=7*exports.DAY}),define("cobble/util/instance",["require","exports","module"],function(require,exports){exports.window=$(window),exports.document=$(document),exports.html=$(document.documentElement),exports.body=$(document.body)});