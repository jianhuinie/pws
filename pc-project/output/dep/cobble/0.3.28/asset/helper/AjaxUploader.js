define("cobble/function/jquerify",["require","exports","module"],function(){"use strict";function e(e){return e.faker||e.element}var t=$.prototype,i={on:function(){return t.on.apply(e(this),arguments),this},off:function(){return t.off.apply(e(this),arguments),this},emit:function(i,a){var o=this,n=e(o);if(n){if(!i[$.expando])i="string"===$.type(i)?$.Event(i):$.Event(null,i);i.cobble=o;var p=[i];if(a)p.push(a);var r=o[$.camelCase("on-"+i.type)];if($.isFunction(r)&&r.apply(o,p)===!1)i.preventDefault();if(!i.isPropagationStopped())t.trigger.apply(n,p);return i}},before:function(t){e(this).before(t)},after:function(t){e(this).after(t)},appendTo:function(t){e(this).appendTo(t)},prependTo:function(t){e(this).prependTo(t)}};return function(e){$.each(i,function(t,i){if(null==e[t])e[t]=i})}}),define("cobble/function/lifeCycle",["require","exports"],function(require,exports){"use strict";exports.init=function(e,t){var i=e.constructor,a="__cobble__"+i.prototype.type,o=t.element;if(o&&o.data(a))e=o.data(a);else if($.extend(e,i.defaultOptions,t),e.init(),o)o.data(a,e);return e},exports.dispose=function(e){var t="__cobble__"+e.constructor.prototype.type,i=e.element;if(i)i.removeData(t)}}),define("cobble/helper/AjaxUploader",["require","exports","module","../function/jquerify","../function/lifeCycle"],function(require){"use strict";function e(e){return c.init(this,e)}function t(e,t){var i=new FormData;$.each(e.data,function(e,t){i.append(e,t)}),i.append(e.fileName,t.nativeFile),t.xhr.send(i)}function i(t,i){var a=i.nativeFile,o=i.file.size,n=i.chunk;if(!n)n=i.chunk={index:0,uploaded:0};var p=n.index,r=t.chunkSize,l=r*p,c=r*(p+1);if(c>o)c=o;if(n.uploading=c-l,n.uploading<=0)return void setTimeout(function(){t.emit("uploadError",{fileItem:i,errorCode:e.ERROR_CHUNK_SIZE})});var s="bytes "+(l+1)+"-"+c+"/"+o,u=i.xhr;u.setRequestHeader("Content-Type",""),u.setRequestHeader("X_FILENAME",encodeURIComponent(a.name)),u.setRequestHeader("Content-Range",s),u.send(a.slice(l,c))}function a(t,i){var a=i.xhr;if(a)$.each(d,function(e,t){a["on"+t.type]=null}),$.each(f,function(e,t){a.upload["on"+t.type]=null}),delete i.xhr;if(t.emit("uploadComplete",{fileItem:i}),i.status===e.STATUS_UPLOAD_SUCCESS||i.status===e.STATUS_UPLOAD_ERROR&&t.ignoreError){var n=i.index+1;if(n<t.fileQueue.files.length)t.fileQueue.index=n,t.upload();else o(t,[])}}function o(t,i){var a=t.fileQueue;a.index=0,a.files=$.map(i,function(t,i){return{index:i,file:r(t),nativeFile:t,status:e.STATUS_WAITING}})}function n(e){var t=e.fileQueue,i=t.index;if(t.files&&"number"===$.type(i))return t.files[i];else return void 0}function p(e){var t=[];return $.each(e,function(e,i){if(u[i])t.push(u[i])}),$.unique(t).join(",")}function r(e){var t=e.name,i=t.split("."),a=i.length>0?i.pop().toLowerCase():"";return{name:t,type:a,size:e.size}}var l=require("../function/jquerify"),c=require("../function/lifeCycle");e.prototype={constructor:e,type:"AjaxUploader",init:function(){var e=this;e.fileQueue={};var t=e.element;if(!t.is(":file"))throw new Error('AjaxUploader element must be <input type="file" />');var i=e.faker=$("<form></form>");t.replaceWith(i),i.append(t);var a={};if(e.accept)a.accept=p(e.accept);if(e.multiple)a.multiple=!0;t.prop(a),t.on("change"+s,function(){o(e,t.prop("files")),e.emit("fileChange")}),e.emit("ready")},getFiles:function(){return this.fileQueue.files||[]},setAction:function(e){this.action=e},setData:function(e){$.extend(this.data,e)},reset:function(){this.faker[0].reset()},upload:function(a){var o=this,p=o.useChunk?e.STATUS_UPLOADING:e.STATUS_WAITING;if(a=a||n(o),a&&!(a.status>p)){var r=new XMLHttpRequest;if(o.xhrProps)$.extend(r,o.xhrProps);a.xhr=r,$.each(d,function(e,t){r["on"+t.type]=function(e){t.handler(o,e)}}),$.each(f,function(e,t){r.upload["on"+t.type]=function(e){t.handler(o,e)}}),r.open("post",o.action,!0);var l=o.useChunk?i:t;l(o,a)}},stop:function(){var t=this,i=n(t);if(i&&i.status===e.STATUS_UPLOADING)i.xhr.abort();t.reset()},enable:function(){this.element.prop("disabled",!1)},disable:function(){this.element.prop("disabled",!0)},dispose:function(){var e=this;c.dispose(e),e.stop(),e.element.off(s),e.faker=e.element=e.fileQueue=null}},l(e.prototype),e.defaultOptions={data:{},multiple:!1,fileName:"Filedata",ignoreError:!1},e.supportChunk="undefined"!=typeof FileReader,e.STATUS_WAITING=0,e.STATUS_UPLOADING=1,e.STATUS_UPLOAD_SUCCESS=2,e.STATUS_UPLOAD_ERROR=3,e.ERROR_CANCEL=0,e.ERROR_CHUNK_SIZE=-1;var s=".cobble_helper_ajaxuploader",u={html:"text/html",htm:"text/html",shtml:"text/html",xml:"text/xml",css:"text/css",js:"application/x-javascript",json:"application/json",atom:"application/atom+xml",rss:"application/rss+xml",mml:"text/mathml",txt:"text/plain",jad:"text/vnd.sun.j2me.app-descriptor",wml:"text/vnd.wap.wml",htc:"text/x-component",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",tif:"image/tiff",tiff:"image/tiff",wbmp:"image/vnd.wap.wbmp",ico:"image/x-icon",jng:"image/x-jng",bmp:"image/x-ms-bmp",svg:"image/svg+xml",svgz:"image/svg+xml",webp:"image/webp",mp3:"audio/mpeg",wma:"audio/x-ms-wma",wav:"audio/x-wav",mid:"audio/midi",midd:"audio/midi",kar:"audio/midi",ogg:"audio/ogg",m4a:"audio/x-m4a",ra:"audio/x-realaudio",ram:"audio/x-pn-realaudio",mod:"audio/mod","3gp":"video/3gpp","3gpp":"video/3gpp",mp4:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",mov:"video/quicktime",webm:"video/webm",flv:"video/x-flv",m4v:"video/x-m4v",mng:"video/x-mng",asx:"video/x-ms-asf",asf:"video/x-ms-asf",wmv:"video/x-ms-wmv",avi:"video/x-msvideo",rm:"video/vnd.rn-realvideo",rmvb:"video/vnd.rn-realvideo",ts:"video/MP2T",dv:"video/x-dv",mkv:"video/x-matroska",jar:"application/java-archive",war:"application/java-archive",ear:"application/java-archive",hqx:"application/mac-binhex40",pdf:"application/pdf",ps:"application/postscript",eps:"application/postscript",ai:"application/postscript",rtf:"application/rtf",wmlc:"application/vnd.wap.wmlc",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz","7z":"application/x-7z-compressed",cco:"application/x-cocoa",jardiff:"application/x-java-archive-diff",jnlp:"application/x-java-jnlp-file",run:"application/x-makeself",pl:"application/x-perl",pm:"application/x-perl",prc:"application/x-pilot",pdb:"application/x-pilot",rar:"application/x-rar-compressed",rpm:"application/x-redhat-package-manager",sea:"application/x-sea",swf:"application/x-shockwave-flash",sit:"application/x-stuffit",tcl:"application/x-tcl",tk:"application/x-tcl",der:"application/x-x509-ca-cert",pem:"application/x-x509-ca-cert",crt:"application/x-x509-ca-cert",xpi:"application/x-xpinstall",xhtml:"application/xhtml+xml",zip:"application/zip",bin:"application/octet-stream",exe:"application/octet-stream",dll:"application/octet-stream",deb:"application/octet-stream",dmg:"application/octet-stream",eot:"application/octet-stream",iso:"application/octet-stream",img:"application/octet-stream",msi:"application/octet-stream",msp:"application/octet-stream",msm:"application/octet-stream",doc:"application/msword",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"},d={uploadStart:{type:"loadstart",handler:function(t){var i=n(t);i.status=e.STATUS_UPLOADING,t.emit("uploadStart",{fileItem:i})}},uploadSuccess:{type:"load",handler:function(t,i){var o=n(t),p={fileItem:o,responseText:o.xhr.responseText},r=o.chunk;if(r){var l=r.uploaded;if(l<o.file.size){var i=t.emit("chunkUploadSuccess",p);if(!i.isDefaultPrevented())if(r.index++,r.uploaded=l+r.uploading,r.uploaded<o.file.size)t.upload();else return o.status=e.STATUS_UPLOAD_SUCCESS,t.emit("uploadSuccess",p),void a(t,o);return}}o.status=e.STATUS_UPLOAD_SUCCESS,t.emit("uploadSuccess",p),a(t,o)}},uploadError:{type:"error",handler:function(t,i,o){var p=n(t);p.status=e.STATUS_UPLOAD_ERROR,t.emit("uploadError",{fileItem:p,errorCode:o}),a(t,p)}},uploadStop:{type:"abort",handler:function(t,i){d.uploadError.handler(t,i,e.ERROR_CANCEL)}}},f={uploadProgress:{type:"progress",handler:function(e,t){var i=n(e),a=i.file.size,o=t.loaded,p=i.chunk;if(p)o+=p.uploaded;var r=o/(a||1);if(r>=0&&1>=r);else if(0>r)r=0;else if(r>1)r=1;r=parseInt(100*r,10)+"%",e.emit("uploadProgress",{fileItem:i,uploaded:o,total:a,percent:r})}}};return e});