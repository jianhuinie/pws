function ue_callback(e,t){function i(e,t,i,a){var r,s=0,o=0,n=e.width||i,l=e.height||a;if(n>t||l>t)if(n>=l){if(s=n-t)r=(s/n).toFixed(2),e.height=l-l*r,e.width=t}else if(o=l-t)r=(o/l).toFixed(2),e.width=n-n*r,e.height=t}var a=document,r=$G("J_picBoard"),s=a.createElement("img");if(removeMaskLayer(),"SUCCESS"==t)r.innerHTML="",s.onload=function(){i(this,300),r.appendChild(s);var e=new scrawl;e.btn2Highlight("J_removeImg"),e.btn2Highlight("J_sacleBoard")},s.src=e;else alert(t)}function removeMaskLayer(){var e=$G("J_maskLayer");e.className="maskLayerNull",e.innerHTML="",dialog.buttons[0].setDisabled(!1)}function addMaskLayer(e){var t=$G("J_maskLayer");dialog.buttons[0].setDisabled(!0),t.className="maskLayer",t.innerHTML=e}function exec(scrawlObj){if(scrawlObj.isScrawl){addMaskLayer(lang.scrawlUpLoading);var base64=scrawlObj.getCanvasData();if(base64){var options={timeout:1e5,onsuccess:function(xhr){if(!scrawlObj.isCancelScrawl){var responseObj;if(responseObj=eval("("+xhr.responseText+")"),"SUCCESS"==responseObj.state){var imgObj={},url=editor.options.scrawlUrlPrefix+responseObj.url;imgObj.src=url,imgObj._src=url,imgObj.alt=responseObj.original||"",imgObj.title=responseObj.title||"",editor.execCommand("insertImage",imgObj),dialog.close()}else alert(responseObj.state)}},onerror:function(){alert(lang.imageError),dialog.close()}};options[editor.getOpt("scrawlFieldName")]=base64;var actionUrl=editor.getActionUrl(editor.getOpt("scrawlActionName")),params=utils.serializeParam(editor.queryCommandValue("serverparam"))||"",url=utils.formatUrl(actionUrl+(-1==actionUrl.indexOf("?")?"?":"&")+params);ajax.request(url,options)}}else addMaskLayer(lang.noScarwl+"&nbsp;&nbsp;&nbsp;<input type='button' value='"+lang.continueBtn+"'  onclick='removeMaskLayer()'/>")}var scrawl=function(e){e&&this.initOptions(e)};!function(){var e=$G("J_brushBoard"),t=e.getContext("2d"),i=[],a=0;scrawl.prototype={isScrawl:!1,brushWidth:-1,brushColor:"",initOptions:function(e){var t=this;t.originalState(e),t._buildToolbarColor(e.colorList),t._addBoardListener(e.saveNum),t._addOPerateListener(e.saveNum),t._addColorBarListener(),t._addBrushBarListener(),t._addEraserBarListener(),t._addAddImgListener(),t._addRemoveImgListenter(),t._addScalePicListenter(),t._addClearSelectionListenter(),t._originalColorSelect(e.drawBrushColor),t._originalBrushSelect(e.drawBrushSize),t._clearSelection()},originalState:function(e){var i=this;i.brushWidth=e.drawBrushSize,i.brushColor=e.drawBrushColor,t.lineWidth=i.brushWidth,t.strokeStyle=i.brushColor,t.fillStyle="transparent",t.lineCap="round",t.fill()},_buildToolbarColor:function(e){var t=null,i=[];i.push("<table id='J_colorList'>");for(var a,r=0;a=e[r++];){if((r-1)%5==0){if(1!=r)i.push("</tr>");i.push("<tr>")}t="#"+a,i.push("<td><a title='"+t+"' href='javascript:void(0)' style='background-color:"+t+"'></a></td>")}i.push("</tr></table>"),$G("J_colorBar").innerHTML=i.join("")},_addBoardListener:function(r){var s,o=this,n=0,l=-1,c=-1,d=!1,h=!1,u=!1,p=0,f="";n=parseInt(domUtils.getComputedStyle($G("J_wrap"),"margin-left")),i.push(t.getImageData(0,0,t.canvas.width,t.canvas.height)),a+=1,domUtils.on(e,["mousedown","mousemove","mouseup","mouseout"],function(e){switch(s=browser.webkit?e.which:p,e.type){case"mousedown":p=1,f=1,d=!0,u=!1,h=!1,o.isScrawl=!0,l=e.clientX-n,c=e.clientY-n,t.beginPath();break;case"mousemove":if(!f&&0==s)return;if(!f&&s)l=e.clientX-n,c=e.clientY-n,t.beginPath(),f=1;if(u||!d)return;var i=e.clientX-n,a=e.clientY-n;t.moveTo(l,c),t.lineTo(i,a),t.stroke(),l=i,c=a,h=!0;break;case"mouseup":if(p=0,!d)return;if(!h)t.arc(l,c,t.lineWidth,0,2*Math.PI,!1),t.fillStyle=t.strokeStyle,t.fill();t.closePath(),o._saveOPerate(r),d=!1,h=!1,u=!0,l=-1,c=-1;break;case"mouseout":if(f="",p=0,1==s)return;t.closePath()}})},_addOPerateListener:function(e){var r=this;domUtils.on($G("J_previousStep"),"click",function(){if(a>1)a-=1,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.putImageData(i[a-1],0,0),r.btn2Highlight("J_nextStep"),1==a&&r.btn2disable("J_previousStep")}),domUtils.on($G("J_nextStep"),"click",function(){if(a>0&&a<i.length)t.clearRect(0,0,t.canvas.width,t.canvas.height),t.putImageData(i[a],0,0),a+=1,r.btn2Highlight("J_previousStep"),a==i.length&&r.btn2disable("J_nextStep")}),domUtils.on($G("J_clearBoard"),"click",function(){t.clearRect(0,0,t.canvas.width,t.canvas.height),i=[],r._saveOPerate(e),a=1,r.isScrawl=!1,r.btn2disable("J_previousStep"),r.btn2disable("J_nextStep"),r.btn2disable("J_clearBoard")})},_addColorBarListener:function(){var e=this;domUtils.on($G("J_colorBar"),"click",function(i){var a=e.getTarget(i),r=a.title;if(r)e._addColorSelect(a),e.brushColor=r,t.globalCompositeOperation="source-over",t.lineWidth=e.brushWidth,t.strokeStyle=r})},_addBrushBarListener:function(){var e=this;domUtils.on($G("J_brushBar"),"click",function(i){var a=e.getTarget(i),r=browser.ie?a.innerText:a.text;if(r)e._addBESelect(a),t.globalCompositeOperation="source-over",t.lineWidth=parseInt(r),t.strokeStyle=e.brushColor,e.brushWidth=t.lineWidth})},_addEraserBarListener:function(){var e=this;domUtils.on($G("J_eraserBar"),"click",function(i){var a=e.getTarget(i),r=browser.ie?a.innerText:a.text;if(r)e._addBESelect(a),t.lineWidth=parseInt(r),t.globalCompositeOperation="destination-out",t.strokeStyle="#FFF"})},_addAddImgListener:function(){var e=$G("J_imgTxt");if(!window.FileReader)$G("J_addImg").style.display="none",$G("J_removeImg").style.display="none",$G("J_sacleBoard").style.display="none";domUtils.on(e,"change",function(t){var i=e.parentNode;addMaskLayer(lang.backgroundUploading);var a=t.target||t.srcElement,r=new FileReader;r.onload=function(e){var t=e.target||e.srcElement;ue_callback(t.result,"SUCCESS")},r.readAsDataURL(a.files[0]),i.reset()})},_addRemoveImgListenter:function(){var e=this;domUtils.on($G("J_removeImg"),"click",function(){$G("J_picBoard").innerHTML="",e.btn2disable("J_removeImg"),e.btn2disable("J_sacleBoard")})},_addScalePicListenter:function(){domUtils.on($G("J_sacleBoard"),"click",function(){var t=$G("J_picBoard"),i=$G("J_scaleCon"),a=t.children[0];if(a)if(!i){t.style.cssText="position:relative;z-index:999;"+t.style.cssText,a.style.cssText="position: absolute;top:"+(e.height-a.height)/2+"px;left:"+(e.width-a.width)/2+"px;";var r=new ScaleBoy;t.appendChild(r.init()),r.startScale(a)}else if("visible"==i.style.visibility)i.style.visibility="hidden",t.style.position="",t.style.zIndex="";else i.style.visibility="visible",t.style.cssText+="position:relative;z-index:999"})},_addClearSelectionListenter:function(){var e=document;domUtils.on(e,"mousemove",function(){if(browser.ie&&browser.version<11)e.selection.clear();else window.getSelection().removeAllRanges()})},_clearSelection:function(){for(var e,t=["J_operateBar","J_colorBar","J_brushBar","J_eraserBar","J_picBoard"],i=0;e=t[i++];)domUtils.unSelectable($G(e))},_saveOPerate:function(e){var r=this;if(i.length<=e){if(a<i.length)r.btn2disable("J_nextStep"),i.splice(a);i.push(t.getImageData(0,0,t.canvas.width,t.canvas.height)),a=i.length}else i.shift(),i.push(t.getImageData(0,0,t.canvas.width,t.canvas.height)),a=i.length;r.btn2Highlight("J_previousStep"),r.btn2Highlight("J_clearBoard")},_originalColorSelect:function(e){for(var t,i=$G("J_colorList").getElementsByTagName("td"),a=0;t=i[a++];)if(t.children[0].title.toLowerCase()==e)t.children[0].style.opacity=1},_originalBrushSelect:function(e){for(var t,i=$G("J_brushBar").children,a=0;t=i[a++];)if("a"==t.tagName.toLowerCase()){var r=browser.ie?t.innerText:t.text;if(r.toLowerCase()==e)t.style.opacity=1}},_addColorSelect:function(e){for(var t,i=$G("J_colorList").getElementsByTagName("td"),a=$G("J_eraserBar").children,r=$G("J_brushBar").children,s=0;t=i[s++];)t.children[0].style.opacity=.3;for(var o,n=0;o=r[n++];)if("a"==o.tagName.toLowerCase()){o.style.opacity=.3;var l=browser.ie?o.innerText:o.text;if(l.toLowerCase()==this.brushWidth)o.style.opacity=1}for(var c,d=0;c=a[d++];)if("a"==c.tagName.toLowerCase())c.style.opacity=.3;e.style.opacity=1,e.blur()},_addBESelect:function(e){for(var t,i=$G("J_brushBar").children,a=$G("J_eraserBar").children,r=0;t=i[r++];)if("a"==t.tagName.toLowerCase())t.style.opacity=.3;for(var s,o=0;s=a[o++];)if("a"==s.tagName.toLowerCase())s.style.opacity=.3;e.style.opacity=1,e.blur()},getCanvasData:function(){var i=$G("J_picBoard"),a=i.children[0];if(a){var r,s;if("absolute"==a.style.position)r=parseInt(a.style.left),s=parseInt(a.style.top);else r=(i.offsetWidth-a.width)/2,s=(i.offsetHeight-a.height)/2;t.globalCompositeOperation="destination-over",t.drawImage(a,r,s,a.width,a.height)}else t.globalCompositeOperation="destination-atop",t.fillStyle="#fff",t.fillRect(0,0,e.width,e.height);try{return e.toDataURL("image/png").substring(22)}catch(o){return""}},btn2Highlight:function(e){var t=$G(e);-1==t.className.indexOf("H")&&(t.className+="H")},btn2disable:function(e){var t=$G(e);-1!=t.className.indexOf("H")&&(t.className=t.className.replace("H",""))},getTarget:function(e){return e.target||e.srcElement}}}();var ScaleBoy=function(){this.dom=null,this.scalingElement=null};!function(){function e(){var e=document,t=e.getElementsByTagName("head")[0],i=e.createElement("style"),a=".scale{visibility:hidden;cursor:move;position:absolute;left:0;top:0;width:100px;height:50px;background-color:#fff;font-size:0;line-height:0;opacity:.4;filter:Alpha(opacity=40);}.scale span{position:absolute;left:0;top:0;width:6px;height:6px;background-color:#006DAE;}.scale .hand0, .scale .hand7{cursor:nw-resize;}.scale .hand1, .scale .hand6{left:50%;margin-left:-3px;cursor:n-resize;}.scale .hand2, .scale .hand4, .scale .hand7{left:100%;margin-left:-6px;}.scale .hand3, .scale .hand4{top:50%;margin-top:-3px;cursor:w-resize;}.scale .hand5, .scale .hand6, .scale .hand7{margin-top:-6px;top:100%;}.scale .hand2, .scale .hand5{cursor:ne-resize;}";i.type="text/css";try{i.appendChild(e.createTextNode(a))}catch(r){i.styleSheet.cssText=a}t.appendChild(i)}function t(){var e=document,t=[],i=e.createElement("div");i.id="J_scaleCon",i.className="scale";for(var a=0;8>a;a++)t.push("<span class='hand"+a+"'></span>");return i.innerHTML=t.join(""),i}var i=[[1,1,-1,-1],[0,1,0,-1],[0,1,1,-1],[1,0,-1,0],[0,0,1,0],[1,0,-1,1],[0,0,0,1],[0,0,1,1]];ScaleBoy.prototype={init:function(){e();var i=this,a=i.dom=t();return i.scaleMousemove.fp=i,domUtils.on(a,"mousedown",function(e){var t=e.target||e.srcElement;if(i.start={x:e.clientX,y:e.clientY},-1!=t.className.indexOf("hand"))i.dir=t.className.replace("hand","");domUtils.on(document.body,"mousemove",i.scaleMousemove),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),domUtils.on(document.body,"mouseup",function(){if(i.start){if(domUtils.un(document.body,"mousemove",i.scaleMousemove),i.moved)i.updateScaledElement({position:{x:a.style.left,y:a.style.top},size:{w:a.style.width,h:a.style.height}});delete i.start,delete i.moved,delete i.dir}}),a},startScale:function(e){var t=this,i=t.dom;i.style.cssText="visibility:visible;top:"+e.style.top+";left:"+e.style.left+";width:"+e.offsetWidth+"px;height:"+e.offsetHeight+"px;",t.scalingElement=e},updateScaledElement:function(e){var t=this.scalingElement,i=e.position,a=e.size;if(i)"undefined"!=typeof i.x&&(t.style.left=i.x),"undefined"!=typeof i.y&&(t.style.top=i.y);if(a)a.w&&(t.style.width=a.w),a.h&&(t.style.height=a.h)},updateStyleByDir:function(e,t){var a,r=this,s=r.dom;if(i.def=[1,1,0,0],0!=i[e][0])a=parseInt(s.style.left)+t.x,s.style.left=r._validScaledProp("left",a)+"px";if(0!=i[e][1])a=parseInt(s.style.top)+t.y,s.style.top=r._validScaledProp("top",a)+"px";if(0!=i[e][2])a=s.clientWidth+i[e][2]*t.x,s.style.width=r._validScaledProp("width",a)+"px";if(0!=i[e][3])a=s.clientHeight+i[e][3]*t.y,s.style.height=r._validScaledProp("height",a)+"px";if("def"===e)r.updateScaledElement({position:{x:s.style.left,y:s.style.top}})},scaleMousemove:function(e){var t=arguments.callee.fp,i=t.start,a=t.dir||"def",r={x:e.clientX-i.x,y:e.clientY-i.y};t.updateStyleByDir(a,r),arguments.callee.fp.start={x:e.clientX,y:e.clientY},arguments.callee.fp.moved=1},_validScaledProp:function(e,t){var i=this.dom,a=$G("J_picBoard");switch(t=isNaN(t)?0:t,e){case"left":return 0>t?0:t+i.clientWidth>a.clientWidth?a.clientWidth-i.clientWidth:t;case"top":return 0>t?0:t+i.clientHeight>a.clientHeight?a.clientHeight-i.clientHeight:t;case"width":return 0>=t?1:t+i.offsetLeft>a.clientWidth?a.clientWidth-i.offsetLeft:t;case"height":return 0>=t?1:t+i.offsetTop>a.clientHeight?a.clientHeight-i.offsetTop:t}}}}();