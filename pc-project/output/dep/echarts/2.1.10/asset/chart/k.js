define("echarts/chart/k",["require","../component/base","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(require){function e(e,s,o,n,r){t.call(this,e,s,o,n,r),i.call(this),this.refresh(n)}var t=require("../component/base"),i=require("./base"),s=require("../util/shape/Candle");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var o=require("../config"),n=require("../util/ecData"),r=require("zrender/tool/util");return e.prototype={type:o.CHART_TYPE_K,_buildShape:function(){var e=this.series;this.selectedMap={};for(var t,i={top:[],bottom:[]},s=0,n=e.length;n>s;s++)if(e[s].type===o.CHART_TYPE_K)if(e[s]=this.reformOption(e[s]),this.legendHoverLink=e[s].legendHoverLink||this.legendHoverLink,t=this.component.xAxis.getAxis(e[s].xAxisIndex),t.type===o.COMPONENT_TYPE_AXIS_CATEGORY)i[t.getPosition()].push(s);for(var r in i)if(i[r].length>0)this._buildSinglePosition(r,i[r]);this.addShapeList()},_buildSinglePosition:function(e,t){var i=this._mapData(t),s=i.locationMap,o=i.maxDataLength;if(0!==o&&0!==s.length){this._buildHorizontal(t,o,s);for(var n=0,r=t.length;r>n;n++)this.buildMark(t[n])}},_mapData:function(e){for(var t,i,s=this.series,o=this.component.legend,n=[],r=0,l=0,a=e.length;a>l;l++){if(t=s[e[l]],i=t.name,o)this.selectedMap[i]=o.isSelected(i);else this.selectedMap[i]=!0;if(this.selectedMap[i])n.push(e[l]);r=Math.max(r,t.data.length)}return{locationMap:n,maxDataLength:r}},_buildHorizontal:function(e,t,i){for(var s,o,n,r,l,a,h,d,y,c,p=this.series,m={},u=0,g=i.length;g>u;u++){if(s=i[u],o=p[s],n=o.xAxisIndex||0,r=this.component.xAxis.getAxis(n),h=o.barWidth||Math.floor(r.getGap()/2),c=o.barMaxWidth,c&&h>c)h=c;l=o.yAxisIndex||0,a=this.component.yAxis.getAxis(l),m[s]=[];for(var x=0,f=t;f>x&&null!=r.getNameByIndex(x);x++)if(d=o.data[x],y=null!=d?null!=d.value?d.value:d:"-","-"!==y&&4==y.length)m[s].push([r.getCoordByIndex(x),h,a.getCoord(y[0]),a.getCoord(y[1]),a.getCoord(y[2]),a.getCoord(y[3]),x,r.getNameByIndex(x)]);else;}this._buildKLine(e,m)},_buildKLine:function(e,t){for(var i,s,n,r,l,a,h,d,y,c,p,m,u,g,x,f,S,A=this.series,_=0,v=e.length;v>_;_++){if(S=e[_],p=A[S],g=t[S],this._isLarge(g))g=this._getLargePointList(g);if(p.type===o.CHART_TYPE_K&&null!=g){m=p,i=this.query(m,"itemStyle.normal.lineStyle.width"),s=this.query(m,"itemStyle.normal.lineStyle.color"),n=this.query(m,"itemStyle.normal.lineStyle.color0"),r=this.query(m,"itemStyle.normal.color"),l=this.query(m,"itemStyle.normal.color0"),a=this.query(m,"itemStyle.emphasis.lineStyle.width"),h=this.query(m,"itemStyle.emphasis.lineStyle.color"),d=this.query(m,"itemStyle.emphasis.lineStyle.color0"),y=this.query(m,"itemStyle.emphasis.color"),c=this.query(m,"itemStyle.emphasis.color0");for(var C=0,L=g.length;L>C;C++)x=g[C],u=p.data[x[6]],m=u,f=x[3]<x[2],this.shapeList.push(this._getCandle(S,x[6],x[7],x[0],x[1],x[2],x[3],x[4],x[5],f?this.query(m,"itemStyle.normal.color")||r:this.query(m,"itemStyle.normal.color0")||l,this.query(m,"itemStyle.normal.lineStyle.width")||i,f?this.query(m,"itemStyle.normal.lineStyle.color")||s:this.query(m,"itemStyle.normal.lineStyle.color0")||n,f?this.query(m,"itemStyle.emphasis.color")||y||r:this.query(m,"itemStyle.emphasis.color0")||c||l,this.query(m,"itemStyle.emphasis.lineStyle.width")||a||i,f?this.query(m,"itemStyle.emphasis.lineStyle.color")||h||s:this.query(m,"itemStyle.emphasis.lineStyle.color0")||d||n))}}},_isLarge:function(e){return e[0][1]<.5},_getLargePointList:function(e){for(var t=this.component.grid.getWidth(),i=e.length,s=[],o=0;t>o;o++)s[o]=e[Math.floor(i/t*o)];return s},_getCandle:function(e,t,i,o,r,l,a,h,d,y,c,p,m,u,g){var x=this.series,f={zlevel:this._zlevelBase,clickable:this.deepQuery([x[e].data[t],x[e]],"clickable"),style:{x:o,y:[l,a,h,d],width:r,color:y,strokeColor:p,lineWidth:c,brushType:"both"},highlightStyle:{color:m,strokeColor:g,lineWidth:u},_seriesIndex:e};return n.pack(f,x[e],e,x[e].data[t],t,i),f=new s(f)},getMarkCoord:function(e,t){var i=this.series[e],s=this.component.xAxis.getAxis(i.xAxisIndex),o=this.component.yAxis.getAxis(i.yAxisIndex);return["string"!=typeof t.xAxis&&s.getCoordByIndex?s.getCoordByIndex(t.xAxis||0):s.getCoord(t.xAxis||0),"string"!=typeof t.yAxis&&o.getCoordByIndex?o.getCoordByIndex(t.yAxis||0):o.getCoord(t.yAxis||0)]},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()},addDataAnimation:function(e){for(var t=this.series,i={},s=0,o=e.length;o>s;s++)i[e[s][0]]=e[s];for(var r,l,a,h,d,y,s=0,o=this.shapeList.length;o>s;s++)if(d=this.shapeList[s]._seriesIndex,i[d]&&!i[d][3])if("candle"===this.shapeList[s].type){if(y=n.get(this.shapeList[s],"dataIndex"),h=t[d],i[d][2]&&y===h.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}else if(!i[d][2]&&0===y){this.zr.delShape(this.shapeList[s].id);continue}l=this.component.xAxis.getAxis(h.xAxisIndex||0).getGap(),r=i[d][2]?l:-l,a=0,this.zr.animate(this.shapeList[s].id,"").when(500,{position:[r,a]}).start()}}},r.inherits(e,i),r.inherits(e,t),require("../chart").define("k",e),e});