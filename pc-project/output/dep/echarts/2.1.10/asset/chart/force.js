define("echarts/chart/force",["require","../component/base","./base","../data/Graph","../layout/Force","zrender/shape/Line","zrender/shape/BezierCurve","zrender/shape/Image","../util/shape/Icon","../config","../util/ecData","zrender/tool/util","zrender/config","zrender/tool/vector","../chart"],function(require){"use strict";function e(e,s,d,l,p){var u=this;n.call(this,e,s,d,l,p),r.call(this),this.__nodePositionMap={},this._graph=new a(!0),this._layout=new h,this._layout.onupdate=function(){u._step()},this._steps=1,this.ondragstart=function(){t.apply(u,arguments)},this.ondragend=function(){o.apply(u,arguments)},this.ondrop=function(){},this.shapeHandler.ondragstart=function(){u.isDragstart=!0},this.onmousemove=function(){i.apply(u,arguments)},this.refresh(l)}function t(e){if(this.isDragstart&&e.target){var t=e.target;t.fixed=!0,this.isDragstart=!1,this.zr.on(y.EVENT.MOUSEMOVE,this.onmousemove)}}function i(){this._layout.temperature=.8,this._step()}function o(e,t){if(this.isDragend&&e.target){var i=e.target;i.fixed=!1,t.dragIn=!0,t.needRefresh=!1,this.isDragend=!1,this.zr.un(y.EVENT.MOUSEMOVE,this.onmousemove)}}function s(e,t,i){var o=v.create();return o[0]=(Math.random()-.5)*i+e,o[1]=(Math.random()-.5)*i+t,o}var n=require("../component/base"),r=require("./base"),a=require("../data/Graph"),h=require("../layout/Force"),d=require("zrender/shape/Line"),l=require("zrender/shape/BezierCurve"),p=require("zrender/shape/Image"),u=require("../util/shape/Icon"),f=require("../config"),c=require("../util/ecData"),g=require("zrender/tool/util"),y=require("zrender/config"),v=require("zrender/tool/vector");return e.prototype={constructor:e,type:f.CHART_TYPE_FORCE,_init:function(){var e,t=this.component.legend,i=this.series;this.clear();for(var o=0,s=i.length;s>o;o++){var n=i[o];if(n.type===f.CHART_TYPE_FORCE){if(i[o]=this.reformOption(i[o]),e=i[o].name||"",this.selectedMap[e]=t?t.isSelected(e):!0,!this.selectedMap[e])continue;this.buildMark(o),this._initSerie(n,o);break}}},_getNodeCategory:function(e,t){return e.categories&&e.categories[t.category||0]},_getNodeQueryTarget:function(e,t,i){i=i||"normal";var o=this._getNodeCategory(e,t)||{};return[t.itemStyle&&t.itemStyle[i],o&&o.itemStyle&&o.itemStyle[i],e.itemStyle[i].nodeStyle]},_getEdgeQueryTarget:function(e,t,i){return i=i||"normal",[t.itemStyle&&t.itemStyle[i],e.itemStyle[i].linkStyle]},_initSerie:function(e,t){if(this._temperature=1,e.data)this._graph=this._getSerieGraphFromDataMatrix(e);else this._graph=this._getSerieGraphFromNodeLinks(e);this._buildLinkShapes(e,t),this._buildNodeShapes(e,t),this.zr.modLayer(this.getZlevelBase(),{panable:e.roam===!0||"move"===e.roam,zoomable:e.roam===!0||"scale"===e.roam}),this._initLayout(e),this._step()},_getSerieGraphFromDataMatrix:function(e){for(var t=[],i=0,o=[],s=0;s<e.matrix.length;s++)o[s]=e.matrix[s].slice();for(var n=e.data||e.nodes,s=0;s<n.length;s++){var r={},h=n[s];for(var d in h)if("name"===d)r.id=h.name;else r[d]=h[d];var l=this._getNodeCategory(e,h),p=l?l.name:h.name;if(this.selectedMap[p]=this.isSelected(p),this.selectedMap[p])t.push(r),i++;else{o.splice(i,1);for(var u=0;u<o.length;u++)o[u].splice(i,1)}}var f=a.fromMatrix(t,o,!0);return f.eachNode(function(e,t){e.layout={size:e.data.value,mass:0},e.rawIndex=t}),f.eachEdge(function(e){e.layout={weight:e.data.weight}}),f},_getSerieGraphFromNodeLinks:function(e){for(var t=new a(!0),i=e.data||e.nodes,o=0,s=i.length;s>o;o++){var n=i[o];if(n&&!n.ignore){var r=this._getNodeCategory(e,n),h=r?r.name:n.name;if(this.selectedMap[h]=this.isSelected(h),this.selectedMap[h]){var d=t.addNode(n.name,n);d.rawIndex=o}}else;}for(var o=0,s=e.links.length;s>o;o++){var l=e.links[o],p=l.source,u=l.target;if("number"==typeof p)if(p=i[p])p=p.name;if("number"==typeof u)if(u=i[u])u=u.name;var f=t.addEdge(p,u,l);if(f)f.rawIndex=o}return t.eachNode(function(e){var t=e.data.value;if(null==t){t=0;for(var i=0;i<e.edges.length;i++)t+=e.edges[i].data.weight||0}e.layout={size:t,mass:0}}),t.eachEdge(function(e){e.layout={weight:null==e.data.weight?1:e.data.weight}}),t},_initLayout:function(e){var t=this._graph,i=t.nodes.length,o=this.query(e,"minRadius"),n=this.query(e,"maxRadius");this._steps=e.steps||1,this._layout.center=this.parseCenter(this.zr,e.center),this._layout.width=this.parsePercent(e.size,this.zr.getWidth()),this._layout.height=this.parsePercent(e.size,this.zr.getHeight()),this._layout.large=e.large,this._layout.scaling=e.scaling,this._layout.ratioScaling=e.ratioScaling,this._layout.gravity=e.gravity,this._layout.temperature=1,this._layout.coolDown=e.coolDown,this._layout.preventNodeEdgeOverlap=e.preventOverlap,this._layout.preventNodeOverlap=e.preventOverlap;for(var r=1/0,a=-(1/0),h=0;i>h;h++){var d=t.nodes[h];a=Math.max(d.layout.size,a),r=Math.min(d.layout.size,r)}for(var l=a-r,h=0;i>h;h++){var d=t.nodes[h];if(l>0)d.layout.size=(d.layout.size-r)*(n-o)/l+o,d.layout.mass=d.layout.size/n;else d.layout.size=(n-o)/2,d.layout.mass=.5}for(var h=0;i>h;h++){var d=t.nodes[h];if("undefined"!=typeof this.__nodePositionMap[d.id])d.layout.position=v.create(),v.copy(d.layout.position,this.__nodePositionMap[d.id]);else if("undefined"!=typeof d.data.initial)d.layout.position=v.create(),v.copy(d.layout.position,d.data.initial);else{var p=this._layout.center,u=Math.min(this._layout.width,this._layout.height);d.layout.position=s(p[0],p[1],.8*u)}var f=d.shape.style,c=d.layout.size;f.width=f.width||2*c,f.height=f.height||2*c,f.x=-f.width/2,f.y=-f.height/2,v.copy(d.shape.position,d.layout.position)}i=t.edges.length,a=-(1/0);for(var h=0;i>h;h++){var g=t.edges[h];if(g.layout.weight>a)a=g.layout.weight}for(var h=0;i>h;h++){var g=t.edges[h];g.layout.weight/=a}this._layout.init(t,e.useWorker)},_buildNodeShapes:function(e,t){var i=this._graph,o=this.query(e,"categories");i.eachNode(function(i){var s=this._getNodeCategory(e,i.data),n=[i.data,s,e],r=this._getNodeQueryTarget(e,i.data),a=this._getNodeQueryTarget(e,i.data,"emphasis"),h=new u({style:{x:0,y:0,color:this.deepQuery(r,"color"),brushType:"both",strokeColor:this.deepQuery(r,"strokeColor")||this.deepQuery(r,"borderColor"),lineWidth:this.deepQuery(r,"lineWidth")||this.deepQuery(r,"borderWidth")},highlightStyle:{color:this.deepQuery(a,"color","emphasis"),strokeColor:this.deepQuery(a,"strokeColor","emphasis")||this.deepQuery(a,"borderColor","emphasis"),lineWidth:this.deepQuery(a,"lineWidth","emphasis")||this.deepQuery(a,"borderWidth","emphasis")},clickable:e.clickable,zlevel:this.getZlevelBase()});if(!h.style.color)h.style.color=s?this.getColor(s.name):this.getColor(i.id);if(h.style.iconType=this.deepQuery(n,"symbol"),h.style.width=h.style.height=2*(this.deepQuery(n,"symbolSize")||0),h.style.iconType.match("image"))h.style.image=h.style.iconType.replace(new RegExp("^image:\\/\\/"),""),h=new p({style:h.style,highlightStyle:h.highlightStyle,clickable:h.clickable});if(this.deepQuery(n,"itemStyle.normal.label.show"))h.style.text=null==i.data.label?i.id:i.data.label,h.style.textPosition=this.deepQuery(n,"itemStyle.normal.label.position"),h.style.textColor=this.deepQuery(n,"itemStyle.normal.label.textStyle.color"),h.style.textFont=this.getFont(this.deepQuery(n,"itemStyle.normal.label.textStyle")||{});if(this.deepQuery(n,"itemStyle.emphasis.label.show"))h.highlightStyle.textPosition=this.deepQuery(n,"itemStyle.emphasis.label.position"),h.highlightStyle.textColor=this.deepQuery(n,"itemStyle.emphasis.label.textStyle.color"),h.highlightStyle.textFont=this.getFont(this.deepQuery(n,"itemStyle.emphasis.label.textStyle")||{});if(this.deepQuery(n,"draggable"))this.setCalculable(h),h.dragEnableTime=0,h.draggable=!0,h.ondragstart=this.shapeHandler.ondragstart,h.ondragover=null;var d="";if("undefined"!=typeof i.category){var s=o[i.category];d=s&&s.name||""}c.pack(h,e,t,i.data,i.rawIndex,i.data.name||"",i.category),this.shapeList.push(h),this.zr.addShape(h),i.shape=h},this)},_buildLinkShapes:function(e,t){for(var i=this._graph,o=i.edges.length,s=0;o>s;s++){var n=i.edges[s],r=n.data,a=n.node1,h=n.node2,p=this._getEdgeQueryTarget(e,n),f=this.deepQuery(p,"type");if(e.linkSymbol&&"none"!==e.linkSymbol)f="line";var y="line"===f?d:l,v=new y({style:{xStart:0,yStart:0,xEnd:0,yEnd:0,lineWidth:1},clickable:this.query(e,"clickable"),highlightStyle:{},zlevel:this.getZlevelBase()});if(g.merge(v.style,this.query(e,"itemStyle.normal.linkStyle"),!0),g.merge(v.highlightStyle,this.query(e,"itemStyle.emphasis.linkStyle"),!0),"undefined"!=typeof r.itemStyle){if(r.itemStyle.normal)g.merge(v.style,r.itemStyle.normal,!0);if(r.itemStyle.emphasis)g.merge(v.highlightStyle,r.itemStyle.emphasis,!0)}if(v.style.lineWidth=v.style.lineWidth||v.style.width,v.style.strokeColor=v.style.strokeColor||v.style.color,v.highlightStyle.lineWidth=v.highlightStyle.lineWidth||v.highlightStyle.width,v.highlightStyle.strokeColor=v.highlightStyle.strokeColor||v.highlightStyle.color,c.pack(v,e,t,n.data,null==n.rawIndex?s:n.rawIndex,n.data.name||a.id+" - "+h.id,a.id,h.id),this.shapeList.push(v),this.zr.addShape(v),n.shape=v,e.linkSymbol&&"none"!==e.linkSymbol){var m=new u({style:{x:-5,y:0,width:e.linkSymbolSize[0],height:e.linkSymbolSize[1],iconType:e.linkSymbol,brushType:"fill",color:v.style.strokeColor,opacity:v.style.opacity,shadowBlur:v.style.shadowBlur,shadowColor:v.style.shadowColor,shadowOffsetX:v.style.shadowOffsetX,shadowOffsetY:v.style.shadowOffsetY},highlightStyle:{brushType:"fill"},position:[0,0],rotation:0});v._symbolShape=m,this.shapeList.push(m),this.zr.addShape(m)}}},_updateLinkShapes:function(){for(var e=v.create(),t=this._graph.edges,i=0,o=t.length;o>i;i++){var s=t[i],n=s.node1.shape,r=s.node2.shape,a=n.position,h=r.position;if(s.shape.style.xStart=a[0],s.shape.style.yStart=a[1],s.shape.style.xEnd=h[0],s.shape.style.yEnd=h[1],"bezier-curve"===s.shape.type)s.shape.style.cpX1=(a[0]+h[0])/2-(h[1]-a[1])/4,s.shape.style.cpY1=(a[1]+h[1])/2-(a[0]-h[0])/4;if(s.shape.modSelf(),s.shape._symbolShape){var d=s.shape._symbolShape;v.copy(d.position,r.position),v.sub(e,n.position,r.position),v.normalize(e,e),v.scaleAndAdd(d.position,d.position,e,r.style.width/2+2);var l=Math.atan2(e[1],e[0]);d.rotation=Math.PI/2-l,d.modSelf()}}},_syncNodePositions:function(){for(var e=this._graph,t=0;t<e.nodes.length;t++){var i=e.nodes[t],o=i.layout.position,s=i.data,n=i.shape;if(n.fixed||s.fixX&&s.fixY)v.copy(o,n.position);else if(s.fixX)o[0]=n.position[0],n.position[1]=o[1];else if(s.fixY)o[1]=n.position[1],n.position[0]=o[0];else if(0==isNaN(s.fixX-0)&&0==isNaN(s.fixY-0))n.position[0]+=(o[0]-n.position[0])*s.fixX,o[0]=n.position[0],n.position[1]+=(o[1]-n.position[1])*s.fixY,o[1]=n.position[1];else if(0==isNaN(s.fixX-0))n.position[0]+=(o[0]-n.position[0])*s.fixX,o[0]=n.position[0],n.position[1]=o[1];else if(0==isNaN(s.fixY-0))n.position[1]+=(o[1]-n.position[1])*s.fixY,o[1]=n.position[1],n.position[0]=o[0];else v.copy(n.position,o);var r=s.name;if(r){var a=this.__nodePositionMap[r];if(!a)a=this.__nodePositionMap[r]=v.create();v.copy(a,o)}n.modSelf()}},_step:function(){if(this._syncNodePositions(),this._updateLinkShapes(),this.zr.refreshNextFrame(),this._layout.temperature>.01)this._layout.step(this._steps);else this.messageCenter.dispatch(f.EVENT.FORCE_LAYOUT_END,{},{},this.myChart)},refresh:function(e){if(e)this.option=e,this.series=this.option.series;if(this.legend=this.component.legend,this.legend)this.getColor=function(e){return this.legend.getColor(e)},this.isSelected=function(e){return this.legend.isSelected(e)};else{var t={},i=0;this.getColor=function(e){if(t[e])return t[e];if(!t[e])t[e]=this.zr.getColor(i++);return t[e]},this.isSelected=function(){return!0}}this._init()},dispose:function(){this.clear(),this.shapeList=null,this.effectList=null,this._layout.dispose(),this._layout=null,this.__nodePositionMap={}},getPosition:function(){var e=[];return this._graph.eachNode(function(t){if(t.layout)e.push({name:t.data.name,position:Array.prototype.slice.call(t.layout.position)})}),e}},g.inherits(e,r),g.inherits(e,n),require("../chart").define("force",e),e}),define("echarts/data/Graph",["require","zrender/tool/util"],function(require){var e=require("zrender/tool/util"),t=function(e){this._directed=e||!1,this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={}};t.prototype.isDirected=function(){return this._directed},t.prototype.addNode=function(e,i){if(this._nodesMap[e])return this._nodesMap[e];var o=new t.Node(e,i);return this.nodes.push(o),this._nodesMap[e]=o,o},t.prototype.getNodeById=function(e){return this._nodesMap[e]},t.prototype.addEdge=function(e,i,o){if("string"==typeof e)e=this._nodesMap[e];if("string"==typeof i)i=this._nodesMap[i];if(e&&i){var s=e.id+"-"+i.id;if(this._edgesMap[s])return this._edgesMap[s];var n=new t.Edge(e,i,o);if(this._directed)e.outEdges.push(n),i.inEdges.push(n);if(e.edges.push(n),e!==i)i.edges.push(n);return this.edges.push(n),this._edgesMap[s]=n,n}},t.prototype.removeEdge=function(t){var i=t.node1,o=t.node2,s=i.id+"-"+o.id;if(this._directed)i.outEdges.splice(e.indexOf(i.outEdges,t),1),o.inEdges.splice(e.indexOf(o.inEdges,t),1);if(i.edges.splice(e.indexOf(i.edges,t),1),i!==o)o.edges.splice(e.indexOf(o.edges,t),1);delete this._edgesMap[s],this.edges.splice(e.indexOf(this.edges,t),1)},t.prototype.getEdge=function(e,t){if("string"!=typeof e)e=e.id;if("string"!=typeof t)t=t.id;if(this._directed)return this._edgesMap[e+"-"+t]||this._edgesMap[t+"-"+e];else return this._edgesMap[e+"-"+t]},t.prototype.removeNode=function(t){if("string"==typeof t)if(t=this._nodesMap[t],!t)return;delete this._nodesMap[t.id],this.nodes.splice(e.indexOf(this.nodes,t),1);for(var i=0;i<this.edges.length;){var o=this.edges[i];if(o.node1===t||o.node2===t)this.removeEdge(o);else i++}},t.prototype.filterNode=function(e,t){for(var i=this.nodes.length,o=0;i>o;)if(e.call(t,this.nodes[o],o))o++;else this.removeNode(this.nodes[o]),i--},t.prototype.filterEdge=function(e,t){for(var i=this.edges.length,o=0;i>o;)if(e.call(t,this.edges[o],o))o++;else this.removeEdge(this.edges[o]),i--},t.prototype.eachNode=function(e,t){for(var i=this.nodes.length,o=0;i>o;o++)if(this.nodes[o])e.call(t,this.nodes[o],o)},t.prototype.eachEdge=function(e,t){for(var i=this.edges.length,o=0;i>o;o++)if(this.edges[o])e.call(t,this.edges[o],o)},t.prototype.clear=function(){this.nodes.length=0,this.edges.length=0,this._nodesMap={},this._edgesMap={}},t.prototype.breadthFirstTraverse=function(e,t,i,o){if("string"==typeof t)t=this._nodesMap[t];if(t){var s="edges";if("out"===i)s="outEdges";else if("in"===i)s="inEdges";for(var n=0;n<this.nodes.length;n++)this.nodes[n].__visited=!1;if(!e.call(o,t,null))for(var r=[t];r.length;)for(var a=r.shift(),h=a[s],n=0;n<h.length;n++){var d=h[n],l=d.node1===a?d.node2:d.node1;if(!l.__visited){if(e.call(l,l,a))return;r.push(l),l.__visited=!0}}}},t.prototype.clone=function(){for(var e=new t(this._directed),i=0;i<this.nodes.length;i++)e.addNode(this.nodes[i].id,this.nodes[i].data);for(var i=0;i<this.edges.length;i++){var o=this.edges[i];e.addEdge(o.node1.id,o.node2.id,o.data)}return e};var i=function(e,t){this.id=e,this.data=t||null,this.inEdges=[],this.outEdges=[],this.edges=[]};i.prototype.degree=function(){return this.edges.length},i.prototype.inDegree=function(){return this.inEdges.length},i.prototype.outDegree=function(){return this.outEdges.length};var o=function(e,t,i){this.node1=e,this.node2=t,this.data=i||null};return t.Node=i,t.Edge=o,t.fromMatrix=function(e,i,o){if(i&&i.length&&i[0].length===i.length&&e.length===i.length){for(var s=i.length,n=new t(o),r=0;s>r;r++){var a=n.addNode(e[r].id,e[r]);if(a.data.value=0,o)a.data.outValue=a.data.inValue=0}for(var r=0;s>r;r++)for(var h=0;s>h;h++){var d=i[r][h];if(o)n.nodes[r].data.outValue+=d,n.nodes[h].data.inValue+=d;n.nodes[r].data.value+=d,n.nodes[h].data.value+=d}for(var r=0;s>r;r++)for(var h=r;s>h;h++){var d=i[r][h];if(0!==d){var l=n.nodes[r],p=n.nodes[h],u=n.addEdge(l,p,{});if(u.data.weight=d,r!==h)if(o&&i[h][r]){var f=n.addEdge(p,l,{});f.data.weight=i[h][r]}}else;}return n}},t}),define("echarts/layout/Force",["require","./forceLayoutWorker","zrender/tool/vector"],function(require){function e(){return Math.round((new Date).getTime()/100)%1e7}function t(){if("undefined"!=typeof Worker&&"undefined"!=typeof Blob)try{var e=new Blob([o.getWorkerCode()]);i=window.URL.createObjectURL(e)}catch(t){i=""}return i}var i,o=require("./forceLayoutWorker"),s=require("zrender/tool/vector"),n=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,16)},r="undefined"==typeof Float32Array?Array:Float32Array,a=function(e){if("undefined"==typeof i)t();e=e||{},this.width=e.width||500,this.height=e.height||500,this.center=e.center||[this.width/2,this.height/2],this.ratioScaling=e.ratioScaling||!1,this.scaling=e.scaling||1,this.gravity="undefined"!=typeof e.gravity?e.gravity:1,this.large=e.large||!1,this.preventNodeOverlap=e.preventNodeOverlap||!1,this.preventNodeEdgeOverlap=e.preventNodeEdgeOverlap||!1,this.maxSpeedIncrease=e.maxSpeedIncrease||1,this.onupdate=e.onupdate||function(){},this.temperature=e.temperature||1,this.coolDown=e.coolDown||.99,this._layout=null,this._layoutWorker=null,this._token=0;var o=this,s=this._$onupdate;this._$onupdate=function(e){s.call(o,e)}};return a.prototype.updateConfig=function(){var e=this.width,t=this.height,i=Math.min(e,t),o={center:this.center,width:this.ratioScaling?e:i,height:this.ratioScaling?t:i,scaling:this.scaling||1,gravity:this.gravity||1,barnesHutOptimize:this.large,preventNodeOverlap:this.preventNodeOverlap,preventNodeEdgeOverlap:this.preventNodeEdgeOverlap,maxSpeedIncrease:this.maxSpeedIncrease};if(this._layoutWorker)this._layoutWorker.postMessage({cmd:"updateConfig",config:o});else for(var s in o)this._layout[s]=o[s]},a.prototype.init=function(t,s){if(i&&s)try{if(!this._layoutWorker)this._layoutWorker=new Worker(i),this._layoutWorker.onmessage=this._$onupdate;this._layout=null}catch(n){if(this._layoutWorker=null,!this._layout)this._layout=new o}else{if(!this._layout)this._layout=new o;if(this._layoutWorker)this._layoutWorker.terminate(),this._layoutWorker=null}this.temperature=1,this.graph=t;for(var a=t.nodes.length,h=new r(2*a),d=new r(a),l=new r(a),p=0;a>p;p++){var u=t.nodes[p];h[2*p]=u.layout.position[0],h[2*p+1]=u.layout.position[1],d[p]="undefined"==typeof u.layout.mass?1:u.layout.mass,l[p]="undefined"==typeof u.layout.size?1:u.layout.size,u.layout.__index=p}a=t.edges.length;for(var f=new r(2*a),c=new r(a),p=0;a>p;p++){var g=t.edges[p];f[2*p]=g.node1.layout.__index,f[2*p+1]=g.node2.layout.__index,c[p]=g.layout.weight||1}if(this._token=e(),this._layoutWorker)this._layoutWorker.postMessage({cmd:"init",nodesPosition:h,nodesMass:d,nodesSize:l,edges:f,edgesWeight:c,token:this._token});else this._layout.setToken(this._token),this._layout.initNodes(h,d,l),this._layout.initEdges(f,c);this.updateConfig()},a.prototype.step=function(e){var t=this.graph.nodes;if(this._layoutWorker){for(var i=new r(2*t.length+1),o=0;o<t.length;o++){var a=t[o];i[2*o+1]=a.layout.position[0],i[2*o+2]=a.layout.position[1]}this._layoutWorker.postMessage(i.buffer,[i.buffer]),this._layoutWorker.postMessage({cmd:"update",steps:e,temperature:this.temperature,coolDown:this.coolDown});for(var o=0;e>o;o++)this.temperature*=this.coolDown}else{n(this._$onupdate);for(var o=0;o<t.length;o++){var a=t[o];s.copy(this._layout.nodes[o].position,a.layout.position)}for(var o=0;e>o;o++)this._layout.temperature=this.temperature,this._layout.update(),this.temperature*=this.coolDown}},a.prototype._$onupdate=function(e){if(this._layoutWorker){var t=new Float32Array(e.data),i=t[0];if(i===this._token){for(var o=0;o<this.graph.nodes.length;o++){var n=this.graph.nodes[o];n.layout.position[0]=t[2*o+1],n.layout.position[1]=t[2*o+2]}this.onupdate&&this.onupdate()}}else if(this._layout)if(this._layout.tokenMatch(this._token)){for(var o=0;o<this.graph.nodes.length;o++){var n=this.graph.nodes[o];s.copy(n.layout.position,this._layout.nodes[o].position)}this.onupdate&&this.onupdate()}},a.prototype.dispose=function(){if(this._layoutWorker)this._layoutWorker.terminate();this._layoutWorker=null,this._layout=null,this._token=0},a}),define("zrender/shape/BezierCurve",["require","./Base","../tool/util"],function(require){"use strict";var e=require("./Base"),t=function(t){this.brushTypeOnly="stroke",this.textPosition="end",e.call(this,t)};return t.prototype={type:"bezier-curve",buildPath:function(e,t){if(e.moveTo(t.xStart,t.yStart),"undefined"!=typeof t.cpX2&&"undefined"!=typeof t.cpY2)e.bezierCurveTo(t.cpX1,t.cpY1,t.cpX2,t.cpY2,t.xEnd,t.yEnd);else e.quadraticCurveTo(t.cpX1,t.cpY1,t.xEnd,t.yEnd)},getRect:function(e){if(e.__rect)return e.__rect;var t=Math.min(e.xStart,e.xEnd,e.cpX1),i=Math.min(e.yStart,e.yEnd,e.cpY1),o=Math.max(e.xStart,e.xEnd,e.cpX1),s=Math.max(e.yStart,e.yEnd,e.cpY1),n=e.cpX2,r=e.cpY2;if("undefined"!=typeof n&&"undefined"!=typeof r)t=Math.min(t,n),i=Math.min(i,r),o=Math.max(o,n),s=Math.max(s,r);var a=e.lineWidth||1;return e.__rect={x:t-a,y:i-a,width:o-t+a,height:s-i+a},e.__rect}},require("../tool/util").inherits(t,e),t}),define("echarts/layout/forceLayoutWorker",["require","zrender/tool/vector"],function e(require){"use strict";function t(){this.subRegions=[],this.nSubRegions=0,this.node=null,this.mass=0,this.centerOfMass=null,this.bbox=new a(4),this.size=0}function i(){this.position=n.create(),this.force=n.create(),this.forcePrev=n.create(),this.speed=n.create(),this.speedPrev=n.create(),this.mass=1,this.inDegree=0,this.outDegree=0}function o(e,t){this.node1=e,this.node2=t,this.weight=1}function s(){this.barnesHutOptimize=!1,this.barnesHutTheta=1.5,this.repulsionByDegree=!1,this.preventNodeOverlap=!1,this.preventNodeEdgeOverlap=!1,this.strongGravity=!0,this.gravity=1,this.scaling=1,this.edgeWeightInfluence=1,this.center=[0,0],this.width=500,this.height=500,this.maxSpeedIncrease=1,this.nodes=[],this.edges=[],this.bbox=new a(4),this._rootRegion=new t,this._rootRegion.centerOfMass=n.create(),this._massArr=null,this._k=0}var n,r="undefined"==typeof window&&"undefined"==typeof require;if(r)n={create:function(e,t){var i=new Float32Array(2);return i[0]=e||0,i[1]=t||0,i},dist:function(e,t){var i=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(i*i+o*o)},len:function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},scaleAndAdd:function(e,t,i,o){return e[0]=t[0]+i[0]*o,e[1]=t[1]+i[1]*o,e},scale:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},sub:function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},normalize:function(e,t){var i=t[0],o=t[1],s=i*i+o*o;if(s>0)s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s;return e},negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,i){return e[0]=t,e[1]=i,e}};else n=require("zrender/tool/vector");var a="undefined"==typeof Float32Array?Array:Float32Array;if(t.prototype.beforeUpdate=function(){for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].beforeUpdate();if(this.mass=0,this.centerOfMass)this.centerOfMass[0]=0,this.centerOfMass[1]=0;this.nSubRegions=0,this.node=null},t.prototype.afterUpdate=function(){this.subRegions.length=this.nSubRegions;for(var e=0;e<this.nSubRegions;e++)this.subRegions[e].afterUpdate()},t.prototype.addNode=function(e){if(0===this.nSubRegions)if(null==this.node)return void(this.node=e);else this._addNodeToSubRegion(this.node),this.node=null;this._addNodeToSubRegion(e),this._updateCenterOfMass(e)},t.prototype.findSubRegion=function(e,t){for(var i=0;i<this.nSubRegions;i++){var o=this.subRegions[i];if(o.contain(e,t))return o}},t.prototype.contain=function(e,t){return this.bbox[0]<=e&&this.bbox[2]>=e&&this.bbox[1]<=t&&this.bbox[3]>=t},t.prototype.setBBox=function(e,t,i,o){this.bbox[0]=e,this.bbox[1]=t,this.bbox[2]=i,this.bbox[3]=o,this.size=(i-e+o-t)/2},t.prototype._newSubRegion=function(){var e=this.subRegions[this.nSubRegions];if(!e)e=new t,this.subRegions[this.nSubRegions]=e;return this.nSubRegions++,e},t.prototype._addNodeToSubRegion=function(e){var t=this.findSubRegion(e.position[0],e.position[1]),i=this.bbox;if(!t){var o=(i[0]+i[2])/2,s=(i[1]+i[3])/2,n=(i[2]-i[0])/2,r=(i[3]-i[1])/2,a=e.position[0]>=o?1:0,h=e.position[1]>=s?1:0,t=this._newSubRegion();t.setBBox(a*n+i[0],h*r+i[1],(a+1)*n+i[0],(h+1)*r+i[1])}t.addNode(e)},t.prototype._updateCenterOfMass=function(e){if(null==this.centerOfMass)this.centerOfMass=n.create();var t=this.centerOfMass[0]*this.mass,i=this.centerOfMass[1]*this.mass;t+=e.position[0]*e.mass,i+=e.position[1]*e.mass,this.mass+=e.mass,this.centerOfMass[0]=t/this.mass,this.centerOfMass[1]=i/this.mass},s.prototype.nodeToNodeRepulsionFactor=function(e,t,i){return i*i*e/t},s.prototype.edgeToNodeRepulsionFactor=function(e,t,i){return i*e/t},s.prototype.attractionFactor=function(e,t,i){return e*t/i},s.prototype.initNodes=function(e,t,o){this.temperature=1;var s=e.length/2;this.nodes.length=0;for(var n="undefined"!=typeof o,r=0;s>r;r++){var a=new i;if(a.position[0]=e[2*r],a.position[1]=e[2*r+1],a.mass=t[r],n)a.size=o[r];this.nodes.push(a)}if(this._massArr=t,n)this._sizeArr=o},s.prototype.initEdges=function(e,t){var i=e.length/2;this.edges.length=0;for(var s="undefined"!=typeof t,n=0;i>n;n++){var r=e[2*n],a=e[2*n+1],h=this.nodes[r],d=this.nodes[a];if(h&&d){h.outDegree++,d.inDegree++;var l=new o(h,d);if(s)l.weight=t[n];this.edges.push(l)}else;}},s.prototype.update=function(){var e=this.nodes.length;if(this.updateBBox(),this._k=.4*this.scaling*Math.sqrt(this.width*this.height/e),this.barnesHutOptimize){this._rootRegion.setBBox(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3]),this._rootRegion.beforeUpdate();for(var t=0;e>t;t++)this._rootRegion.addNode(this.nodes[t]);this._rootRegion.afterUpdate()}else{var i=0,o=this._rootRegion.centerOfMass;n.set(o,0,0);for(var t=0;e>t;t++){var s=this.nodes[t];i+=s.mass,n.scaleAndAdd(o,o,s.position,s.mass)}if(i>0)n.scale(o,o,1/i)}this.updateForce(),this.updatePosition()},s.prototype.updateForce=function(){for(var e=this.nodes.length,t=0;e>t;t++){var i=this.nodes[t];n.copy(i.forcePrev,i.force),n.copy(i.speedPrev,i.speed),n.set(i.force,0,0)}if(this.updateNodeNodeForce(),this.gravity>0)this.updateGravityForce();if(this.updateEdgeForce(),this.preventNodeEdgeOverlap)this.updateNodeEdgeForce()},s.prototype.updatePosition=function(){for(var e=this.nodes.length,t=n.create(),i=0;e>i;i++){var o=this.nodes[i],s=o.speed;n.scale(o.force,o.force,1/30);var r=n.len(o.force)+.1,a=Math.min(r,500)/r;n.scale(o.force,o.force,a),n.add(s,s,o.force),n.scale(s,s,this.temperature),n.sub(t,s,o.speedPrev);var h=n.len(t);if(h>0){n.scale(t,t,1/h);var d=n.len(o.speedPrev);if(d>0)h=Math.min(h/d,this.maxSpeedIncrease)*d,n.scaleAndAdd(s,o.speedPrev,t,h)}var l=n.len(s),a=Math.min(l,100)/(l+.1);n.scale(s,s,a),n.add(o.position,o.position,s)}},s.prototype.updateNodeNodeForce=function(){for(var e=this.nodes.length,t=0;e>t;t++){var i=this.nodes[t];if(this.barnesHutOptimize)this.applyRegionToNodeRepulsion(this._rootRegion,i);else for(var o=t+1;e>o;o++){var s=this.nodes[o];this.applyNodeToNodeRepulsion(i,s,!1)}}},s.prototype.updateGravityForce=function(){for(var e=0;e<this.nodes.length;e++)this.applyNodeGravity(this.nodes[e])},s.prototype.updateEdgeForce=function(){for(var e=0;e<this.edges.length;e++)this.applyEdgeAttraction(this.edges[e])},s.prototype.updateNodeEdgeForce=function(){for(var e=0;e<this.nodes.length;e++)for(var t=0;t<this.edges.length;t++)this.applyEdgeToNodeRepulsion(this.edges[t],this.nodes[e])},s.prototype.applyRegionToNodeRepulsion=function(){var e=n.create();return function(t,i){if(t.node)this.applyNodeToNodeRepulsion(t.node,i,!0);else{if(0===t.mass&&0===i.mass)return;n.sub(e,i.position,t.centerOfMass);var o=e[0]*e[0]+e[1]*e[1];if(o>this.barnesHutTheta*t.size*t.size){var s=this._k*this._k*(i.mass+t.mass)/(o+1);n.scaleAndAdd(i.force,i.force,e,2*s)}else for(var r=0;r<t.nSubRegions;r++)this.applyRegionToNodeRepulsion(t.subRegions[r],i)}}}(),s.prototype.applyNodeToNodeRepulsion=function(){var e=n.create();return function(t,i,o){if(t!==i)if(0!==t.mass||0!==i.mass){n.sub(e,t.position,i.position);var s=e[0]*e[0]+e[1]*e[1];if(0!==s){var r,a=t.mass+i.mass,h=Math.sqrt(s);if(n.scale(e,e,1/h),this.preventNodeOverlap){if(h=h-t.size-i.size,h>0)r=this.nodeToNodeRepulsionFactor(a,h,this._k);else if(0>=h)r=this._k*this._k*10*a}else r=this.nodeToNodeRepulsionFactor(a,h,this._k);if(!o)n.scaleAndAdd(t.force,t.force,e,2*r);n.scaleAndAdd(i.force,i.force,e,2*-r)}}}}(),s.prototype.applyEdgeAttraction=function(){var e=n.create();return function(t){var i=t.node1,o=t.node2;n.sub(e,i.position,o.position);var s,r=n.len(e);if(0===this.edgeWeightInfluence)s=1;else if(1==this.edgeWeightInfluence)s=t.weight;else s=Math.pow(t.weight,this.edgeWeightInfluence);var a;if(this.preventOverlap)if(r=r-i.size-o.size,0>=r)return;var a=this.attractionFactor(s,r,this._k);n.scaleAndAdd(i.force,i.force,e,-a),n.scaleAndAdd(o.force,o.force,e,a)}}(),s.prototype.applyNodeGravity=function(){var e=n.create();return function(t){if(n.sub(e,this.center,t.position),this.width>this.height)e[1]*=this.width/this.height;else e[0]*=this.height/this.width;var i=n.len(e)/100;if(this.strongGravity)n.scaleAndAdd(t.force,t.force,e,i*this.gravity*t.mass);else n.scaleAndAdd(t.force,t.force,e,this.gravity*t.mass/(i+1))}}(),s.prototype.applyEdgeToNodeRepulsion=function(){var e=n.create(),t=n.create(),i=n.create();return function(o,s){var r=o.node1,a=o.node2;if(r!==s&&a!==s){n.sub(e,a.position,r.position),n.sub(t,s.position,r.position);var h=n.len(e);n.scale(e,e,1/h);var d=n.dot(e,t);if(!(0>d||d>h)){n.scaleAndAdd(i,r.position,e,d);var l=n.dist(i,s.position)-s.size,p=this.edgeToNodeRepulsionFactor(s.mass,Math.max(l,.1),100);n.sub(e,s.position,i),n.normalize(e,e),n.scaleAndAdd(s.force,s.force,e,p),n.scaleAndAdd(r.force,r.force,e,-p),n.scaleAndAdd(a.force,a.force,e,-p)}}}}(),s.prototype.updateBBox=function(){for(var e=1/0,t=1/0,i=-(1/0),o=-(1/0),s=0;s<this.nodes.length;s++){var n=this.nodes[s].position;e=Math.min(e,n[0]),t=Math.min(t,n[1]),i=Math.max(i,n[0]),o=Math.max(o,n[1])}this.bbox[0]=e,this.bbox[1]=t,this.bbox[2]=i,this.bbox[3]=o},s.getWorkerCode=function(){var t=e.toString();return t.slice(t.indexOf("{")+1,t.lastIndexOf("return"))},s.prototype.setToken=function(e){this._token=e},s.prototype.tokenMatch=function(e){return e===this._token},r){var h=null;self.onmessage=function(e){if(!(e.data instanceof ArrayBuffer))switch(e.data.cmd){case"init":if(!h)h=new s;h.initNodes(e.data.nodesPosition,e.data.nodesMass,e.data.nodesSize),h.initEdges(e.data.edges,e.data.edgesWeight),h._token=e.data.token;break;case"updateConfig":if(h)for(var t in e.data.config)h[t]=e.data.config[t];break;case"update":var i=e.data.steps;if(h){var o=h.nodes.length,n=new Float32Array(2*o+1);h.temperature=e.data.temperature;for(var r=0;i>r;r++)h.update(),h.temperature*=e.data.coolDown;for(var r=0;o>r;r++){var a=h.nodes[r];n[2*r+1]=a.position[0],n[2*r+2]=a.position[1]}n[0]=h._token,self.postMessage(n.buffer,[n.buffer])}else{var d=new Float32Array;self.postMessage(d.buffer,[d.buffer])}}else{if(!h)return;for(var n=new Float32Array(e.data),o=(n.length-1)/2,r=0;o>r;r++){var a=h.nodes[r];a.position[0]=n[2*r+1],a.position[1]=n[2*r+2]}}}}return s});