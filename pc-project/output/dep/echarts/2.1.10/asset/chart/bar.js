define("echarts/chart/bar",["require","../component/base","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(require){function e(e,a,r,s,o){t.call(this,e,a,r,s,o),i.call(this),this.refresh(s)}var t=require("../component/base"),i=require("./base"),a=require("zrender/shape/Rectangle");require("../component/axis"),require("../component/grid"),require("../component/dataZoom");var r=require("../config"),s=require("../util/ecData"),o=require("zrender/tool/util"),l=require("zrender/tool/color");return e.prototype={type:r.CHART_TYPE_BAR,_buildShape:function(){this._bulidPosition()},_buildNormal:function(e,t,i,r,s){for(var o,l,n,h,d,x,y,g,p,m,u,c,f=this.series,b=i[0][0],I=f[b],A=I.xAxisIndex,v=I.yAxisIndex,M="horizontal"==s?this.component.xAxis.getAxis(A):this.component.yAxis.getAxis(v),z=this._mapSize(M,i),C=z.gap,B=z.barGap,_=z.barWidthMap,N=z.barMaxWidthMap,W=z.barWidth,S=z.barMinHeightMap,T=z.interval,Y=0,L=t;L>Y&&null!=M.getNameByIndex(Y);Y++){"horizontal"==s?h=M.getCoordByIndex(Y)-C/2:d=M.getCoordByIndex(Y)+C/2;for(var G=0,X=i.length;X>G;G++){v=f[i[G][0]].yAxisIndex||0,A=f[i[G][0]].xAxisIndex||0,o="horizontal"==s?this.component.yAxis.getAxis(v):this.component.xAxis.getAxis(A),y=x=p=g=o.getCoord(0);for(var k=0,E=i[G].length;E>k;k++)if(b=i[G][k],I=f[b],u=I.data[Y],c=null!=u?null!=u.value?u.value:u:"-",r[b]=r[b]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},"-"!==c){if(c>0){if(l=k>0?o.getCoordSize(c):"horizontal"==s?y-o.getCoord(c):o.getCoord(c)-y,1===E&&S[b]>l)l=S[b];if("horizontal"==s)x-=l,d=x;else h=x,x+=l}else if(0>c){if(l=k>0?o.getCoordSize(c):"horizontal"==s?o.getCoord(c)-p:p-o.getCoord(c),1===E&&S[b]>l)l=S[b];if("horizontal"==s)d=g,g+=l;else g-=l,h=g}else if(l=0,"horizontal"==s)x-=l,d=x;else h=x,x+=l;var n=Math.min(N[b]||Number.MAX_VALUE,_[b]||W);if(r[b][Y]="horizontal"==s?h+n/2:d-n/2,r[b].min>c)if(r[b].min=c,"horizontal"==s)r[b].minY=d,r[b].minX=r[b][Y];else r[b].minX=h+l,r[b].minY=r[b][Y];if(r[b].max<c)if(r[b].max=c,"horizontal"==s)r[b].maxY=d,r[b].maxX=r[b][Y];else r[b].maxX=h+l,r[b].maxY=r[b][Y];if(r[b].sum+=c,r[b].counter++,Y%T===0)m=this._getBarItem(b,Y,M.getNameByIndex(Y),h,d-("horizontal"==s?0:n),"horizontal"==s?n:l,"horizontal"==s?l:n,"horizontal"==s?"vertical":"horizontal"),this.shapeList.push(new a(m))}else;for(var k=0,E=i[G].length;E>k;k++)if(b=i[G][k],I=f[b],u=I.data[Y],c=null!=u?null!=u.value?u.value:u:"-","-"==c){if(this.deepQuery([u,I,this.option],"calculable")){if("horizontal"==s)x-=this.ecTheme.island.r,d=x;else h=x,x+=this.ecTheme.island.r;n=Math.min(N[b]||Number.MAX_VALUE,_[b]||W),m=this._getBarItem(b,Y,M.getNameByIndex(Y),h+.5,d+.5-("horizontal"==s?0:n),("horizontal"==s?n:this.ecTheme.island.r)-1,("horizontal"==s?this.ecTheme.island.r:n)-1,"horizontal"==s?"vertical":"horizontal"),m.hoverable=!1,m.draggable=!1,m.style.lineWidth=1,m.style.brushType="stroke",m.style.strokeColor=I.calculableHolderColor||this.ecTheme.calculableHolderColor,this.shapeList.push(new a(m))}}else;"horizontal"==s?h+=n+B:d-=n+B}}this._calculMarkMapXY(r,i,"horizontal"==s?"y":"x")},_buildHorizontal:function(e,t,i,a){return this._buildNormal(e,t,i,a,"horizontal")},_buildVertical:function(e,t,i,a){return this._buildNormal(e,t,i,a,"vertical")},_buildOther:function(e,t,i,r){for(var s=this.series,o=0,l=i.length;l>o;o++)for(var n=0,h=i[o].length;h>n;n++){var d=i[o][n],x=s[d],y=x.xAxisIndex||0,g=this.component.xAxis.getAxis(y),p=g.getCoord(0),m=x.yAxisIndex||0,u=this.component.yAxis.getAxis(m),c=u.getCoord(0);r[d]=r[d]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var f=0,b=x.data.length;b>f;f++){var I=x.data[f],A=null!=I?null!=I.value?I.value:I:"-";if(A instanceof Array){var v,M,z=g.getCoord(A[0]),C=u.getCoord(A[1]),B=[I,x],_=this.deepQuery(B,"barWidth")||10,N=this.deepQuery(B,"barHeight");if(null!=N){if(v="horizontal",A[0]>0)_=z-p,z-=_;else if(A[0]<0)_=p-z;else _=0;M=this._getBarItem(d,f,A[0],z,C-N/2,_,N,v)}else{if(v="vertical",A[1]>0)N=c-C;else if(A[1]<0)N=C-c,C-=N;else N=0;M=this._getBarItem(d,f,A[0],z-_/2,C,_,N,v)}if(this.shapeList.push(new a(M)),z=g.getCoord(A[0]),C=u.getCoord(A[1]),r[d].min0>A[0])r[d].min0=A[0],r[d].minY0=C,r[d].minX0=z;if(r[d].max0<A[0])r[d].max0=A[0],r[d].maxY0=C,r[d].maxX0=z;if(r[d].sum0+=A[0],r[d].counter0++,r[d].min1>A[1])r[d].min1=A[1],r[d].minY1=C,r[d].minX1=z;if(r[d].max1<A[1])r[d].max1=A[1],r[d].maxY1=C,r[d].maxX1=z;r[d].sum1+=A[1],r[d].counter1++}else;}}this._calculMarkMapXY(r,i,"xy")},_mapSize:function(e,t,i){var a,r,s=this._findSpecialBarSzie(t,i),o=s.barWidthMap,l=s.barMaxWidthMap,n=s.barMinHeightMap,h=s.sBarWidthCounter,d=s.sBarWidthTotal,x=s.barGap,y=s.barCategoryGap,g=1;if(t.length!=h){if(!i){if(a="string"==typeof y&&y.match(/%$/)?Math.floor(e.getGap()*(100-parseFloat(y))/100):e.getGap()-y,"string"==typeof x&&x.match(/%$/))x=parseFloat(x)/100,r=Math.floor((a-d)/((t.length-1)*x+t.length-h)),x=Math.floor(r*x);else x=parseFloat(x),r=Math.floor((a-d-x*(t.length-1))/(t.length-h));if(0>=r)return this._mapSize(e,t,!0)}else if(a=e.getGap(),x=0,r=Math.floor(a/t.length),0>=r)g=Math.floor(t.length/a),r=1}else if(a=h>1?"string"==typeof y&&y.match(/%$/)?Math.floor(e.getGap()*(100-parseFloat(y))/100):e.getGap()-y:d,r=0,x=h>1?Math.floor((a-d)/(h-1)):0,0>x)return this._mapSize(e,t,!0);return this._recheckBarMaxWidth(t,o,l,n,a,r,x,g)},_findSpecialBarSzie:function(e,t){for(var i,a,r,s,o=this.series,l={},n={},h={},d=0,x=0,y=0,g=e.length;g>y;y++)for(var p={barWidth:!1,barMaxWidth:!1},m=0,u=e[y].length;u>m;m++){var c=e[y][m],f=o[c];if(!t){if(!p.barWidth){if(i=this.query(f,"barWidth"),null!=i){l[c]=i,x+=i,d++,p.barWidth=!0;for(var b=0,I=m;I>b;b++){var A=e[y][b];l[A]=i}}}else l[c]=i;if(!p.barMaxWidth){if(a=this.query(f,"barMaxWidth"),null!=a){n[c]=a,p.barMaxWidth=!0;for(var b=0,I=m;I>b;b++){var A=e[y][b];n[A]=a}}}else n[c]=a}h[c]=this.query(f,"barMinHeight"),r=null!=r?r:this.query(f,"barGap"),s=null!=s?s:this.query(f,"barCategoryGap")}return{barWidthMap:l,barMaxWidthMap:n,barMinHeightMap:h,sBarWidth:i,sBarMaxWidth:a,sBarWidthCounter:d,sBarWidthTotal:x,barGap:r,barCategoryGap:s}},_recheckBarMaxWidth:function(e,t,i,a,r,s,o,l){for(var n=0,h=e.length;h>n;n++){var d=e[n][0];if(i[d]&&i[d]<s)r-=s-i[d]}return{barWidthMap:t,barMaxWidthMap:i,barMinHeightMap:a,gap:r,barWidth:s,barGap:o,interval:l}},_getBarItem:function(e,t,i,a,r,o,n,h){var d,x=this.series,y=x[e],g=y.data[t],p=this._sIndex2ColorMap[e],m=[g,y],u=this.deepQuery(m,"itemStyle.normal.color")||p,c=this.deepQuery(m,"itemStyle.emphasis.color"),f=this.deepMerge(m,"itemStyle.normal"),b=f.barBorderWidth,I=this.deepMerge(m,"itemStyle.emphasis");if(d={zlevel:this._zlevelBase,clickable:this.deepQuery(m,"clickable"),style:{x:a,y:r,width:o,height:n,brushType:"both",color:this.getItemStyleColor(u,e,t,g),radius:f.barBorderRadius,lineWidth:b,strokeColor:f.barBorderColor},highlightStyle:{color:this.getItemStyleColor(c,e,t,g),radius:I.barBorderRadius,lineWidth:I.barBorderWidth,strokeColor:I.barBorderColor},_orient:h},d.highlightStyle.color=d.highlightStyle.color||("string"==typeof d.style.color?l.lift(d.style.color,-.3):d.style.color),b>0&&d.style.height>b&&d.style.width>b)d.style.y+=b/2,d.style.height-=b,d.style.x+=b/2,d.style.width-=b;else d.style.brushType="fill";if(d.highlightStyle.textColor=d.highlightStyle.color,d=this.addLabel(d,y,g,i,h),"insideLeft"===d.style.textPosition||"insideRight"===d.style.textPosition||"insideTop"===d.style.textPosition||"insideBottom"===d.style.textPosition){var A=5;switch(d.style.textPosition){case"insideLeft":d.style.textX=d.style.x+A,d.style.textY=d.style.y+d.style.height/2,d.style.textAlign="left",d.style.textBaseline="middle";break;case"insideRight":d.style.textX=d.style.x+d.style.width-A,d.style.textY=d.style.y+d.style.height/2,d.style.textAlign="right",d.style.textBaseline="middle";break;case"insideTop":d.style.textX=d.style.x+d.style.width/2,d.style.textY=d.style.y+A/2,d.style.textAlign="center",d.style.textBaseline="top";break;case"insideBottom":d.style.textX=d.style.x+d.style.width/2,d.style.textY=d.style.y+d.style.height-A/2,d.style.textAlign="center",d.style.textBaseline="bottom"}d.style.textPosition="specific",d.style.textColor=d.style.textColor||"#fff"}if(this.deepQuery([g,y,this.option],"calculable"))this.setCalculable(d),d.draggable=!0;return s.pack(d,x[e],e,x[e].data[t],t,i),d},getMarkCoord:function(e,t){var i,a,r=this.series[e],s=this.xMarkMap[e],o=this.component.xAxis.getAxis(r.xAxisIndex),l=this.component.yAxis.getAxis(r.yAxisIndex);if(t.type&&("max"===t.type||"min"===t.type||"average"===t.type)){var n=null!=t.valueIndex?t.valueIndex:null!=s.maxX0?"1":"";a=[s[t.type+"X"+n],s[t.type+"Y"+n],s[t.type+"Line"+n],s[t.type+n]]}else if(s.isHorizontal){i="string"==typeof t.xAxis&&o.getIndexByName?o.getIndexByName(t.xAxis):t.xAxis||0;var h=s[i];h=null!=h?h:"string"!=typeof t.xAxis&&o.getCoordByIndex?o.getCoordByIndex(t.xAxis||0):o.getCoord(t.xAxis||0),a=[h,l.getCoord(t.yAxis||0)]}else{i="string"==typeof t.yAxis&&l.getIndexByName?l.getIndexByName(t.yAxis):t.yAxis||0;var d=s[i];d=null!=d?d:"string"!=typeof t.yAxis&&l.getCoordByIndex?l.getCoordByIndex(t.yAxis||0):l.getCoord(t.yAxis||0),a=[o.getCoord(t.xAxis||0),d]}return a},refresh:function(e){if(e)this.option=e,this.series=e.series;this.backupShapeList(),this._buildShape()},addDataAnimation:function(e){for(var t=this.series,i={},a=0,r=e.length;r>a;a++)i[e[a][0]]=e[a];for(var o,l,n,h,d,x,y,a=this.shapeList.length-1;a>=0;a--)if(x=s.get(this.shapeList[a],"seriesIndex"),i[x]&&!i[x][3])if("rectangle"===this.shapeList[a].type){if(y=s.get(this.shapeList[a],"dataIndex"),d=t[x],i[x][2]&&y===d.data.length-1){this.zr.delShape(this.shapeList[a].id);continue}else if(!i[x][2]&&0===y){this.zr.delShape(this.shapeList[a].id);continue}if("horizontal"===this.shapeList[a]._orient)h=this.component.yAxis.getAxis(d.yAxisIndex||0).getGap(),n=i[x][2]?-h:h,o=0;else l=this.component.xAxis.getAxis(d.xAxisIndex||0).getGap(),o=i[x][2]?l:-l,n=0;this.shapeList[a].position=[0,0],this.zr.animate(this.shapeList[a].id,"").when(500,{position:[o,n]}).start()}}},o.inherits(e,i),o.inherits(e,t),require("../chart").define("bar",e),e});