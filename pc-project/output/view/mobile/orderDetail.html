{{ *

@file 手机页面 - 订单详情
@author zhangjiayi

* }}

{{ extends file="common/mobile/base.html" }}

{{ block name="data" }}

{{ $smarty.block.parent }}

{{ $script_path = "mobile/orderDetail_2337fd27b8" }}

{{ /block }}

{{ block name="title" prepend }}
手机订单详情 -
{{ /block }}

{{ block name="style" }}
<link rel="stylesheet" href="{{ $static_origin }}/asset/css/mobile/orderDetail_8fa2be6fe7.css">
{{ /block }}

{{ block name="body" }}
{{ strip }}
<div id="mobile-body">

    <div class="order-date">
        {{ $temp_create_time = ' '|explode: $tpl_data.purchase.create_time }}
        <span class="time">{{ $temp_create_time[1]|substr:0:5 }}</span>
        <span class="date">{{ $temp_create_time[0] }}</span>
        <span class="order-id">
            订单号: {{ $tpl_data.purchase.purchase_id }}
        </span>
    </div>

    <div class="order-head">

        <div class="person-detail clearfix">
            <div class="person-foto"><img src="{{ $tpl_data.user.avatar }}" /></div>
            <div class="person-name">{{ $tpl_data.purchase.teacher_user_name }}</div>
            <div class="person-phone">
                <a {{ if $tpl_data.user.mobile }} class="telphone" href="tel:{{ $tpl_data.user.mobile }}" data-phone="{{ $tpl_data.user.mobile }}" {{ /if }} >
                    <i class="icon icon-phone-circle phone-call"></i>
                </a>
            </div>
        </div>

        <div class="person-order">
            <p>
                <span>购买课程：</span>
                {{ $tpl_data.purchase.course_name }}
            </p>
            <p>
                <span class="lesson-way">购买课程：</span>
                {{ if isset($tpl_data.purchase.lesson_way) && $tpl_data.purchase.lesson_way == 1 }}
                双方协商
                {{ elseif isset($tpl_data.purchase.lesson_way) && $tpl_data.purchase.lesson_way == 2 }}
                在线授课
                {{ elseif isset($tpl_data.purchase.lesson_way) && $tpl_data.purchase.lesson_way == 4 }}
                学生上门
                {{ elseif isset($tpl_data.purchase.lesson_way) && $tpl_data.purchase.lesson_way == 8 }}
                老师上门
                {{ /if }}
            <money>￥ {{ $tpl_data.purchase.price }}</money>
            </p>
        </div>
    </div>

    <div class="order-detail-wrapper">
        <div class="order-detail">
            <div class="order-type">
                <div class="order-status">
                    {{ if isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'canceled' }}
                    已取消
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'wait_for_pay' }}
                    待支付
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'appeal_over' }}
                    已处理
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'pay_failed' }}
                    支付失败
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'appealing' }}
                    申诉中
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'closed' }}
                    已关闭
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'pay_success' }}
                    进行中
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'wait_for_comment' }}
                    待评价
                    {{ elseif isset($tpl_data.purchase.status) && $tpl_data.purchase.status == 'normal_over' }}
                    已结束
                    {{ /if }}
                </div>
                <div class="order-price">支付总价：￥{{ $tpl_data.purchase.pay_money }}</div>
            </div>

            {{ $percent = ($tpl_data.purchase.progress/60)|string_format:"%.1f" }}
            {{ $parts = explode('.', $percent) }}
            {{ if $parts[1] == 0 }}
            {{ $percent = $parts[0] }}
            {{ /if }}
            <div class="order-total">
                <span>课程总时长：</span>
                <strong>{{ $tpl_data.purchase.hours }}</strong> 小时
            </div>
            <div class="order-progress">
                <div class="progress">
                    <div class="progress-bar" style="width: {{ $tpl_data.purchase.progress*100/60.0/$tpl_data.purchase.hours
                         }}%;">
                    </div>
                </div>
            </div>
            <div class="order-past">
                <div class="order-present">
                    <span>已完成：</span>
                    <strong>{{ $percent }}/{{ $tpl_data.purchase.hours }} </strong>
                    <span>课时</span>
                </div>
                <div class="order-rest">
                    余额： <strong>￥{{ $tpl_data.purchase.rest_prices }}</strong>
                </div>
            </div>

            {{ $orderUrl = $tpl_data.purchase.order_url }}

            {{ if $orderUrl|count > 0 }}
            <div class="order-control" data-id = "{{ $tpl_data.purchase.purchase_id }}">

                {{ if isset($orderUrl.reserve_lesson_url) && $orderUrl.reserve_lesson_url }}

                    {{ if isset($orderUrl.reserve_lesson_status) && ($orderUrl.reserve_lesson_status == 1) }}
                        {{ $text = " " }}
                    {{ else if $orderUrl.reserve_lesson_status == 0 }}
                        {{ $text = " disabled" }}
                    {{ /if }}

                <div><a class="btn btn-primary order-control-lesson" {{ $text }}>发起约课</a></div>
                {{ /if }}


                {{ if isset($orderUrl.comment_url) && $orderUrl.comment_url }}
                <div><a class="btn btn-default order-control-comment">评价课程</a></div>
                {{ /if }}

                {{ if isset($orderUrl.cancel_order_url) && $orderUrl.cancel_order_url }}
                <div><a class="btn btn-default order-control-cancel" data-price="{{ $tpl_data.purchase.rest_prices }}">取消订单</a></div>
                {{ /if }}

                {{ if isset($orderUrl.pay_again_url) && $orderUrl.pay_again_url }}
                <div><a class="btn btn-info order-control-again">继续购买</a></div>
                {{ /if }}

                {{ if isset($orderUrl.confirm_pay_url) && $orderUrl.confirm_pay_url }}
                <div><a class="btn btn-info order-control-pay">前往支付</a></div>
                {{ /if }}

                {{ if isset($orderUrl.appeal_url) && $orderUrl.appeal_url }}
                <div><a class="btn btn-info order-appeal">我要申诉</a></div>
                {{ /if }}

            </div>
            {{ /if }}

        </div>
    </div>

    {{ if $tpl_data.lessons|count > 0 }}
    <div class="order-lesson-list">
        {{ foreach $tpl_data.lessons as $item }}
        <li class="lesson">
            <div class="lesson-date">
                <div class="date">
                    {{ $temp_create_time = ' '|explode: $item.start_time }}
                    {{ $date = '-'|explode: $temp_create_time[0] }}
                    <strong>{{ $date[1] }}</strong>月
                    <strong>{{ $date[2] }}</strong>日
                </div>
                <div class="week">
                    <span>{{ $item.time_info }}</span>
                </div>
            </div>
            <div class="lesson-time">
                <div class="time">
                    {{ $temp_create_time[1]|substr:0:5 }}
                    -
                    {{ $temp_end_time = ' '|explode: $item.end_time }}
                    {{ $temp_end_time[1]|substr:0:5 }}
                </div>
                <div class="type">
                    {{ $item.operation.label }}
                </div>
            </div>
            <div class="lesson-rest">
                <strong>- {{ $item.length / 60 }} </strong>
                <span> 小时</span>
            </div>
        </li>
        {{ /foreach }}
    </div>
    {{ /if }}

</div>
<script>
    var telphone = '{{ $tpl_data.user.mobile }}', purchase_id = '{{ $tpl_data.purchase.purchase_id }}', teacher_id = '{{ $tpl_data.user.number }}';

</script>
{{ include file="common/script.html" }}
{{ /strip }}
{{ /block }}