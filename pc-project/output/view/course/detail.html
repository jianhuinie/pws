{{ *

@file 班课详情 页
@author liucong

* }}

{{ extends file="common/main/base.html" }}

{{ block name="data" }}

    {{ $smarty.block.parent }}

    {{ $script_path = "course/detail_c906baff68" }}
    {{ $script_data.teacherId = $tpl_data.course_info.user_id }}
    {{ **取第一位老师,因为后端是用id来索引的,所以需要遍历一下,取第一个** }}
    {{ $first_teacher = '' }}
    {{ foreach $tpl_data.teacher_profiles as $val }}
        {{ if $val@first }}
            {{ $first_teacher = $val }}
        {{ /if }}
    {{ /foreach }}
    {{ if !empty($first_teacher) }}
        {{ $script_data.teacherNum = $first_teacher.number }}
    {{ /if }}
    {{ $script_data.courseNum = $tpl_data.course_info.number }}
    {{ $script_data.courseType = $tpl_data.course_type }}
    {{ $script_data.courseName = $tpl_data.course_info.name }}
    {{ $script_data.orgNum = $tpl_data.course_info.organization_number }}
    {{ $script_data.price = $tpl_data.course_info.price }}
    {{ $script_data.displayStatus = $tpl_data.course_info.display_status }}
    {{ $script_data.userId = $user_data.user_id }}
    {{ $script_data.teacherId = $tpl_data.teacher.id }}
    {{ $script_data.crumb = $tpl_data.course_path[3].remark_name }}

    {{ **如果是机构班课,右侧不吸顶** }}
    {{ if !empty($tpl_data.organization) }}
        {{ $script_data.isOrgCourse = true }}
        {{ $script_data.extension = $tpl_data.organization.extension|default:'4000－910－910' }}
        {{ $script_data.orgNumber = $tpl_data.organization.number }}
        {{ if not empty ($tpl_data.organization.support_tianxiao) }}
            {{ $script_data.isTianxiaoOrg = $tpl_data.organization.support_tianxiao }}
        {{ /if }}
    {{ else }}
        {{ $script_data.isOrgCourse = false }}
    {{ /if }}

    {{ if $tpl_data.course_info.display_status == 2 || $tpl_data.course_info.display_status == 5 }}
        {{ $script_data.enrolling = 1 }}
    {{ /if }}

    {{ $nav_config.hidden = 0 }}
    {{ $nav_config.active = '' }}
    {{ $nav_config.popup = 1 }}

    {{ * 个人班课支持自分享，含线下班课、直播课 * }}
    {{ if isset($first_teacher.number) && $user_data.user_number == $first_teacher.number && $tpl_data.course_type == 2 && $user_data.user_type == 0 }}

        {{ if (strpos($smarty.server.REQUEST_URI, '?')) }}
            {{ $share_link = $root|cat: $smarty.server.REQUEST_URI|cat: "&sf=1" }}
        {{ else }}
            {{ $share_link = $root|cat: $smarty.server.REQUEST_URI|cat: "?sf=1" }}
        {{ /if }}

        {{ $baidu_share_url = $share_link }}
    {{ else }}
        {{ $share_link = '' }}
    {{ /if }}

    {{ $baidu_share_text = "#跟谁学# 分享一位老师给你哦~"|cat: $tpl_data.course_info.name }}
    {{ $baidu_share_text = $baidu_share_text|cat: "，还在等什么？找好老师，上跟谁学，快来开启寻师之旅吧！" }}
    {{ $baidu_share_text = $baidu_share_text|replace:"'":"\'"|replace:'"':'\"' }}

    {{ $baidu_share_image = $tpl_data.course_info.cover.url }}
    {{ if !$baidu_share_image || $baidu_share_image == "" }}
        {{ $baidu_share_image = $tpl_data.course_info.photos[0].url }}
    {{ /if }}
    {{ if !$baidu_share_image || $baidu_share_image=="" }}
        {{ $baidu_share_image = $static_origin|cat:"/asset/img/share.jpg" }}
    {{ /if }}
    {{ $baidu_query = "跟谁学 " }}

    {{ **顶部搜索去掉placeholder支持空query** }}
    {{ $current_page = 'detail' }}
    {{ **是否登陆** }}

    {{ $login_dialog_config.student_only = true }}
    {{ $need_mobile_seo = true }}

    {{ if $tpl_data.course_type != 4 && $tpl_data.course_info.lesson_way == 4 }}
        {{ $need_location_seo = true }}
    {{ /if }}

{{ /block }}

{{ * SKU统计上报 * }}
{{ block name='sku_id' }}
{{ $sku_id=$tpl_data.course_info.number }}
{{ /block }}

{{ block name="title" }}
    {{ strip }}
        {{ if $tpl_data.course_info.price == 0 }}【免费】{{ /if }}
        {{ $tpl_data.course_info.name }}_{{ $tpl_data.course_path['3'].name }}_{{ foreach $tpl_data.teacher_profiles as $key=>$teacher_profile }}{{ $teacher_profile.display_name }}{{ /foreach }}-跟谁学
    {{ /strip }}
{{ /block }}

{{ block name="keywords" }}
{{ strip }}
{{ $tpl_data.course_info.name }}
{{ /strip }}
{{ /block }}

{{ block name="description" }}
{{ strip }}

跟谁学为您提供{{ foreach $tpl_data.teacher_profiles as $key=>$teacher_profile }}{{ $teacher_profile.display_name }}{{ /foreach }}{{ $tpl_data.course_info.name }}课程，{{ $tpl_data.course_info.target }}。找好老师，上跟谁学！

{{ /strip }}
{{ /block }}

{{ block name="style" }}
<link rel="stylesheet" href="{{ $static_origin }}/asset/css/course/detail_853a80e3ad.css">
{{ /block }}

{{ block name="main" }}
{{ strip }}

{{ if $smarty.server.REQUEST_URI|strstr:"/preview" }}
<div class="mask">
    <div class="alpha-mask"></div>
    <div class="half-alpha-mask"></div>
    <p>
        <span>这是预览页面，不可操作哦~</span>
        <br />
        （信息填写完整并检查后可提交审核，审核通过的班课会自动开始招生）
    </p>
</div>
{{ /if }}

<div id="main">

    {{ if $tpl_data.crumb }}
    <div class="crumb">

        <a href="{{ $tpl_data.crumb.host }}">
            跟谁学{{ $tpl_data.crumb.city.name }}站
        </a>
        <span class="splitter">&nbsp;&gt;&nbsp;</span>

        <a href="{{ $tpl_data.crumb.host }}sc-.html">
            {{ $tpl_data.crumb.city.name }}课程
        </a>
        <span class="splitter">&nbsp;&gt;&nbsp;</span>

        <a href="{{ $tpl_data.crumb.host }}sc--{{ $tpl_data.course_path['1'].id }}.html">
            {{ $tpl_data.course_path['1'].name }}培训
        </a>
        <span class="splitter">&nbsp;&gt;&nbsp;</span>

        <a href="{{ $tpl_data.crumb.host }}sc--{{ $tpl_data.course_path['1'].id }}_{{ $tpl_data.course_path['2'].id }}.html">
            {{ $tpl_data.course_path['2'].name }}培训
        </a>
        <span class="splitter">&nbsp;&gt;&nbsp;</span>

        <a href="{{ $tpl_data.crumb.host }}sc--{{ $tpl_data.course_path['1'].id }}_{{ $tpl_data.course_path['2'].id }}_{{ $tpl_data.course_path['3'].id }}.html">
            {{ $tpl_data.course_path['3'].remark_name }}培训
        </a>
    </div>
    {{ /if }}

    {{ include "course/detail/profile.html" coupons=$tpl_data.coupons tpl_data=$tpl_data.course_info is_favored=$tpl_data.is_favored popularity=$tpl_data.popularity teacher_profiles=$tpl_data.teacher_profiles course_type=$tpl_data.course_type org=$tpl_data.organization advisory=$tpl_data.support_student_advisory }}

    {{ if isset($tpl_data.lianbao_info) && $tpl_data.lianbao_info }}
        {{ include "course/detail/combo.html" courses=$tpl_data.lianbao_info current_course=$tpl_data.course_info }}
    {{ /if }}

    <div id="sidebar">
        <div id="sidebar-box">
            <div class="app-download">
                <img src="{{ $static_origin }}/asset/img/course/app-download_a4f1330fde.jpg" alt="">
                <div class="info">
                    <h3>跟谁学手机版</h3>
                    <a href="/static/app" class="btn-primary">立即下载</a>
                </div>
            </div>
            {{ if $tpl_data.is_organization }}
                {{ include file="course/detail/org.html" tpl_data=$tpl_data.organization }}
            {{ /if }}
            {{ include file="course/detail/teacher.html" tpl_data=$tpl_data.teacher_profiles course_type=$tpl_data.course_type is_organization=$tpl_data.is_organization }}
        </div>

        {{ include file="teacher/search/relatedcourse.html" relatedcourse=$tpl_data.relatedcourse title="老师往期课程" }}
    </div>

    {{ $display_status = $tpl_data.course_info.display_status }}
    {{ **如果审核未通过则状态置为暂停招生** }}
    {{ if $tpl_data.course_info.verify_status == 2 }}
        {{ $display_status = 3 }}
    {{ /if }}


    {{ if $tpl_data.course_type == 4 }}
        {{ $sku_type="3810" }}
    {{ else }}
        {{ $sku_type="class" }}
    {{ /if }}
    <div id="content">

        {{ if isset($tpl_data.is_juhuixue) && $tpl_data.is_juhuixue }}
            <a href="http://ju.genshuixue.com/" target="_blank">
                <img class="juhuixue-photo" src="{{ $static_origin }}/asset/img/classCourse/juhuixuePc_a8dd641193.png">
            </a>
        {{ /if }}

        {{ include file="course/detail/notification.html" course_info=$tpl_data.course_info other_courses=$tpl_data.other_courses course_type=$tpl_data.course_type }}

        <div class="header">

            <div class="wrapper tab-nav tab-nav-primary">

                <div class="nav-action-container">
                {{ if $display_status == 2 }}

                    {{ if $tpl_data.course_info.max_student <= $tpl_data.course_info.total_pay }}
                        <div class="one-line">
                            <span class="nav-item-prize">课程价格：<i>￥{{ $tpl_data.course_info.price }}</i></span>
                            <span class="label-default">还有机会，其中<i>{{ $tpl_data.course_info.total_pay-$tpl_data.course_info.succ_pay }}</i>人待付款</span>
                        </div>
                    {{ else }}
                        <div class="two-lines">
                            <div class="course-info">
                                <div class="nav-item-prize">课程价格：<i>￥{{ $tpl_data.course_info.price }}</i></div>
                                <div class="nav-item-left">还剩下<i>{{ $tpl_data.course_info.can_pay }}</i>个名额</div>
                            </div>
                        </div>
                        <button data-click="order_2" data-sku="{{ $sku_type }}|{{ $tpl_data.course_info.number }}"  class="btn-primary small reserve-course">立即报名</button>
                    {{ /if }}
                {{ /if }}

                {{ if $display_status == 5 && $tpl_data.course_info.can_chaban && !$tpl_data.course_info.is_full }}
                    <div class="one-line">
                        <span class="nav-item-prize">插班价格：<i>￥{{ $tpl_data.course_info.realtime_price }}</i></span>
                        <button data-click="order_2" data-sku="{{ $sku_type }}|{{ $tpl_data.course_info.number }}" class="btn-primary small reserve-course">立即报名</button>
                    </div>
                {{ /if }}
                </div>

                <div class="nav-item-container">
                    {{ **3810去掉课程简介和教学大纲** }}
                    {{ if $tpl_data.course_type != 4 }}
                        <a id="nav-course-summary" class="nav-item active" href="#course-summary">
                            <div>课程简介</div>
                        </a>
                    {{ /if }}

                    {{ if $tpl_data.course_info.lesson_way == 4 && (!empty($tpl_data.course_info.offline_poi) || !empty($tpl_data.course_info.address)) }}
                    <a id="nav-course-address" class="nav-item" href="#course-address">
                        <div>上课地址</div>
                    </a>
                    {{ /if }}

                    <a id="nav-course-introduction" class="nav-item" href="#course-introduction">
                        <div>课程详情</div>
                    </a>

                    {{ if $tpl_data.course_type != 4 }}
                        <a id="nav-course-plan" class="nav-item" href="#course-plan">
                            <div>教学大纲</div>
                        </a>
                    {{ /if }}

                    {{ if $tpl_data.course_type == 4  }}
                        <a class="nav-item" href="#course-comment">
                            <div>机构评价</div>
                        </a>
                    {{ else }}
                        <a class="nav-item" href="#course-comment">
                            <div>课程评价</div>
                        </a>
                    {{ /if }}

                    {{ if $tpl_data.course_info.lesson_way == 2 }}
                        <a class="nav-item" href="#course-liveinfo">
                            <div>直播须知</div>
                        </a>
                    {{ /if }}
                </div>
            </div>
        </div>

        <div class="body">
            {{ **3810去掉课程简介，教学大纲** }}
            {{ if $tpl_data.course_type != 4 }}
                {{ include file="course/detail/summary.html" tpl_data=$tpl_data.course_info }}
            {{ /if }}

            {{ if $tpl_data.course_info.lesson_way == 4 && (!empty($tpl_data.course_info.offline_poi) || !empty($tpl_data.course_info.address)) }}
                {{ include file="course/detail/address.html" tpl_data=$tpl_data.course_info }}
            {{ /if }}

            {{ include file="course/detail/introduction.html" tpl_data=$tpl_data.course_info }}
            {{ if $tpl_data.course_type != 4 }}
                {{ include file="course/detail/plan.html" tpl_data=$tpl_data.course_info }}
            {{ /if }}

            {{ include file="course/detail/comment.html" type=$tpl_data.course_type }}

            {{ if $tpl_data.course_info.lesson_way == 2 }}
                {{ include file="course/detail/liveinfo.html" }}
            {{ /if }}
        </div>

    </div>
    {{ include file="common/component/baiduMap.html" }}
</div>

{{ /strip }}
{{ /block }}

{{ block name="script" }}
{{ /block }}

{{ block name="inner_link" }}
{{ include file="common/innerlink/searchList.html" data=$tpl_data.pageInnerLinks mod="课程" inner_type="course" }}
{{ /block }}
