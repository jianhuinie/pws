{{ *

@file 播放视频
@author zhujl

* }}

{{ extends file="common/base.html" }}

{{ block name="data" }}
{{ $smarty.block.parent }}
{{ /block }}

{{ block name="title" prepend }}
{{ strip }}

{{ if isset($tpl_data.video_title) }}
    {{ $tpl_data.video_title }}
{{ else }}
    播放视频
{{ /if }}

{{ if isset($tpl_data.is_ours) }}
    {{ $is_ours = $tpl_data.is_ours }}
{{ else }}
    {{ $is_ours = 0 }}
{{ /if }}

{{ /strip }}
{{ /block }}

{{ block name="style" }}
{{ strip }}
<style>
    html,
    body {
        background-color: #FFF;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
    }
</style>
{{ /strip }}
{{ /block }}

{{ block name="body" }}
{{ strip }}
<script>
    var videoVod = {};
    videoVod.send = function(){};
</script>
{{ if $is_mobile_platform }}

    <script>
        var letvcloud_player_conf =  {
            uu: '{{ $tpl_data.user_unique }}',
            vu: '{{ $tpl_data.video_unique }}',
            auto_play: 1,
            gpcflag: 1,
            width: 676,
            height: 383
        };
    </script>
    <script src="http://yuntv.letv.com/bcloud.js"></script>

{{ else }}

    {{ $file_root = 'http://d.gsxservice.com/video/'|cat: $env|cat: '/player' }}

    {{ if !empty($tpl_data.logourl) }}
        {{ $params['logourl'] = $tpl_data.logourl }}
    {{ /if }}
    {{ $params['tailurl'] = 'http://d.gsxservice.com/video/files/over.flv' }}

    {{ $params['picStartUrl'] = 'http://d.gsxservice.com/video/files/video_bg.png' }}
    {{ $params['uu'] = $tpl_data.user_unique }}
    {{ $params['vu1'] = $tpl_data.video_unique }}
    {{ $params['autoplay'] = 0 }}

    {{ if $tpl_data.video_unique == 'ef056c00a8' || $tpl_data.video_unique == '3eae3e3d9a' }}
        {{ $params['uu'] = '8e47e8aed7' }}
        {{ $params['logourl'] = 'http://d.gsxservice.com/video/files/over-cd.flv' }}
    {{ /if }}

    {{ if isset($tpl_data.is_video_course) && $tpl_data.is_video_course }}
        {{ $params['payer_name'] = $tpl_data.payer_name }}
        {{ $params['check_code'] = $tpl_data.check_code }}
    {{ /if }}

    {{ if isset($user_data) && $user_data.user_number }}
        {{ $params['userno'] = $user_data.user_number }}
    {{ /if }}

    {{ $swf_url = $file_root|cat: '/BJHLPlayer.swf?t=2015-12-03' }}

    {{ * 如果用跟谁学的播放器 * }}
    {{ if $is_ours }}
        {{ if $env == 'test' }}
            {{ $swf_url = 'http://123.56.4.1:8080/sunyong/GSXPlayer.swf?t=201605261359' }}
        {{ else }}
            {{ $swf_url = $file_root|cat: '/GSXPlayer.swf?t=201605261359' }}
        {{ /if }}
        {{ $params['fid'] = $tpl_data.fid }}
        {{ if isset($tpl_data.checkcode) && $tpl_data.checkcode }}
            {{ $params['checkcode'] = $tpl_data.checkcode }}
        {{ /if }}
    {{ /if }}

    {{ * 水印 * }}
    {{ if isset($tpl_data.video_info.watermark) }}
        {{ $params['watermark'] = $tpl_data.video_info.watermark }}
    {{ /if }}

    <script>
        // alert('view');

        function gomainpage() {
            window.parent.open('http://www.genshuixue.com', '_blank');
        }
        {{ if isset($tpl_data.is_video_course) && $tpl_data.is_video_course }}
            function letvError(errorcodes , messages)
            {
                var parent = window.parent;

                parent.alert({
                    title: '温馨提示',
                    content: '发生网络错误，请尝试重新刷新页面',
                    buttons: [{
                        text: '确定',
                        type: 'primary',
                        handler: function () {
                            this.hide();
                            parent.$('#main-video').hide();
                        }
                    }]
                });
            }
        {{ /if }}
    </script>
    {{ if $is_ours }}
        <object id="BJHLPlayer" name="BJHLPlayer" type="application/x-shockwave-flash" data="{{ $swf_url }}" width="100%" height="100%">
            <param name="wmode" value="transparent">
            <param name="movie" value="{{ $swf_url }}">
            <param name="quality" value="high">
            <param name="menu" value="false">
            <param name="allowScriptAccess" value="always">
            <param name="allowFullScreen" value="true">
            <param name="flashvars" value="{{ urldecode(http_build_query($params)) }}">
        </object>
    {{ else }}
        <object id="BJHLPlayer" name="BJHLPlayer" type="application/x-shockwave-flash" data="{{ $swf_url }}" width="100%" height="100%">
            <param name="wmode" value="transparent">
            <param name="movie" value="{{ $swf_url }}">
            <param name="quality" value="high">
            <param name="menu" value="false">
            <param name="allowScriptAccess" value="always">
            <param name="allowFullScreen" value="true">
            <param name="flashvars" value="{{ urldecode(http_build_query($params)) }}">
        </object>
    {{ /if }}

{{ /if }}

{{ if $env == 'www' }}
    <script>
        (function () {

            {{ if isset($user_data.avatar) }}
                {{ $user_number = $user_data.user_number }}
            {{ else }}
                {{ $user_number = '' }}
            {{ /if }}

            var data = {
                guid: WAT.getCookie('__guid__'),
                user_number: '{{ $user_number }}',
                page_url: document.URL,
                referer: document.referrer
            };

            WAT.send(
                WAT.toUrl('click.genshuixue.com', '/pv.gif'),
                data
            );

            WAT.send(
                WAT.toUrl('www.genshuixue.com', '/empty.gif'),
                data
            );
        })();
    </script>
{{ /if }}
{{ /strip }}
{{ /block }}