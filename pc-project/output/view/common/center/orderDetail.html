{{ *

@file 订单详情
@author zhujialu

* }}
{{ extends file="common/center/base.html" }}

{{ block name="data" }}

    {{ $smarty.block.parent }}

    {{ $script_path = "common/center/orderDetail_550058968b" }}
    {{ $script_data.purchaseId = $tpl_data.purchase.purchase_id }}
    {{ $script_data.createTime = $tpl_data.purchase.create_time }}
    {{ $script_data.hours = $tpl_data.purchase.hours }}
    {{ $script_data.courseType = $tpl_data.purchase.course_type }}
    {{ $script_data.price = $tpl_data.purchase.price }}
    {{ $script_data.restPrice = $tpl_data.purchase.rest_prices }}
    {{ $script_data.payMoney = $tpl_data.purchase.pay_money }}
    {{ if $tpl_data.purchase.course_type != 4 }}
        {{ $script_data.studentName = $tpl_data.user.display_name }}
    {{ /if }}
    {{ $script_data.courseNameCut = $tpl_data.purchase.course_name|cn_truncate: 15 }}

    {{ $is_one2one_course = $tpl_data.purchase.course_type == 1 }}
    {{ $is_class_course = $tpl_data.purchase.course_type == 2 }}
    {{ $is_video_course = $tpl_data.purchase.course_type == 3 }}
    {{ $is_org_class_course = $tpl_data.purchase.course_type == 4 }}
    {{ $is_x_course = $tpl_data.purchase.course_type == 11 || $tpl_data.purchase.course_type == 12 }}
    {{ $is_x_one_course = $tpl_data.purchase.course_type == 11 }}
    {{ $is_x_class_course = $tpl_data.purchase.course_type == 12 }}
    {{ $is_trial_course = $tpl_data.purchase.course_type == 5 }}

{{ /block }}

{{ block name="title" prepend }}
订单详情 -
{{ /block }}

{{ block name="style" }}
<link rel="stylesheet" href="{{ $static_origin }}/asset/css/common/center/orderDetail_73a6121046.css">
{{ $smarty.block.parent }}
{{ /block }}

{{ block name="main" }}
{{ strip }}

    {{ if $is_org_class_course }}
        {{ include file="common/variable/courseStatus.html" scope=parent }}
        {{ include file="common/variable/scheduleAction.html" scope=parent }}
        {{ include file="common/center/orderDetail/orgCrumb.html" progress=$tpl_data.progress }}
    {{ else if !$is_video_course }}
        {{ include file="common/variable/courseStatus.html" scope=parent }}
        {{ include file="common/variable/scheduleAction.html" scope=parent }}
        {{ include file="common/center/orderDetail/crumb.html" tpl_data=$tpl_data.purchase is_class_course=$is_class_course is_x_class_course=$is_x_class_course is_x_one_course=$is_x_one_course is_org_class_course=$is_org_class_course }}

        {{ if $is_x_course && $tpl_data.is_suspend == 1 }}
            <div class="suspend">
                <i class="icon icon-info-circle text-primary"></i>
                您已经被机构停课，如有疑问请联系机构
            </div>
        {{ /if }}
    {{ else }}
        <h1>订单详情</h1>
    {{ /if }}

    {{ if $is_org_class_course }}
        {{ $org = $tpl_data.organization }}
    {{ else if $is_video_course && $tpl_data.purchase.teacher_user_id == 0 }}
        {{ $org = $tpl_data.organization_data }}
    {{ else }}
        {{ $org = $tpl_data.organization_data }}
    {{ /if }}

    {{ if $is_org_class_course || $is_x_course }}
        {{ include file="common/center/orderDetail/orgInfo.html" is_x_course=$is_x_course org=$org.organization }}
    {{ else if $is_video_course && $tpl_data.purchase.teacher_user_id == 0 }}
        {{ include file="common/center/orderDetail/orgInfo.html" is_video_course=$is_video_course org=$org.organization }}
    {{ else }}
        {{ include file="common/center/orderDetail/user.html" tpl_data=$tpl_data.user purchase=$tpl_data.purchase org=$org is_org_class_course=$is_org_class_course is_class_course=$is_class_course is_video_course=$is_video_course is_trial_course=$is_trial_course }}
    {{ /if }}

    {{ $lesson_count = 0 }}
    {{ if isset($tpl_data.lesson_count) }}
        {{ $lesson_count = $tpl_data.lesson_count }}
    {{ /if }}

    {{ if $is_org_class_course }}
        {{ include file="common/center/orderDetail/orgOrder.html" tpl_data=$tpl_data.purchase lesson_count=$lesson_count pay=$tpl_data.pay }}
    {{ else if $is_x_course }}
        {{ include file="common/center/orderDetail/xOrder.html" tpl_data=$tpl_data.purchase pay=$tpl_data.pay is_x_one_course=$is_x_one_course }}
    {{ else if $is_class_course && $user_data.user_type == 0 }}
        {{ * 老师班课订单单独拿出来后续订单也将走这套逻辑 后端统一处理订单操作 现在太乱 * }}
        {{ include file="common/center/orderDetail/tClassOrder.html" tpl_data=$tpl_data.purchase actions=$tpl_data.actions lesson_count=$lesson_count pay=$tpl_data.pay is_class_course=$is_class_course is_video_course=$is_video_course is_trial_course=$is_trial_course is_one2one_course=$is_one2one_course }}
    {{ else }}
        {{ include file="common/center/orderDetail/order.html" tpl_data=$tpl_data.purchase lesson_count=$lesson_count pay=$tpl_data.pay is_class_course=$is_class_course is_video_course=$is_video_course is_trial_course=$is_trial_course is_one2one_course=$is_one2one_course }}
    {{ /if }}

    {{ if isset($tpl_data.purchase.fenqi_data) && !empty($tpl_data.purchase.fenqi_data) }}
        {{ include file="common/center/orderDetail/stage.html" fenqi_data=$tpl_data.purchase.fenqi_data }}
    {{ /if }}

    {{ include file="common/center/orderDetail/pay.html" tpl_data=$tpl_data.pay purchase=$tpl_data.purchase }}

    {{ if $identity !== 'teacher'  && $tpl_data.purchase.status === 'refunded' && $tpl_data.purchase.refund_money }}
        {{ include file="common/center/orderDetail/refundInfo.html" tpl_data=$tpl_data.purchase }}
    {{ /if }}

    {{ if !$is_video_course && !$is_org_class_course }}
        {{ if $is_x_course }}
            {{ include file="common/center/orderDetail/xCourse.html" lesson_count=$tpl_data.lesson_count lessons=$tpl_data.lessons latest_lesson=$tpl_data.latest_lesson org=$tpl_data.organization_data is_class_course=$is_class_course teacher=$tpl_data.user ext_info=$tpl_data.purchase.ext_info }}

            {{ if $tpl_data.class_fire_record }}
                {{ include file="common/center/orderDetail/fireRecord.html" fire_record=$tpl_data.class_fire_record }}
            {{ /if }}
        {{ else }}
            {{ include file="common/center/orderDetail/course.html" lesson_count=$tpl_data.lesson_count lessons=$tpl_data.lessons latest_lesson=$tpl_data.latest_lesson org=$tpl_data.organization_data is_class_course=$is_class_course teacher=$tpl_data.user }}
        {{ /if }}

        {{ include file="common/center/orderDetail/comment.html" teacher_comment=$tpl_data.teacher_comment student_comment=$tpl_data.student_comment is_class_course=$is_class_course }}
    {{ /if }}

    {{ if isset($tpl_data.pay.fee_detail) }}
        {{ include file="common/center/orderDetail/otherFee.html" tpl_data=$tpl_data.pay }}
    {{ /if }}



    {{ include file="common/component/baiduMap.html" }}

{{ /strip }}
{{ /block }}

