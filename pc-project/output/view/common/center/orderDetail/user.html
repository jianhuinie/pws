{{ *

@file 用户信息
@author zhujialu

* }}
{{ strip }}

{{ include file="common/variable/lessonWayCode2Name.html" scope=parent }}

{{ function getUserItem user=null }}

<div class="user-item">

    {{ if !$is_teacher }}
        {{ $teacher_home = '/'|cat: $user.private_domain }}
    {{ /if }}

    {{ if isset($teacher_home) }}

        <a href="{{ $teacher_home }}" class="thumbnail" target="_blank">
            {{ include file="common/component/image.html" width=78 url=$user.avatar }}
        </a>

    {{ else }}
        <a href="/x/{{ $user.number }}" target="_blank">
            {{ include file="common/component/image.html" width=78 url=$user.avatar class="thumbnail" }}
        </a>
    {{ /if }}

    <div class="item">
        {{ if $is_teacher }}
        学生姓名
        {{ else }}
        授课老师
        {{ /if }}
        ：
        {{ $user.display_name }}

        {{ if $is_teacher }}
            {{ $user_type = 'student' }}
            {{ $chat_to_student = true }}
        {{ else }}
            {{ $user_type = 'teacher' }}
             {{ $chat_to_student = false }}
        {{ /if }}

        {{ if isset($user.organization) && $user.organization }}

            {{ $org_home = 'http://'|cat: $user.organization.domain|cat: '.genshuixue.com' }}

            {{ include file="common/component/orgLabel.html" name=$user.organization.name url=$org_home desc="" }}

        {{ /if }}

        {{ include file="common/component/chatLabel4.html" user_number=$user.number user_type=$user_type online_status=$user.im_online_status size="tiny" chat_to_student=$chat_to_student }}

        {{ if isset($purchase.qreserve_sign) && $purchase.qreserve_sign == 1 }}
            {{ $opened = 1 }}
        {{ else }}
            {{ $opened = 0 }}
        {{ /if }}

        {{ if $purchase.course_type == 1 }}
            {{ if $is_teacher }}

                {{ if $opened == 1 }}
                    <i class="icon icon-lightning-circle text-primary" data-title="{{ $user.display_name }}为你开启了闪电约课，你向该学生约课将被自动确认。{{ if !(isset($purchase.use_plat_ensure) && $purchase.use_plat_ensure == 0) }}课程结束后系统会自动支付课酬。{{ /if }}" data-width="20em"></i>
                {{ else }}
                    <i class="icon icon-lightning-o" data-title="闪电约课未开启。学生为你开启闪电约课后，你发起的约课会被系统自动确认。" data-width="21em"></i>
                {{ /if }}

            {{ else }}

                <span class="{{ if $opened == 1 }}opened{{ /if }} quick-lesson-box" data-user-num="{{ $user.number }}">

                    <label class="form-checkbox {{ if $opened }} checked {{ /if }}">
                        <input type="checkbox" name="quick-lesson" {{ if $opened }} checked="checked" {{ /if }} />

                        {{ if $opened == 1 }}
                            <i class="icon icon-lightning"></i>
                            <span>闪电约课已开启</span>
                        {{ else }}
                            <span class="closed">
                                <i class="icon icon-lightning"></i>
                                闪电约课
                            </span>
                        {{ /if }}

                        <i class="icon icon-question-circle" data-title="什么是闪电约课？<br />开启闪电约课后，该老师发起的约课以及时间修改系统将为你自动确认" data-width="19em"></i>
                    </label>

                </span>

            {{ /if }}
        {{ /if }}

    </div>

    {{ if $user.address }}
    <span class="item">
        所属地区：
        {{ if !$user.country }}
            {{ $user.address }}
        {{ else }} 
            {{ $user.country }}
        {{ /if }}
    </span>
    {{ /if }}

    {{ if !$is_video_course && !$is_trial_course }}

        {{ if !$is_teacher }}
            {{ if isset($org.organization.city_filter) && $org.organization.city_filter && isset($org.organization.extension) && $org.organization.extension }}
                <span class="four-hundred">
                    <i class="icon icon-big-phone-o"></i>
                    <span>{{ $org.organization.extension }}</span>
                </span>
            {{ else if isset($user.call_info) }}
                <span class="item mobile" data-number="{{ $user.number }}" data-name="{{ $user.display_name }}" data-role="{{ $user.im_info.user_role }}">
                    <i class="icon icon-call"></i>
                </span>
            {{ /if }}

        {{ else if isset($user.mobile) }}
            {{ if isset($org.organization.city_filter) && $org.organization.city_filter && isset($org.organization.extension) && $org.organization.extension }}
                <span class="four-hundred">
                    <i class="icon icon-big-phone-o"></i>
                    <span> {{ $org.organization.extension }} </span>
                </span>
            {{ else }}

                {{ if isset($user.has_mobile) && $user.has_mobile }}
                <span class="item">
                    &nbsp;联系电话： {{ $user.mobile }}
                </span>
                {{ /if }}

            {{ /if }}

        {{ /if }}
    {{ /if }}

    <div class="links">
        {{ if $is_teacher }}

        <a class="link" href="/comment/fromTeacherDetail?page_size=10&page=1&number={{ $user.number }}" target="_blank">
            查看TA的信用
        </a>

        {{ else }}
        <a class="link" href="{{ $teacher_home }}" target="_blank">
            查看TA的主页
        </a>

            {{ if !$is_org_class_course && !$is_class_course && !$is_trial_course }}
            <a class="link" href="/pay/course?teacher_number={{ $user.number }}&lesson_way={{ $lesson_way_code2name[$purchase.lesson_way] }}&course_id={{ $purchase.course_id }}" target="_blank">
                继续购买课程
            </a>
            {{ /if }}

        {{ /if }}
    </div>

</div>

{{ /function }}

<div class="user">

    {{ $is_teacher = $identity == 'teacher' }}

    <h2>
        <i class="icon icon-circle"></i>
        {{ if $is_teacher }}
            学生
        {{ else }}
            老师
        {{ /if }}
        信息
    </h2>

    <div class="content">
        {{ if $is_teacher || !$org }}
            {{ $user_list[] = $tpl_data }}
        {{ else }}
            {{ $user_list = $org.teacher_list }}
        {{ /if }}

        {{ $count = count($user_list) }}

        {{ foreach $user_list as $user }}

        {{ if $user@index < 3 }}

            {{ getUserItem user=$user }}

        {{ else }}

            {{ if $user@index == 3 }}
            <div class="wrapper">
            {{ /if }}

            {{ getUserItem user=$user }}


            {{ if $user@last }}

            </div>
            <div class="toggle btn-link btn-block">
                <i class="icon icon-angle-down"></i>展开
            </div>
            {{ /if }}

        {{ /if }}

        {{ /foreach }}

    </div>

</div>

{{ /strip }}