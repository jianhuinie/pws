{{ *

@file 照片等比缩放

      参数：
      url: 图片 url
      raw_width： 原始图宽度
      raw_height： 原始图高度
      width: 显示宽度
      height: 显示高度

@author jixiaohui

* }}
{{ strip }}

{{ $parts = explode('.', $url) }}
{{ $extname = array_pop($parts) }}

{{ if empty($raw_height) || $raw_height == 0 }}
    {{ $raw_height = 1 }}
{{ /if }}

{{ if empty($raw_width) || $raw_width == 0 }}
    {{ $raw_width = 1 }}
{{ /if }}

{{ if empty($height) || $height == 0 }}
    {{ $height = 1 }}
{{ /if }}

{{ if ($raw_width / $raw_height) >= ($width / $height) }}
    {{ if $raw_width > $width }}
        {{ $fit_width = $width }}
        {{ $fit_height = intval(($raw_height * $width)/$raw_width) }}
    {{ else }}
        {{ $fit_width = $raw_width }}
        {{ $fit_height = $raw_height }}
    {{ /if }}
{{ else }}
    {{ if $raw_height > $height }}
        {{ $fit_width = intval(($raw_width * $height)/$raw_height) }}
        {{ $fit_height = $height }}
    {{ else }}
        {{ $fit_width = $raw_width }}
        {{ $fit_height = $raw_height }}
    {{ /if }}
{{ /if }}

{{ $suffix[] = "@1e_" }}
{{ $suffix[] = $fit_width }}
{{ $suffix[] = "w_" }}
{{ $suffix[] = $fit_height }}
{{ $suffix[] = "h_1c_0i_1o_90Q_1x" }}
{{ $suffix[] = "." }}
{{ $suffix[] = $extname }}

{{ $suffix = implode("", $suffix) }}

{{ $photo = $url|cat: $suffix scope="parent" }}
{{ $fit_height = $fit_height scope="parent" }}

{{ /strip }}