{{ *
    @file 全站 pager 组件
    @description 参数
                 show_count 总共要显示的页码个数
                 count 物料总数
                 page_size 每页的个数
                 page  当前的页码
                 url   需要附加page参数的url
                 hide_jump 是否隐藏输入页码跳转
                 text 页码跳转的文案
                 fix 页码后面的值

    @author  liucong
* }}
{{ strip }}

{{ if not isset($url) }}
    {{ $url = $smarty.server.REQUEST_URI }}
{{ /if }}

{{ * 默认当前页为1 * }}
{{ if not isset($page) }}
    {{ $page = 1 }}
{{ /if }}

{{ if not isset($page_size) }}
    {{ $page_size = 10 }}
{{ /if }}

{{ if not isset($count) }}
    {{ $count = 1 }}
{{ /if }}

{{ $page_count = ($count / $page_size)|ceil }}

{{ if not isset($show_count) }}
    {{ $show_count = 4 }}
{{ /if }}

{{ * 让当前页码前后都有show_count/2个页码 * }}
{{ if $show_count % 2 == 1 }}
{{ $show_count = $show_count - 1 }}
{{ /if }}


{{ if $page_count > 1 }}
<div class="pager-block">

    <div class="pager">

        {{ if $page > 1 }}
            {{ if !empty($fix) }}
                <a href="{{ $url }}/p{{ $page-1 }}{{ $fix }}" data-page="{{ $page-1 }}">
                    <i class="icon icon-chevron-left"></i> 上一页
                </a>
            {{ else }}
                <a href="{{ $url }}/p{{ $page-1 }}/" data-page="{{ $page-1 }}">
                    <i class="icon icon-chevron-left"></i> 上一页
                </a>
            {{ /if }}
        {{ else if $page == 1 }}
            {{ if !empty($fix) }}
                <a href="{{ $url }}{{ $fix }}" data-page="{{ $page-1 }}">
                    <i class="icon icon-chevron-left"></i> 上一页
                </a>
            {{ else }}
                <a href="{{ $url }}" data-page="{{ $page-1 }}">
                    <i class="icon icon-chevron-left"></i> 上一页
                </a>
            {{ /if }}
        {{ /if }}

        {{ if $page_count <= $show_count + 1 }}
            {{ $start = 1 }}
            {{ $end = $page_count }}
        {{ elseif $page_count <= $page + $show_count  }}
            {{ $end = $page_count }}
            {{ $start = $page_count - $show_count }}
        {{ elseif $page <= ($show_count/2) }}
            {{ $start = 1 }}
            {{ $end = 1 + $show_count }}
        {{ else }}
            {{ $start = $page - $show_count/2  }}
            {{ $end = $page + $show_count/2 }}
        {{ /if }}

        {{ if $start > 2 }}
            {{ if !empty($fix) }}
                <a href="{{ $url }}{{ $fix }}" data-page="1">1</a>
            {{ else }}
                <a href="{{ $url }}" data-page="1">1</a>
            {{ /if }}
        <b class="ellipsis">...</b>
        {{ /if }}

        {{ for $item=$start to $end }}

        {{ $replace_to = "page="|cat:$item }}

        {{ if $item != $page }}
            {{ if !empty($fix) }}
                <a href="{{ $url }}/p{{ $item }}{{ $fix }}" data-page="{{ $item }}">{{ $item }}</a>
            {{ else }}
                <a href="{{ $url }}/p{{ $item }}/" data-page="{{ $item }}">{{ $item }}</a>
            {{ /if }}
        {{ else }}
        <a class="active">{{ $item }}</a>
        {{ /if }}
        {{ /for }}

        {{ if $end < $page_count }}
        <b class="ellipsis">...</b>
        {{ if !empty($fix) }}
            <a href="{{ $url }}/p{{ $page_count }}{{ $fix }}" data-page="{{ $page_count }}">{{ $page_count }}</a>
        {{ else }}
            <a href="{{ $url }}/p{{ $page_count }}/" data-page="{{ $page_count }}">{{ $page_count }}</a>
        {{ /if }}
        {{ /if }}

        {{ if $page < $page_count }}
        {{ if !empty($fix) }}
            <a href="{{ $url }}/p{{ $page+1 }}{{ $fix }}" data-page="{{ $page+1 }}">
                下一页 <i class="icon icon-chevron-right"></i>
            </a>
        {{ else }}
            <a href="{{ $url }}/p{{ $page+1 }}/" data-page="{{ $page+1 }}">
                下一页 <i class="icon icon-chevron-right"></i>
            </a>
        {{ /if }}
        {{ /if }}

    </div>

    {{ if !isset($hide_jump) || !$hide_jump }}
    <div class="pager-form">
        {{ if isset($text) }}
            <b>{{ $text }}</b>
        {{ else }}
            <b>共 {{ $page_count }} 页，去第</b>
        {{ /if }}
        {{ if !empty($fix) }}
            <input class="form-text small" type="text" onchange="
                var button = this.nextSibling.nextSibling;
                var page = this.value;

                button.href = 'javascript:void(0);';
                button.removeAttribute('data-page');

                if (/^\d+$/.test(page) && parseInt(page, 10) >= 1 && parseInt(page, 10) <= {{ $page_count }}) {
                    button.href = '{{ $url }}/p'+ page + '{{ $fix }}';
                    button.setAttribute('data-page', page);
                }
                else {
                    this.select();
                }
            "/>
        {{ else }}
            <input class="form-text small" type="text" onchange="
                var button = this.nextSibling.nextSibling;
                var page = this.value;

                button.href = 'javascript:void(0);';
                button.removeAttribute('data-page');

                if (/^\d+$/.test(page) && parseInt(page, 10) >= 1 && parseInt(page, 10) <= {{ $page_count }}) {
                    button.href = '{{ $url }}/p'+ page +'/';
                    button.setAttribute('data-page', page);
                }
                else {
                    this.select();
                }
            "/>
        {{ /if }}
        <b>页</b>

        <a class="btn-default small">确定</a>

    </div>
    {{ /if }}
</div>
{{ /if }}

{{ /strip }}