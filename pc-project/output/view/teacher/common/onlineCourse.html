{{ *

@file 非老师详情页 - 课程页面 - 课程列表 - 直播课 2017.1.11
@author wangyujie

* }}

{{ if isset($online_course.course) && count($online_course.course) }}
    <div class="online-box static-online-course-box list">
        {{ if $profile.online_count > 3 }}
            <a class="more-box">查看全部></a>
        {{ /if }}
        <ul class="online-course">
            {{ foreach $online_course.course as $val }}
                <li class="item" {{ if $val@last }}style="border-bottom:none;padding-bottom:0;"{{ /if }}>
                    <a href="/teacher/classCourseDetail/{{ $val.number }}" target="_blank">
                        <img src="{{ $val.cover_url }}@1e_180w_100h_1c_0i_1o_90Q_1x" alt="{{ $val.name }}-{{ $profile.name }}">
                    </a>
                    <div class="info">
                        {{ if !empty($val.discount) }}
                            {{ $course_name = $val.name|cn_truncate:13 }}
                        {{ else }}
                            {{ $course_name = $val.name }}
                        {{ /if }}
                        <div class="new-title">
                            <a class="title" href="/teacher/classCourseDetail/{{ $val.number }}" target="_blank" {{ if $course_name != $val.name }}data-title="{{ $val.name }}"{{ /if }}>
                                {{ $course_name }}
                            </a>
                            {{ if $val.fenqi }}
                                <span class="fenqi_tag"> {{ $val.fenqi.tag_name }}</span>
                            {{ /if }}
                        </div>
                        <ul class="course-info">
                            <li>
                                课程长度：
                                {{ $course_length = $val.course_len/3600 }}
                                {{ if $course_length == abs(floor($course_length)) }}
                                    {{ $course_length }}小时
                                {{ else }}
                                    {{ abs(($val.course_len/3600))|number_format: 1 }}小时
                                {{ /if }}
                            </li>
                            <li>
                                班级人数：{{ $val.max_student }}人
                            </li>
                            <li>
                                课程安排：
                                {{ $arrange = $val.arrangement|cn_truncate:12 }}
                                <span {{ if $arrange != $val.arrangement }} data-title="{{ $val.arrangement }}" data-width="20em"{{ /if }}>
                                    {{ $arrange }}
                                </span>
                            </li>
                            <li>
                                上课方式：
                                {{ if $val.lesson_way == 4 }}
                                    线下授课
                                    <div class="address">
                                        上课地点：
                                        {{ $address = '' }}
                                        {{ if isset($val.address_area) }}
                                            {{ $area = $val.address_area }}
                                            {{ if isset($area.province)&&$area.province }}
                                                {{ $address = $address|cat:$area.province.name }}
                                            {{ /if }}
                                            {{ if isset($area.city)&&$area.city }}
                                                {{ if !(!empty($area.province) && $area.province.name == $area.city.name)  }}
                                                    {{ $address = $address|cat:$area.city.name }}
                                                {{ /if }}
                                            {{ /if }}
                                            {{ if isset($area.area)&&$area.area }}
                                                {{ $address = $address|cat:$area.area.name }}
                                            {{ /if }}
                                            {{ if isset($area.country)&&$area.country }}
                                                {{ $address = $address|cat:$area.country.name }}
                                            {{ /if }}
                                            {{ if isset($area.location_addr)&&$area.location_addr }}
                                                {{ $address = $address|cat:$area.location_addr }}
                                            {{ /if }}
                                        {{ /if }}
                                        <span>{{ $address|escape }}</span>
                                        {{ if isset($val.offline_poi) && $val.offline_poi.lng }}
                                            <a class="detail map" data-offline='{{ json_encode($val.offline_poi, 77) }}' data-map="{{ $address|escape }}">
                                                查看地图位置
                                            </a>
                                        {{ /if }}
                                    </div>
                                {{ else if $val.lesson_way == 2 }}
                                    在线授课
                                    {{ if $val.class_type == 1 }}
                                        （支持手机观看）
                                    {{ else }}
                                        （支持手机APP观看）
                                    {{ /if }}
                                {{ /if }}
                            </li>
                        </ul>
                        {{ ** 限时折扣逻辑 ** }}
                        {{ $show_price_tip = false }}

                        {{ if !empty($val.discount) && $val.discount }}
                            {{ if $val.discount.type == 1 }}
                                {{ * 限额折扣 活动中提醒 * }}
                                {{ $show_zhekou = true }}
                                <div class="price-tip-box">
                                    <div class="price-tip price-tip-end">
                                        <span class="name">
                                            限额折扣
                                        </span>
                                        剩余 {{ $val.discount.remain_amount }} 个优惠名额
                                    </div>

                                    <span class="price">
                                        <i>课程总价：</i>￥{{ $val.discount.pre_price }}
                                    </span>

                                    <span class="rob-price">
                                        抢购价：￥{{ $val.discount.discount_price }}
                                    </span>
                                </div>
                            {{ else if $val.discount.type == 2 }}
                                {{ **获取当前时间** }}
                                {{ $cur_time = $smarty.now }}
                                {{ $start_time = strtotime($val.discount.start_time) }}
                                {{ $end_time = strtotime($val.discount.end_time) }}

                                {{ ** 距离活动开始一天内 ** }}
                                {{ if ($start_time - $cur_time) < (24*60*60) &&
                                ($start_time - $cur_time > 0) }}
                                    {{ $show_price_tip = true }}
                                    <div class="price-tip-box">
                                        <div class="price-tip price-tip-begin" data-cur="{{ $cur_time }}" data-start="{{ $start_time }}">
                                            <span class="name">
                                                限时折扣
                                            </span>
                                            距抢购开始
                                            <span class="time">
                                                {{ include file='common/component/countDown.html' time=($start_time - $cur_time) }}
                                            </span>
                                        </div>

                                        <span class="price">
                                            <i>课程总价：</i>￥{{ $val.discount.pre_price }}
                                        </span>

                                        <span class="rob-price">
                                            抢购价：￥{{ $val.discount.discount_price }}
                                        </span>
                                    </div>
                                {{ ** 距离活动结束时间内 ** }}
                                {{ else if ($start_time < $cur_time) && ($cur_time < $end_time) }}
                                    {{ $show_price_tip = true }}
                                    <div class="price-tip-box">
                                        <div class="price-tip price-tip-end" data-cur="{{ $cur_time }}" data-end="{{ $end_time }}">
                                            <span class="name">
                                                限时折扣
                                            </span>
                                            距抢购结束
                                            <span class="time">
                                                {{ include file='common/component/countDown.html' time=($end_time - $cur_time) }}
                                            </span>
                                        </div>

                                        <span class="price">
                                            <i>课程总价：</i>￥{{ $val.discount.discount_price }}
                                        </span>

                                        <span class="original-price">
                                            ￥{{ $val.discount.pre_price }}
                                        </span>
                                    </div>
                                {{ /if }}
                            {{ /if }}
                        {{ /if }}

                        <div class="button-box" data-coursenum="{{ $val.number }}">

                            {{ ** 非限时折扣执行原来逻辑 ** }}
                            {{ * if empty($val.discount) || !$show_price_tip * }}
                                <!--div class="price">
                                    课程总价：<span>￥{{ $val.price }}</span>
                                </div-->
                            {{ * else * }}
                                <!--div class="price" style="height:36px;"></div-->
                            {{ * /if * }}

                            {{ $display_status = $val.display_status }}
                            {{ **如果审核未通过则状态置为暂停招生** }}
                            {{ if $val.verify_status == 2 }}
                                {{ $display_status = 3 }}
                            {{ /if }}

                            {{ if $display_status == 2 }}
                                {{ if $val.max_student <= $val.total_pay }}
                                    <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                        还有机会，其中<i>{{ $val.total_pay-$val.succ_pay }}</i>人待付款
                                    </a>
                                {{ else }}
                                    <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-primary reserve-course {{ if !$profile.can_order }}disabled-order{{ /if }}" data-coursenum="{{ $val.number }}" {{ if !$profile.can_order }}disabled{{ /if }}>
                                        还剩{{ $val.max_student - $val.total_pay }}个名额&nbsp;&nbsp;|&nbsp;&nbsp;立即报名
                                    </a>
                                {{ /if }}
                            {{ else if $display_status == 3 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    暂停招生
                                </a>
                            {{ else if $display_status == 4 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    满班&nbsp;&nbsp;|&nbsp;&nbsp;可以联系老师增加名额
                                </a>
                            {{ else if $display_status == 5 }}
                                {{ **加入插班判断** }}
                                {{ if $val.can_chaban }}
                                    {{ if $val.is_full }}
                                        <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                            课程已开始，可联系老师增加名额插班
                                        </a>
                                    {{ else if $show_price_tip }}
                                        <a target="_blank" href="{{ $course_url }}" class="btn btn-primary reserve-course {{ if !$profile.can_order }}disabled-order{{ /if }}" data-coursenum="{{ $val.number }}" {{ if !$profile.can_order }}disabled{{ /if }}>
                                            还剩{{ $val.max_student - $val.total_pay }}个名额&nbsp;&nbsp;|&nbsp;&nbsp;立即报名
                                        </a>
                                    {{ else }}
                                        <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-primary reserve-course {{ if !$profile.can_order }}disabled-order{{ /if }}" data-coursenum="{{ $val.number }}" {{ if !$profile.can_order }}disabled{{ /if }}>
                                            插班价￥{{ $val.realtime_price }}&nbsp;&nbsp;|&nbsp;&nbsp;立即报名
                                        </a>
                                    {{ /if }}
                                {{ else }}
                                    <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                        进行中
                                    </a>
                                {{ /if }}
                            {{ else if $display_status == 6 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    已完成
                                </a>
                            {{ else if $display_status == 8 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    审核中
                                </a>
                            {{ else if $display_status == 12 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    已失效
                                </a>
                            {{ else if $display_status == 13 }}
                                <a target="_blank" href="/teacher/classCourseDetail/{{ $val.number }}" class="btn btn-default">
                                    已完成
                                </a>
                            {{ /if }}
                        </div>
                    </div>
                </li>
            {{ /foreach }}
        </ul>

        {{ if empty($tpl_data.online.sort_by) }}
            {{ $fix = 'update_time' }}
        {{ else }}
            {{ $fix = $tpl_data.online.sort_by }}
        {{ /if }}

        {{ include file="teacher/newDetail/pager.html" page=$tpl_data.pager.current_page count=$tpl_data.pager.total }}
    </div>
{{ /if }}