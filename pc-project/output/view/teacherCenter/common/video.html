{{ $course_url = '/video_course/getcourseshowdetail?number='|cat:$val.number }}
{{ $profile = $tpl_data.profile }}

<div class="course-item">
    <a class="course-link" href="{{ $course_url }}" target="_blank">
        {{ include file="common/variable/photo.html" url=$val.portrait raw_width=300 raw_height=200 width=200 height=112 }}
        <img src="{{ $photo }}" alt="{{ $val.title }}-{{ $profile.name }}">
        {{ if !empty($val.discount) && $val.discount }}
            <span class="icon icon_zhekou">
                {{ if $val.discount.type == 1 }}
                    限额折扣
                {{ else if $val.discount.type == 2 }}
                    限时折扣
                {{ /if }}
            </span>
        {{ /if }}
    </a>

    <ul class="course-item-info">
        {{ $course_name = $val.name|cn_truncate:20 }}
        <li class="course-title">
            <a class="title" href="{{ $course_url }}" target="_blank" {{ if $course_name != $val.name }}data-title="{{ $val.name }}"{{ /if }}>
                <span class="course-lesson-way">视频课</span>
                {{ $course_name }}
            </a>
            {{ if $val.fenqi }}
                <span class="fenqi_tag">{{ $val.fenqi.tag_name }}</span>
            {{ /if }}
        </li>

        <li class="course-time">
        {{ if $val.expire_hours == 0 }}
            随时看
        {{ else }}
            {{ $day = $val.expire_hours/24 }}
            {{ $day }}天随时看
        {{ /if }}
        </li>

        {{ * $course_length = $val.course_len/3600 * }}
        <li class="course-time">
            共{{ $val.course_items_count }}课节
        </li>
        <li class="course-time">

            {{ if $val.price == 0 || $val.price == "0.00" }}
                {{ $val.payer_count }} 人学习
            {{ else }}
                {{ if $val.payer_count != 0 }}
                    {{ $val.payer_count }} 人购买
                {{ else }}
                    暂无人购买
                {{ /if }}
            {{ /if }}
        </li>
    </ul>

    {{ $show_zhekou = false }}
    {{ if !empty($val.discount) && $val.discount }}

        {{ if $val.discount.type == 1 }}
            {{ * 限额折扣 活动中提醒 * }}
            {{ $show_zhekou = true }}
            {{ $remain_amount = $val.discount.remain_amount }}
            {{ $class = "price-tip-end" }}
            {{ $price = $val.discount.discount_price }}
            {{ $price_no = $val.discount.pre_price }}
        {{ else if $val.discount.type == 2 }}
            {{ $cur_time = $smarty.now }}
            {{ $start_time = strtotime($val.discount.start_time) }}
            {{ $end_time = strtotime($val.discount.end_time) }}
            {{ if ($start_time - $cur_time) < (24*60*60) && ($start_time - $cur_time > 0) }}
                {{ * 活动开始前提醒 * }}
                {{ $show_zhekou = true }}
                {{ $time = ($start_time - $cur_time) }}
                {{ $class = "price-tip-begin" }}
                {{ $price = $val.discount.pre_price }}
                {{ $price_no = $val.discount.discount_price }}
            {{ else if ($start_time < $cur_time) && ($cur_time < $end_time) }}
                {{ * 活动中提醒 * }}
                {{ $show_zhekou = true }}
                {{ $time = ($end_time - $cur_time) }}
                {{ $class = "price-tip-end" }}
                {{ $price = $val.discount.discount_price }}
                {{ $price_no = $val.discount.pre_price }}
            {{ /if }}
        {{ /if }}
    {{ /if }}

    <div class="course-price">
        {{ if $val.price == 0 || $val.price == "0.00" }}
            <span class="price free">免费</span>
        {{ else }}
            {{ if $show_zhekou && $val.discount.type == 1 }}
                <span class="price">
                    ￥{{ $price }}
                </span>
                <span class="not-price">
                    ￥{{ $price_no }}
                </span>
            {{ else if $show_zhekou && $val.discount.type == 2 && !empty($time) }}
                {{ if $class == "price-tip-begin" }}
                    <span class="price">￥{{ $price }}</span>

                    <span class="cheap-price">
                        抢购价:￥{{ $price_no }}
                    </span>
                {{ else if $class == "price-tip-end" }}
                    <span class="price">￥{{ $price }}</span>

                    <span class="not-price">
                        ￥{{ $price_no }}
                    </span>
                {{ else }}
                    <span class="price">￥{{ $price }}</span>
                    {{ if !empty($price_no) }}
                        <span class="not-price">￥{{ $price_no }}</span>
                    {{ /if }}
                {{ /if }}
            {{ else }}
                <span class="price">￥{{ $val.price }}</span>
            {{ /if }}

        {{ /if }}
    </div>

    <div class="course-button">
        {{ if $val.price == 0 }}
            <a target="_blank" href="{{ $course_url }}" class="btn btn-default btn-success">
                开始学习
            </a>
        {{ else }}
            {{ if $val.discount.type == 1 && $show_zhekou }}
                <span class="limit-discount {{ $class }}">
                    限额折扣：剩余
                    <em class="text-error">{{ $remain_amount }}</em>
                    个优惠名额
                </span>
            {{ else if $val.discount.type == 2 && $show_zhekou && !empty($time) }}
                <span class="limit-discount {{ $class }}" data-cur="{{ $cur_time }}" data-start="{{ $start_time }}" data-end="{{ $end_time }}">
                    {{ if $class == "price-tip-begin" }}
                        距抢购开始:
                    {{ else if $class == "price-tip-end" }}
                        距抢购结束:
                    {{ /if }}
                    <span class="time">
                        {{ include file='common/component/countDown.html' time=$time }}
                    </span>
                </span>
            {{ /if }}

            {{ if $val.section_id }}
                <a target="_blank" href="{{ $course_url }}" class="btn btn-default try-listen">开始试听</a>
            {{ /if }}

            <a target="_blank" href="{{ $course_url }}" class="btn btn-default btn-primary {{ if !$profile.can_order }}disabled-order{{ /if }}" {{ if !$profile.can_order }}disabled{{ /if }}>
                立即购买
            </a>
        {{ /if }}
    </div>

</div>